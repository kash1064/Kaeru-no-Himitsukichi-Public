<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e71379dda153709d1a9a.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.625rem;margin:.3125rem 0;border:1px solid #999;border-radius:.3125rem}.Sidebar-module--search-container--17C6F{position:relative}.Sidebar-module--search-container-input--27Tw4{width:100%}.Sidebar-module--search-container-submit--WwtLg{position:absolute;width:2.375rem;height:2.375rem;top:calc(50% - 19px);right:0;border:3px solid #999;border-radius:0 .25rem .25rem 0;background:#999}.Sidebar-module--search-container-submit--WwtLg:before{position:absolute;content:"";width:.9375rem;height:.9375rem;top:calc(50% - 9px);left:calc(50% - 9px);border-radius:50%;box-shadow:0 0 0 2px #fff}.Sidebar-module--search-container-submit--WwtLg:after{position:absolute;content:"";width:.5rem;height:.375rem;top:calc(50% + 6px);left:calc(50% + 2px);border-top:2px solid #fff;transform:rotate(45deg)}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">CTF で学ぶ ClamAV シグネチャの作成と解析 - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content="SECCON 2022 の Devil Hunter という問題をテーマに ClamAV のシグネチャの記法や解析方法についてまとめました。"/><meta data-react-helmet="true" property="og:site_name" content="CTF で学ぶ ClamAV シグネチャの作成と解析 - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/db944af72e92649853a357aaef5a7500/clamav-signature-basic.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="CTF で学ぶ ClamAV シグネチャの作成と解析 - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content="SECCON 2022 の Devil Hunter という問題をテーマに ClamAV のシグネチャの記法や解析方法についてまとめました。"/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/db944af72e92649853a357aaef5a7500/clamav-signature-basic.png"/><link as="script" rel="preload" href="/webpack-runtime-a3c0f166cb4b802ff58f.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-206f62bbc9a23b5258ed.js"/><link as="script" rel="preload" href="/app-5379d71873e8730fc841.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/clamav-signature-basic/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">CTF で学ぶ ClamAV シグネチャの作成と解析</h1><div class="Content-module--content__body--2TrQ-"><p>今回は SECCON 2022 の Devil Hunter という問題をテーマに ClamAV のシグネチャの記法や解析方法についてまとめました。</p>
<p>参考：<a href="https://github.com/SECCON/SECCON2022_online_CTF/tree/main/reversing/devil_hunter" target="_blank" rel="nofollow noopener noreferrer">SECCON2022<em>online</em>CTF/reversing/devil<em>hunter at main · SECCON/SECCON2022</em>online_CTF</a></p>
<p>参考：<a href="/clamav-note01">ClamAV をソースコードからビルドして OnAccessScan をセットアップするまでのまとめ</a></p>
<!-- omit in toc -->
<h2 id="もくじ" style="position:relative;"><a href="#%E3%82%82%E3%81%8F%E3%81%98" aria-label="もくじ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>もくじ</h2>
<ul>
<li><a href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E6%A6%82%E8%A6%81devil-hunterrev">問題の概要：Devil Hunter(Rev)</a></li>
<li><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E5%BD%A2%E5%BC%8F%E3%81%AE%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3cdvcld">データベース形式のシグネチャ(CDV、CLD)</a></li>
<li>
<p><a href="#body-based-%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3">Body-based シグネチャ</a></p>
<ul>
<li><a href="#%E6%8B%A1%E5%BC%B5%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3extended-signatures">拡張シグネチャ(Extended signatures)</a></li>
<li><a href="#%E8%AB%96%E7%90%86%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3logical-signatures">論理シグネチャ(Logical signatures)</a></li>
<li><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3container-metadata-signatures">コンテナメタデータシグネチャ(Container Metadata Signatures)</a></li>
<li><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3bytecode-signatures">バイトコードシグネチャ(Bytecode Signatures)</a></li>
<li><a href="#%E3%83%95%E3%82%A3%E3%83%83%E3%82%B7%E3%83%B3%E3%82%B0%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3phishing-url-signatures">フィッシングシグネチャ(Phishing URL Signatures)</a></li>
</ul>
</li>
<li>
<p><a href="#hash-based-%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3">Hash-based シグネチャ</a></p>
<ul>
<li><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3file-hash-signatures">ファイルハッシュシグネチャ(File hash signatures)</a></li>
<li><a href="#pe-%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3pe-section-hash-signatures">PE セクションハッシュシグネチャ(PE section hash signatures)</a></li>
</ul>
</li>
<li><a href="#yara-%E3%83%AB%E3%83%BC%E3%83%AB%E5%BD%A2%E5%BC%8F">YARA ルール形式</a></li>
<li><a href="#%E8%A8%B1%E5%8F%AF%E3%83%AB%E3%83%BC%E3%83%AB%E3%81%AE%E6%A7%8B%E6%88%90">許可ルールの構成</a></li>
<li><a href="#sigtool-%E3%81%AE%E5%88%A9%E7%94%A8%E4%BE%8B">sigtool の利用例</a></li>
<li>
<p><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3bytecode-signatures%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB">バイトコードシグネチャ(Bytecode Signatures)のチュートリアル</a></p>
<ul>
<li><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%81%AE%E6%BA%96%E5%82%99">バイトコードコンパイラの準備</a></li>
<li><a href="#logical-signature-bytecodesalgorithmic-detection-bytecodes">Logical signature bytecodes(Algorithmic detection bytecodes)</a></li>
<li><a href="#%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%90%8D%E3%81%A8%E3%82%BF%E3%83%BC%E3%82%B2%E3%83%83%E3%83%88%E3%81%AE%E6%8C%87%E5%AE%9A">マルウェア名とターゲットの指定</a></li>
<li><a href="#flevel-%E3%81%AE%E6%8C%87%E5%AE%9A">FLEVEL の指定</a></li>
<li><a href="#declarations-%E3%81%A8-definitions">Declarations と Definitions</a></li>
<li><a href="#logical-signature-%E9%96%A2%E6%95%B0%E3%81%AE%E5%AE%9A%E7%BE%A9">Logical signature 関数の定義</a></li>
<li><a href="#%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E5%AE%9A%E7%BE%A9">シグネチャの定義</a></li>
<li><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%A8%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">バイトコードシグネチャのコンパイルとスキャン</a></li>
</ul>
</li>
<li>
<p><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E6%B4%BB%E7%94%A8">バイトコードシグネチャの活用</a></p>
<ul>
<li><a href="#file-properties-collection-%E5%88%86%E6%9E%90%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">File Properties Collection 分析を使用する</a></li>
<li><a href="#%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE%E3%81%AE%E5%88%A9%E7%94%A8">正規表現の利用</a></li>
</ul>
</li>
<li>
<p><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B">バイトコードシグネチャを解析する</a></p>
<ul>
<li><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E6%A6%82%E8%A6%81%E6%83%85%E5%A0%B1%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B">バイトコードシグネチャの概要情報を表示する</a></li>
<li><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B">バイトコードシグネチャのソースコードを参照する</a></li>
<li><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%82%92%E9%80%86%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AB%E3%81%99%E3%82%8B">バイトコードシグネチャを逆アセンブルする</a></li>
<li><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0">バイトコードシグネチャのデバッグ</a></li>
<li><a href="#libclamav-%E3%81%A7%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B">libclamav でバイトコードシグネチャのデバッグトレースを有効化する</a></li>
</ul>
</li>
<li>
<p><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%97%E3%81%A6-devil-hunter-%E3%82%92%E8%A7%A3%E3%81%8F">バイトコードシグネチャを解析して Devil Hunter を解く</a></p>
<ul>
<li><a href="#cbc-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B">cbc ファイルの情報を調べる</a></li>
<li><a href="#func2-%E3%81%AE%E8%AA%BF%E6%9F%BB">Func2 の調査</a></li>
<li><a href="#func1-%E3%81%AE%E8%AA%BF%E6%9F%BB">Func1 の調査</a></li>
<li><a href="#solver-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%81%A6-flag-%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B">Solver を作成して Flag を特定する</a></li>
</ul>
</li>
<li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li>
</ul>
<h2 id="問題の概要devil-hunterrev" style="position:relative;"><a href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E6%A6%82%E8%A6%81devil-hunterrev" aria-label="問題の概要devil hunterrev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>問題の概要：Devil Hunter(Rev)</h2>
<blockquote>
<p>Clam Devil; Asari no Akuma</p>
</blockquote>
<p>問題バイナリとして flag.cbc と check.sh が与えられます。</p>
<p>check.sh は、以下のように clamscan と flag.cbc を使用してスキャンを行った際に検出されるテキストが Flag になることがわかります。</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">#!/bin/sh
if [ -z &quot;$1&quot; ]
then
    echo &quot;[+] ${0} &lt;flag.txt&gt;&quot;
    exit 1
else
    clamscan --bytecode-unsigned=yes --quiet -dflag.cbc &quot;$1&quot;
    if [ $? -eq 1 ]
    then
        echo &quot;Correct!&quot;
    else
        echo &quot;Wrong...&quot;
    fi
fi</code></pre></div>
<p>flag.cbc は以下のテキストでした。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">ClamBCafhaio<span class="token variable"><span class="token variable">`</span>lfcf<span class="token operator">|</span>aa<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span>c<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>a<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token operator">|</span>ah<span class="token variable">`</span></span>cnbac<span class="token variable"><span class="token variable">`</span>cecnb<span class="token variable">`</span></span>c`<span class="token variable"><span class="token variable">`</span>beaacp<span class="token variable">`</span></span>clamcoincidencejb:4096
Seccon.Reversing.<span class="token punctuation">{</span>FLAG<span class="token punctuation">}</span><span class="token punctuation">;</span>Engine:56-255,Target:0<span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token number">0</span>:534543434f4e7b
Teddaaahdabahdacahdadahdaeahdafahdagahebdeebaddbdbahebndebceaacb<span class="token variable"><span class="token variable">`</span>bbadb<span class="token variable">`</span></span>baacb<span class="token variable"><span class="token variable">`</span>bb<span class="token variable">`</span></span>bb<span class="token variable"><span class="token variable">`</span>bdaib<span class="token variable">`</span></span>bdbfaah
Eaeacabbae<span class="token operator">|</span>aebgefafdf`<span class="token variable"><span class="token variable">`</span>adbbe<span class="token operator">|</span>aecgefefkf<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>aebae<span class="token operator">|</span>amcgefdgfgifbgegcgnfafmfef<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>
G<span class="token variable">`</span></span>ad<span class="token variable"><span class="token variable">`</span>@<span class="token variable">`</span></span>bdeBceBefBcfBcfBofBnfBnbBbeBefBfgBefBbgBcgBifBnfBgfBnbBfdBldBadBgd@<span class="token variable"><span class="token variable">`</span>bad@Aa<span class="token variable">`</span></span>bad@Aa<span class="token variable"><span class="token variable">`</span>
A<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bLabaa<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>Faeac
Baa`<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>abTaa<span class="token variable"><span class="token variable">`</span>aaab
Bb<span class="token variable">`</span></span>baaabbaeAc<span class="token variable"><span class="token variable">`</span>BeadTbaab
BTcab<span class="token variable">`</span></span>b@dE
A<span class="token variable"><span class="token variable">`</span>aaLbhfb<span class="token variable">`</span></span>dab<span class="token variable"><span class="token variable">`</span>dab<span class="token variable">`</span></span>daahabndabad<span class="token variable"><span class="token variable">`</span>bndabad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>ah<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>Fbcgah
Bbadaedbbodad@dbadagdbbodaf@db<span class="token variable"><span class="token variable">`</span>bahabbadAgd@db<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bb@habTbaab
Baaaiiab<span class="token variable">`</span></span>dbbaBdbhb<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>bbbbaabTaaaiabac
Bb<span class="token variable"><span class="token variable">`</span>dajbbabajb<span class="token variable">`</span></span>dakh<span class="token variable"><span class="token variable">`</span>ajB<span class="token variable">`</span></span>bhb<span class="token variable"><span class="token variable">`</span>dalj<span class="token variable">`</span></span>akB<span class="token variable"><span class="token variable">`</span>bhb<span class="token variable">`</span></span>bamn<span class="token variable"><span class="token variable">`</span>albadandbbodad@dbadaocbbadanamb<span class="token variable">`</span></span>bb<span class="token variable"><span class="token variable">`</span>aabbabaoAadaabaanab<span class="token variable">`</span></span>bb<span class="token variable"><span class="token variable">`</span>aAadb<span class="token variable">`</span></span>dbbaa<span class="token variable"><span class="token variable">`</span>ajAahb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bb@h<span class="token variable">`</span></span>Taabaaagaa
Bb<span class="token variable"><span class="token variable">`</span>bbcaabbabacAadaabdakab<span class="token variable">`</span></span>bbca@dahbeabbacbeaaabfaeaahbeaBmgaaabgak<span class="token variable"><span class="token variable">`</span>bdabfab<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bb@h<span class="token variable">`</span></span>Taabgaadag
Bb<span class="token variable"><span class="token variable">`</span>bbhaabbabacAadaabiakab<span class="token variable">`</span></span>bbha@db<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>bb@haab<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>bb@h<span class="token variable"><span class="token variable">`</span>Taabiaagae
Bb<span class="token variable">`</span></span>dbjabbaabjab<span class="token variable"><span class="token variable">`</span>dbkah<span class="token variable">`</span></span>bjaB<span class="token variable"><span class="token variable">`</span>bhb<span class="token variable">`</span></span>dblaj<span class="token variable"><span class="token variable">`</span>bkaB<span class="token variable">`</span></span>bhb<span class="token variable"><span class="token variable">`</span>bbman<span class="token variable">`</span></span>blabadbnadbbodad@dbadboacbbadbnabmab<span class="token variable"><span class="token variable">`</span>bb<span class="token variable">`</span></span>bgbboab<span class="token variable"><span class="token variable">`</span>bbab<span class="token variable">`</span></span>baacb<span class="token variable"><span class="token variable">`</span>bb<span class="token variable">`</span></span>dbbbh<span class="token variable"><span class="token variable">`</span>bjaBnahb<span class="token variable">`</span></span>dbcbj<span class="token variable"><span class="token variable">`</span>bbbB<span class="token variable">`</span></span>bhb<span class="token variable"><span class="token variable">`</span>bbdbn<span class="token variable">`</span></span>bcbb<span class="token variable"><span class="token variable">`</span>bbebc<span class="token variable">`</span></span>Add@dbadbfbcbbadagbebb<span class="token variable"><span class="token variable">`</span>bbgbc<span class="token variable">`</span></span>Addbdbbadbhbcbbadbfbbgbb<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>fbbabbhbb<span class="token variable"><span class="token variable">`</span>dbiba<span class="token variable">`</span></span>bjaAdhaabjbiab<span class="token variable"><span class="token variable">`</span>dbibBdbhb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bbbibaaTaabjbaeaf
Bb<span class="token variable">`</span></span>bbkbgbagaablbeab<span class="token variable"><span class="token variable">`</span>bbkbHbj<span class="token variable">`</span></span>hnicgdb<span class="token variable"><span class="token variable">`</span>bbmbc<span class="token variable">`</span></span>Add@dbadbnbcbbadagbmbb<span class="token variable"><span class="token variable">`</span>bbobc<span class="token variable">`</span></span>AddAadbadb<span class="token variable"><span class="token variable">`</span>ccbbadbnbbobb<span class="token variable">`</span></span>bbacgbb<span class="token variable"><span class="token variable">`</span>caabbceab<span class="token variable">`</span></span>bbacHcj<span class="token variable"><span class="token variable">`</span>hnjjcdaabcck<span class="token variable">`</span></span>blbbbcb<span class="token variable"><span class="token variable">`</span>bbdcc<span class="token variable">`</span></span>Add@dbadbeccbbadagbdcb<span class="token variable"><span class="token variable">`</span>bbfcc<span class="token variable">`</span></span>AddAbdbadbgccbbadbecbfcb<span class="token variable"><span class="token variable">`</span>bbhcgbbgcaabiceab<span class="token variable">`</span></span>bbhcHoigndjkcdaabjck<span class="token variable"><span class="token variable">`</span>bccbicb<span class="token variable">`</span></span>bbkcc<span class="token variable"><span class="token variable">`</span>Add@dbadblccbbadagbkcb<span class="token variable">`</span></span>bbmcc<span class="token variable"><span class="token variable">`</span>AddAcdbadbnccbbadblcbmcb<span class="token variable">`</span></span>bbocgbbncaab<span class="token variable"><span class="token variable">`</span>deab<span class="token variable">`</span></span>bbocHcoaljkhgdaabadk<span class="token variable"><span class="token variable">`</span>bjcb<span class="token variable">`</span></span>db<span class="token variable"><span class="token variable">`</span>bbbdc<span class="token variable">`</span></span>Add@dbadbcdcbbadagbbdb<span class="token variable"><span class="token variable">`</span>bbddc<span class="token variable">`</span></span>AddAddbadbedcbbadbcdbddb<span class="token variable"><span class="token variable">`</span>bbfdgbbedaabgdeab<span class="token variable">`</span></span>bbfdHcoalionedaabhdk<span class="token variable"><span class="token variable">`</span>badbgdb<span class="token variable">`</span></span>bbidc<span class="token variable"><span class="token variable">`</span>Add@dbadbjdcbbadagbidb<span class="token variable">`</span></span>bbkdc<span class="token variable"><span class="token variable">`</span>AddAedbadbldcbbadbjdbkdb<span class="token variable">`</span></span>bbmdgbbldaabndeab<span class="token variable"><span class="token variable">`</span>bbmdHoilnikkcdaabodk<span class="token variable">`</span></span>bhdbndb<span class="token variable"><span class="token variable">`</span>bb<span class="token variable">`</span></span>ec<span class="token variable"><span class="token variable">`</span>Add@dbadbaecbbadagb<span class="token variable">`</span></span>eb<span class="token variable"><span class="token variable">`</span>bbbec<span class="token variable">`</span></span>AddAfdbadbcecbbadbaebbeb<span class="token variable"><span class="token variable">`</span>bbdegbbceaabeeeab<span class="token variable">`</span></span>bbdeHdochfheedaabfek<span class="token variable"><span class="token variable">`</span>bodbeeb<span class="token variable">`</span></span>bbgec<span class="token variable"><span class="token variable">`</span>Add@dbadbhecbbadagbgeb<span class="token variable">`</span></span>bbiec<span class="token variable"><span class="token variable">`</span>AddAgdbadbjecbbadbhebieb<span class="token variable">`</span></span>bbkegbbjeaableeab<span class="token variable"><span class="token variable">`</span>bbkeHdiemjoeedaabmek<span class="token variable">`</span></span>bfebleb<span class="token variable"><span class="token variable">`</span>bbnec<span class="token variable">`</span></span>Add@dbadboecbbadagbneb<span class="token variable"><span class="token variable">`</span>bb<span class="token variable">`</span></span>fc<span class="token variable"><span class="token variable">`</span>AddAhdbadbafcbbadboeb<span class="token variable">`</span></span>fb<span class="token variable"><span class="token variable">`</span>bbbfgbbafaabcfeab<span class="token variable">`</span></span>bbbfHoimmoklfdaabdfk<span class="token variable"><span class="token variable">`</span>bmebcfb<span class="token variable">`</span></span>dbefo<span class="token variable"><span class="token variable">`</span>bdfb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bbbef<span class="token variable">`</span></span>Tbaag
Bb<span class="token variable"><span class="token variable">`</span>dbffbb<span class="token variable">`</span></span>bffaabgfn<span class="token variable"><span class="token variable">`</span>bffTcaaabgfE
Aab<span class="token variable">`</span></span>bLbaab<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>dab<span class="token variable">`</span></span>dab<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>Fbfaac
Bb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bb@habb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bbG<span class="token variable">`</span></span>lckjljhaaTbaaa
Bb<span class="token variable"><span class="token variable">`</span>dacbbaaacb<span class="token variable">`</span></span>dadbbabadb<span class="token variable"><span class="token variable">`</span>baen<span class="token variable">`</span></span>acb<span class="token variable"><span class="token variable">`</span>bafn<span class="token variable">`</span></span>adb<span class="token variable"><span class="token variable">`</span>bagh<span class="token variable">`</span></span>afAcdb<span class="token variable"><span class="token variable">`</span>bahi<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>agb<span class="token variable">`</span></span>baik<span class="token variable"><span class="token variable">`</span>ahBoodb<span class="token variable">`</span></span>bajm<span class="token variable"><span class="token variable">`</span>aiaeb<span class="token variable">`</span></span>bakh<span class="token variable"><span class="token variable">`</span>ajAhdb<span class="token variable">`</span></span>bali<span class="token variable"><span class="token variable">`</span>aeBhadb<span class="token variable">`</span></span>baml<span class="token variable"><span class="token variable">`</span>akalb<span class="token variable">`</span></span>bana<span class="token variable"><span class="token variable">`</span>afAadaaaoeab<span class="token variable">`</span></span>banAddb<span class="token variable"><span class="token variable">`</span>db<span class="token variable">`</span></span>ao<span class="token variable"><span class="token variable">`</span>anb<span class="token variable">`</span></span>dbaao<span class="token variable"><span class="token variable">`</span>amb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bbb<span class="token variable">`</span></span>aabb<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>bbbaaaaTaaaoabaa
BTcab<span class="token variable"><span class="token variable">`</span>bamE
Snfofdg<span class="token variable">`</span></span>bcgof<span class="token variable"><span class="token variable">`</span>befafcgig<span class="token variable">`</span></span>bjc<span class="token variable"><span class="token variable">`</span>ej<span class="token variable">`</span></span></code></pre></div>
<p>この CBC ファイルは ClamAV のバイトコードシグネチャなので、この署名にマッチするテキストを特定することが Flag を取得する方法といえそうです。</p>
<p>参考：<a href="https://docs.clamav.net/manual/Signatures/BytecodeSignatures.html" target="_blank" rel="nofollow noopener noreferrer">Bytecode Signatures - ClamAV Documentation</a></p>
<p>問題を解く前に、ClamAV のシグネチャに関するドキュメントを読み込んでおくことにします。</p>
<p>参考：<a href="https://docs.clamav.net/manual/Signatures.html" target="_blank" rel="nofollow noopener noreferrer">Signatures - ClamAV Documentation</a></p>
<p>ClamAV のシグネチャには大きく以下の種類があるようです。</p>
<ul>
<li>データベース形式(CDV/CLD)</li>
<li>Body-based なシグネチャ</li>
</ul>
<p>ここからは、ClamAV の各シグネチャについてドキュメントの情報を整理します。</p>
<h2 id="データベース形式のシグネチャcdvcld" style="position:relative;"><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E5%BD%A2%E5%BC%8F%E3%81%AE%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3cdvcld" aria-label="データベース形式のシグネチャcdvcld permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>データベース形式のシグネチャ(CDV、CLD)</h2>
<p>ClamAV では、CDV および CLD というデータベース形式のアーカイブファイルとしてシグネチャが配信されます。</p>
<p>CLD は、CDIFF という差分更新の仕組みで更新が行われた場合に作成されるファイルです。</p>
<p>参考：<a href="https://docs.clamav.net/appendix/Terminology.html" target="_blank" rel="nofollow noopener noreferrer">Terminology - ClamAV Documentation</a></p>
<p>参考：<a href="https://blog.clamav.net/2021/03/clamav-cvds-cdiffs-and-magic-behind.html" target="_blank" rel="nofollow noopener noreferrer">ClamAV® blog: ClamAV, CVDs, CDIFFs and the magic behind the curtain</a></p>
<p>CVD がシグネチャデータベースアーカイブが圧縮されているものであり、Cisco-Talos によりデジタル署名され、配布されています。</p>
<p>ClamAV を利用するマシンでは通常、freshclam モジュールによって CVD のダウンロードを行います。</p>
<p>CVD の拡張子は <code class="language-text">.cvd</code> ですが、CVD または CLD データベースが CDIFF パッチファイルによって更新されると、拡張子は <code class="language-text">.cld</code> になります。</p>
<p>なお、ClamAV では Cisco-Talos により配布されている CDV データベースに加えて、カスタムデータベースファイルを使用してスキャンを行うことも可能です。</p>
<h2 id="body-based-シグネチャ" style="position:relative;"><a href="#body-based-%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3" aria-label="body based シグネチャ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Body-based シグネチャ</h2>
<p>ClamAV ではデータベース形式のシグネチャに加え、Body-based シグネチャを利用することもできます。</p>
<p>Body-based シグネチャは、ハッシュではなくスキャン対象内の特定のバイトシーケンスを検知条件として定義するシグネチャです。</p>
<p>ClamAV で使用可能な Body-based シグネチャには主に以下の種類があります。</p>
<p>※ 拡張子の末尾に <code class="language-text">u</code> が付与されているものは、PUA シグネチャが有効化されている場合にのみロードされます。</p>
<ul>
<li><code class="language-text">*.ndb / *.ndu</code>: Extended signatures</li>
<li><code class="language-text">*.ldb / *.ldu / *.idb</code>: Logical Signatures</li>
<li><code class="language-text">*.cdb</code>: Container Metadata Signatures</li>
<li><code class="language-text">*.cbc</code>: Bytecode Signatures</li>
<li><code class="language-text">*.pdb / *.gdb / *.wdb</code>: Phishing URL Signatures</li>
</ul>
<p>今回の問題で使用しているバイトコードシグネチャ(<code class="language-text">.cbc</code>) も、この Body-based シグネチャの一種です。</p>
<h3 id="拡張シグネチャextended-signatures" style="position:relative;"><a href="#%E6%8B%A1%E5%BC%B5%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3extended-signatures" aria-label="拡張シグネチャextended signatures permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>拡張シグネチャ(Extended signatures)</h3>
<p><code class="language-text">*.ndb / *.ndu</code> は拡張シグネチャを指します。</p>
<p>拡張シグネチャは以下のフォーマットで記述でき、Hex シグネチャに加えて TargetType、Virus offset、FLEVEL などを定義します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">MalwareName:TargetType:Offset:HexSignature<span class="token punctuation">[</span>:min_flevel:<span class="token punctuation">[</span>max_flevel<span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre></div>
<p>参考：<a href="https://docs.clamav.net/manual/Signatures/ExtendedSignatures.html" target="_blank" rel="nofollow noopener noreferrer">Extended Signatures - ClamAV Documentation</a></p>
<p>MalwareName には任意の値を記載できますが、公式のシグネチャでは通常以下の命名規則に従って定義されます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">{</span>platform<span class="token punctuation">}</span>.<span class="token punctuation">{</span>category<span class="token punctuation">}</span>.<span class="token punctuation">{</span>name<span class="token punctuation">}</span>-<span class="token punctuation">{</span>signature id<span class="token punctuation">}</span>-<span class="token punctuation">{</span>revision<span class="token punctuation">}</span></code></pre></div>
<p>参考：<a href="https://docs.clamav.net/manual/Signatures.html#signature-names" target="_blank" rel="nofollow noopener noreferrer">Signatures - ClamAV Documentation</a></p>
<p>また、TargetType にはスキャン対象のファイルの種類を指定します。</p>
<p>任意のファイルをスキャン対象とする場合は 0 を指定します。</p>
<p>参考：<a href="https://docs.clamav.net/appendix/FileTypes.html#Target-Types" target="_blank" rel="nofollow noopener noreferrer">ClamAV File Types and Target Types - ClamAV Documentation</a></p>
<p>例えば、<code class="language-text">TEST_EXTENDED_SIG</code> という検出名でファイルを検出する拡張シグネチャは以下のように定義できます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">TEST_EXTENDED_SIG:0:*:48656c6c6f2c20436c616d4156</code></pre></div>
<p>このシグネチャでは、<code class="language-text">sigtool --hex-dump</code> などで Hexdump 化した文字列 <code class="language-text">Hello, ClamAV</code> を任意の種類のファイルから検出できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 304px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/87d76b4303ad28107bec681294fa02b2/c1724/image-20240730221051779.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 23.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVQY0z1QR3KDQBDkBZJASAYfKFURTFgWMMEki0XBJZ95mV7cZsYuH7Z2ekL39GhFHaAZIvSTwKBSiMzFWyIRRhGSJEFZlmiaBnVdI45jOI6DPM/R9z2itYfy8zxz7XA4QGuHHJ+qhJA+3psQVSMRxQJSSiYiwqIokGUZPM+DbdvwfZ9JXddFmqZo2xZhGP4Sns9qVflYtxGwXl5XpQRf9zuu1yuqqsJms4Gu69hutzBNkx9hwzCw3++x2+04dzweYVkWtMf3A7fbDeM4YhgHdF2LaZp4s67ruHa5XNgi2aM+pRRj+u+r+PP5ZMskoJE1AnQPIQTHQRD84+jvlhSTVaoTJvsU0/yyLDidTrzlD1E1mQ+u7nZgAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/87d76b4303ad28107bec681294fa02b2/8ac56/image-20240730221051779.webp 240w,
/static/87d76b4303ad28107bec681294fa02b2/e6f1a/image-20240730221051779.webp 304w"
              sizes="(max-width: 304px) 100vw, 304px"
              type="image/webp"
            />
          <source
            srcset="/static/87d76b4303ad28107bec681294fa02b2/8ff5a/image-20240730221051779.png 240w,
/static/87d76b4303ad28107bec681294fa02b2/c1724/image-20240730221051779.png 304w"
            sizes="(max-width: 304px) 100vw, 304px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/87d76b4303ad28107bec681294fa02b2/c1724/image-20240730221051779.png"
            alt="image-20240730221051779"
            title="image-20240730221051779"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>実際にこのシグネチャを使用して <code class="language-text">clamscan --database=TEST_EXTENDED_SIG.ndb test1.txt</code> コマンドでスキャンを発行すると、<code class="language-text">Hello, ClamAV</code> というテキストが含まれているファイルを <code class="language-text">TEST_EXTENDED_SIG</code> という検出名で検出できました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 666px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/cd249c40519c10b4dc4de14da6e1229d/ace37/image-20240730221234979.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 120%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOElEQVQ4y5WV6ZKbQAyE5yF8X/gE24AZcy1JKpX3fyqFTxu5Zr1xwv5QafAwPS2pGztfplKUiWR5KlmWyfF4lNPpJNvtVmaz2eCYTqeaXfPmpWpyadpGrtdUdrudxHEsURTJZDIZFCGwy4tEfHWRwt8UKEkSBTWmh8NBg73z+azr/X7/yFQCu9FopOCu+9bIz1/fJdpGkqaZtD3Ty+XSs71K0zRSFIWG917KstT1/X7X/eVyqRflea57m81GXBwnPauzlsgPsGNNDtnwHK4JGPEulQD8B/C9TAJwO0jJ/Ha73bRU3kvTVNmzzwABGI/HGo+S1+u1ENAHgAOUBBN+W61WmunT3+J52q7rukdf6ANAsAulMEQuD0AaD5gFzYbpYrH48PIr8E+AdV3rNGHHJCl/Pp/ri6YzOzSEsYMVQAAzgKqqNNM3m/j/wMJ+uqp+B0BLAFvwTOlM9CsWdGVZ9UPxehi2MLVeEkjDyg4zUglbYhZ0ZZ1J98PL/rgT3wO3bau6gyFrFAAwmT6jPwJ5oU1EHUqrH0olb12r1mOTgyZ0A0PQBEBkLuNSGHHGZoCvXXyK1Xpoz8xuNkQ6BLfb2gIlUKaJ38zhzGoAUQLAZPPqK4eEUgr764wZAJRkpfLMjXbzEFF/sJ4JG3bE88uvvPsJEJfQUPve2Qc2tN5zif8EBIwwhrSAJj/r7EvWo2SznIHTVyRhThkC9mAIEAGQBVqjl/afMdh65l2+g2Y9wHACmSmbrYYA/wawRJYJtTb5iQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/cd249c40519c10b4dc4de14da6e1229d/8ac56/image-20240730221234979.webp 240w,
/static/cd249c40519c10b4dc4de14da6e1229d/d3be9/image-20240730221234979.webp 480w,
/static/cd249c40519c10b4dc4de14da6e1229d/be082/image-20240730221234979.webp 666w"
              sizes="(max-width: 666px) 100vw, 666px"
              type="image/webp"
            />
          <source
            srcset="/static/cd249c40519c10b4dc4de14da6e1229d/8ff5a/image-20240730221234979.png 240w,
/static/cd249c40519c10b4dc4de14da6e1229d/e85cb/image-20240730221234979.png 480w,
/static/cd249c40519c10b4dc4de14da6e1229d/ace37/image-20240730221234979.png 666w"
            sizes="(max-width: 666px) 100vw, 666px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/cd249c40519c10b4dc4de14da6e1229d/ace37/image-20240730221234979.png"
            alt="image-20240730221234979"
            title="image-20240730221234979"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h3 id="論理シグネチャlogical-signatures" style="position:relative;"><a href="#%E8%AB%96%E7%90%86%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3logical-signatures" aria-label="論理シグネチャlogical signatures permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>論理シグネチャ(Logical signatures)</h3>
<p><code class="language-text">*.ldb / *.ldu / *.idb</code> の拡張子を持つシグネチャは論理シグネチャです。</p>
<p>論理シグネチャは論理演算子を使用して複数の署名を組み合わせることができます。</p>
<p>論理シグネチャのフォーマットは以下の通りです。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">SignatureName<span class="token punctuation">;</span>TargetDescriptionBlock<span class="token punctuation">;</span>LogicalExpression<span class="token punctuation">;</span>Subsig0<span class="token punctuation">;</span>Subsig1<span class="token punctuation">;</span>Subsig2<span class="token punctuation">;</span><span class="token punctuation">..</span>.</code></pre></div>
<p>TargetDescriptionBlock にはエンジンやターゲットファイルに関する情報をコンマ区切りのペアで記述します。</p>
<p>TargetDescriptionBlock には Engine 以外の項目も記述できますが、互換性の維持の観点から Engine の指定を最初に置くことが推奨されています。</p>
<p>Engine の指定は <code class="language-text">Engine:81-255</code> のようなフォーマットで行います。</p>
<p>特に特定のバージョンから追加された機能を使用するシグネチャの場合には、この Engine の指定が重要なようです。</p>
<p>ちなみに、この指定は FLEVEL の値の範囲で記述されます。FLEVEL の値は 81 がバージョン 0.99 と対応しています。</p>
<p>参考：<a href="https://docs.clamav.net/appendix/FunctionalityLevels.html" target="_blank" rel="nofollow noopener noreferrer">ClamAV Versions and Functionality Levels - ClamAV Documentation</a></p>
<p>TargetDescriptionBlock で指定可能な他の値には、Target や FileSize、EntryPoint のオフセットなど様々な値があります。</p>
<p>Target ではスキャン対象のファイルを指定できます。指定方法は拡張シグネチャと同じで、0 が任意のファイルを指定する値です。</p>
<p>参考：<a href="https://docs.clamav.net/appendix/FileTypes.html#Target-Types" target="_blank" rel="nofollow noopener noreferrer">ClamAV File Types and Target Types - ClamAV Documentation</a></p>
<p>続く LogicalExpression のセクションでは、以降のサブシグネチャ間の関係を定義する論理式を記述します。</p>
<p>サブシグネチャには最大 64 個の項目を定義でき、定義した順に 0, 1,2 … という値で参照されます。</p>
<p>少々実装がわかりづらいですが、このサブシグネチャの中には式や値が含まれます。</p>
<p>例えば、ドキュメントのサンプルと同じ以下のシグネチャでは、<code class="language-text">0&amp;1</code> の論理式により、Subsig0(<code class="language-text">41414141::i</code>) と Subsig1(<code class="language-text">424242424242::i</code>) の両方にマッチした場合にのみ対象のファイルを検出するようなシグネチャを定義できます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">TEST_LOGICAL_SIG<span class="token punctuation">;</span>Engine:81-255,Target:0<span class="token punctuation">;</span><span class="token number">0</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token number">41414141</span>::i<span class="token punctuation">;</span><span class="token number">424242424242</span>::i</code></pre></div>
<p><code class="language-text">::i</code> は大文字小文字を区別しないことを指示するオプションです。</p>
<p>つまり、上記のシグネチャは、ファイル内に <code class="language-text">AAAA(または aaaa)</code> と <code class="language-text">BBBBBB(または bbbbbb)</code> の両方が存在する場合にファイルを検出するシグネチャです。</p>
<p>実際に、このシグネチャを使って test1 から test4 までのテキストファイルの検出を試してみると、ァイル内に <code class="language-text">AAAA(または aaaa)</code> と <code class="language-text">BBBBBB(または bbbbbb)</code> の両方が存在する場合にのみ検知が行われることを確認できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 672px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/31b3e9028e0c618c1bdc66745bddd30e/30d16/image-20240731220015849.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 118.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAACXklEQVQ4y5WV2ZbaQAxE/RHsO8Z4X7BZDIfA0/z/L2l8NRHxEJwhDzrdNq3qklRlnCh15XSNJUp8SdNc4jiWPM/lcrnI7XaT+Xwuu91OiqKQ9Xotg8FARqPRyxgOh+IUlS/3j1zyMpGqOkiWpQqUpqmUZangSZLIbDbTJABJZLV9G9SJM1fqX6HEWdAkFwpS17UyAuxwOCj4drsV13Vls9nIarXSPUEF/X5fQxmWZSG3+7VJ8MTztnI8HiUIAo39fq/ssizTiyjdWEdRpKy5iGcITCYTcTzPa5JD7Q8HuBUGPMPGmDzHcrlUVpzzfV+ByXdICsNQGfGDlfR1UaBD4h0rwRmCvfWy1+v9KRlU+mD0KaWqKgWcTqf6npXDz/Fq0g5Nt/4YEIzG4/EjqSv51XsHMJoPGI1lopRKg9sJr5I7AU+n0wOQZtvhZ611Mf0LECADtJXeMZz2Bf9yyAOQ3qEzegkQFxCUzvSRyE+svlkvTbMHAAJF2FwAGGxh+Gw3ApnY+/bUnawI5Xpvpuu76orz+axgXMAe1kjJBsZlPBMMj7YwQJOWkxeZnC91I5eNqp4WcBhNkkySAXARgmaPvGDE71RC3m+nfFkP9ZvlFouF7tGjfRRYCdMpQcmAmDnUy/SIHwHisCXZCgN+sw8G7+y99a4tL8fMThLlcBD6PFMSjiHwq3mWYN9pPXpg9rMvByDvyKTTKSZwGg7jtvXasvjJLSpsYwkgYDTZdPbf1jOn8IEAEHD2Nllzyjtg3wBxCCytn4iY8pHPu2AKiDsAYRgAAGwuoLcwtL/Od4A/AVuamqzYjLQhAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/31b3e9028e0c618c1bdc66745bddd30e/8ac56/image-20240731220015849.webp 240w,
/static/31b3e9028e0c618c1bdc66745bddd30e/d3be9/image-20240731220015849.webp 480w,
/static/31b3e9028e0c618c1bdc66745bddd30e/0fa99/image-20240731220015849.webp 672w"
              sizes="(max-width: 672px) 100vw, 672px"
              type="image/webp"
            />
          <source
            srcset="/static/31b3e9028e0c618c1bdc66745bddd30e/8ff5a/image-20240731220015849.png 240w,
/static/31b3e9028e0c618c1bdc66745bddd30e/e85cb/image-20240731220015849.png 480w,
/static/31b3e9028e0c618c1bdc66745bddd30e/30d16/image-20240731220015849.png 672w"
            sizes="(max-width: 672px) 100vw, 672px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/31b3e9028e0c618c1bdc66745bddd30e/30d16/image-20240731220015849.png"
            alt="image-20240731220015849"
            title="image-20240731220015849"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>test3 および test4 は、<code class="language-text">AAAA</code> と <code class="language-text">BBBBBB</code> のどちらか一方しか含まれていないファイルであるため、このシグネチャでは検出されません。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 651px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b6b52f65f08f2155abd167b19de4f4ec/1ac66/image-20240731220037513.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 109.16666666666669%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBklEQVQ4y52VWXLCQAxE5xLsu81qMN4NBu5/LYWnKpGBJJTJh0qKM9NqSa3BxclOTk0qQbiQ3W4nRVFIFEWy2Wwkz3M5Ho+y3+8lSRKND4eDxHGsZ5bLpdpsNlM/HA7FxfFRsiyXMAhlOp0q0Gq10kMWY+v1+hHzPQxD6XQ6Mh6PNRHJt9utODvABbIsFgsFns/n0u/3W1uv11Pv7DLemFAWDAaDgZaBt0u+/fbN0TeYAURvzMMUsNFopN5n8crKN1dVlQ4Cy7JMy8deM/uM3pXuAKrrWgFpLAwpH2ZtGP0ARA4ww5gW7Ci32+1+zE4By7JQjZ1OJ0nTVD2GBGBLgo+mDKso+hYuA2HKCBdA9AhbMy76HntimBepnJtKon2kZd9uN2UK4PV61ST0czKZqIiJfY8BjshVNnGyva9ecl+9uZZpivdXD8YkwajA1tE2hyEiPZK4NM2kqmoVMgK3PQ6CQIHQKQn4TowRA0S5gJGoLEv9n2OiXAaQmJ5RBge5QCl+D/1e2jDsnJYMCNnwMCELA+IbGwK4bcpfk30aioHB0J4kQCmfHf5t9XygV1B3uVwe2mNjrEfvHoO3wmZq/uMJUyvzX6sHq/P5rAzZZ5ODCfbj1YMhwzAxI25iQGGLbwv2YIiAm6bRHvKc8TdtgC0DawumgLCif2gRpvYjBTvY2svTluUX3YVeA6w6R6YAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/b6b52f65f08f2155abd167b19de4f4ec/8ac56/image-20240731220037513.webp 240w,
/static/b6b52f65f08f2155abd167b19de4f4ec/d3be9/image-20240731220037513.webp 480w,
/static/b6b52f65f08f2155abd167b19de4f4ec/be1d0/image-20240731220037513.webp 651w"
              sizes="(max-width: 651px) 100vw, 651px"
              type="image/webp"
            />
          <source
            srcset="/static/b6b52f65f08f2155abd167b19de4f4ec/8ff5a/image-20240731220037513.png 240w,
/static/b6b52f65f08f2155abd167b19de4f4ec/e85cb/image-20240731220037513.png 480w,
/static/b6b52f65f08f2155abd167b19de4f4ec/1ac66/image-20240731220037513.png 651w"
            sizes="(max-width: 651px) 100vw, 651px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/b6b52f65f08f2155abd167b19de4f4ec/1ac66/image-20240731220037513.png"
            alt="image-20240731220037513"
            title="image-20240731220037513"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>サブシグネチャの記法は非常に多くあるので今回の記事では扱いません。</p>
<p>詳細については以下のドキュメントにまとまっています。</p>
<p>参考：<a href="https://docs.clamav.net/manual/Signatures/LogicalSignatures.html" target="_blank" rel="nofollow noopener noreferrer">Logical Signatures - ClamAV Documentation</a></p>
<h3 id="コンテナメタデータシグネチャcontainer-metadata-signatures" style="position:relative;"><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3container-metadata-signatures" aria-label="コンテナメタデータシグネチャcontainer metadata signatures permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>コンテナメタデータシグネチャ(Container Metadata Signatures)</h3>
<p>コンテナメタデータシグネチャは <code class="language-text">*.cdb</code> の拡張子を持つファイルにより定義されます。</p>
<p>シグネチャのフォーマットは以下の通りです。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">VirusName:ContainerType:ContainerSize:FileNameREGEX:FileSizeInContainer:FileSizeReal:IsEncrypted:FilePos:Res1:Res2<span class="token punctuation">[</span>:MinFL<span class="token punctuation">[</span>:MaxFL<span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre></div>
<p>ContainerType には、<code class="language-text">CL_TYPE_ZIP</code> や <code class="language-text">CL_TYPE_7Z</code> など、ClamAV で独自に定義されているアーカイブファイルのタイプを指定します。</p>
<p>任意のファイルタイプを指定する場合は <code class="language-text">*</code> を使用できるようです。</p>
<p>参考：<a href="https://docs.clamav.net/appendix/FileTypes.html#file-types" target="_blank" rel="nofollow noopener noreferrer">ClamAV File Types and Target Types - ClamAV Documentation</a></p>
<p>コンテナメタデータシグネチャに関する情報はあまり多くありませんが、ファイルの種類やサイズなどを指定してアーカイブファイルを検出できるようなシグネチャみたいです。</p>
<p>例えば、ContainerType に <code class="language-text">CL_TYPE_ZIP</code> のみを指定した以下のシグネチャを使うと、任意の ZIP ファイルを検出することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">TEST_CONTAINER_METADATA_SIG:CL_TYPE_ZIP:*:*:*:*:*:*:*:*</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 656px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f4ab5918c17f8a7c2bf74329cf09898f/748f4/image-20240801191401840.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 98.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/ElEQVQ4y5WUWXLCQAxE5wj8sC9mX23jBbOluP+xFD8lTREqlcCHENbMtFqa1oSi2tn5I7X5amlxVlqW7a2qKlssFlYUhZVlaXme237/FT8ej/59uVxsvV7bdrv1fVmW2XK5tJAkqWX73IaDgY3Hka1Wq9qPbTKZ2Hw+t+l06v8x/rM2m83cNxoN6/V6nny32/l6AIBMoM9qABY5wCKArCVJYmma+qE4jp0V5zabjRtniXEuiM1oNLqXIPrExCyKIv/GhsOhm2KDujp8v9+3QAaQYQMYALBksd1uW6fTcd9qtf419oXr9eqNpuEYCSin2+3+AMS/YgGw0+l0v1EYwo7Fx8yvAoc4ib3ZyAJ28oCqX++wDEVR+iVQbl57mHKrANNbGAP2qoXT+Vj3sHKW51qs9NTBv8XMBZEZvcnor7yMPfiQZmsr62mJpmPbxKmzgzHs0B7ftEB6xCQt9pBQukSCASaHw8E1hd5Y1IRIlxig8lSDTpvNpp/jGxwfPamdw2QjKLHDgNJUznOJuijF2Bv4Qel4AKCuuVRcmnw2gf64FHqieaZnAgVMWbHfZPNbLNxuN3+KEDciV5+eWT2y+VOHNBPTi0L/Huf3GfBfYUsKyEBy0KQwJZT+1qRQKrKhbAT9ONfcOBJ6c/QKLxnJAKInnvJ5TAGl9FdBPwH5TyvsLNqEoAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/f4ab5918c17f8a7c2bf74329cf09898f/8ac56/image-20240801191401840.webp 240w,
/static/f4ab5918c17f8a7c2bf74329cf09898f/d3be9/image-20240801191401840.webp 480w,
/static/f4ab5918c17f8a7c2bf74329cf09898f/31099/image-20240801191401840.webp 656w"
              sizes="(max-width: 656px) 100vw, 656px"
              type="image/webp"
            />
          <source
            srcset="/static/f4ab5918c17f8a7c2bf74329cf09898f/8ff5a/image-20240801191401840.png 240w,
/static/f4ab5918c17f8a7c2bf74329cf09898f/e85cb/image-20240801191401840.png 480w,
/static/f4ab5918c17f8a7c2bf74329cf09898f/748f4/image-20240801191401840.png 656w"
            sizes="(max-width: 656px) 100vw, 656px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/f4ab5918c17f8a7c2bf74329cf09898f/748f4/image-20240801191401840.png"
            alt="image-20240801191401840"
            title="image-20240801191401840"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>さらに、ContainerSize のオプションでは、ZIP などのコンテナファイル自体のサイズをバイト単位で条件に指定できます。</p>
<p>ContainerSize の値を <code class="language-text">80000000-90000000</code> に変更すると、testzip.zip は検出されなくなるものの、ファイルサイズが 88843043 の bigsizezip.zip は検出されます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">TEST_CONTAINER_METADATA_SIG:CL_TYPE_ZIP:80000000-90000000:*:*:*:*:*:*:*</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 767px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9519b0160acf36162018cf21cc5d9ca5/6c2f2/image-20240801191920008.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 99.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACSElEQVQ4y5VU6dLaMAzMQwCBJOROIAe5yDG8/4NttQZ9Y2inLT80lhNrtZLWdu5Li/XRYVo3zMuKaZqwLAsejwfu97vx53lGP47IiwJt2yJNU5zPZ4RhhCSNUF5lzWLEaQ6nH2pMc4tr02AYJ1TXqwGlFQLA4DyKUCUJijg2QEfPw+l0EvPg+R6Cswc/8MUP4LRdiX6qkJYlumFAVVVY19UwHIXVVRLkWYY6S9HGES5RiDwMDeDxeDR2OLhwae4BzrwMmNceSZ6j6wfDjKDKsu+lHVI6kyyynyVJmWcmEVvBs67r/oA7TdOirhskUk4mTGjxy4+kVPo0+pGsgZS82+/Nt1KqYkveAHkwkf7wB3tmShS2DHiWc3gzDaa/F2Cu3PM7zSEA2XAl/bquDTh75Pv+W6/UbEafe0ebz37cbjdTBoE0ox6295+AtjkE0gGQHWXBALu8f4H8BkhmFHHf94at6i8UefwPiF22MwyjAIo0BIigg2iRCciWgLvdzjTfNh2Q7u1KnGnusGwDsvKCRa7fJnrjcMi86zozcQ6skZukg+MQ9Tur0TYZhtN9lCvXGY1dLhfUrwAG2pNX49AYSCC9BG9TZqaiKF9Zn5npU5tcGcggJqPxv7LTlQxVj0bYKm7+5GvCwCAITA95mL4aJaW+J4+EavWnZD5PHALpa5942G70502xZfUpLwNIME6YgGTFzHbwV7LhNKk9FTbLZRlazp+u2l+FrUDPp6o3K1vAYXAoXwNSyPqQbttmSmcCfuNtoXC/Af0FzQMqKYuoQcEAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/9519b0160acf36162018cf21cc5d9ca5/8ac56/image-20240801191920008.webp 240w,
/static/9519b0160acf36162018cf21cc5d9ca5/d3be9/image-20240801191920008.webp 480w,
/static/9519b0160acf36162018cf21cc5d9ca5/e0ad8/image-20240801191920008.webp 767w"
              sizes="(max-width: 767px) 100vw, 767px"
              type="image/webp"
            />
          <source
            srcset="/static/9519b0160acf36162018cf21cc5d9ca5/8ff5a/image-20240801191920008.png 240w,
/static/9519b0160acf36162018cf21cc5d9ca5/e85cb/image-20240801191920008.png 480w,
/static/9519b0160acf36162018cf21cc5d9ca5/6c2f2/image-20240801191920008.png 767w"
            sizes="(max-width: 767px) 100vw, 767px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/9519b0160acf36162018cf21cc5d9ca5/6c2f2/image-20240801191920008.png"
            alt="image-20240801191920008"
            title="image-20240801191920008"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>他にも、コンテナファイルのファイル名や、圧縮されたサイズ、暗号化の有無など様々な条件を指定してコンテナファイルを検出できます。</p>
<h3 id="バイトコードシグネチャbytecode-signatures" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3bytecode-signatures" aria-label="バイトコードシグネチャbytecode signatures permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードシグネチャ(Bytecode Signatures)</h3>
<p>Devil Hunter の問題バイナリとして与えられたような <code class="language-text">.cbc</code> の拡張子を持つシグネチャはバイトコードシグネチャです。</p>
<p>参考：<a href="https://docs.clamav.net/manual/Signatures/BytecodeSignatures.html" target="_blank" rel="nofollow noopener noreferrer">Bytecode Signatures - ClamAV Documentation</a></p>
<p>ClamAV では、コンテンツを解析する C コードを記述することでより複雑なパターンマッチングを実装できます。</p>
<p>この時 C コードで作成されたシグネチャは「bytecode」と呼ばれる中間言語にコンパイルされます。</p>
<p>この「bytecode」は ASCII 形式の <code class="language-text">.cbc</code> ファイルとして生成され、<code class="language-text">.cvd / .cld</code> のデータベースファイルとして配布できます。</p>
<p>バイトコードシグネチャの記述方法とコンパイルの詳細については後述します。</p>
<h3 id="フィッシングシグネチャphishing-url-signatures" style="position:relative;"><a href="#%E3%83%95%E3%82%A3%E3%83%83%E3%82%B7%E3%83%B3%E3%82%B0%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3phishing-url-signatures" aria-label="フィッシングシグネチャphishing url signatures permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>フィッシングシグネチャ(Phishing URL Signatures)</h3>
<p>ClamAV では、メールなどに記載された HTML 内の表示リンクと、実際のリンクのアドレスを検査できます。</p>
<p>参考：<a href="https://docs.clamav.net/manual/Signatures/PhishSigs.html?search=" target="_blank" rel="nofollow noopener noreferrer">Phishing Signatures - ClamAV Documentation</a></p>
<p>フィッシングシグネチャについてはかなり多くの情報が記載されていますが、今回は割愛します。</p>
<h2 id="hash-based-シグネチャ" style="position:relative;"><a href="#hash-based-%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3" aria-label="hash based シグネチャ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hash-based シグネチャ</h2>
<p>ClamAV は Hash-based シグネチャを使用してファイルハッシュチェックによりファイルを検出できます。</p>
<p>Hash-based シグネチャには以下の 2 つの種類があります。</p>
<ul>
<li><code class="language-text">*.hdb *.hsb *.hdu *.hsu</code>: File hash signatures</li>
<li><code class="language-text">*.mdb *.msb *.mdu *.msu</code>: PE section hash signatures</li>
</ul>
<h3 id="ファイルハッシュシグネチャfile-hash-signatures" style="position:relative;"><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3file-hash-signatures" aria-label="ファイルハッシュシグネチャfile hash signatures permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ファイルハッシュシグネチャ(File hash signatures)</h3>
<p>ファイルハッシュシグネチャは以下のフォーマットで定義されます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">HashString:FileSize:MalwareName</code></pre></div>
<p>ファイルハッシュには MD5、SHA1、SHA256 などを使用でき、以下のように sigtool を使用することで特定のファイルのファイルハッシュシグネチャを作成することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">sigtool --md5 test1.txt <span class="token operator">></span> test.hdb
sigtool --sha1 test1.txt <span class="token operator">></span> test.hdb
sigtool --sha256 test1.txt <span class="token operator">></span> test.hdb</code></pre></div>
<p>このコマンドで生成したファイルハッシュシグネチャを使用すると、静的マッチングでファイルを検出することができます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 656px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/05efb3db880614f5cf9868dd71b41e54/748f4/image-20240802003159509.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABG0lEQVQoz5VS146DQBDbr6CXEHqLCCW0//8unzzSnKIInXIPlodZ7PEsmKpJMS41sjJF3nRo2xbP5xP3+13qvu9RVRXquhYuyxJFUSBJEti2Dcdx4LoufN+XZ0PB67UgTVPcbjcxoZiCpmkE74Za05QGURTJO9M0iYcpi/LXJMsy5HkuZnEci4g9ctd1IuQ5a02k6RTG8zwEQQAyjSigkNPYJ8IwlCRkilhzVRp+wlDMeyG4PhNxLSbU6WTLsgQUKdP0E2bfd5zniXVdsW2brM8hTPw++Up81TePxwPjOIJMaDIeaqq/DC4NueowDHLZTEhwVb2/b83EcFkW+e+O4wBrrq49/T3+ZciEKmYy3uM8z/KReEbWtb8x/QFLDRRtAEVUCgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/05efb3db880614f5cf9868dd71b41e54/8ac56/image-20240802003159509.webp 240w,
/static/05efb3db880614f5cf9868dd71b41e54/d3be9/image-20240802003159509.webp 480w,
/static/05efb3db880614f5cf9868dd71b41e54/31099/image-20240802003159509.webp 656w"
              sizes="(max-width: 656px) 100vw, 656px"
              type="image/webp"
            />
          <source
            srcset="/static/05efb3db880614f5cf9868dd71b41e54/8ff5a/image-20240802003159509.png 240w,
/static/05efb3db880614f5cf9868dd71b41e54/e85cb/image-20240802003159509.png 480w,
/static/05efb3db880614f5cf9868dd71b41e54/748f4/image-20240802003159509.png 656w"
            sizes="(max-width: 656px) 100vw, 656px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/05efb3db880614f5cf9868dd71b41e54/748f4/image-20240802003159509.png"
            alt="image-20240802003159509"
            title="image-20240802003159509"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>なお、sigtool で生成したファイルハッシュシグネチャには FileSize 欄に対象ファイルのサイズが記述されます。</p>
<p>しかし、ファイルサイズが不明でハッシュのみがわかっている場合には、以下のように FileSize をワイルドカードに置き換えることでも検出が可能です。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">bf47ba8d5e3af20bd79fa2c9ed028c5a9501a00f:*:test1.txt:73</code></pre></div>
<p>この記法を使用する場合、末尾に最小エンジンレベルを 73 以上に指定するための値を追記する必要があります。</p>
<h3 id="pe-セクションハッシュシグネチャpe-section-hash-signatures" style="position:relative;"><a href="#pe-%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3pe-section-hash-signatures" aria-label="pe セクションハッシュシグネチャpe section hash signatures permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PE セクションハッシュシグネチャ(PE section hash signatures)</h3>
<p>ClamAV はファイルのハッシュだけでなく、PE ファイル内の特定のセクションのハッシュシグネチャを検出に利用することもできます。</p>
<p>PE セクションハッシュシグネチャも sigtool で作成することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">sigtool --mdb /path/to/32bit/PE/file</code></pre></div>
<p>ただし、本記事執筆時点(2024 年 8 月)時点で最新の ClamAV でも 64bit PE バイナリのセクションハッシュシグネチャの作成はサポートしていないようです。</p>
<p>※ PE インポートテーブルハッシュシグネチャも同じく 32bit のみサポート</p>
<h2 id="yara-ルール形式" style="position:relative;"><a href="#yara-%E3%83%AB%E3%83%BC%E3%83%AB%E5%BD%A2%E5%BC%8F" aria-label="yara ルール形式 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>YARA ルール形式</h2>
<p>ClamAV は YARA ルールを処理することができるため、YARA ルールが記述された <code class="language-text">.yar / .yara</code> の拡張子を持つシグネチャを定義できます。</p>
<p>ただし、ClamAV で扱うことができる YARA ルールにはいくつか制限があるので注意が必要です。</p>
<p>詳しい制限や利用方法については本記事では割愛します。</p>
<p>参考：<a href="https://docs.clamav.net/manual/Signatures/YaraRules.html" target="_blank" rel="nofollow noopener noreferrer">YARA Rules - ClamAV Documentation</a></p>
<h2 id="許可ルールの構成" style="position:relative;"><a href="#%E8%A8%B1%E5%8F%AF%E3%83%AB%E3%83%BC%E3%83%AB%E3%81%AE%E6%A7%8B%E6%88%90" aria-label="許可ルールの構成 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>許可ルールの構成</h2>
<p>ClamAV では誤検知抑制のためにいくつかの許可ルールを構成することができます。</p>
<p>許可ルールの構成はファイルハッシュやシグネチャ単位で行うことができます。</p>
<p>特定のファイルの検出を抑制する許可ルールを作成することは簡単で、ファイルハッシュシグネチャと同じように sigtool で出力した行を追加するだけです。</p>
<p>SHA1 もしくは SHA256 ハッシュを許可ルールとして追加する場合、許可リストの拡張子として <code class="language-text">.sfp</code> を使用します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">sigtool --sha256 ~/Downloads/eicar.com <span class="token operator">>></span> /var/lib/clamav/false-positives.sfp</code></pre></div>
<h2 id="sigtool-の利用例" style="position:relative;"><a href="#sigtool-%E3%81%AE%E5%88%A9%E7%94%A8%E4%BE%8B" aria-label="sigtool の利用例 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>sigtool の利用例</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># シグネチャに使用する Hex 文字列を確認</span>
<span class="token builtin class-name">echo</span> -n <span class="token string">"test"</span> <span class="token operator">|</span> sigtool --hex-dump

<span class="token comment"># ファイルハッシュシグネチャの作成</span>
sigtool --md5 test1.txt <span class="token operator">></span> test.hdb
sigtool --sha1 test1.txt <span class="token operator">></span> test.hdb
sigtool --sha256 test1.txt <span class="token operator">></span> test.hdb

<span class="token comment"># 許可ルールの作成</span>
sigtool --sha256 ~/Downloads/eicar.com <span class="token operator">>></span> /var/lib/clamav/false-positives.sfp</code></pre></div>
<p>参考：<a href="https://docs.clamav.net/manual/Signatures.html#using-sigtool" target="_blank" rel="nofollow noopener noreferrer">Signatures - ClamAV Documentation</a></p>
<h2 id="バイトコードシグネチャbytecode-signaturesのチュートリアル" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3bytecode-signatures%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB" aria-label="バイトコードシグネチャbytecode signaturesのチュートリアル permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードシグネチャ(Bytecode Signatures)のチュートリアル</h2>
<p>今回のテーマとしている問題の Devil Hunter を解くため、バイトコードシグネチャについて詳しくドキュメントを読み進めます。</p>
<p>参考：<a href="https://github.com/Cisco-Talos/clamav-bytecode-compiler/blob/main/docs/user/clambc-user.pdf" target="_blank" rel="nofollow noopener noreferrer">clamav-bytecode-compiler/docs/user/clambc-user.pdf at main · Cisco-Talos/clamav-bytecode-compiler</a></p>
<h3 id="バイトコードコンパイラの準備" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%81%AE%E6%BA%96%E5%82%99" aria-label="バイトコードコンパイラの準備 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードコンパイラの準備</h3>
<p>まずはバイトコードコンパイラを用意します。</p>
<p>バイトコードコンパイラのビルドに必要な clang と LLVM をインストールします。</p>
<p>clang と LLVM のバージョンはそろえる必要があり、バージョン 8 が推奨のようです。</p>
<p>試しに apt でインストールできる最新のバージョン 18 を使用してみたところビルドに失敗したので、Docker を利用してバージョン 8 の clang/LLVM 環境を用意することにします。</p>
<p>参考：<a href="https://github.com/Cisco-Talos/clamav-docker/blob/main/clamav-bytecode-compiler/README.md" target="_blank" rel="nofollow noopener noreferrer">clamav-docker/clamav-bytecode-compiler/README.md at main · Cisco-Talos/clamav-docker</a></p>
<p>任意のディレクトリをカレントディレクトリにセットした状態で以下のコマンドを実行します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> run -v <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>:/src -it clamav/clambc-compiler:stable /bin/bash</code></pre></div>
<p>これで、clambc-compiler を実行できるようになりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 693px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/8dcdbd359b0c17785ddfcbbeab7e75cf/61c63/image-20240803015241622.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 76.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABh0lEQVQ4y32TV4oDQQxE+w7OOec4zhjjP9//SDKvoGAxvfNRI02HUih12m63cTwe43w+x+Vykc/a6XTSGn632435fC7baDSi2WwKf30jLRaLmE6n0e/3dWE0Gsnv9XoxGAx0qFarCfV6XSS2OdJE5NVqFRBDUK1Wo1KpiHgymSgYe8vlUuAf22638xm2Wi0dKopCByEdj8ciAWTN5U6nI9j/t2QuHA6HeDwewm63i+FwKFA6AV3iL7IlE42yLY5LgpgMc1mUikIGVpmyUfr5fMbn8xExYvwSlAURoYUBm81G2VH+bDaTMBaFFpSRiZCPe4YYlAwR8Bo+tozImSdUY4jf77cuMjaIgFj0F8tMeqjLoAwhpIfX6zXW67XKpgWUDgktAR4XrDPyP+CMMvyN4I39fi+RCIYlAGv8U5Gfp/dY527KqUfZHEaY2+0mazImgLX7/S7fZzhPy1JONXqIqpBgIQK0g7YwBc7Yk+ERS7lBZYPX83q9FBkCP0sImARKZo0AvHvf/QKabp58uQkJDQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/8dcdbd359b0c17785ddfcbbeab7e75cf/8ac56/image-20240803015241622.webp 240w,
/static/8dcdbd359b0c17785ddfcbbeab7e75cf/d3be9/image-20240803015241622.webp 480w,
/static/8dcdbd359b0c17785ddfcbbeab7e75cf/1fd2f/image-20240803015241622.webp 693w"
              sizes="(max-width: 693px) 100vw, 693px"
              type="image/webp"
            />
          <source
            srcset="/static/8dcdbd359b0c17785ddfcbbeab7e75cf/8ff5a/image-20240803015241622.png 240w,
/static/8dcdbd359b0c17785ddfcbbeab7e75cf/e85cb/image-20240803015241622.png 480w,
/static/8dcdbd359b0c17785ddfcbbeab7e75cf/61c63/image-20240803015241622.png 693w"
            sizes="(max-width: 693px) 100vw, 693px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/8dcdbd359b0c17785ddfcbbeab7e75cf/61c63/image-20240803015241622.png"
            alt="image-20240803015241622"
            title="image-20240803015241622"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h3 id="logical-signature-bytecodesalgorithmic-detection-bytecodes" style="position:relative;"><a href="#logical-signature-bytecodesalgorithmic-detection-bytecodes" aria-label="logical signature bytecodesalgorithmic detection bytecodes permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Logical signature bytecodes(Algorithmic detection bytecodes)</h3>
<p>Logical signature bytecodes(別名 Algorithmic detection bytecodes) は、Logical signature(<code class="language-text">.ldb</code>) と同等のシグネチャによってトリガーされるバイトコードシグネチャです。</p>
<p>ClamAV が公式に配布している CDV/CLV のシグネチャもバイトコードシグネチャに該当しています。</p>
<p>なお、ClamAV は既定では Cisco が正式に配布したシグネチャ以外のバイトコードシグネチャを「信頼できない」シグネチャとみなします。</p>
<p>そのため、独自に作成したバイトコードシグネチャを使用してスキャンを行う場合には、clamscan もしくは clamd で信頼できないバイトコードシグネチャの使用を許可するオプションを明示的に有効化する必要がある点に注意が必要です。</p>
<p>参考：<a href="https://blog.clamav.net/2014/11/brief-re-introduction-to-clamav.html" target="_blank" rel="nofollow noopener noreferrer">ClamAV® blog: Brief Re-introduction to ClamAV Bytecode Signatures</a></p>
<p>Logical signature bytecodes を使用すると、Logical signature を使用するよりもより高速に動作する複雑な検出ロジックを定義することができます。</p>
<p>Algorithmic detection bytecodes は、大きく以下の要素で構成されます。</p>
<ul>
<li>シグネチャと対応するマルウェア名</li>
<li>パターン定義 (for logical subexpressions)</li>
<li>シンプルな C 関数で記述された Logical signature(<code class="language-text">bool logical_trigger(void)</code>)</li>
<li>Logical signature にマッチした際にトリガーされるシグネチャ(<code class="language-text">int entrypoint(void)</code></li>
<li>(オプション) その他 entrypoint で使用する関数や定数</li>
</ul>
<h3 id="マルウェア名とターゲットの指定" style="position:relative;"><a href="#%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%90%8D%E3%81%A8%E3%82%BF%E3%83%BC%E3%82%B2%E3%83%83%E3%83%88%E3%81%AE%E6%8C%87%E5%AE%9A" aria-label="マルウェア名とターゲットの指定 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>マルウェア名とターゲットの指定</h3>
<p>バイトコードシグネチャでは、検出に使用するマルウェア名として必須の <code class="language-text">VIRUSNAME_PREFIX</code> と、オプションの <code class="language-text">VIRUSNAMES</code> を定義します。</p>
<p><code class="language-text">VIRUSNAME_PREFIX</code> に指定した名前は検出時に必ず使用されます。</p>
<p>また、オプションの <code class="language-text">VIRUSNAMES</code> にカンマ区切りで定義した値は、<code class="language-text">VIRUSNAME_PREFIX</code> 以降に付与されます。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// TESTMALWARE.001.A</span>
<span class="token comment">// TESTMALWARE.001.B</span>
<span class="token function">VIRUSNAME_PREFIX</span><span class="token punctuation">(</span><span class="token string">"TESTMALWARE.001"</span><span class="token punctuation">)</span>
<span class="token function">VIRUSNAMES</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span><span class="token string">"B"</span><span class="token punctuation">)</span></code></pre></div>
<p>このオプション部分については、バイトコードシグネチャの中で <code class="language-text">foundVirus("A");</code> のように foundVirus 関数の引数として与えられることで決定されます。</p>
<p>また、<code class="language-text">TARGET</code> にはバイトコードシグネチャのスキャンターゲットとなる種類を示す整数値を指定する必要があります。</p>
<p>この整数値は、ここまで他のシグネチャで使用したものと同じく、以下のドキュメントに記載の値を使用します。</p>
<p>参考：<a href="https://docs.clamav.net/appendix/FileTypes.html#Target-Types" target="_blank" rel="nofollow noopener noreferrer">ClamAV File Types and Target Types - ClamAV Documentation</a></p>
<p>例えば、以下の例ではターゲットとして <code class="language-text">HTML(normalized)</code> を指定しています。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// HTML(normalized)</span>
<span class="token comment">// HTML - Whitespace transformed to spaces, tags/tag attributes normalized, all lowercase.</span>
<span class="token function">TARGET</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></code></pre></div>
<p>なお、ターゲットとして <code class="language-text">HTML(normalized)</code> を指定する場合、空白文字やタグの変換、またすべてのテキストが小文字で解釈されるなどの点に注意が必要です。(大文字のテキストを対象としたシグネチャが有効に動作しなくなります)</p>
<h3 id="flevel-の指定" style="position:relative;"><a href="#flevel-%E3%81%AE%E6%8C%87%E5%AE%9A" aria-label="flevel の指定 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FLEVEL の指定</h3>
<p>バイトコードシグネチャでも、最小要件となる FLEVEL の指定ができます。</p>
<p>バイトコードシグネチャ内で定義する場合は、FLEVEL の整数値ではなく、<code class="language-text">FUNC_LEVEL_098_5</code> のような指定をを行います。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// FUNC_LEVEL_098_5 = 78</span>
<span class="token function">FUNCTIONALITY_LEVEL_MIN</span><span class="token punctuation">(</span>FUNC_LEVEL_098_5<span class="token punctuation">)</span></code></pre></div>
<p>指定に使用可能な値は下記 Docs の <code class="language-text">FunctionalityLevel (bytecode enum)</code> の列の値を使用できます。</p>
<p>参考：<a href="https://docs.clamav.net/appendix/FunctionalityLevels.html#versions--functionality-levels-flevels" target="_blank" rel="nofollow noopener noreferrer">ClamAV Versions and Functionality Levels - ClamAV Documentation</a></p>
<h3 id="declarations-と-definitions" style="position:relative;"><a href="#declarations-%E3%81%A8-definitions" aria-label="declarations と definitions permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Declarations と Definitions</h3>
<p>バイトコードシグネチャの中では Declarations と Definitions を定義できます。</p>
<p>Declarations は変数宣言、Definitions は変数定義のように使用されます。</p>
<p>そのため、Declarations は常に Definitions の前に行う必要があります。</p>
<p>以下の例では、magic、trojan の 2 つの Declarations を定義しています。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Declarations</span>
SIGNATURES_DECL_BEGIN
<span class="token function">DECLARE_SIGNATURE</span><span class="token punctuation">(</span>magic<span class="token punctuation">)</span>
<span class="token function">DECLARE_SIGNATURE</span><span class="token punctuation">(</span>trojan<span class="token punctuation">)</span>
SIGNATURES_DECL_END</code></pre></div>
<p>この Declarations と対応する Definitions は以下のように定義できます。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Definitions </span>
SIGNATURES_DEF_BEGIN
<span class="token function">DEFINE_SIGNATURE</span><span class="token punctuation">(</span>magic<span class="token punctuation">,</span><span class="token string">"61616161"</span><span class="token punctuation">)</span>
<span class="token function">DEFINE_SIGNATURE</span><span class="token punctuation">(</span>trojan<span class="token punctuation">,</span><span class="token string">"74726f6a616e"</span><span class="token punctuation">)</span>
SIGNATURES_END</code></pre></div>
<p>これで、magic と trojan という 2 つのグローバル変数が登録されるため、バイトコードシグネチャのロジックの中でこれらの値を利用できるようになります。</p>
<p>なお、シグネチャで特定の文字列を検出したい場合は、論理シグネチャ(Logical signatures) の場合と同じく Hexdump した文字列を指定する必要があります。</p>
<p>上記の例では、<code class="language-text">aaaa</code> という文字列を対象としたいので、<code class="language-text">DEFINE_SIGNATURE(magic,"aaaa")</code> ではなく <code class="language-text">DEFINE_SIGNATURE(magic,"61616161")</code> を定義しています。</p>
<h3 id="logical-signature-関数の定義" style="position:relative;"><a href="#logical-signature-%E9%96%A2%E6%95%B0%E3%81%AE%E5%AE%9A%E7%BE%A9" aria-label="logical signature 関数の定義 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Logical signature 関数の定義</h3>
<p>バイトコードシグネチャでは、シンプルな C 関数で記述された Logical signature(<code class="language-text">bool logical_trigger(void)</code>) のパターンにマッチした場合にシグネチャ (<code class="language-text">int entrypoint(void)</code> がトリガーされます。</p>
<p>そのため、まずは <code class="language-text">logical_trigger</code> 関数を以下のように定義します。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// All bytecode triggered by logical signatures must have this function</span>
bool <span class="token function">logical_trigger</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">count_match</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>magic<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">count_match</code> 関数は、特定のパターンにマッチした回数をカウントして return する関数です。</p>
<p>上記の例の場合、magic で定義したパターンにマッチしたカウントを返却します。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// This is the bytecode function that is actually executed when the logical signature matched</span>
<span class="token keyword">int</span> <span class="token function">entrypoint</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">matches</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>deadbeef<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">foundVirus</span> <span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// success, return 0</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h3 id="シグネチャの定義" style="position:relative;"><a href="#%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E5%AE%9A%E7%BE%A9" aria-label="シグネチャの定義 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>シグネチャの定義</h3>
<p>Logical signature にマッチした場合に呼び出されるバイトコードシグネチャの本体であるシグネチャ (<code class="language-text">int entrypoint(void)</code> を定義します。</p>
<p>entrypoint の処理に成功した場合、この関数は常に 0 を返却するように定義することが推奨されています。</p>
<p>また、Malware の条件にマッチした場合には foundVirus 関数を使用します。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// This is the bytecode function that is actually executed when the logical signature matched</span>
<span class="token keyword">int</span> <span class="token function">entrypoint</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">matches</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>trojan<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// success, return 0</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>上記の例では、<code class="language-text">matches(Signatures.deadbeef)</code> のパターンにマッチした場合にはオプションの VIRUSNAMES である <code class="language-text">A</code> を使用し、マッチしない場合には <code class="language-text">B</code> を使用して検出を行う実装になっています。</p>
<p>今回作成したシグネチャの全文は以下の通りです。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// TESTMALWARE.001.A</span>
<span class="token comment">// TESTMALWARE.001.B</span>
<span class="token function">VIRUSNAME_PREFIX</span><span class="token punctuation">(</span><span class="token string">"TESTMALWARE.001"</span><span class="token punctuation">)</span>
<span class="token function">VIRUSNAMES</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span><span class="token string">"B"</span><span class="token punctuation">)</span>
<span class="token function">TARGET</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// FUNC_LEVEL_098_5 = 78</span>
<span class="token function">FUNCTIONALITY_LEVEL_MIN</span><span class="token punctuation">(</span>FUNC_LEVEL_098_5<span class="token punctuation">)</span>

<span class="token comment">// Declarations</span>
SIGNATURES_DECL_BEGIN
<span class="token function">DECLARE_SIGNATURE</span><span class="token punctuation">(</span>magic<span class="token punctuation">)</span>
<span class="token function">DECLARE_SIGNATURE</span><span class="token punctuation">(</span>trojan<span class="token punctuation">)</span>
SIGNATURES_DECL_END

<span class="token comment">// Definitions </span>
SIGNATURES_DEF_BEGIN
<span class="token function">DEFINE_SIGNATURE</span><span class="token punctuation">(</span>magic<span class="token punctuation">,</span><span class="token string">"61616161"</span><span class="token punctuation">)</span>
<span class="token function">DEFINE_SIGNATURE</span><span class="token punctuation">(</span>trojan<span class="token punctuation">,</span><span class="token string">"74726f6a616e"</span><span class="token punctuation">)</span>
SIGNATURES_END

<span class="token comment">// All bytecode triggered by logical signatures must have this function</span>
bool <span class="token function">logical_trigger</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">count_match</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>magic<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// This is the bytecode function that is actually executed when the logical signature matched</span>
<span class="token keyword">int</span> <span class="token function">entrypoint</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">matches</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>trojan<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// success, return 0</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h3 id="バイトコードシグネチャのコンパイルとスキャン" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%A8%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3" aria-label="バイトコードシグネチャのコンパイルとスキャン permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードシグネチャのコンパイルとスキャン</h3>
<p>ここまでに作成したバイトコードシグネチャをコンパイルしてスキャンを行います。</p>
<p>ディレクトリ構成は以下のようになっています。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ tree
<span class="token builtin class-name">.</span>
├── bytecodes
│   └── TESTCODE001.c
├── samplefiles
│   ├── TEST001.html
│   └── TEST001.txt
└── up_bytecodes.sh</code></pre></div>
<p>まずは clambc-compiler のコンテナイメージを pull して起動します。</p>
<p>このとき、ボリュームディレクトリには c ファイルを格納している bytecodes ディレクトリを指定しています。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># clambc-compiler の Docker コンテナを pull して起動する</span>
<span class="token function">docker</span> run -v ./bytecodes:/src -it clamav/clambc-compiler:stable /bin/bash

<span class="token comment"># 作成した TESTCODE001.c を TESTCODE001.cbc にコンパイルする</span>
<span class="token builtin class-name">cd</span> /src
clambc-compiler /src/TESTCODE001.c -o TESTCODE001.cbc -O2</code></pre></div>
<p>上記の例では最適化オプションとして <code class="language-text">-O2</code> を指定しています。</p>
<p>最適化オプションには <code class="language-text">-O0</code> から <code class="language-text">-O3</code> までのいずれかを使用できますが、少なくとも <code class="language-text">-O1</code> 以上の最適化オプションを使用することが推奨されているようです。</p>
<p>これでコンパイルされた CBC ファイルを使用することでスキャンが可能になります。</p>
<p>Cisco が配布していないバイトコードシグネチャを使用する場合は <code class="language-text">--bytecode-unsigned=yes</code> のオプションを使用する必要があります。</p>
<p>また、意図した通りに検出が行われない場合などは <code class="language-text">--debug</code> オプションを使用して調査を行います。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">clamscan --bytecode-unsigned<span class="token operator">=</span>yes --disable-cache -d ./bytecodes/TESTCODE001.cbc ./samplefiles/TEST001.txt</code></pre></div>
<p>今回はターゲットファイルを <code class="language-text">HTML(normalized)</code> に指定しているので、<code class="language-text">aaaa</code> などの文字列を含む場合でも txt ファイルは検知されません。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/54738b0f03a99be166905315107f4530/e3189/image-20240810140541309.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVQoz5WQWW6EMBBEfQn2VWCbgeANcf+rVSgrRow0SpSPp7YM/brcwocv7E5BG4uX8VBKYZomSCkxzzP6vkdd1+i6LtZ0btsWTdPEc4J3wgeL3azQ64rdOuhLuCzLzbZtcQAxxsTKIYSCcRwxDEOsvBPzLK80CvJKQ5n6EWqt7+ayLCNsZKosy5DnOYqiiPWJ4NMIkxA2VVUVBWx4kiRpwCdECAHnecI5F3eWRL81pe9p0JuQouM4YK3Feu0xLff5418D3oQUcdne+zspd/cfyZNvpte9VUiTMAcAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/54738b0f03a99be166905315107f4530/8ac56/image-20240810140541309.webp 240w,
/static/54738b0f03a99be166905315107f4530/d3be9/image-20240810140541309.webp 480w,
/static/54738b0f03a99be166905315107f4530/e46b2/image-20240810140541309.webp 960w,
/static/54738b0f03a99be166905315107f4530/77d2c/image-20240810140541309.webp 1035w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/54738b0f03a99be166905315107f4530/8ff5a/image-20240810140541309.png 240w,
/static/54738b0f03a99be166905315107f4530/e85cb/image-20240810140541309.png 480w,
/static/54738b0f03a99be166905315107f4530/d9199/image-20240810140541309.png 960w,
/static/54738b0f03a99be166905315107f4530/e3189/image-20240810140541309.png 1035w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/54738b0f03a99be166905315107f4530/d9199/image-20240810140541309.png"
            alt="image-20240810140541309"
            title="image-20240810140541309"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>一方で、<code class="language-text">aaaa</code> を 2 つ以上と <code class="language-text">trojan</code> という文字列を含む HTML ファイルをスキャンした場合は、<code class="language-text">TESTMALWARE.001.A</code> として検知できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4511707357c7e607f52bea0b8c906968/ee9b6/image-20240810140618893.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 21.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAmElEQVQY022PWxLCIAxFWUVboA8sr4JYq+5/bVeSmVYd+3EmN4E5mQgfHNb1Bus9lNLo+/6HruvQNA3Tti3z3e95R1h3wfa4I6bMAq11Fas/8TAMPKf3aZqOOeVxHI+ZeL62KouwISLnK2KMTEqp9pkrfbbWopQCYwwLzoS0VHgfQIR6cgiUP3WeZyzLAuccZ1okpTw9f+cNB2NsuuT1EDIAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/4511707357c7e607f52bea0b8c906968/8ac56/image-20240810140618893.webp 240w,
/static/4511707357c7e607f52bea0b8c906968/d3be9/image-20240810140618893.webp 480w,
/static/4511707357c7e607f52bea0b8c906968/e46b2/image-20240810140618893.webp 960w,
/static/4511707357c7e607f52bea0b8c906968/e0a35/image-20240810140618893.webp 1041w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/4511707357c7e607f52bea0b8c906968/8ff5a/image-20240810140618893.png 240w,
/static/4511707357c7e607f52bea0b8c906968/e85cb/image-20240810140618893.png 480w,
/static/4511707357c7e607f52bea0b8c906968/d9199/image-20240810140618893.png 960w,
/static/4511707357c7e607f52bea0b8c906968/ee9b6/image-20240810140618893.png 1041w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/4511707357c7e607f52bea0b8c906968/d9199/image-20240810140618893.png"
            alt="image-20240810140618893"
            title="image-20240810140618893"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>また、<code class="language-text">aaaa</code> を 2 つ以上のみ含む場合には、<code class="language-text">if (matches(Signatures.trojan)) { foundVirus("A"); }</code> の条件にはマッチしなくなるため <code class="language-text">TESTMALWARE.001.B</code> として検出されます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1bc5583c4c91a35270ee5aa2681c8eb4/1ff84/image-20240810140647040.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 19.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlUlEQVQY05VPSQ6EMAzrK4CCBF1Qmy5Smf8/zoMjMeI6B8uxEyuJkXIiSoWPJ0IISCkhxqjsnMM8z3/BXJ8LWQTLYm8smKZJmU1rrWLbNmV667qqJj/1A2pTWkZIgtI6cs4/lFJQa9Vrj+NQLfdiXs1P9n1Xn33vvTJ7prV2D4uGGaLuvWuY3hhDh+lzET8geO1Tv/EFHvFtKU963DwAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/1bc5583c4c91a35270ee5aa2681c8eb4/8ac56/image-20240810140647040.webp 240w,
/static/1bc5583c4c91a35270ee5aa2681c8eb4/d3be9/image-20240810140647040.webp 480w,
/static/1bc5583c4c91a35270ee5aa2681c8eb4/e46b2/image-20240810140647040.webp 960w,
/static/1bc5583c4c91a35270ee5aa2681c8eb4/02506/image-20240810140647040.webp 1040w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/1bc5583c4c91a35270ee5aa2681c8eb4/8ff5a/image-20240810140647040.png 240w,
/static/1bc5583c4c91a35270ee5aa2681c8eb4/e85cb/image-20240810140647040.png 480w,
/static/1bc5583c4c91a35270ee5aa2681c8eb4/d9199/image-20240810140647040.png 960w,
/static/1bc5583c4c91a35270ee5aa2681c8eb4/1ff84/image-20240810140647040.png 1040w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/1bc5583c4c91a35270ee5aa2681c8eb4/d9199/image-20240810140647040.png"
            alt="image-20240810140647040"
            title="image-20240810140647040"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>参考：<a href="https://blog.clamav.net/2014/11/sample-file-properties-collection.html" target="_blank" rel="nofollow noopener noreferrer">ClamAV® blog: Sample File Properties Collection Analysis Bytecode Signature Walkthrough</a></p>
<h2 id="バイトコードシグネチャの活用" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E6%B4%BB%E7%94%A8" aria-label="バイトコードシグネチャの活用 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードシグネチャの活用</h2>
<p>ここからは、バイトコードシグネチャの様々な記法を試してみたいと思います。</p>
<h3 id="file-properties-collection-分析を使用する" style="position:relative;"><a href="#file-properties-collection-%E5%88%86%E6%9E%90%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B" aria-label="file properties collection 分析を使用する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>File Properties Collection 分析を使用する</h3>
<p>libclamav が File Properties Collection の JSON を生成するように構成されている場合、バイトコードシグネチャでは生成された JSON オブジェクトを検出条件にすることができます。</p>
<p>参考：<a href="https://blog.clamav.net/2014/11/sample-file-properties-collection.html" target="_blank" rel="nofollow noopener noreferrer">ClamAV® blog: Sample File Properties Collection Analysis Bytecode Signature Walkthrough</a></p>
<p>以下は、ClamAV のリポジトリにあるサンプルのシグネチャをカスタマイズしたものです。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">VIRUSNAME_PREFIX</span><span class="token punctuation">(</span><span class="token string">"SUBMIT.filetype"</span><span class="token punctuation">)</span>
<span class="token function">VIRUSNAMES</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_MSWORD"</span><span class="token punctuation">,</span> <span class="token string">"CL_TYPE_MSPPT"</span><span class="token punctuation">,</span> <span class="token string">"CL_TYPE_MSXL"</span><span class="token punctuation">,</span>
           <span class="token string">"CL_TYPE_OOXML_WORD"</span><span class="token punctuation">,</span> <span class="token string">"CL_TYPE_OOXML_PPT"</span><span class="token punctuation">,</span> <span class="token string">"CL_TYPE_OOXML_XL"</span><span class="token punctuation">,</span>
           <span class="token string">"CL_TYPE_MSEXE"</span><span class="token punctuation">,</span> <span class="token string">"CL_TYPE_PDF"</span><span class="token punctuation">,</span> <span class="token string">"CL_TYPE_MSOLE2"</span><span class="token punctuation">,</span> <span class="token string">"CL_TYPE_UNKNOWN"</span><span class="token punctuation">,</span> <span class="token string">"InActive"</span><span class="token punctuation">)</span>

<span class="token comment">/* Target type is 0, all relevant files */</span>
<span class="token function">TARGET</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">/* JSON API call will require FUNC_LEVEL_098_5 = 78 */</span>
<span class="token comment">/* PRECLASS_HOOK_DECLARE will require FUNC_LEVEL_098_7 = 80 */</span>
<span class="token function">FUNCTIONALITY_LEVEL_MIN</span><span class="token punctuation">(</span>FUNC_LEVEL_098_7<span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STR_MAXLEN</span> <span class="token expression"><span class="token number">256</span></span></span>

<span class="token comment">// Declarations</span>
SIGNATURES_DECL_BEGIN
<span class="token function">DECLARE_SIGNATURE</span><span class="token punctuation">(</span>magic<span class="token punctuation">)</span>
SIGNATURES_DECL_END

<span class="token comment">// Definitions </span>
SIGNATURES_DEF_BEGIN
<span class="token function">DEFINE_SIGNATURE</span><span class="token punctuation">(</span>magic<span class="token punctuation">,</span><span class="token string">"73616d706c65"</span><span class="token punctuation">)</span>
SIGNATURES_END

<span class="token comment">// All bytecode triggered by logical signatures must have this function</span>
bool <span class="token function">logical_trigger</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">matches</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>magic<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">entrypoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">int32_t</span> objid<span class="token punctuation">,</span> type<span class="token punctuation">,</span> strlen<span class="token punctuation">;</span>
    <span class="token keyword">char</span> str<span class="token punctuation">[</span>STR_MAXLEN<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">/* check is json is available, alerts on inactive (optional) */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">json_is_active</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"InActive"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* acquire the filetype object */</span>
    objid <span class="token operator">=</span> <span class="token function">json_get_object</span><span class="token punctuation">(</span><span class="token string">"FileType"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>objid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">debug_print_str</span><span class="token punctuation">(</span><span class="token string">"json object has no filetype!"</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    type <span class="token operator">=</span> <span class="token function">json_get_type</span><span class="token punctuation">(</span>objid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">!=</span> JSON_TYPE_STRING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">debug_print_str</span><span class="token punctuation">(</span><span class="token string">"json object filetype property is not string!"</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* acquire string length, note +1 is for the NULL terminator */</span>
    strlen <span class="token operator">=</span> <span class="token function">json_get_string_length</span><span class="token punctuation">(</span>objid<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">/* prevent buffer overflow */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">></span> STR_MAXLEN<span class="token punctuation">)</span>
        strlen <span class="token operator">=</span> STR_MAXLEN<span class="token punctuation">;</span>

    <span class="token comment">/* acquire string data, note strlen includes NULL terminator */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">json_get_string</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> strlen<span class="token punctuation">,</span> objid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* debug print str (with '\n' and prepended message */</span>
        <span class="token function">debug_print_str</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> strlen<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* check the contained object's filetype */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">==</span> <span class="token number">14</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"CL_TYPE_MSEXE"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_MSEXE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">==</span> <span class="token number">12</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"CL_TYPE_PDF"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_PDF"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">==</span> <span class="token number">19</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"CL_TYPE_OOXML_WORD"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_OOXML_WORD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">==</span> <span class="token number">18</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"CL_TYPE_OOXML_PPT"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_OOXML_PPT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">==</span> <span class="token number">17</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"CL_TYPE_OOXML_XL"</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_OOXML_XL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">==</span> <span class="token number">15</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"CL_TYPE_MSWORD"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_MSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">==</span> <span class="token number">14</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"CL_TYPE_MSPPT"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_MSPPT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">==</span> <span class="token number">13</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"CL_TYPE_MSXL"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_MSXL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">==</span> <span class="token number">15</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"CL_TYPE_MSOLE2"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_MSOLE2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_UNKNOWN"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>上記のシグネチャでは、<code class="language-text">json_is_active()</code> で File Properties Collection の JSON が生成されているかを確認し、生成されていない場合は <code class="language-text">InActive</code> で検出を行います。</p>
<p>JSON が生成されている場合には FileType 要素の文字列を比較して対象ファイルの種類を検出できます。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>strlen <span class="token operator">==</span> <span class="token number">14</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"CL_TYPE_MSEXE"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"CL_TYPE_MSEXE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>このシグネチャをコンパイルした cbc ファイルを使用したスキャンは以下のコマンドで実施できます。</p>
<p>clamscan を使用する場合は <code class="language-text">--gen-json</code> オプションを使用する必要があります。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">clamscan --gen-json --bytecode-unsigned<span class="token operator">=</span>yes --disable-cache -d ./bytecodes/TESTCODE002.cbc  ./samplefiles/doc_sample.docx</code></pre></div>
<p>このシグネチャを使用してサンプルの Word ファイルをスキャンすると <code class="language-text">SUBMIT.filetype.CL_TYPE_OOXML_WORD</code> としてファイルを検出することができます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/de8cd5f3d8196b8af3b9d242c28e1ce1/d5c6f/image-20240812123022567.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 9.166666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAW0lEQVQI102KQQrAIAwE/YSKoAc1KdVI6f8/t21ChR6GXYZxxzgh1405pzHGgIgYvXfbtRZKKcg5o7UGIgIzm9NG3cbRK/gLdqiR/lqr/T8pJXjvEUJAjNH2zwPjrje0MIhpWQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/de8cd5f3d8196b8af3b9d242c28e1ce1/8ac56/image-20240812123022567.webp 240w,
/static/de8cd5f3d8196b8af3b9d242c28e1ce1/d3be9/image-20240812123022567.webp 480w,
/static/de8cd5f3d8196b8af3b9d242c28e1ce1/e46b2/image-20240812123022567.webp 960w,
/static/de8cd5f3d8196b8af3b9d242c28e1ce1/8f19f/image-20240812123022567.webp 1261w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/de8cd5f3d8196b8af3b9d242c28e1ce1/8ff5a/image-20240812123022567.png 240w,
/static/de8cd5f3d8196b8af3b9d242c28e1ce1/e85cb/image-20240812123022567.png 480w,
/static/de8cd5f3d8196b8af3b9d242c28e1ce1/d9199/image-20240812123022567.png 960w,
/static/de8cd5f3d8196b8af3b9d242c28e1ce1/d5c6f/image-20240812123022567.png 1261w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/de8cd5f3d8196b8af3b9d242c28e1ce1/d9199/image-20240812123022567.png"
            alt="image-20240812123022567"
            title="image-20240812123022567"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>また、clamscan で <code class="language-text">--debug</code> オプションを使用すると、生成された JSON オブジェクトをダンプできます。</p>
<p>今回の場合は、以下のような JSON をダンプすることができました。</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Magic"</span><span class="token operator">:</span><span class="token string">"CLAMJSONv0"</span><span class="token punctuation">,</span>
  <span class="token property">"RootFileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_OOXML_WORD"</span><span class="token punctuation">,</span>
  <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"doc_sample.docx"</span><span class="token punctuation">,</span>
  <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_OOXML_WORD"</span><span class="token punctuation">,</span>
  <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">29864</span><span class="token punctuation">,</span>
  <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"1d45f29f2c0523d334d4665acd30a208"</span><span class="token punctuation">,</span>
  <span class="token property">"CoreProperties"</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">"Attributes"</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">"cp"</span><span class="token operator">:</span><span class="token string">"http://schemas.openxmlformats.org/package/2006/metadata/core-properties"</span><span class="token punctuation">,</span>
      <span class="token property">"dc"</span><span class="token operator">:</span><span class="token string">"http://purl.org/dc/elements/1.1/"</span><span class="token punctuation">,</span>
      <span class="token property">"dcterms"</span><span class="token operator">:</span><span class="token string">"http://purl.org/dc/terms/"</span><span class="token punctuation">,</span>
      <span class="token property">"dcmitype"</span><span class="token operator">:</span><span class="token string">"http://purl.org/dc/dcmitype/"</span><span class="token punctuation">,</span>
      <span class="token property">"xsi"</span><span class="token operator">:</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"Title"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"Keywords"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"Created"</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">"Value"</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">"2024-07-26T03:53:00Z"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"Modified"</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">"Value"</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">"2024-07-26T03:53:00Z"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"CorePropertiesFileCount"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"CustomPropertiesFileCount"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"ContainedObjects"</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"app.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-05142ae220fd85d0de8aa5fdbb679e88.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">1105</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"133656865921af498aa28ec5b4f77b24"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">".rels"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-1e11204e3c8bc451adce2bbf9684d61f.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">877</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"834bb9f139e2c89042bc5f73ca3681ac"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"core.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-16f795eae2e129a3bc2d6b6d045d7ec6.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">602</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"48d63fac37f1798301b4a380bc7fbd47"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"document.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-df7bee169e6486afa59bea2b33a0c6aa.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">16079</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"7caa4d90df6f35547e9a0212c52c3cfb"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"webSettings.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-e66fe6b6cdc5505ef6837c41f64a7dc9.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">976</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"e6ef4ee039cfbbe805db5fd64c9285d6"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"document.xml.rels"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-fcb2cd75df0a7781452fb1173c41b495.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">1962</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"a272a252c4514589d0f0b4095edbf65b"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"theme11.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-1196c9448d0bd47e20333d0bdd69f464.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">6808</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"d4c5d9b2fbc2334a7d960978173fcbc1"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"item3.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-c2d5f805bdde863a8c614f7b89a9ebda.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">219</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"5eca9e027b94e6cd1bc64f2a06dcee92"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"itemProps31.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-5c0ec7b9b208dd18bc16221dd74383a8.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">335</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"08962c42256ecf756d4c628af592ff6f"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"item3.xml.rels"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-5fef1f0b8a132ec493b0cb870a6ffc2d.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">293</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"14d033452b3fba1be7138b73fa7d2e4b"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"settings.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-99884602b93a2ddf9d3eeaa0e70f0967.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">6081</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"de6f78fd2ae424ff5fd54310e161a25b"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"fontTable.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-b2a1927c2e99604e8697311d48fd4e48.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">3025</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"aadd621b59bb8af6b1324ce4579db1d8"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"item22.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-bce3cc1fe0e193e1f97ad4aa8bded549.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">1131</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"1aa7d8c84bbb518b7eec09d8fa79bdf7"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"itemProps22.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-c1f279419e99fb98be3876f2ffaa58bc.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">614</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"bbb569ce2200d3b8e0f5af2fd0ee87f2"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"item22.xml.rels"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-68018783a654cc1de6c75725876934cf.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">293</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"1b52716de290d728812bdd805e6ee277"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"item13.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-1cb43cc91c383ab4dc962120b926aafb.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">306</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"217ee5ba5f9835428ff1ab7501faf018"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"itemProps13.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-1832e99cda5310119c2166934cca1c9c.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">341</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"f8fb694a3d90c965a676bdfec949186a"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"item13.xml.rels"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-395ccc11d1cb463e8e27d5075cd0f4ed.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">293</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"4c767529172a3f3e3f06c29757972fd2"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"FileName"</span><span class="token operator">:</span><span class="token string">"styles.xml"</span><span class="token punctuation">,</span>
      <span class="token property">"FilePath"</span><span class="token operator">:</span><span class="token string">"/tmp/20240812_032807-scantemp.57234350df/clamav-5e22fe74d8b0fa6e8b63533680ba5d43.tmp"</span><span class="token punctuation">,</span>
      <span class="token property">"FileType"</span><span class="token operator">:</span><span class="token string">"CL_TYPE_TEXT_ASCII"</span><span class="token punctuation">,</span>
      <span class="token property">"FileSize"</span><span class="token operator">:</span><span class="token number">51823</span><span class="token punctuation">,</span>
      <span class="token property">"FileMD5"</span><span class="token operator">:</span><span class="token string">"6092dcc046c92f52c15c83ef435e4f35"</span><span class="token punctuation">,</span>
      <span class="token property">"Viruses"</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">"SUBMIT.filetype.CL_TYPE_OOXML_WORD"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<h3 id="正規表現の利用" style="position:relative;"><a href="#%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE%E3%81%AE%E5%88%A9%E7%94%A8" aria-label="正規表現の利用 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>正規表現の利用</h3>
<p>バイトコードシグネチャ内では POSIX 正規表現を利用することができます。</p>
<p>ここでは、seek によるスキャン位置の指定やループ処理なども使用することができるようです。</p>
<p>詳しくは公式ドキュメントを参照・・・。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">entrypoint</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    REGEX_SCANNER<span class="token punctuation">;</span>
    
    <span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        REGEX_LOOP_BEGIN
        <span class="token comment">/* 
         * ! re2c
         * ANY = [^];
         * 
         * "eval(" [a-zA-Z_] [a-zA-Z_0-9]* ".unescape" {
         *     long pos = REGEX_POS;
         *     if (pos &lt; 0)
         *         continue;
         *     debug("unescape found at: ");
         *     debug(pos);
         * }
         * ANY {
         *     continue;
         * }
         */</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="バイトコードシグネチャを解析する" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B" aria-label="バイトコードシグネチャを解析する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードシグネチャを解析する</h2>
<h3 id="バイトコードシグネチャの概要情報を表示する" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E6%A6%82%E8%A6%81%E6%83%85%E5%A0%B1%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B" aria-label="バイトコードシグネチャの概要情報を表示する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードシグネチャの概要情報を表示する</h3>
<p><code class="language-text">clambc --info</code> コマンドを使用すると、コンパイルされたバイトコードシグネチャの概要情報を表示できます。</p>
<p>以下は、TESTCODE001.cbc の情報をダンプした例です。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/10c9e72c94830abd927c0712f82c1692/aa08e/image-20240812133304509.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVQoz4WRWW6EMBBEOQQ7Y/YtgIk9wEfQ5P7HqqFamiiKNPFH4baxn6vanr1/wtgV2ljMi8Y0fWAcR/R9j7Iskee5jEopxHGMKIpkfCdP3RSGYcT344F5mq56wLIsqOtaIARWVYWiKP4F/QB935fDX+cJa62445yANE2RJAmyLJM6DEOnPH7ogDCtNYwxUk+XW8ZumkacUryEjjlSv9fYFkqALPZ9x7ZtEnmeZ1nrug5t28qFdE05gUEQyKHzikwg3fEHN756xzlrApyRCWQsgtZ1xXEc4pAAvuhfOR/lFZm9o9g7Rnh3wAV9AhnZ2cVV6TNvAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/10c9e72c94830abd927c0712f82c1692/8ac56/image-20240812133304509.webp 240w,
/static/10c9e72c94830abd927c0712f82c1692/d3be9/image-20240812133304509.webp 480w,
/static/10c9e72c94830abd927c0712f82c1692/e46b2/image-20240812133304509.webp 960w,
/static/10c9e72c94830abd927c0712f82c1692/9d28c/image-20240812133304509.webp 967w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/10c9e72c94830abd927c0712f82c1692/8ff5a/image-20240812133304509.png 240w,
/static/10c9e72c94830abd927c0712f82c1692/e85cb/image-20240812133304509.png 480w,
/static/10c9e72c94830abd927c0712f82c1692/d9199/image-20240812133304509.png 960w,
/static/10c9e72c94830abd927c0712f82c1692/aa08e/image-20240812133304509.png 967w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/10c9e72c94830abd927c0712f82c1692/d9199/image-20240812133304509.png"
            alt="image-20240812133304509"
            title="image-20240812133304509"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>上記のダンプ結果から、Logical シグネチャの情報やバイトコードシグネチャ内の関数の数を把握することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">bytecode logical signature: TESTMALWARE.001.<span class="token punctuation">{</span>A,B<span class="token punctuation">}</span><span class="token punctuation">;</span>Engine:79-255,Target:3<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">61616161</span><span class="token punctuation">;</span>74726f6a616e</code></pre></div>
<h3 id="バイトコードシグネチャのソースコードを参照する" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B" aria-label="バイトコードシグネチャのソースコードを参照する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードシグネチャのソースコードを参照する</h3>
<p><code class="language-text">clambc --printsrc</code> コマンドを使用すると、以下のようにバイトコードシグネチャの元になったソースコードを参照できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 832px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d89d592b1bd280bf01d8b9492c9003b5/ef6b9/image-20240812134504034.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 91.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnklEQVQ4y5WU6Y6CQBCE5yE88T5RwVtwAwbjn/X9n6h3v07ajEh29UdlZhqm6KruxkVxKPnlLF+XQtIslzAMpdfryWAwUPT7fZlOpzIej3WdzWYab7Va0mw2dfXh0vQs9++75FkmyekkURQpuNjpdKTRaEi9Xn8CMSMrk7rdbifb7Va63a4EQaAvlFHOwlCZ4Xw+lziOZblcKhaLhcoz2XzoL9IXQqRBiHeTyUR9AuwBHn5EuNlsJEkSOR6P6t1wOHz4VPbqHWKX/RYjz3O5Xq9SFIWSI9e//FGGSF2tVg/JeFYm+YhwvV5rVlQbYjxrt9sKX/K7lXZIBbfbTaXjKR85HA5CBxhxFap60dEqVBngHUA2xQFkbDEfxCozpO+oLoRkt9/v1c/RaKSw9qE3LWZxG4SXPuRlXkAiZ/Zcspmt1Wov4+ePoG+BI3VmlhV59lMwVEm1PfeA/9wxFTZ2yOZs/gFIUWAqAHGzwWJ21lmGjJZhtQuWoZ3JBPkmzceTZDyzeYYUAl8qNrDSPm81NhlSZS7aX8bPopzRf5PzA3xX5naGtlFuAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d89d592b1bd280bf01d8b9492c9003b5/8ac56/image-20240812134504034.webp 240w,
/static/d89d592b1bd280bf01d8b9492c9003b5/d3be9/image-20240812134504034.webp 480w,
/static/d89d592b1bd280bf01d8b9492c9003b5/de44a/image-20240812134504034.webp 832w"
              sizes="(max-width: 832px) 100vw, 832px"
              type="image/webp"
            />
          <source
            srcset="/static/d89d592b1bd280bf01d8b9492c9003b5/8ff5a/image-20240812134504034.png 240w,
/static/d89d592b1bd280bf01d8b9492c9003b5/e85cb/image-20240812134504034.png 480w,
/static/d89d592b1bd280bf01d8b9492c9003b5/ef6b9/image-20240812134504034.png 832w"
            sizes="(max-width: 832px) 100vw, 832px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d89d592b1bd280bf01d8b9492c9003b5/ef6b9/image-20240812134504034.png"
            alt="image-20240812134504034"
            title="image-20240812134504034"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>clambc のコードを見るとわかる通り、このソースコードはコンパイルされたバイトコードシグネチャ内の <code class="language-text">S</code> から始まる行にエンコードされて埋め込まれています。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">print_src</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>file<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> nread<span class="token punctuation">,</span> i<span class="token punctuation">,</span> found <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> lcnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    FILE <span class="token operator">*</span>f <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Unable to reopen %s\n"</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        nread <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nread <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                lcnt<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">/* skip over the logical trigger */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lcnt <span class="token operator">>=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'\n'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'S'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                found <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>found <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>nread <span class="token operator">==</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>debug_flag<span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[clambc] Source code:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> nread<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'S'</span> <span class="token operator">||</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">putc</span><span class="token punctuation">(</span><span class="token char">'\n'</span><span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">putc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> nread <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> nread <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token function">fseek</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">SEEK_CUR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        i     <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        nread <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>nread <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>このコードは <code class="language-text">(buf[i] &amp; 0xf) | ((buf[i + 1] &amp; 0xf) &lt;&lt; 4)</code> のコードで取り出されています。</p>
<p>参考：<a href="https://github.com/Cisco-Talos/clamav/blob/main/clambc/bcrun.c" target="_blank" rel="nofollow noopener noreferrer">clamav/clambc/bcrun.c at main · Cisco-Talos/clamav</a></p>
<p>実際に以下の Python スクリプトを作成してバイトコードシグネチャ内に埋め込まれているソースコードのデコードが可能なことを確認します。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">code <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""Sobob`bdeedcedemdadldgeadbeednb`c`cacnbadSobob`bdeedcedemdadldgeadbeednb`c`cacnbbdSfeidbeeecendadmdedoe`ebeedfdidhehbbbdeedcedemdadldgeadbeednb`c`cacbbibSfeidbeeecendadmdedcehbbbadbblbbbbdbbib
deadbegdeddehbccibSSobob`bfdeendcdoeldedfeedldoe`cichcoeec`bmc`bgchcSfdeendcddeidodndadldiddeieoeldedfeedldoemdidndhbfdeendcdoeldedfeedldoe`cichcoeecibSSobob`bddefcflfafbgafdgifofnfcg
ceidgdndaddeeebeedceoeddedcdldoebdedgdidndSddedcdldadbeedoeceidgdndaddeeebeedhbmfafgfifcfibSddedcdldadbeedoeceidgdndaddeeebeedhbdgbgofjfafnfibSceidgdndaddeeebeedceoeddedcdldoeednddd
Sobob`bddefffifnfifdgifofnfcg`bSceidgdndaddeeebeedceoeddedfdoebdedgdidndSddedfdidndedoeceidgdndaddeeebeedhbmfafgfifcflbbbfcacfcacfcacfcacbbibSddedfdidndedoeceidgdndaddeeebeedhbdgbgofjfafnflbbbgcdcgcbcfcfffcaffcacfcefbbib
ceidgdndaddeeebeedceoeedndddSSobob`badlflf`bbfigdgefcfofdfef`bdgbgifgfgfefbgefdf`bbfig`blfofgfifcfaflf`bcgifgfnfafdgegbgefcg`bmfegcgdg`bhfaffgef`bdghfifcg`bffegnfcfdgifofnf
bfofoflf`blfofgfifcfaflfoedgbgifgfgfefbghbfgofifdfibSkgSbgefdgegbgnf`bcfofegnfdgoemfafdgcfhfhbceifgfnfafdgegbgefcgnbmfafgfifcfib`bnc`backcSmgSSobob`bdehfifcg`bifcg`bdghfef`bbfigdgefcfofdfef`bffegnfcfdgifofnf`bdghfafdg`bifcg`bafcfdgegaflflfig`befhgefcfegdgefdf`bgghfefnf`bdghfef`blfofgfifcfaflf`bcgifgfnfafdgegbgef`bmfafdgcfhfefdf
ifnfdg`befnfdgbgig`gofifnfdghbfgofifdfibSkgSifff`bhbmfafdgcfhfefcghbceifgfnfafdgegbgefcgnbdgbgofjfafnfibib`bkg`bffofegnfdffeifbgegcghbbbadbbibkc`bmgSeflfcgef`bkg`bffofegnfdffeifbgegcghbbbbdbbibkc`bmg
Sobob`bcgegcfcfefcgcglb`bbgefdgegbgnf`b`cSbgefdgegbgnf`b`ckcSmg"""</span>

i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">>=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> code<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"S"</span> <span class="token keyword">or</span> code<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"\n"</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            i <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            w <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>code<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>code<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
            i <span class="token operator">+=</span> <span class="token number">2</span></code></pre></div>
<p>上記の Python スクリプトを実行すると clambc を使用した場合と同じくコンパイル元のソースコードを取得できることがわかりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 838px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/6659b0d69854244750e035312d7edda4/a1dd2/image-20240812162154366.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 118.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0klEQVQ4y52UV47DQAxDfYj03ntDAqTnI/c/lBZPAAPF62Tt/SCmeIYmJY2Ser1u7XbbhsOhzedzm0wm1ul0rN/v+5yRdaPRsGq1arVa7RfifsLBSqXiFxaLhQ0GA1+nL7PWfhqRNEEhC1SgcjweO/FsNrPRaOR7OGAfxfwQsJ+l/EVYKpX8EGTY1AW+Ay4K2su03Gq1DDSbTQe2yuWy45PFr5ZRdL1e7XK52OFwsF6vZ/qJ1Gcl4mNSHo+HPZ9P2+/3tlqtPNOA+KE4D2FEAgnB1gZWiSeQbanIQ+6Eu93OttutbTYbH8mwMk5iiqhMuAzpdDr1y5QIo1DUtsfwfr8bI8lZr9duU4hZzGWZ7B6PR8/y6XTyOkyrKqSQOClmEKkGQVad/Ul4u91MQCEZp2QY+UGRGnTC8/nsRIzY1ZtVo+BQjOmn+L4IUUOGY9si091u18GakRekPeYg6yV52SyXS1ekOiSe8bLmQOXEPDaIN4XqLswBVhm5pE4UodeklxSR6K8ogRjIktRorTPRdtpJQiPAMsAy6nRA1uJPImHWvhMSP2KnRoHd2ME5TDuLfVJ9Mz1/yzLkZDjWWOH2xduFjNYO2TeSXG+Z2GHvv08tjR9t3YJzQ8i63gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/6659b0d69854244750e035312d7edda4/8ac56/image-20240812162154366.webp 240w,
/static/6659b0d69854244750e035312d7edda4/d3be9/image-20240812162154366.webp 480w,
/static/6659b0d69854244750e035312d7edda4/7820a/image-20240812162154366.webp 838w"
              sizes="(max-width: 838px) 100vw, 838px"
              type="image/webp"
            />
          <source
            srcset="/static/6659b0d69854244750e035312d7edda4/8ff5a/image-20240812162154366.png 240w,
/static/6659b0d69854244750e035312d7edda4/e85cb/image-20240812162154366.png 480w,
/static/6659b0d69854244750e035312d7edda4/a1dd2/image-20240812162154366.png 838w"
            sizes="(max-width: 838px) 100vw, 838px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/6659b0d69854244750e035312d7edda4/a1dd2/image-20240812162154366.png"
            alt="image-20240812162154366"
            title="image-20240812162154366"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>公式から配布されているバイトコードシグネチャや CTF の問題などで使用される場合には、clambc で簡単にソースコードを復元されないように、バイトコードシグネチャ内のソースコード部分が削除されたり置換されたりするようです。</p>
<p>実際に、Devil Hunter の問題バイナリでは、以下のコードで生成した偽のデータが埋め込まれており、clambc コマンドで元のソースを参照できないようになっていました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">fake <span class="token operator">=</span> b<span class="token string">"not so easy :P<span class="token entity" title="\n">\n</span>"</span>
line <span class="token operator">=</span> <span class="token string">"S"</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">c</span> <span class="token keyword">in</span> fake:
    line <span class="token operator">+=</span> chr<span class="token punctuation">(</span>0x60 + <span class="token punctuation">(</span>c <span class="token operator">&amp;</span> 0xf<span class="token punctuation">))</span>
    line <span class="token operator">+=</span> chr<span class="token punctuation">(</span>0x60 + <span class="token variable"><span class="token punctuation">((</span>c<span class="token operator">>></span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">))</span></span>
print<span class="token punctuation">(</span>line<span class="token punctuation">)</span></code></pre></div>
<p>参考：<a href="https://github.com/SECCON/SECCON2022_online_CTF/blob/main/reversing/devil_hunter/builds/gen.py" target="_blank" rel="nofollow noopener noreferrer">SECCON2022<em>online</em>CTF/reversing/devil<em>hunter/builds/gen.py at main · SECCON/SECCON2022</em>online_CTF</a></p>
<h3 id="バイトコードシグネチャを逆アセンブルする" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%82%92%E9%80%86%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AB%E3%81%99%E3%82%8B" aria-label="バイトコードシグネチャを逆アセンブルする permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードシグネチャを逆アセンブルする</h3>
<p><code class="language-text">clambc --printsrc</code> を使用できない場合、<code class="language-text">clambc --printbcir</code> でバイトコードシグネチャを可読可能なテキストとして表示して解析を行うことができます。</p>
<p>例えば、ここまで使用してきた TESTCODE001.cbc を解析すると以下の結果を得ることができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ clambc --printbcir ./bytecodes/TESTCODE001.cbc 

found <span class="token number">19</span> extra types of <span class="token number">83</span> total, starting at tid <span class="token number">69</span>
TID  KIND                INTERNAL
------------------------------------------------------------------------
 <span class="token number">65</span>: DPointerType        i8*
 <span class="token number">66</span>: DPointerType        i16*
 <span class="token number">67</span>: DPointerType        i32*
 <span class="token number">68</span>: DPointerType        i64*
 <span class="token number">69</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">1</span> x i8<span class="token punctuation">]</span>
 <span class="token number">70</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">2</span> x i8<span class="token punctuation">]</span>
 <span class="token number">71</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">3</span> x i8<span class="token punctuation">]</span>
 <span class="token number">72</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">4</span> x i8<span class="token punctuation">]</span>
 <span class="token number">73</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">5</span> x i8<span class="token punctuation">]</span>
 <span class="token number">74</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">6</span> x i8<span class="token punctuation">]</span>
 <span class="token number">75</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">7</span> x i8<span class="token punctuation">]</span>
 <span class="token number">76</span>: DPointerType        <span class="token punctuation">[</span><span class="token number">64</span> x i32<span class="token punctuation">]</span>*
 <span class="token number">77</span>: DPointerType        <span class="token punctuation">[</span><span class="token number">18</span> x i8<span class="token punctuation">]</span>*
 <span class="token number">78</span>: DPointerType        i32**
 <span class="token number">79</span>: DPointerType        i8**
 <span class="token number">80</span>: DFunctionType       i32 func <span class="token punctuation">(</span> i32 i32 <span class="token punctuation">)</span>
 <span class="token number">81</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">18</span> x i8<span class="token punctuation">]</span>
 <span class="token number">82</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">64</span> x i32<span class="token punctuation">]</span>
------------------------------------------------------------------------
<span class="token comment">########################################################################</span>
<span class="token comment">####################### Function id   0 ################################</span>
<span class="token comment">########################################################################</span>
found a total of <span class="token number">9</span> globals
GID  ID    VALUE
------------------------------------------------------------------------
  <span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: i0 unknown
  <span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: <span class="token punctuation">[</span><span class="token number">18</span> x i8<span class="token punctuation">]</span> unknown
  <span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: <span class="token punctuation">[</span><span class="token number">18</span> x i8<span class="token punctuation">]</span> unknown
  <span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: i32* unknown
  <span class="token number">4</span> <span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>: i32* unknown
  <span class="token number">5</span> <span class="token punctuation">[</span>  <span class="token number">5</span><span class="token punctuation">]</span>: i8* unknown
  <span class="token number">6</span> <span class="token punctuation">[</span>  <span class="token number">6</span><span class="token punctuation">]</span>: i8* unknown
  <span class="token number">7</span> <span class="token punctuation">[</span>  <span class="token number">7</span><span class="token punctuation">]</span>: i8* unknown
  <span class="token number">8</span> <span class="token punctuation">[</span>  <span class="token number">8</span><span class="token punctuation">]</span>: i8* unknown
------------------------------------------------------------------------
found <span class="token number">4</span> values with <span class="token number">0</span> arguments and <span class="token number">4</span> locals
VID  ID    VALUE
------------------------------------------------------------------------
  <span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: i32
  <span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: i1
  <span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: i32
  <span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: i32
------------------------------------------------------------------------
found a total of <span class="token number">4</span> constants
CID  ID    VALUE
------------------------------------------------------------------------
  <span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
  <span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">5</span><span class="token punctuation">]</span>: <span class="token number">17</span><span class="token punctuation">(</span>0x11<span class="token punctuation">)</span>
  <span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">6</span><span class="token punctuation">]</span>: <span class="token number">17</span><span class="token punctuation">(</span>0x11<span class="token punctuation">)</span>
  <span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">7</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
------------------------------------------------------------------------
found a total of <span class="token number">8</span> total values
------------------------------------------------------------------------
FUNCTION ID: F.0 -<span class="token operator">></span> NUMINSTS <span class="token number">8</span>
BB   IDX  OPCODE              <span class="token punctuation">[</span>ID /IID/MOD<span class="token punctuation">]</span>  INST
------------------------------------------------------------------------
  <span class="token number">0</span>    <span class="token number">0</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">0</span> <span class="token operator">&lt;</span>- p.-2147483644
  <span class="token number">0</span>    <span class="token number">1</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token number">0</span>    <span class="token number">2</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">1</span> ? bb.2 <span class="token builtin class-name">:</span> bb.1

  <span class="token number">1</span>    <span class="token number">3</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">2</span> <span class="token operator">=</span> setvirusname<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.-2147483640, <span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token number">1</span>    <span class="token number">4</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.3

  <span class="token number">2</span>    <span class="token number">5</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">3</span> <span class="token operator">=</span> setvirusname<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.-2147483642, <span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token number">2</span>    <span class="token number">6</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.3

  <span class="token number">3</span>    <span class="token number">7</span>  OP_BC_RET           <span class="token punctuation">[</span><span class="token number">19</span> / <span class="token number">98</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  ret <span class="token number">7</span>
------------------------------------------------------------------------</code></pre></div>
<p>TESTCODE001.c のコードは以下の通りでした。</p>
<p>バイトコードシグネチャの関数は entrypoint の 1 つのみですので、ダンプ結果内にも <code class="language-text">Function id   0</code> のみが存在しています。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// TESTMALWARE.001.A</span>
<span class="token comment">// TESTMALWARE.001.B</span>
<span class="token function">VIRUSNAME_PREFIX</span><span class="token punctuation">(</span><span class="token string">"TESTMALWARE.001"</span><span class="token punctuation">)</span>
<span class="token function">VIRUSNAMES</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span><span class="token string">"B"</span><span class="token punctuation">)</span>
<span class="token function">TARGET</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment">// FUNC_LEVEL_098_5 = 78</span>
<span class="token function">FUNCTIONALITY_LEVEL_MIN</span><span class="token punctuation">(</span>FUNC_LEVEL_098_5<span class="token punctuation">)</span>

<span class="token comment">// Declarations</span>
SIGNATURES_DECL_BEGIN
<span class="token function">DECLARE_SIGNATURE</span><span class="token punctuation">(</span>magic<span class="token punctuation">)</span>
<span class="token function">DECLARE_SIGNATURE</span><span class="token punctuation">(</span>trojan<span class="token punctuation">)</span>
SIGNATURES_DECL_END

<span class="token comment">// Definitions </span>
SIGNATURES_DEF_BEGIN
<span class="token function">DEFINE_SIGNATURE</span><span class="token punctuation">(</span>magic<span class="token punctuation">,</span><span class="token string">"61616161"</span><span class="token punctuation">)</span>
<span class="token function">DEFINE_SIGNATURE</span><span class="token punctuation">(</span>trojan<span class="token punctuation">,</span><span class="token string">"74726f6a616e"</span><span class="token punctuation">)</span>
SIGNATURES_END

<span class="token comment">// All bytecode triggered by logical signatures must have this function</span>
bool <span class="token function">logical_trigger</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">count_match</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>magic<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// This is the bytecode function that is actually executed when the logical signature matched</span>
<span class="token keyword">int</span> <span class="token function">entrypoint</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">matches</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>trojan<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// success, return 0</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ここからは逆アセンブルされたコードを整理していきます。</p>
<p>この逆アセンブル結果については公開されている情報がほとんどないため、ClamAV のソースコードの情報を参照しながら手探りで読み進めます。 </p>
<p>参考：<a href="https://github.com/Cisco-Talos/clamav/blob/main/libclamav/bytecode.c" target="_blank" rel="nofollow noopener noreferrer">clamav/libclamav/bytecode.c at main · Cisco-Talos/clamav</a></p>
<p>参考：<a href="https://github.com/Cisco-Talos/clamav/blob/main/libclamav/bytecode_vm.c" target="_blank" rel="nofollow noopener noreferrer">clamav/libclamav/bytecode_vm.c at main · Cisco-Talos/clamav</a></p>
<p>参考：<a href="https://github.com/Cisco-Talos/clamav/blob/main/libclamav/clambc.h" target="_blank" rel="nofollow noopener noreferrer">clamav/libclamav/clambc.h at main · Cisco-Talos/clamav</a></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">BB   IDX  OPCODE              <span class="token punctuation">[</span>ID /IID/MOD<span class="token punctuation">]</span>  INST
------------------------------------------------------------------------
<span class="token number">0</span>    <span class="token number">0</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">0</span> <span class="token operator">&lt;</span>- p.-2147483644
<span class="token number">0</span>    <span class="token number">1</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token number">0</span>    <span class="token number">2</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">1</span> ? bb.2 <span class="token builtin class-name">:</span> bb.1
<span class="token number">1</span>    <span class="token number">3</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">2</span> <span class="token operator">=</span> setvirusname<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.-2147483640, <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token number">1</span>    <span class="token number">4</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.3
<span class="token number">2</span>    <span class="token number">5</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">3</span> <span class="token operator">=</span> setvirusname<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.-2147483642, <span class="token number">6</span><span class="token punctuation">)</span>
<span class="token number">2</span>    <span class="token number">6</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.3
<span class="token number">3</span>    <span class="token number">7</span>  OP_BC_RET           <span class="token punctuation">[</span><span class="token number">19</span> / <span class="token number">98</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  ret <span class="token number">7</span></code></pre></div>
<p>まず、最初の <code class="language-text">OP_BC_LOAD</code> は何らかの値を変数(おそらく ID 0 の変数)にロードするようです。</p>
<p>続く <code class="language-text">OP_BC_ICMP_EQ</code> は 2 つのオペランドを比較した結果を変数(おそらく ID 1 の変数) に格納します。</p>
<p>今回の場合は ID 4 の定数 0 と比較していそうです。</p>
<p><code class="language-text">OP_BC_BRANCH</code> ではその比較結果に応じて <code class="language-text">bb.2</code> と <code class="language-text">bb.1</code> のどちらにジャンプするかが決定されます。</p>
<p>VIRUSNAME などは <code class="language-text">p.-2147483640</code> のように表現されてしまっていてどちらがどの値かは判断ができませんが、ソースコードを見ると <code class="language-text">condition ? True : False</code> の構造となっていることを確認できます。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// control operations (termination instructions)</span>
<span class="token keyword">case</span> OP_BC_BRANCH<span class="token operator">:</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"br %d ? bb.%d : bb.%d"</span><span class="token punctuation">,</span> inst<span class="token operator">-></span>u<span class="token punctuation">.</span>branch<span class="token punctuation">.</span>condition<span class="token punctuation">,</span>inst<span class="token operator">-></span>u<span class="token punctuation">.</span>branch<span class="token punctuation">.</span>br_true<span class="token punctuation">,</span> inst<span class="token operator">-></span>u<span class="token punctuation">.</span>branch<span class="token punctuation">.</span>br_false<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>bbnum<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span></code></pre></div>
<p>シグネチャ変数が多いと読みづらいので、次は以下のコードから生成したバイトコードシグネチャを逆アセンブルしてみます。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">entrypoint</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c<span class="token punctuation">;</span>

    c <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token function">count_match</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>magic<span class="token punctuation">)</span> <span class="token operator">+</span> b <span class="token operator">*</span> <span class="token function">count_match</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>trojan<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token function">foundVirus</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// success, return 0</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>このコードから生成したバイトコードシグネチャを逆アセンブルすると以下の結果を得ることができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">found <span class="token number">7</span> values with <span class="token number">0</span> arguments and <span class="token number">7</span> locals
VID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: i32
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: i32
<span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: i32
<span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: i32
<span class="token number">4</span> <span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>: i1
<span class="token number">5</span> <span class="token punctuation">[</span>  <span class="token number">5</span><span class="token punctuation">]</span>: i32
<span class="token number">6</span> <span class="token punctuation">[</span>  <span class="token number">6</span><span class="token punctuation">]</span>: i32
------------------------------------------------------------------------
found a total of <span class="token number">5</span> constants
CID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">7</span><span class="token punctuation">]</span>: <span class="token number">1</span><span class="token punctuation">(</span>0x1<span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">8</span><span class="token punctuation">]</span>: <span class="token number">5</span><span class="token punctuation">(</span>0x5<span class="token punctuation">)</span>
<span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">9</span><span class="token punctuation">]</span>: <span class="token number">17</span><span class="token punctuation">(</span>0x11<span class="token punctuation">)</span>
<span class="token number">3</span> <span class="token punctuation">[</span> <span class="token number">10</span><span class="token punctuation">]</span>: <span class="token number">17</span><span class="token punctuation">(</span>0x11<span class="token punctuation">)</span>
<span class="token number">4</span> <span class="token punctuation">[</span> <span class="token number">11</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
------------------------------------------------------------------------
found a total of <span class="token number">12</span> total values
------------------------------------------------------------------------
FUNCTION ID: F.0 -<span class="token operator">></span> NUMINSTS <span class="token number">11</span>
BB   IDX  OPCODE              <span class="token punctuation">[</span>ID /IID/MOD<span class="token punctuation">]</span>  INST
------------------------------------------------------------------------
<span class="token number">0</span>    <span class="token number">0</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">0</span> <span class="token operator">&lt;</span>- p.-2147483642
<span class="token number">0</span>    <span class="token number">1</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">1</span> <span class="token operator">&lt;</span>- p.-2147483643
<span class="token number">0</span>    <span class="token number">2</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">43</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span>
<span class="token number">0</span>    <span class="token number">3</span>  OP_BC_ADD           <span class="token punctuation">[</span><span class="token number">1</span>  /  <span class="token number">8</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">2</span> + <span class="token number">0</span>
<span class="token number">0</span>    <span class="token number">4</span>  OP_BC_ICMP_SGT      <span class="token punctuation">[</span><span class="token number">27</span> /138/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">4</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token number">0</span>    <span class="token number">5</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">4</span> ? bb.1 <span class="token builtin class-name">:</span> bb.2

<span class="token number">1</span>    <span class="token number">6</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">5</span> <span class="token operator">=</span> setvirusname<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.-2147483638, <span class="token number">9</span><span class="token punctuation">)</span>
<span class="token number">1</span>    <span class="token number">7</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.3

<span class="token number">2</span>    <span class="token number">8</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">6</span> <span class="token operator">=</span> setvirusname<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.-2147483640, <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">2</span>    <span class="token number">9</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.3

<span class="token number">3</span>   <span class="token number">10</span>  OP_BC_RET           <span class="token punctuation">[</span><span class="token number">19</span> / <span class="token number">98</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  ret <span class="token number">11</span>
------------------------------------------------------------------------</code></pre></div>
<p>まず、変数 0 と 1 に magic と trojan のカウントを格納しています。</p>
<p>その後、変数 1 を 1 つ左シフトした結果(2 倍した結果) を変数 2 に格納し、さらにそれに変数 0 を加算します。</p>
<p>ここまでの計算は以下のコードと対応しています。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> c<span class="token punctuation">;</span>
c <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token function">count_match</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>magic<span class="token punctuation">)</span> <span class="token operator">+</span> b <span class="token operator">*</span> <span class="token function">count_match</span><span class="token punctuation">(</span>Signatures<span class="token punctuation">.</span>trojan<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>その後、<code class="language-text">OP_BC_ICMP_SGT</code> で計算結果(変数 3)の値が 5 より大きいか否かを比較し、条件分岐を行います。</p>
<p>このように、バイトコードシグネチャの逆アセンブル結果は VM コードのように読み進めることができます。 </p>
<h3 id="バイトコードシグネチャのデバッグ" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0" aria-label="バイトコードシグネチャのデバッグ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードシグネチャのデバッグ</h3>
<p>バイトコードシグネチャの VM 実行は gdb を使ってある程度デバッグすることができます。</p>
<p>デバッグは以下のコマンドで実行できます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">gdb ~/clamav/build/clamscan/clamscan

<span class="token comment"># libclamav のロード</span>
run --bytecode-unsigned<span class="token operator">=</span>yes --disable-cache -d ./bytecodes/TESTCODE001.cbc ./samplefiles/TEST001.txt

<span class="token comment"># Breakpoint の設定と実行</span>
b cli_vm_execute
run --bytecode-unsigned<span class="token operator">=</span>yes --disable-cache -d ./bytecodes/TESTCODE001.cbc ./samplefiles/TEST001.txt</code></pre></div>
<p><code class="language-text">cli_vm_execute</code> は bytecode_vm.c で定義されている関数で、バイトコードシグネチャ内のオペコードとオペランドを解釈して実行する処理を担っています。</p>
<p>参考：<a href="https://github.com/Cisco-Talos/clamav/blob/main/libclamav/bytecode_vm.c" target="_blank" rel="nofollow noopener noreferrer">clamav/libclamav/bytecode_vm.c at main · Cisco-Talos/clamav</a></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/03c17fc94e1025ab242b1865885875ba/11a8f/image-20240814221102543.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 76.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACSklEQVQ4y31T23KjMBTjJxLuxuAbBpKUNgkk7f//llY2TSfdzeyDhmMMOpaOnAzWYHItJtuhkw26poasK9SS0BbCODSdgeo8irJEVdcQUm7PpoFst7qsKuRFgaTvDT6/FhyPY8Tl+gHnBPRYQh4vEH5EZwco2cPy58t8wPubh+d/zmq0UkAIgbKskOU5Em0M1vWGcZwwTRPm+QPaNGhUjq7tIbIMVZ5hv99B82SjtfBUpbXeiIocJfdFXcY60UrhfD6zYw/vPU6nNygtKDmH5MlaqVAVlEPiiWSD71GVBQqepqbMmnJz1hn3AxLLjz6/vnA8nSIulwXWSUidQ7gJrRshlYse+a7DOB3YeIBxDtPhACnb6F2W5ZtkQ8kPBPmGDbTR6FQbu8fO/DDPC6T8KeU6EJS14JCquN72NyTBi5LTC34EgjRNsdvt6Nk+IqwDaXw+1eljL9RPSIxV7FTAjAfc73esyxKlhAYt5YRmG3n6C49GfyPp6EuaZsxTS8JPLCQMQzqSdKangbSqCjYIAyiJrS4o+xVp4gdmTCt4pzB6G4lDpqp6y1ZR0A6GvSGEqFGTLKwFGxXfYX5Gsiwrhp6TPnus7z3GwTK4Qwxt3/so/SExKAnYvN3/8u7Hw0CouxbLbHF944Stgx1HtMynIaHsVCRteM1anl7x/WPyLz00hmGl7NNxYr5cjE3IVvYdkUdksogta0FaHQZGW/6RXNGHMIh1XeMtuV6vcR3i9ByZn9i8kPlLcpBzu90i4TzPEeH2PDL5Stb/8AdpspwNy0vcyQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/03c17fc94e1025ab242b1865885875ba/8ac56/image-20240814221102543.webp 240w,
/static/03c17fc94e1025ab242b1865885875ba/d3be9/image-20240814221102543.webp 480w,
/static/03c17fc94e1025ab242b1865885875ba/e46b2/image-20240814221102543.webp 960w,
/static/03c17fc94e1025ab242b1865885875ba/4cec6/image-20240814221102543.webp 1272w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/03c17fc94e1025ab242b1865885875ba/8ff5a/image-20240814221102543.png 240w,
/static/03c17fc94e1025ab242b1865885875ba/e85cb/image-20240814221102543.png 480w,
/static/03c17fc94e1025ab242b1865885875ba/d9199/image-20240814221102543.png 960w,
/static/03c17fc94e1025ab242b1865885875ba/11a8f/image-20240814221102543.png 1272w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/03c17fc94e1025ab242b1865885875ba/d9199/image-20240814221102543.png"
            alt="image-20240814221102543"
            title="image-20240814221102543"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>この関数のデバッグを進めると、以下のように各オペコードの処理時の実行コードにアクセスできるようになります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/57126eb30b0e11b2b089f086f0a6a4cb/d0c2f/image-20240814224438808.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACH0lEQVQ4y41TWXabQBDkFFpgmH2DYRASRpL9Yt//VpUeJCey4rzkox5bd1Fd1VN13iD3DsEqBKeQooUzLYTlkMMEmQaEMMGpCC0FQnSwVKtcgCQIKeG9R9ty7Pc1qjxmvH+8o1xP8wnXtzdq4hBeQk5niJThfIbmGlMXcDwvmE5HTPMLtCdSJRFjBOeFcI+qPCzLgr7vMY4jjscTrCOFpFIqC8EaNHUNRkjWIncRkRRprcEFJzAI0aJtaux2O1QdFVwuF3Rdh5wHnE4zjGVoNRWGRKM7SEnEDUcymtR4OGdgnAeXikZtYY1B0zBSSISRiA7ThD4lDDmTygMs+WqCBVMGe1JWUBOkkBDawIYOxljwtiEwMFJXxr2P3K3FNZkq+gyuNARvwRjDdrtdx/hEef6C8u7h+zpy3weSe/vDfH3DOI3IA3mVE/lkqHFzK/5C/nT/8JMqBL+SbesGOk+UnIch/6TkpLz5U9U/UKVhID80PO3WcDiQ2Y4IW2gyuhB+erO7o9w3FETd3L8Vj/e/US3LGV0w+LjQ2vQWJo1QoUcJK9MaMXZrLj43dN09efaMldAZgR9LXE+MignKRyhKsSTKSE1ZWiEElFLU9KD4O0JHng1Dwkg7GGOgYxaoUWLzGcLaeCMoiZYRGReoGft+5LLxr6+vOJ/PmOcZ1+sVE+3lY4K/sLubv9n8PZRCWE5KIStEiRbcUCBr8k97+D/4CVdAgPSBy9YaAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/57126eb30b0e11b2b089f086f0a6a4cb/8ac56/image-20240814224438808.webp 240w,
/static/57126eb30b0e11b2b089f086f0a6a4cb/d3be9/image-20240814224438808.webp 480w,
/static/57126eb30b0e11b2b089f086f0a6a4cb/e46b2/image-20240814224438808.webp 960w,
/static/57126eb30b0e11b2b089f086f0a6a4cb/66be3/image-20240814224438808.webp 1362w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/57126eb30b0e11b2b089f086f0a6a4cb/8ff5a/image-20240814224438808.png 240w,
/static/57126eb30b0e11b2b089f086f0a6a4cb/e85cb/image-20240814224438808.png 480w,
/static/57126eb30b0e11b2b089f086f0a6a4cb/d9199/image-20240814224438808.png 960w,
/static/57126eb30b0e11b2b089f086f0a6a4cb/d0c2f/image-20240814224438808.png 1362w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/57126eb30b0e11b2b089f086f0a6a4cb/d9199/image-20240814224438808.png"
            alt="image-20240814224438808"
            title="image-20240814224438808"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h3 id="libclamav-でバイトコードシグネチャのデバッグトレースを有効化する" style="position:relative;"><a href="#libclamav-%E3%81%A7%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B" aria-label="libclamav でバイトコードシグネチャのデバッグトレースを有効化する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>libclamav でバイトコードシグネチャのデバッグトレースを有効化する</h3>
<p>本記事では使用していませんが、バイトコードシグネチャのデバッグを行う際には、libclamav のソースコードを変更してデバッグトレースを出力する方法が非常に便利です。</p>
<p>詳しくは以下の記事にまとめています。</p>
<p>参考：<a href="/clamav-debug-signature-libclamav">libclamav でバイトコードシグネチャのデバッグトレースを有効化する方法</a></p>
<h2 id="バイトコードシグネチャを解析して-devil-hunter-を解く" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B7%E3%82%B0%E3%83%8D%E3%83%81%E3%83%A3%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%97%E3%81%A6-devil-hunter-%E3%82%92%E8%A7%A3%E3%81%8F" aria-label="バイトコードシグネチャを解析して devil hunter を解く permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイトコードシグネチャを解析して Devil Hunter を解く</h2>
<p>ClamAV のシグネチャについて概ね整理できたところで、いよいよ Devil Hunter の問題を解きます。</p>
<p>Devil Hunter の問題バイナリは以下の cbc ファイルでした。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">ClamBCafhaio<span class="token variable"><span class="token variable">`</span>lfcf<span class="token operator">|</span>aa<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span>c<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>a<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token operator">|</span>ah<span class="token variable">`</span></span>cnbac<span class="token variable"><span class="token variable">`</span>cecnb<span class="token variable">`</span></span>c`<span class="token variable"><span class="token variable">`</span>beaacp<span class="token variable">`</span></span>clamcoincidencejb:4096
Seccon.Reversing.<span class="token punctuation">{</span>FLAG<span class="token punctuation">}</span><span class="token punctuation">;</span>Engine:56-255,Target:0<span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token number">0</span>:534543434f4e7b
Teddaaahdabahdacahdadahdaeahdafahdagahebdeebaddbdbahebndebceaacb<span class="token variable"><span class="token variable">`</span>bbadb<span class="token variable">`</span></span>baacb<span class="token variable"><span class="token variable">`</span>bb<span class="token variable">`</span></span>bb<span class="token variable"><span class="token variable">`</span>bdaib<span class="token variable">`</span></span>bdbfaah
Eaeacabbae<span class="token operator">|</span>aebgefafdf`<span class="token variable"><span class="token variable">`</span>adbbe<span class="token operator">|</span>aecgefefkf<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>aebae<span class="token operator">|</span>amcgefdgfgifbgegcgnfafmfef<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>
G<span class="token variable">`</span></span>ad<span class="token variable"><span class="token variable">`</span>@<span class="token variable">`</span></span>bdeBceBefBcfBcfBofBnfBnbBbeBefBfgBefBbgBcgBifBnfBgfBnbBfdBldBadBgd@<span class="token variable"><span class="token variable">`</span>bad@Aa<span class="token variable">`</span></span>bad@Aa<span class="token variable"><span class="token variable">`</span>
A<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bLabaa<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>Faeac
Baa`<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>abTaa<span class="token variable"><span class="token variable">`</span>aaab
Bb<span class="token variable">`</span></span>baaabbaeAc<span class="token variable"><span class="token variable">`</span>BeadTbaab
BTcab<span class="token variable">`</span></span>b@dE
A<span class="token variable"><span class="token variable">`</span>aaLbhfb<span class="token variable">`</span></span>dab<span class="token variable"><span class="token variable">`</span>dab<span class="token variable">`</span></span>daahabndabad<span class="token variable"><span class="token variable">`</span>bndabad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>ah<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>bad<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>bad<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>aa<span class="token variable">`</span></span>Fbcgah
Bbadaedbbodad@dbadagdbbodaf@db<span class="token variable"><span class="token variable">`</span>bahabbadAgd@db<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bb@habTbaab
Baaaiiab<span class="token variable">`</span></span>dbbaBdbhb<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>bbbbaabTaaaiabac
Bb<span class="token variable"><span class="token variable">`</span>dajbbabajb<span class="token variable">`</span></span>dakh<span class="token variable"><span class="token variable">`</span>ajB<span class="token variable">`</span></span>bhb<span class="token variable"><span class="token variable">`</span>dalj<span class="token variable">`</span></span>akB<span class="token variable"><span class="token variable">`</span>bhb<span class="token variable">`</span></span>bamn<span class="token variable"><span class="token variable">`</span>albadandbbodad@dbadaocbbadanamb<span class="token variable">`</span></span>bb<span class="token variable"><span class="token variable">`</span>aabbabaoAadaabaanab<span class="token variable">`</span></span>bb<span class="token variable"><span class="token variable">`</span>aAadb<span class="token variable">`</span></span>dbbaa<span class="token variable"><span class="token variable">`</span>ajAahb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bb@h<span class="token variable">`</span></span>Taabaaagaa
Bb<span class="token variable"><span class="token variable">`</span>bbcaabbabacAadaabdakab<span class="token variable">`</span></span>bbca@dahbeabbacbeaaabfaeaahbeaBmgaaabgak<span class="token variable"><span class="token variable">`</span>bdabfab<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bb@h<span class="token variable">`</span></span>Taabgaadag
Bb<span class="token variable"><span class="token variable">`</span>bbhaabbabacAadaabiakab<span class="token variable">`</span></span>bbha@db<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>bb@haab<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>bb@h<span class="token variable"><span class="token variable">`</span>Taabiaagae
Bb<span class="token variable">`</span></span>dbjabbaabjab<span class="token variable"><span class="token variable">`</span>dbkah<span class="token variable">`</span></span>bjaB<span class="token variable"><span class="token variable">`</span>bhb<span class="token variable">`</span></span>dblaj<span class="token variable"><span class="token variable">`</span>bkaB<span class="token variable">`</span></span>bhb<span class="token variable"><span class="token variable">`</span>bbman<span class="token variable">`</span></span>blabadbnadbbodad@dbadboacbbadbnabmab<span class="token variable"><span class="token variable">`</span>bb<span class="token variable">`</span></span>bgbboab<span class="token variable"><span class="token variable">`</span>bbab<span class="token variable">`</span></span>baacb<span class="token variable"><span class="token variable">`</span>bb<span class="token variable">`</span></span>dbbbh<span class="token variable"><span class="token variable">`</span>bjaBnahb<span class="token variable">`</span></span>dbcbj<span class="token variable"><span class="token variable">`</span>bbbB<span class="token variable">`</span></span>bhb<span class="token variable"><span class="token variable">`</span>bbdbn<span class="token variable">`</span></span>bcbb<span class="token variable"><span class="token variable">`</span>bbebc<span class="token variable">`</span></span>Add@dbadbfbcbbadagbebb<span class="token variable"><span class="token variable">`</span>bbgbc<span class="token variable">`</span></span>Addbdbbadbhbcbbadbfbbgbb<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>fbbabbhbb<span class="token variable"><span class="token variable">`</span>dbiba<span class="token variable">`</span></span>bjaAdhaabjbiab<span class="token variable"><span class="token variable">`</span>dbibBdbhb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bbbibaaTaabjbaeaf
Bb<span class="token variable">`</span></span>bbkbgbagaablbeab<span class="token variable"><span class="token variable">`</span>bbkbHbj<span class="token variable">`</span></span>hnicgdb<span class="token variable"><span class="token variable">`</span>bbmbc<span class="token variable">`</span></span>Add@dbadbnbcbbadagbmbb<span class="token variable"><span class="token variable">`</span>bbobc<span class="token variable">`</span></span>AddAadbadb<span class="token variable"><span class="token variable">`</span>ccbbadbnbbobb<span class="token variable">`</span></span>bbacgbb<span class="token variable"><span class="token variable">`</span>caabbceab<span class="token variable">`</span></span>bbacHcj<span class="token variable"><span class="token variable">`</span>hnjjcdaabcck<span class="token variable">`</span></span>blbbbcb<span class="token variable"><span class="token variable">`</span>bbdcc<span class="token variable">`</span></span>Add@dbadbeccbbadagbdcb<span class="token variable"><span class="token variable">`</span>bbfcc<span class="token variable">`</span></span>AddAbdbadbgccbbadbecbfcb<span class="token variable"><span class="token variable">`</span>bbhcgbbgcaabiceab<span class="token variable">`</span></span>bbhcHoigndjkcdaabjck<span class="token variable"><span class="token variable">`</span>bccbicb<span class="token variable">`</span></span>bbkcc<span class="token variable"><span class="token variable">`</span>Add@dbadblccbbadagbkcb<span class="token variable">`</span></span>bbmcc<span class="token variable"><span class="token variable">`</span>AddAcdbadbnccbbadblcbmcb<span class="token variable">`</span></span>bbocgbbncaab<span class="token variable"><span class="token variable">`</span>deab<span class="token variable">`</span></span>bbocHcoaljkhgdaabadk<span class="token variable"><span class="token variable">`</span>bjcb<span class="token variable">`</span></span>db<span class="token variable"><span class="token variable">`</span>bbbdc<span class="token variable">`</span></span>Add@dbadbcdcbbadagbbdb<span class="token variable"><span class="token variable">`</span>bbddc<span class="token variable">`</span></span>AddAddbadbedcbbadbcdbddb<span class="token variable"><span class="token variable">`</span>bbfdgbbedaabgdeab<span class="token variable">`</span></span>bbfdHcoalionedaabhdk<span class="token variable"><span class="token variable">`</span>badbgdb<span class="token variable">`</span></span>bbidc<span class="token variable"><span class="token variable">`</span>Add@dbadbjdcbbadagbidb<span class="token variable">`</span></span>bbkdc<span class="token variable"><span class="token variable">`</span>AddAedbadbldcbbadbjdbkdb<span class="token variable">`</span></span>bbmdgbbldaabndeab<span class="token variable"><span class="token variable">`</span>bbmdHoilnikkcdaabodk<span class="token variable">`</span></span>bhdbndb<span class="token variable"><span class="token variable">`</span>bb<span class="token variable">`</span></span>ec<span class="token variable"><span class="token variable">`</span>Add@dbadbaecbbadagb<span class="token variable">`</span></span>eb<span class="token variable"><span class="token variable">`</span>bbbec<span class="token variable">`</span></span>AddAfdbadbcecbbadbaebbeb<span class="token variable"><span class="token variable">`</span>bbdegbbceaabeeeab<span class="token variable">`</span></span>bbdeHdochfheedaabfek<span class="token variable"><span class="token variable">`</span>bodbeeb<span class="token variable">`</span></span>bbgec<span class="token variable"><span class="token variable">`</span>Add@dbadbhecbbadagbgeb<span class="token variable">`</span></span>bbiec<span class="token variable"><span class="token variable">`</span>AddAgdbadbjecbbadbhebieb<span class="token variable">`</span></span>bbkegbbjeaableeab<span class="token variable"><span class="token variable">`</span>bbkeHdiemjoeedaabmek<span class="token variable">`</span></span>bfebleb<span class="token variable"><span class="token variable">`</span>bbnec<span class="token variable">`</span></span>Add@dbadboecbbadagbneb<span class="token variable"><span class="token variable">`</span>bb<span class="token variable">`</span></span>fc<span class="token variable"><span class="token variable">`</span>AddAhdbadbafcbbadboeb<span class="token variable">`</span></span>fb<span class="token variable"><span class="token variable">`</span>bbbfgbbafaabcfeab<span class="token variable">`</span></span>bbbfHoimmoklfdaabdfk<span class="token variable"><span class="token variable">`</span>bmebcfb<span class="token variable">`</span></span>dbefo<span class="token variable"><span class="token variable">`</span>bdfb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bbbef<span class="token variable">`</span></span>Tbaag
Bb<span class="token variable"><span class="token variable">`</span>dbffbb<span class="token variable">`</span></span>bffaabgfn<span class="token variable"><span class="token variable">`</span>bffTcaaabgfE
Aab<span class="token variable">`</span></span>bLbaab<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>dab<span class="token variable">`</span></span>dab<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>b<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>aa<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>b<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>Fbfaac
Bb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bb@habb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bbG<span class="token variable">`</span></span>lckjljhaaTbaaa
Bb<span class="token variable"><span class="token variable">`</span>dacbbaaacb<span class="token variable">`</span></span>dadbbabadb<span class="token variable"><span class="token variable">`</span>baen<span class="token variable">`</span></span>acb<span class="token variable"><span class="token variable">`</span>bafn<span class="token variable">`</span></span>adb<span class="token variable"><span class="token variable">`</span>bagh<span class="token variable">`</span></span>afAcdb<span class="token variable"><span class="token variable">`</span>bahi<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>agb<span class="token variable">`</span></span>baik<span class="token variable"><span class="token variable">`</span>ahBoodb<span class="token variable">`</span></span>bajm<span class="token variable"><span class="token variable">`</span>aiaeb<span class="token variable">`</span></span>bakh<span class="token variable"><span class="token variable">`</span>ajAhdb<span class="token variable">`</span></span>bali<span class="token variable"><span class="token variable">`</span>aeBhadb<span class="token variable">`</span></span>baml<span class="token variable"><span class="token variable">`</span>akalb<span class="token variable">`</span></span>bana<span class="token variable"><span class="token variable">`</span>afAadaaaoeab<span class="token variable">`</span></span>banAddb<span class="token variable"><span class="token variable">`</span>db<span class="token variable">`</span></span>ao<span class="token variable"><span class="token variable">`</span>anb<span class="token variable">`</span></span>dbaao<span class="token variable"><span class="token variable">`</span>amb<span class="token variable">`</span></span>d<span class="token variable"><span class="token variable">`</span>bbb<span class="token variable">`</span></span>aabb<span class="token variable"><span class="token variable">`</span>d<span class="token variable">`</span></span>bbbaaaaTaaaoabaa
BTcab<span class="token variable"><span class="token variable">`</span>bamE
Snfofdg<span class="token variable">`</span></span>bcgof<span class="token variable"><span class="token variable">`</span>befafcgig<span class="token variable">`</span></span>bjc<span class="token variable"><span class="token variable">`</span>ej<span class="token variable">`</span></span></code></pre></div>
<h3 id="cbc-ファイルの情報を調べる" style="position:relative;"><a href="#cbc-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B" aria-label="cbc ファイルの情報を調べる permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cbc ファイルの情報を調べる</h3>
<p>まずは <code class="language-text">clambc --info</code> で情報を調べます。</p>
<p>このバイトコードシグネチャのトリガーとなる logical signature は <code class="language-text">534543434f4e7b(SECCON{)</code> がシグネチャとして定義されたもののようです。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ clambc --info flag.cbc

Bytecode <span class="token function">format</span> functionality level: <span class="token number">6</span>
Bytecode metadata:
        compiler version: <span class="token number">0.105</span>.0
        compiled on: <span class="token punctuation">(</span><span class="token number">1668026257</span><span class="token punctuation">)</span> Wed Nov  <span class="token number">9</span> <span class="token number">20</span>:37:37 <span class="token number">2022</span>
        compiled by:
        target exclude: <span class="token number">0</span>
        bytecode type: logical only
        bytecode functionality level: <span class="token number">0</span> - <span class="token number">0</span>
        bytecode logical signature: Seccon.Reversing.<span class="token punctuation">{</span>FLAG<span class="token punctuation">}</span><span class="token punctuation">;</span>Engine:56-255,Target:0<span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token number">0</span>:534543434f4e7b
        virusname prefix: <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
        virusnames: <span class="token number">0</span>
        bytecode triggered on: files matching logical signature
        number of functions: <span class="token number">3</span>
        number of types: <span class="token number">21</span>
        number of global constants: <span class="token number">4</span>
        number of debug nodes: <span class="token number">0</span>
        bytecode APIs used:
         read, seek, setvirusname</code></pre></div>
<p>残念ながらソースコードの情報は改ざんされているようで、<code class="language-text">clambc --printsrc</code> を使用しても情報は取得できませんでした。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 873px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d571f266980f711aa9e779997bfb861e/35751/image-20240815015927581.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 9.583333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVQI1y2OSw7CMAwFu2xrh8Tkg6oi2LBIHAnE/Q/3cEMXI2tGb+Fpf2y4G+WWkXJBTAXvzxdVO9pJbQf6x1xVB7VW9G6b1oYfd3q2gv11BfkFMwnWS8TixDyCQwaFNNpqbWY/ug8eQQKIyB6IcI4hImBm/AAR4TRKcCx5nwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d571f266980f711aa9e779997bfb861e/8ac56/image-20240815015927581.webp 240w,
/static/d571f266980f711aa9e779997bfb861e/d3be9/image-20240815015927581.webp 480w,
/static/d571f266980f711aa9e779997bfb861e/d21af/image-20240815015927581.webp 873w"
              sizes="(max-width: 873px) 100vw, 873px"
              type="image/webp"
            />
          <source
            srcset="/static/d571f266980f711aa9e779997bfb861e/8ff5a/image-20240815015927581.png 240w,
/static/d571f266980f711aa9e779997bfb861e/e85cb/image-20240815015927581.png 480w,
/static/d571f266980f711aa9e779997bfb861e/35751/image-20240815015927581.png 873w"
            sizes="(max-width: 873px) 100vw, 873px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d571f266980f711aa9e779997bfb861e/35751/image-20240815015927581.png"
            alt="image-20240815015927581"
            title="image-20240815015927581"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>そこで、<code class="language-text">clambc --printbc</code> の出力結果を調べることにします。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ clambc --printbc flag.cbc
found <span class="token number">21</span> extra types of <span class="token number">85</span> total, starting at tid <span class="token number">69</span>
TID  KIND                INTERNAL
------------------------------------------------------------------------
<span class="token number">65</span>: DPointerType        i8*
<span class="token number">66</span>: DPointerType        i16*
<span class="token number">67</span>: DPointerType        i32*
<span class="token number">68</span>: DPointerType        i64*
<span class="token number">69</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">1</span> x i8<span class="token punctuation">]</span>
<span class="token number">70</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">2</span> x i8<span class="token punctuation">]</span>
<span class="token number">71</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">3</span> x i8<span class="token punctuation">]</span>
<span class="token number">72</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">4</span> x i8<span class="token punctuation">]</span>
<span class="token number">73</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">5</span> x i8<span class="token punctuation">]</span>
<span class="token number">74</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">6</span> x i8<span class="token punctuation">]</span>
<span class="token number">75</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">7</span> x i8<span class="token punctuation">]</span>
<span class="token number">76</span>: DPointerType        <span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span>*
<span class="token number">77</span>: DPointerType        i8**
<span class="token number">78</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">36</span> x i8<span class="token punctuation">]</span>
<span class="token number">79</span>: DPointerType        <span class="token punctuation">[</span><span class="token number">36</span> x i8<span class="token punctuation">]</span>*
<span class="token number">80</span>: DPointerType        <span class="token punctuation">[</span><span class="token number">9</span> x i32<span class="token punctuation">]</span>*
<span class="token number">81</span>: DFunctionType       i32 func <span class="token punctuation">(</span> i32 i32 <span class="token punctuation">)</span>
<span class="token number">82</span>: DFunctionType       i32 func <span class="token punctuation">(</span> i32 i32 <span class="token punctuation">)</span>
<span class="token number">83</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">9</span> x i32<span class="token punctuation">]</span>
<span class="token number">84</span>: DArrayType          <span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span>
------------------------------------------------------------------------
<span class="token comment">########################################################################</span>
<span class="token comment">####################### Function id   0 ################################</span>
<span class="token comment">########################################################################</span>
found a total of <span class="token number">4</span> globals
GID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: i0 unknown
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: <span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span> unknown
<span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: i8* unknown
<span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: i8* unknown
------------------------------------------------------------------------
found <span class="token number">2</span> values with <span class="token number">0</span> arguments and <span class="token number">2</span> locals
VID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: i1
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: i32
------------------------------------------------------------------------
found a total of <span class="token number">2</span> constants
CID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: <span class="token number">21</span><span class="token punctuation">(</span>0x15<span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
------------------------------------------------------------------------
found a total of <span class="token number">4</span> total values
------------------------------------------------------------------------
FUNCTION ID: F.0 -<span class="token operator">></span> NUMINSTS <span class="token number">5</span>
BB   IDX  OPCODE              <span class="token punctuation">[</span>ID /IID/MOD<span class="token punctuation">]</span>  INST
------------------------------------------------------------------------
<span class="token number">0</span>    <span class="token number">0</span>  OP_BC_CALL_DIRECT   <span class="token punctuation">[</span><span class="token number">32</span> /160/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">0</span> <span class="token operator">=</span> call F.1 <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">0</span>    <span class="token number">1</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">0</span> ? bb.1 <span class="token builtin class-name">:</span> bb.2

<span class="token number">1</span>    <span class="token number">2</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">1</span> <span class="token operator">=</span> setvirusname<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.-2147483645, <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">1</span>    <span class="token number">3</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.2

<span class="token number">2</span>    <span class="token number">4</span>  OP_BC_RET           <span class="token punctuation">[</span><span class="token number">19</span> / <span class="token number">98</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  ret <span class="token number">3</span>
------------------------------------------------------------------------
<span class="token comment">########################################################################</span>
<span class="token comment">####################### Function id   1 ################################</span>
<span class="token comment">########################################################################</span>
found a total of <span class="token number">4</span> globals
GID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: i0 unknown
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: <span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span> unknown
<span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: i8* unknown
<span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: i8* unknown
------------------------------------------------------------------------
found <span class="token number">104</span> values with <span class="token number">0</span> arguments and <span class="token number">104</span> locals
VID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: alloc i64
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: alloc i64
<span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: alloc i64
<span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: alloc i8
<span class="token number">4</span> <span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>: alloc <span class="token punctuation">[</span><span class="token number">36</span> x i8<span class="token punctuation">]</span>
<span class="token number">5</span> <span class="token punctuation">[</span>  <span class="token number">5</span><span class="token punctuation">]</span>: i8*
<span class="token number">6</span> <span class="token punctuation">[</span>  <span class="token number">6</span><span class="token punctuation">]</span>: alloc <span class="token punctuation">[</span><span class="token number">36</span> x i8<span class="token punctuation">]</span>
<span class="token number">7</span> <span class="token punctuation">[</span>  <span class="token number">7</span><span class="token punctuation">]</span>: i8*
<span class="token number">8</span> <span class="token punctuation">[</span>  <span class="token number">8</span><span class="token punctuation">]</span>: i32
<span class="token number">9</span> <span class="token punctuation">[</span>  <span class="token number">9</span><span class="token punctuation">]</span>: i1
<span class="token number">10</span> <span class="token punctuation">[</span> <span class="token number">10</span><span class="token punctuation">]</span>: i64
<span class="token number">11</span> <span class="token punctuation">[</span> <span class="token number">11</span><span class="token punctuation">]</span>: i64
<span class="token number">12</span> <span class="token punctuation">[</span> <span class="token number">12</span><span class="token punctuation">]</span>: i64
<span class="token number">13</span> <span class="token punctuation">[</span> <span class="token number">13</span><span class="token punctuation">]</span>: i32
<span class="token number">14</span> <span class="token punctuation">[</span> <span class="token number">14</span><span class="token punctuation">]</span>: i8*
<span class="token number">15</span> <span class="token punctuation">[</span> <span class="token number">15</span><span class="token punctuation">]</span>: i8*
<span class="token number">16</span> <span class="token punctuation">[</span> <span class="token number">16</span><span class="token punctuation">]</span>: i32
<span class="token number">17</span> <span class="token punctuation">[</span> <span class="token number">17</span><span class="token punctuation">]</span>: i1
<span class="token number">18</span> <span class="token punctuation">[</span> <span class="token number">18</span><span class="token punctuation">]</span>: i64
<span class="token number">19</span> <span class="token punctuation">[</span> <span class="token number">19</span><span class="token punctuation">]</span>: i32
<span class="token number">20</span> <span class="token punctuation">[</span> <span class="token number">20</span><span class="token punctuation">]</span>: i1
<span class="token number">21</span> <span class="token punctuation">[</span> <span class="token number">21</span><span class="token punctuation">]</span>: i8
<span class="token number">22</span> <span class="token punctuation">[</span> <span class="token number">22</span><span class="token punctuation">]</span>: i1
<span class="token number">23</span> <span class="token punctuation">[</span> <span class="token number">23</span><span class="token punctuation">]</span>: i1
<span class="token number">24</span> <span class="token punctuation">[</span> <span class="token number">24</span><span class="token punctuation">]</span>: i32
<span class="token number">25</span> <span class="token punctuation">[</span> <span class="token number">25</span><span class="token punctuation">]</span>: i1
<span class="token number">26</span> <span class="token punctuation">[</span> <span class="token number">26</span><span class="token punctuation">]</span>: i64
<span class="token number">27</span> <span class="token punctuation">[</span> <span class="token number">27</span><span class="token punctuation">]</span>: i64
<span class="token number">28</span> <span class="token punctuation">[</span> <span class="token number">28</span><span class="token punctuation">]</span>: i64
<span class="token number">29</span> <span class="token punctuation">[</span> <span class="token number">29</span><span class="token punctuation">]</span>: i32
<span class="token number">30</span> <span class="token punctuation">[</span> <span class="token number">30</span><span class="token punctuation">]</span>: i8*
<span class="token number">31</span> <span class="token punctuation">[</span> <span class="token number">31</span><span class="token punctuation">]</span>: i8*
<span class="token number">32</span> <span class="token punctuation">[</span> <span class="token number">32</span><span class="token punctuation">]</span>: i32
<span class="token number">33</span> <span class="token punctuation">[</span> <span class="token number">33</span><span class="token punctuation">]</span>: i32
<span class="token number">34</span> <span class="token punctuation">[</span> <span class="token number">34</span><span class="token punctuation">]</span>: i64
<span class="token number">35</span> <span class="token punctuation">[</span> <span class="token number">35</span><span class="token punctuation">]</span>: i64
<span class="token number">36</span> <span class="token punctuation">[</span> <span class="token number">36</span><span class="token punctuation">]</span>: i32
<span class="token number">37</span> <span class="token punctuation">[</span> <span class="token number">37</span><span class="token punctuation">]</span>: i32
<span class="token number">38</span> <span class="token punctuation">[</span> <span class="token number">38</span><span class="token punctuation">]</span>: i8*
<span class="token number">39</span> <span class="token punctuation">[</span> <span class="token number">39</span><span class="token punctuation">]</span>: i32
<span class="token number">40</span> <span class="token punctuation">[</span> <span class="token number">40</span><span class="token punctuation">]</span>: i8*
<span class="token number">41</span> <span class="token punctuation">[</span> <span class="token number">41</span><span class="token punctuation">]</span>: i64
<span class="token number">42</span> <span class="token punctuation">[</span> <span class="token number">42</span><span class="token punctuation">]</span>: i1
<span class="token number">43</span> <span class="token punctuation">[</span> <span class="token number">43</span><span class="token punctuation">]</span>: i32
<span class="token number">44</span> <span class="token punctuation">[</span> <span class="token number">44</span><span class="token punctuation">]</span>: i1
<span class="token number">45</span> <span class="token punctuation">[</span> <span class="token number">45</span><span class="token punctuation">]</span>: i32
<span class="token number">46</span> <span class="token punctuation">[</span> <span class="token number">46</span><span class="token punctuation">]</span>: i8*
<span class="token number">47</span> <span class="token punctuation">[</span> <span class="token number">47</span><span class="token punctuation">]</span>: i32
<span class="token number">48</span> <span class="token punctuation">[</span> <span class="token number">48</span><span class="token punctuation">]</span>: i8*
<span class="token number">49</span> <span class="token punctuation">[</span> <span class="token number">49</span><span class="token punctuation">]</span>: i32
<span class="token number">50</span> <span class="token punctuation">[</span> <span class="token number">50</span><span class="token punctuation">]</span>: i1
<span class="token number">51</span> <span class="token punctuation">[</span> <span class="token number">51</span><span class="token punctuation">]</span>: i1
<span class="token number">52</span> <span class="token punctuation">[</span> <span class="token number">52</span><span class="token punctuation">]</span>: i32
<span class="token number">53</span> <span class="token punctuation">[</span> <span class="token number">53</span><span class="token punctuation">]</span>: i8*
<span class="token number">54</span> <span class="token punctuation">[</span> <span class="token number">54</span><span class="token punctuation">]</span>: i32
<span class="token number">55</span> <span class="token punctuation">[</span> <span class="token number">55</span><span class="token punctuation">]</span>: i8*
<span class="token number">56</span> <span class="token punctuation">[</span> <span class="token number">56</span><span class="token punctuation">]</span>: i32
<span class="token number">57</span> <span class="token punctuation">[</span> <span class="token number">57</span><span class="token punctuation">]</span>: i1
<span class="token number">58</span> <span class="token punctuation">[</span> <span class="token number">58</span><span class="token punctuation">]</span>: i1
<span class="token number">59</span> <span class="token punctuation">[</span> <span class="token number">59</span><span class="token punctuation">]</span>: i32
<span class="token number">60</span> <span class="token punctuation">[</span> <span class="token number">60</span><span class="token punctuation">]</span>: i8*
<span class="token number">61</span> <span class="token punctuation">[</span> <span class="token number">61</span><span class="token punctuation">]</span>: i32
<span class="token number">62</span> <span class="token punctuation">[</span> <span class="token number">62</span><span class="token punctuation">]</span>: i8*
<span class="token number">63</span> <span class="token punctuation">[</span> <span class="token number">63</span><span class="token punctuation">]</span>: i32
<span class="token number">64</span> <span class="token punctuation">[</span> <span class="token number">64</span><span class="token punctuation">]</span>: i1
<span class="token number">65</span> <span class="token punctuation">[</span> <span class="token number">65</span><span class="token punctuation">]</span>: i1
<span class="token number">66</span> <span class="token punctuation">[</span> <span class="token number">66</span><span class="token punctuation">]</span>: i32
<span class="token number">67</span> <span class="token punctuation">[</span> <span class="token number">67</span><span class="token punctuation">]</span>: i8*
<span class="token number">68</span> <span class="token punctuation">[</span> <span class="token number">68</span><span class="token punctuation">]</span>: i32
<span class="token number">69</span> <span class="token punctuation">[</span> <span class="token number">69</span><span class="token punctuation">]</span>: i8*
<span class="token number">70</span> <span class="token punctuation">[</span> <span class="token number">70</span><span class="token punctuation">]</span>: i32
<span class="token number">71</span> <span class="token punctuation">[</span> <span class="token number">71</span><span class="token punctuation">]</span>: i1
<span class="token number">72</span> <span class="token punctuation">[</span> <span class="token number">72</span><span class="token punctuation">]</span>: i1
<span class="token number">73</span> <span class="token punctuation">[</span> <span class="token number">73</span><span class="token punctuation">]</span>: i32
<span class="token number">74</span> <span class="token punctuation">[</span> <span class="token number">74</span><span class="token punctuation">]</span>: i8*
<span class="token number">75</span> <span class="token punctuation">[</span> <span class="token number">75</span><span class="token punctuation">]</span>: i32
<span class="token number">76</span> <span class="token punctuation">[</span> <span class="token number">76</span><span class="token punctuation">]</span>: i8*
<span class="token number">77</span> <span class="token punctuation">[</span> <span class="token number">77</span><span class="token punctuation">]</span>: i32
<span class="token number">78</span> <span class="token punctuation">[</span> <span class="token number">78</span><span class="token punctuation">]</span>: i1
<span class="token number">79</span> <span class="token punctuation">[</span> <span class="token number">79</span><span class="token punctuation">]</span>: i1
<span class="token number">80</span> <span class="token punctuation">[</span> <span class="token number">80</span><span class="token punctuation">]</span>: i32
<span class="token number">81</span> <span class="token punctuation">[</span> <span class="token number">81</span><span class="token punctuation">]</span>: i8*
<span class="token number">82</span> <span class="token punctuation">[</span> <span class="token number">82</span><span class="token punctuation">]</span>: i32
<span class="token number">83</span> <span class="token punctuation">[</span> <span class="token number">83</span><span class="token punctuation">]</span>: i8*
<span class="token number">84</span> <span class="token punctuation">[</span> <span class="token number">84</span><span class="token punctuation">]</span>: i32
<span class="token number">85</span> <span class="token punctuation">[</span> <span class="token number">85</span><span class="token punctuation">]</span>: i1
<span class="token number">86</span> <span class="token punctuation">[</span> <span class="token number">86</span><span class="token punctuation">]</span>: i1
<span class="token number">87</span> <span class="token punctuation">[</span> <span class="token number">87</span><span class="token punctuation">]</span>: i32
<span class="token number">88</span> <span class="token punctuation">[</span> <span class="token number">88</span><span class="token punctuation">]</span>: i8*
<span class="token number">89</span> <span class="token punctuation">[</span> <span class="token number">89</span><span class="token punctuation">]</span>: i32
<span class="token number">90</span> <span class="token punctuation">[</span> <span class="token number">90</span><span class="token punctuation">]</span>: i8*
<span class="token number">91</span> <span class="token punctuation">[</span> <span class="token number">91</span><span class="token punctuation">]</span>: i32
<span class="token number">92</span> <span class="token punctuation">[</span> <span class="token number">92</span><span class="token punctuation">]</span>: i1
<span class="token number">93</span> <span class="token punctuation">[</span> <span class="token number">93</span><span class="token punctuation">]</span>: i1
<span class="token number">94</span> <span class="token punctuation">[</span> <span class="token number">94</span><span class="token punctuation">]</span>: i32
<span class="token number">95</span> <span class="token punctuation">[</span> <span class="token number">95</span><span class="token punctuation">]</span>: i8*
<span class="token number">96</span> <span class="token punctuation">[</span> <span class="token number">96</span><span class="token punctuation">]</span>: i32
<span class="token number">97</span> <span class="token punctuation">[</span> <span class="token number">97</span><span class="token punctuation">]</span>: i8*
<span class="token number">98</span> <span class="token punctuation">[</span> <span class="token number">98</span><span class="token punctuation">]</span>: i32
<span class="token number">99</span> <span class="token punctuation">[</span> <span class="token number">99</span><span class="token punctuation">]</span>: i1
<span class="token number">100</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span>: i1
<span class="token number">101</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">]</span>: i64
<span class="token number">102</span> <span class="token punctuation">[</span><span class="token number">102</span><span class="token punctuation">]</span>: i64
<span class="token number">103</span> <span class="token punctuation">[</span><span class="token number">103</span><span class="token punctuation">]</span>: i1
------------------------------------------------------------------------
found a total of <span class="token number">72</span> constants
CID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token punctuation">[</span><span class="token number">105</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">2</span> <span class="token punctuation">[</span><span class="token number">106</span><span class="token punctuation">]</span>: <span class="token number">7</span><span class="token punctuation">(</span>0x7<span class="token punctuation">)</span>
<span class="token number">3</span> <span class="token punctuation">[</span><span class="token number">107</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">4</span> <span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">5</span> <span class="token punctuation">[</span><span class="token number">109</span><span class="token punctuation">]</span>: <span class="token number">36</span><span class="token punctuation">(</span>0x24<span class="token punctuation">)</span>
<span class="token number">6</span> <span class="token punctuation">[</span><span class="token number">110</span><span class="token punctuation">]</span>: <span class="token number">32</span><span class="token punctuation">(</span>0x20<span class="token punctuation">)</span>
<span class="token number">7</span> <span class="token punctuation">[</span><span class="token number">111</span><span class="token punctuation">]</span>: <span class="token number">32</span><span class="token punctuation">(</span>0x20<span class="token punctuation">)</span>
<span class="token number">8</span> <span class="token punctuation">[</span><span class="token number">112</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">9</span> <span class="token punctuation">[</span><span class="token number">113</span><span class="token punctuation">]</span>: <span class="token number">1</span><span class="token punctuation">(</span>0x1<span class="token punctuation">)</span>
<span class="token number">10</span> <span class="token punctuation">[</span><span class="token number">114</span><span class="token punctuation">]</span>: <span class="token number">1</span><span class="token punctuation">(</span>0x1<span class="token punctuation">)</span>
<span class="token number">11</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">]</span>: <span class="token number">1</span><span class="token punctuation">(</span>0x1<span class="token punctuation">)</span>
<span class="token number">12</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">13</span> <span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">]</span>: <span class="token number">1</span><span class="token punctuation">(</span>0x1<span class="token punctuation">)</span>
<span class="token number">14</span> <span class="token punctuation">[</span><span class="token number">118</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">15</span> <span class="token punctuation">[</span><span class="token number">119</span><span class="token punctuation">]</span>: <span class="token number">125</span><span class="token punctuation">(</span>0x7d<span class="token punctuation">)</span>
<span class="token number">16</span> <span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">17</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">]</span>: <span class="token number">1</span><span class="token punctuation">(</span>0x1<span class="token punctuation">)</span>
<span class="token number">18</span> <span class="token punctuation">[</span><span class="token number">122</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">19</span> <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">20</span> <span class="token punctuation">[</span><span class="token number">124</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">21</span> <span class="token punctuation">[</span><span class="token number">125</span><span class="token punctuation">]</span>: <span class="token number">32</span><span class="token punctuation">(</span>0x20<span class="token punctuation">)</span>
<span class="token number">22</span> <span class="token punctuation">[</span><span class="token number">126</span><span class="token punctuation">]</span>: <span class="token number">32</span><span class="token punctuation">(</span>0x20<span class="token punctuation">)</span>
<span class="token number">23</span> <span class="token punctuation">[</span><span class="token number">127</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">24</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span>: <span class="token number">30</span><span class="token punctuation">(</span>0x1e<span class="token punctuation">)</span>
<span class="token number">25</span> <span class="token punctuation">[</span><span class="token number">129</span><span class="token punctuation">]</span>: <span class="token number">32</span><span class="token punctuation">(</span>0x20<span class="token punctuation">)</span>
<span class="token number">26</span> <span class="token punctuation">[</span><span class="token number">130</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">27</span> <span class="token punctuation">[</span><span class="token number">131</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">28</span> <span class="token punctuation">[</span><span class="token number">132</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">29</span> <span class="token punctuation">[</span><span class="token number">133</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">30</span> <span class="token punctuation">[</span><span class="token number">134</span><span class="token punctuation">]</span>: <span class="token number">36</span><span class="token punctuation">(</span>0x24<span class="token punctuation">)</span>
<span class="token number">31</span> <span class="token punctuation">[</span><span class="token number">135</span><span class="token punctuation">]</span>: <span class="token number">1939767458</span><span class="token punctuation">(</span>0x739e80a2<span class="token punctuation">)</span>
<span class="token number">32</span> <span class="token punctuation">[</span><span class="token number">136</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">33</span> <span class="token punctuation">[</span><span class="token number">137</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">34</span> <span class="token punctuation">[</span><span class="token number">138</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">35</span> <span class="token punctuation">[</span><span class="token number">139</span><span class="token punctuation">]</span>: <span class="token number">1</span><span class="token punctuation">(</span>0x1<span class="token punctuation">)</span>
<span class="token number">36</span> <span class="token punctuation">[</span><span class="token number">140</span><span class="token punctuation">]</span>: <span class="token number">984514723</span><span class="token punctuation">(</span>0x3aae80a3<span class="token punctuation">)</span>
<span class="token number">37</span> <span class="token punctuation">[</span><span class="token number">141</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">38</span> <span class="token punctuation">[</span><span class="token number">142</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">39</span> <span class="token punctuation">[</span><span class="token number">143</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">40</span> <span class="token punctuation">[</span><span class="token number">144</span><span class="token punctuation">]</span>: <span class="token number">2</span><span class="token punctuation">(</span>0x2<span class="token punctuation">)</span>
<span class="token number">41</span> <span class="token punctuation">[</span><span class="token number">145</span><span class="token punctuation">]</span>: <span class="token number">1000662943</span><span class="token punctuation">(</span>0x3ba4e79f<span class="token punctuation">)</span>
<span class="token number">42</span> <span class="token punctuation">[</span><span class="token number">146</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">43</span> <span class="token punctuation">[</span><span class="token number">147</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">44</span> <span class="token punctuation">[</span><span class="token number">148</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">45</span> <span class="token punctuation">[</span><span class="token number">149</span><span class="token punctuation">]</span>: <span class="token number">3</span><span class="token punctuation">(</span>0x3<span class="token punctuation">)</span>
<span class="token number">46</span> <span class="token punctuation">[</span><span class="token number">150</span><span class="token punctuation">]</span>: <span class="token number">2025505267</span><span class="token punctuation">(</span>0x78bac1f3<span class="token punctuation">)</span>
<span class="token number">47</span> <span class="token punctuation">[</span><span class="token number">151</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">48</span> <span class="token punctuation">[</span><span class="token number">152</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">49</span> <span class="token punctuation">[</span><span class="token number">153</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">50</span> <span class="token punctuation">[</span><span class="token number">154</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">51</span> <span class="token punctuation">[</span><span class="token number">155</span><span class="token punctuation">]</span>: <span class="token number">1593426419</span><span class="token punctuation">(</span>0x5ef9c1f3<span class="token punctuation">)</span>
<span class="token number">52</span> <span class="token punctuation">[</span><span class="token number">156</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">53</span> <span class="token punctuation">[</span><span class="token number">157</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">54</span> <span class="token punctuation">[</span><span class="token number">158</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">55</span> <span class="token punctuation">[</span><span class="token number">159</span><span class="token punctuation">]</span>: <span class="token number">5</span><span class="token punctuation">(</span>0x5<span class="token punctuation">)</span>
<span class="token number">56</span> <span class="token punctuation">[</span><span class="token number">160</span><span class="token punctuation">]</span>: <span class="token number">1002040479</span><span class="token punctuation">(</span>0x3bb9ec9f<span class="token punctuation">)</span>
<span class="token number">57</span> <span class="token punctuation">[</span><span class="token number">161</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">58</span> <span class="token punctuation">[</span><span class="token number">162</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">59</span> <span class="token punctuation">[</span><span class="token number">163</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">60</span> <span class="token punctuation">[</span><span class="token number">164</span><span class="token punctuation">]</span>: <span class="token number">6</span><span class="token punctuation">(</span>0x6<span class="token punctuation">)</span>
<span class="token number">61</span> <span class="token punctuation">[</span><span class="token number">165</span><span class="token punctuation">]</span>: <span class="token number">1434878964</span><span class="token punctuation">(</span>0x558683f4<span class="token punctuation">)</span>
<span class="token number">62</span> <span class="token punctuation">[</span><span class="token number">166</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">63</span> <span class="token punctuation">[</span><span class="token number">167</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">64</span> <span class="token punctuation">[</span><span class="token number">168</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">65</span> <span class="token punctuation">[</span><span class="token number">169</span><span class="token punctuation">]</span>: <span class="token number">7</span><span class="token punctuation">(</span>0x7<span class="token punctuation">)</span>
<span class="token number">66</span> <span class="token punctuation">[</span><span class="token number">170</span><span class="token punctuation">]</span>: <span class="token number">1442502036</span><span class="token punctuation">(</span>0x55fad594<span class="token punctuation">)</span>
<span class="token number">67</span> <span class="token punctuation">[</span><span class="token number">171</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">68</span> <span class="token punctuation">[</span><span class="token number">172</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">69</span> <span class="token punctuation">[</span><span class="token number">173</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">70</span> <span class="token punctuation">[</span><span class="token number">174</span><span class="token punctuation">]</span>: <span class="token number">8</span><span class="token punctuation">(</span>0x8<span class="token punctuation">)</span>
<span class="token number">71</span> <span class="token punctuation">[</span><span class="token number">175</span><span class="token punctuation">]</span>: <span class="token number">1824513439</span><span class="token punctuation">(</span>0x6cbfdd9f<span class="token punctuation">)</span>
------------------------------------------------------------------------
found a total of <span class="token number">176</span> total values
------------------------------------------------------------------------
FUNCTION ID: F.1 -<span class="token operator">></span> NUMINSTS <span class="token number">115</span>
BB   IDX  OPCODE              <span class="token punctuation">[</span>ID /IID/MOD<span class="token punctuation">]</span>  INST
------------------------------------------------------------------------
<span class="token number">0</span>    <span class="token number">0</span>  OP_BC_GEPZ          <span class="token punctuation">[</span><span class="token number">36</span> /184/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">5</span> <span class="token operator">=</span> gepz p.4 + <span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span>
<span class="token number">0</span>    <span class="token number">1</span>  OP_BC_GEPZ          <span class="token punctuation">[</span><span class="token number">36</span> /184/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">7</span> <span class="token operator">=</span> gepz p.6 + <span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">)</span>
<span class="token number">0</span>    <span class="token number">2</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">8</span> <span class="token operator">=</span> seek<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">106</span>, <span class="token number">107</span><span class="token punctuation">)</span>
<span class="token number">0</span>    <span class="token number">3</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">108</span> -<span class="token operator">></span> <span class="token number">2</span>
<span class="token number">0</span>    <span class="token number">4</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.2

<span class="token number">1</span>    <span class="token number">5</span>  OP_BC_ICMP_ULT      <span class="token punctuation">[</span><span class="token number">25</span> /129/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">9</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">18</span> <span class="token operator">&lt;</span> <span class="token number">109</span><span class="token punctuation">)</span>
<span class="token number">1</span>    <span class="token number">6</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">18</span> -<span class="token operator">></span> <span class="token number">2</span>
<span class="token number">1</span>    <span class="token number">7</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">9</span> ? bb.2 <span class="token builtin class-name">:</span> bb.3

<span class="token number">2</span>    <span class="token number">8</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">2</span> -<span class="token operator">></span> <span class="token number">10</span>
<span class="token number">2</span>    <span class="token number">9</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">44</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">11</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">&lt;&lt;</span> <span class="token number">110</span>
<span class="token number">2</span>   <span class="token number">10</span>  OP_BC_ASHR          <span class="token punctuation">[</span><span class="token number">10</span> / <span class="token number">54</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">12</span> <span class="token operator">=</span> <span class="token number">11</span> <span class="token operator">>></span> <span class="token number">111</span>
<span class="token number">2</span>   <span class="token number">11</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">13</span> <span class="token operator">=</span> <span class="token number">12</span> trunc ffffffffffffffff
<span class="token number">2</span>   <span class="token number">12</span>  OP_BC_GEPZ          <span class="token punctuation">[</span><span class="token number">36</span> /184/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">14</span> <span class="token operator">=</span> gepz p.4 + <span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span>
<span class="token number">2</span>   <span class="token number">13</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">15</span> <span class="token operator">=</span> gep1 p.14 + <span class="token punctuation">(</span><span class="token number">13</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">2</span>   <span class="token number">14</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">16</span> <span class="token operator">=</span> read<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.15, <span class="token number">113</span><span class="token punctuation">)</span>
<span class="token number">2</span>   <span class="token number">15</span>  OP_BC_ICMP_SLT      <span class="token punctuation">[</span><span class="token number">30</span> /153/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">17</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">&lt;</span> <span class="token number">114</span><span class="token punctuation">)</span>
<span class="token number">2</span>   <span class="token number">16</span>  OP_BC_ADD           <span class="token punctuation">[</span><span class="token number">1</span>  /  <span class="token number">9</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">18</span> <span class="token operator">=</span> <span class="token number">10</span> + <span class="token number">115</span>
<span class="token number">2</span>   <span class="token number">17</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">116</span> -<span class="token operator">></span> <span class="token number">0</span>
<span class="token number">2</span>   <span class="token number">18</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">17</span> ? bb.7 <span class="token builtin class-name">:</span> bb.1

<span class="token number">3</span>   <span class="token number">19</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">19</span> <span class="token operator">=</span> read<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.3, <span class="token number">117</span><span class="token punctuation">)</span>
<span class="token number">3</span>   <span class="token number">20</span>  OP_BC_ICMP_SGT      <span class="token punctuation">[</span><span class="token number">27</span> /138/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">20</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">19</span> <span class="token operator">></span> <span class="token number">118</span><span class="token punctuation">)</span>
<span class="token number">3</span>   <span class="token number">21</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /171/  <span class="token number">1</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">3</span> -<span class="token operator">></span> <span class="token number">21</span>
<span class="token number">3</span>   <span class="token number">22</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /106/  <span class="token number">1</span><span class="token punctuation">]</span>  <span class="token number">22</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">21</span> <span class="token operator">==</span> <span class="token number">119</span><span class="token punctuation">)</span>
<span class="token number">3</span>   <span class="token number">23</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">23</span> <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">&amp;</span> <span class="token number">22</span>
<span class="token number">3</span>   <span class="token number">24</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">120</span> -<span class="token operator">></span> <span class="token number">0</span>
<span class="token number">3</span>   <span class="token number">25</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">23</span> ? bb.4 <span class="token builtin class-name">:</span> bb.7

<span class="token number">4</span>   <span class="token number">26</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">24</span> <span class="token operator">=</span> read<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.3, <span class="token number">121</span><span class="token punctuation">)</span>
<span class="token number">4</span>   <span class="token number">27</span>  OP_BC_ICMP_SGT      <span class="token punctuation">[</span><span class="token number">27</span> /138/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">25</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">></span> <span class="token number">122</span><span class="token punctuation">)</span>
<span class="token number">4</span>   <span class="token number">28</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">123</span> -<span class="token operator">></span> <span class="token number">1</span>
<span class="token number">4</span>   <span class="token number">29</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">124</span> -<span class="token operator">></span> <span class="token number">0</span>
<span class="token number">4</span>   <span class="token number">30</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">25</span> ? bb.7 <span class="token builtin class-name">:</span> bb.5

<span class="token number">5</span>   <span class="token number">31</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">1</span> -<span class="token operator">></span> <span class="token number">26</span>
<span class="token number">5</span>   <span class="token number">32</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">44</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">27</span> <span class="token operator">=</span> <span class="token number">26</span> <span class="token operator">&lt;&lt;</span> <span class="token number">125</span>
<span class="token number">5</span>   <span class="token number">33</span>  OP_BC_ASHR          <span class="token punctuation">[</span><span class="token number">10</span> / <span class="token number">54</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">28</span> <span class="token operator">=</span> <span class="token number">27</span> <span class="token operator">>></span> <span class="token number">126</span>
<span class="token number">5</span>   <span class="token number">34</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">29</span> <span class="token operator">=</span> <span class="token number">28</span> trunc ffffffffffffffff
<span class="token number">5</span>   <span class="token number">35</span>  OP_BC_GEPZ          <span class="token punctuation">[</span><span class="token number">36</span> /184/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">30</span> <span class="token operator">=</span> gepz p.4 + <span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">36</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">31</span> <span class="token operator">=</span> gep1 p.30 + <span class="token punctuation">(</span><span class="token number">29</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">37</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">32</span> <span class="token operator">&lt;</span>- p.31
<span class="token number">5</span>   <span class="token number">38</span>  OP_BC_CALL_DIRECT   <span class="token punctuation">[</span><span class="token number">32</span> /163/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">33</span> <span class="token operator">=</span> call F.2 <span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">39</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">44</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">34</span> <span class="token operator">=</span> <span class="token number">26</span> <span class="token operator">&lt;&lt;</span> <span class="token number">128</span>
<span class="token number">5</span>   <span class="token number">40</span>  OP_BC_ASHR          <span class="token punctuation">[</span><span class="token number">10</span> / <span class="token number">54</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">35</span> <span class="token operator">=</span> <span class="token number">34</span> <span class="token operator">>></span> <span class="token number">129</span>
<span class="token number">5</span>   <span class="token number">41</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">36</span> <span class="token operator">=</span> <span class="token number">35</span> trunc ffffffffffffffff
<span class="token number">5</span>   <span class="token number">42</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">37</span> <span class="token operator">=</span> <span class="token number">130</span> * <span class="token number">131</span>
<span class="token number">5</span>   <span class="token number">43</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">38</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">37</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">44</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">39</span> <span class="token operator">=</span> <span class="token number">132</span> * <span class="token number">36</span>
<span class="token number">5</span>   <span class="token number">45</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">40</span> <span class="token operator">=</span> gep1 p.38 + <span class="token punctuation">(</span><span class="token number">39</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">46</span>  OP_BC_STORE         <span class="token punctuation">[</span><span class="token number">38</span> /193/  <span class="token number">3</span><span class="token punctuation">]</span>  store <span class="token number">33</span> -<span class="token operator">></span> p.40
<span class="token number">5</span>   <span class="token number">47</span>  OP_BC_ADD           <span class="token punctuation">[</span><span class="token number">1</span>  /  <span class="token number">9</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">41</span> <span class="token operator">=</span> <span class="token number">26</span> + <span class="token number">133</span>
<span class="token number">5</span>   <span class="token number">48</span>  OP_BC_ICMP_ULT      <span class="token punctuation">[</span><span class="token number">25</span> /129/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">42</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">41</span> <span class="token operator">&lt;</span> <span class="token number">134</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">49</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">41</span> -<span class="token operator">></span> <span class="token number">1</span>
<span class="token number">5</span>   <span class="token number">50</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">42</span> ? bb.5 <span class="token builtin class-name">:</span> bb.6

<span class="token number">6</span>   <span class="token number">51</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">43</span> <span class="token operator">&lt;</span>- p.7
<span class="token number">6</span>   <span class="token number">52</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">44</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">43</span> <span class="token operator">==</span> <span class="token number">135</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">53</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">45</span> <span class="token operator">=</span> <span class="token number">136</span> * <span class="token number">137</span>
<span class="token number">6</span>   <span class="token number">54</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">46</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">45</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">55</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">47</span> <span class="token operator">=</span> <span class="token number">138</span> * <span class="token number">139</span>
<span class="token number">6</span>   <span class="token number">56</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">48</span> <span class="token operator">=</span> gep1 p.46 + <span class="token punctuation">(</span><span class="token number">47</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">57</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">49</span> <span class="token operator">&lt;</span>- p.48
<span class="token number">6</span>   <span class="token number">58</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">50</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">49</span> <span class="token operator">==</span> <span class="token number">140</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">59</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">51</span> <span class="token operator">=</span> <span class="token number">44</span> <span class="token operator">&amp;</span> <span class="token number">50</span>
<span class="token number">6</span>   <span class="token number">60</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">52</span> <span class="token operator">=</span> <span class="token number">141</span> * <span class="token number">142</span>
<span class="token number">6</span>   <span class="token number">61</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">53</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">52</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">62</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">54</span> <span class="token operator">=</span> <span class="token number">143</span> * <span class="token number">144</span>
<span class="token number">6</span>   <span class="token number">63</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">55</span> <span class="token operator">=</span> gep1 p.53 + <span class="token punctuation">(</span><span class="token number">54</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">64</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">56</span> <span class="token operator">&lt;</span>- p.55
<span class="token number">6</span>   <span class="token number">65</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">57</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">56</span> <span class="token operator">==</span> <span class="token number">145</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">66</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">58</span> <span class="token operator">=</span> <span class="token number">51</span> <span class="token operator">&amp;</span> <span class="token number">57</span>
<span class="token number">6</span>   <span class="token number">67</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">59</span> <span class="token operator">=</span> <span class="token number">146</span> * <span class="token number">147</span>
<span class="token number">6</span>   <span class="token number">68</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">60</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">59</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">69</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">61</span> <span class="token operator">=</span> <span class="token number">148</span> * <span class="token number">149</span>
<span class="token number">6</span>   <span class="token number">70</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">62</span> <span class="token operator">=</span> gep1 p.60 + <span class="token punctuation">(</span><span class="token number">61</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">71</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">63</span> <span class="token operator">&lt;</span>- p.62
<span class="token number">6</span>   <span class="token number">72</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">64</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">63</span> <span class="token operator">==</span> <span class="token number">150</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">73</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">65</span> <span class="token operator">=</span> <span class="token number">58</span> <span class="token operator">&amp;</span> <span class="token number">64</span>
<span class="token number">6</span>   <span class="token number">74</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">66</span> <span class="token operator">=</span> <span class="token number">151</span> * <span class="token number">152</span>
<span class="token number">6</span>   <span class="token number">75</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">67</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">66</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">76</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">68</span> <span class="token operator">=</span> <span class="token number">153</span> * <span class="token number">154</span>
<span class="token number">6</span>   <span class="token number">77</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">69</span> <span class="token operator">=</span> gep1 p.67 + <span class="token punctuation">(</span><span class="token number">68</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">78</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">70</span> <span class="token operator">&lt;</span>- p.69
<span class="token number">6</span>   <span class="token number">79</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">71</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">70</span> <span class="token operator">==</span> <span class="token number">155</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">80</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">72</span> <span class="token operator">=</span> <span class="token number">65</span> <span class="token operator">&amp;</span> <span class="token number">71</span>
<span class="token number">6</span>   <span class="token number">81</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">73</span> <span class="token operator">=</span> <span class="token number">156</span> * <span class="token number">157</span>
<span class="token number">6</span>   <span class="token number">82</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">74</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">73</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">83</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">75</span> <span class="token operator">=</span> <span class="token number">158</span> * <span class="token number">159</span>
<span class="token number">6</span>   <span class="token number">84</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">76</span> <span class="token operator">=</span> gep1 p.74 + <span class="token punctuation">(</span><span class="token number">75</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">85</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">77</span> <span class="token operator">&lt;</span>- p.76
<span class="token number">6</span>   <span class="token number">86</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">78</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">77</span> <span class="token operator">==</span> <span class="token number">160</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">87</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">79</span> <span class="token operator">=</span> <span class="token number">72</span> <span class="token operator">&amp;</span> <span class="token number">78</span>
<span class="token number">6</span>   <span class="token number">88</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">80</span> <span class="token operator">=</span> <span class="token number">161</span> * <span class="token number">162</span>
<span class="token number">6</span>   <span class="token number">89</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">81</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">80</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">90</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">82</span> <span class="token operator">=</span> <span class="token number">163</span> * <span class="token number">164</span>
<span class="token number">6</span>   <span class="token number">91</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">83</span> <span class="token operator">=</span> gep1 p.81 + <span class="token punctuation">(</span><span class="token number">82</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">92</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">84</span> <span class="token operator">&lt;</span>- p.83
<span class="token number">6</span>   <span class="token number">93</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">85</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">84</span> <span class="token operator">==</span> <span class="token number">165</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">94</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">86</span> <span class="token operator">=</span> <span class="token number">79</span> <span class="token operator">&amp;</span> <span class="token number">85</span>
<span class="token number">6</span>   <span class="token number">95</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">87</span> <span class="token operator">=</span> <span class="token number">166</span> * <span class="token number">167</span>
<span class="token number">6</span>   <span class="token number">96</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">88</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">87</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">97</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">89</span> <span class="token operator">=</span> <span class="token number">168</span> * <span class="token number">169</span>
<span class="token number">6</span>   <span class="token number">98</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">90</span> <span class="token operator">=</span> gep1 p.88 + <span class="token punctuation">(</span><span class="token number">89</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>   <span class="token number">99</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">91</span> <span class="token operator">&lt;</span>- p.90
<span class="token number">6</span>  <span class="token number">100</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">92</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">91</span> <span class="token operator">==</span> <span class="token number">170</span><span class="token punctuation">)</span>
<span class="token number">6</span>  <span class="token number">101</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">93</span> <span class="token operator">=</span> <span class="token number">86</span> <span class="token operator">&amp;</span> <span class="token number">92</span>
<span class="token number">6</span>  <span class="token number">102</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">94</span> <span class="token operator">=</span> <span class="token number">171</span> * <span class="token number">172</span>
<span class="token number">6</span>  <span class="token number">103</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">95</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">94</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>  <span class="token number">104</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">96</span> <span class="token operator">=</span> <span class="token number">173</span> * <span class="token number">174</span>
<span class="token number">6</span>  <span class="token number">105</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">97</span> <span class="token operator">=</span> gep1 p.95 + <span class="token punctuation">(</span><span class="token number">96</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>  <span class="token number">106</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">98</span> <span class="token operator">&lt;</span>- p.97
<span class="token number">6</span>  <span class="token number">107</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">99</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">98</span> <span class="token operator">==</span> <span class="token number">175</span><span class="token punctuation">)</span>
<span class="token number">6</span>  <span class="token number">108</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">100</span> <span class="token operator">=</span> <span class="token number">93</span> <span class="token operator">&amp;</span> <span class="token number">99</span>
<span class="token number">6</span>  <span class="token number">109</span>  OP_BC_SEXT          <span class="token punctuation">[</span><span class="token number">15</span> / <span class="token number">79</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">101</span> <span class="token operator">=</span> <span class="token number">100</span> sext <span class="token number">1</span>
<span class="token number">6</span>  <span class="token number">110</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">101</span> -<span class="token operator">></span> <span class="token number">0</span>
<span class="token number">6</span>  <span class="token number">111</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.7

<span class="token number">7</span>  <span class="token number">112</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">0</span> -<span class="token operator">></span> <span class="token number">102</span>
<span class="token number">7</span>  <span class="token number">113</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">70</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">103</span> <span class="token operator">=</span> <span class="token number">102</span> trunc ffffffffffffffff
<span class="token number">7</span>  <span class="token number">114</span>  OP_BC_RET           <span class="token punctuation">[</span><span class="token number">19</span> / <span class="token number">95</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  ret <span class="token number">103</span>
------------------------------------------------------------------------
<span class="token comment">########################################################################</span>
<span class="token comment">####################### Function id   2 ################################</span>
<span class="token comment">########################################################################</span>
found a total of <span class="token number">4</span> globals
GID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: i0 unknown
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: <span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span> unknown
<span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: i8* unknown
<span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: i8* unknown
------------------------------------------------------------------------
found <span class="token number">18</span> values with <span class="token number">1</span> arguments and <span class="token number">17</span> locals
VID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: i32 argument
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: alloc i64
<span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: alloc i64
<span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: i64
<span class="token number">4</span> <span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>: i64
<span class="token number">5</span> <span class="token punctuation">[</span>  <span class="token number">5</span><span class="token punctuation">]</span>: i32
<span class="token number">6</span> <span class="token punctuation">[</span>  <span class="token number">6</span><span class="token punctuation">]</span>: i32
<span class="token number">7</span> <span class="token punctuation">[</span>  <span class="token number">7</span><span class="token punctuation">]</span>: i32
<span class="token number">8</span> <span class="token punctuation">[</span>  <span class="token number">8</span><span class="token punctuation">]</span>: i32
<span class="token number">9</span> <span class="token punctuation">[</span>  <span class="token number">9</span><span class="token punctuation">]</span>: i32
<span class="token number">10</span> <span class="token punctuation">[</span> <span class="token number">10</span><span class="token punctuation">]</span>: i32
<span class="token number">11</span> <span class="token punctuation">[</span> <span class="token number">11</span><span class="token punctuation">]</span>: i32
<span class="token number">12</span> <span class="token punctuation">[</span> <span class="token number">12</span><span class="token punctuation">]</span>: i32
<span class="token number">13</span> <span class="token punctuation">[</span> <span class="token number">13</span><span class="token punctuation">]</span>: i32
<span class="token number">14</span> <span class="token punctuation">[</span> <span class="token number">14</span><span class="token punctuation">]</span>: i32
<span class="token number">15</span> <span class="token punctuation">[</span> <span class="token number">15</span><span class="token punctuation">]</span>: i1
<span class="token number">16</span> <span class="token punctuation">[</span> <span class="token number">16</span><span class="token punctuation">]</span>: i64
<span class="token number">17</span> <span class="token punctuation">[</span> <span class="token number">17</span><span class="token punctuation">]</span>: i64
------------------------------------------------------------------------
found a total of <span class="token number">8</span> constants
CID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span> <span class="token number">18</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token punctuation">[</span> <span class="token number">19</span><span class="token punctuation">]</span>: <span class="token number">181056448</span><span class="token punctuation">(</span>0xacab3c0<span class="token punctuation">)</span>
<span class="token number">2</span> <span class="token punctuation">[</span> <span class="token number">20</span><span class="token punctuation">]</span>: <span class="token number">3</span><span class="token punctuation">(</span>0x3<span class="token punctuation">)</span>
<span class="token number">3</span> <span class="token punctuation">[</span> <span class="token number">21</span><span class="token punctuation">]</span>: <span class="token number">255</span><span class="token punctuation">(</span>0xff<span class="token punctuation">)</span>
<span class="token number">4</span> <span class="token punctuation">[</span> <span class="token number">22</span><span class="token punctuation">]</span>: <span class="token number">8</span><span class="token punctuation">(</span>0x8<span class="token punctuation">)</span>
<span class="token number">5</span> <span class="token punctuation">[</span> <span class="token number">23</span><span class="token punctuation">]</span>: <span class="token number">24</span><span class="token punctuation">(</span>0x18<span class="token punctuation">)</span>
<span class="token number">6</span> <span class="token punctuation">[</span> <span class="token number">24</span><span class="token punctuation">]</span>: <span class="token number">1</span><span class="token punctuation">(</span>0x1<span class="token punctuation">)</span>
<span class="token number">7</span> <span class="token punctuation">[</span> <span class="token number">25</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
------------------------------------------------------------------------
found a total of <span class="token number">26</span> total values
------------------------------------------------------------------------
FUNCTION ID: F.2 -<span class="token operator">></span> NUMINSTS <span class="token number">22</span>
BB   IDX  OPCODE              <span class="token punctuation">[</span>ID /IID/MOD<span class="token punctuation">]</span>  INST
------------------------------------------------------------------------
<span class="token number">0</span>    <span class="token number">0</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">18</span> -<span class="token operator">></span> <span class="token number">2</span>
<span class="token number">0</span>    <span class="token number">1</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">19</span> -<span class="token operator">></span> <span class="token number">1</span>
<span class="token number">0</span>    <span class="token number">2</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.1

<span class="token number">1</span>    <span class="token number">3</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">1</span> -<span class="token operator">></span> <span class="token number">3</span>
<span class="token number">1</span>    <span class="token number">4</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">2</span> -<span class="token operator">></span> <span class="token number">4</span>
<span class="token number">1</span>    <span class="token number">5</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">3</span> trunc ffffffffffffffff
<span class="token number">1</span>    <span class="token number">6</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">4</span> trunc ffffffffffffffff
<span class="token number">1</span>    <span class="token number">7</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">43</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span>
<span class="token number">1</span>    <span class="token number">8</span>  OP_BC_LSHR          <span class="token punctuation">[</span><span class="token number">9</span>  / <span class="token number">48</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">8</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">>></span> <span class="token number">7</span>
<span class="token number">1</span>    <span class="token number">9</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">58</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">9</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">21</span>
<span class="token number">1</span>   <span class="token number">10</span>  OP_BC_XOR           <span class="token punctuation">[</span><span class="token number">13</span> / <span class="token number">68</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">10</span> <span class="token operator">=</span> <span class="token number">9</span> ^ <span class="token number">5</span>
<span class="token number">1</span>   <span class="token number">11</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">43</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">11</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">&lt;&lt;</span> <span class="token number">22</span>
<span class="token number">1</span>   <span class="token number">12</span>  OP_BC_LSHR          <span class="token punctuation">[</span><span class="token number">9</span>  / <span class="token number">48</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">12</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">>></span> <span class="token number">23</span>
<span class="token number">1</span>   <span class="token number">13</span>  OP_BC_OR            <span class="token punctuation">[</span><span class="token number">12</span> / <span class="token number">63</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">13</span> <span class="token operator">=</span> <span class="token number">11</span> <span class="token operator">|</span> <span class="token number">12</span>
<span class="token number">1</span>   <span class="token number">14</span>  OP_BC_ADD           <span class="token punctuation">[</span><span class="token number">1</span>  /  <span class="token number">8</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">14</span> <span class="token operator">=</span> <span class="token number">6</span> + <span class="token number">24</span>
<span class="token number">1</span>   <span class="token number">15</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">15</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">14</span> <span class="token operator">==</span> <span class="token number">25</span><span class="token punctuation">)</span>
<span class="token number">1</span>   <span class="token number">16</span>  OP_BC_SEXT          <span class="token punctuation">[</span><span class="token number">15</span> / <span class="token number">79</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">16</span> <span class="token operator">=</span> <span class="token number">14</span> sext <span class="token number">20</span>
<span class="token number">1</span>   <span class="token number">17</span>  OP_BC_SEXT          <span class="token punctuation">[</span><span class="token number">15</span> / <span class="token number">79</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">17</span> <span class="token operator">=</span> <span class="token number">13</span> sext <span class="token number">20</span>
<span class="token number">1</span>   <span class="token number">18</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">16</span> -<span class="token operator">></span> <span class="token number">2</span>
<span class="token number">1</span>   <span class="token number">19</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">17</span> -<span class="token operator">></span> <span class="token number">1</span>
<span class="token number">1</span>   <span class="token number">20</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">15</span> ? bb.2 <span class="token builtin class-name">:</span> bb.1

<span class="token number">2</span>   <span class="token number">21</span>  OP_BC_RET           <span class="token punctuation">[</span><span class="token number">19</span> / <span class="token number">98</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  ret <span class="token number">13</span>
------------------------------------------------------------------------</code></pre></div>
<p>このシグネチャでは、ID 0 から 2 までの 3 つの関数が定義されているようです。</p>
<p>このうち、以下の ID 0 の関数が entrypoint のように見えます。</p>
<p>この中では、<code class="language-text">call F.1 ()</code> の結果を評価し、True の場合には foundVirus が返される実装になっています。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">BB   IDX  OPCODE              <span class="token punctuation">[</span>ID /IID/MOD<span class="token punctuation">]</span>  INST
------------------------------------------------------------------------
<span class="token number">0</span>    <span class="token number">0</span>  OP_BC_CALL_DIRECT   <span class="token punctuation">[</span><span class="token number">32</span> /160/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">0</span> <span class="token operator">=</span> call F.1 <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">0</span>    <span class="token number">1</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">0</span> ? bb.1 <span class="token builtin class-name">:</span> bb.2

<span class="token number">1</span>    <span class="token number">2</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">1</span> <span class="token operator">=</span> setvirusname<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.-2147483645, <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">1</span>    <span class="token number">3</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.2

<span class="token number">2</span>    <span class="token number">4</span>  OP_BC_RET           <span class="token punctuation">[</span><span class="token number">19</span> / <span class="token number">98</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  ret <span class="token number">3</span></code></pre></div>
<p>そのため、<code class="language-text">call F.1 ()</code> が True を返す入力が正しい Flag になることを予想できます。</p>
<p>ID 1 の関数では何かしらの値を比較しているようです。</p>
<p>また、その中では <code class="language-text">call F.2 (32)</code> により ID 2 の関数が実行されています。</p>
<h3 id="func2-の調査" style="position:relative;"><a href="#func2-%E3%81%AE%E8%AA%BF%E6%9F%BB" aria-label="func2 の調査 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Func2 の調査</h3>
<p>ID 1 の関数がメインの処理のようですが、先にコード量の少ない ID 2 の関数を調べることにします。</p>
<p>以下は ID 2 の関数(以降 Func2)の逆アセンブル結果です。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">########################################################################</span>
<span class="token comment">####################### Function id   2 ################################</span>
<span class="token comment">########################################################################</span>
found a total of <span class="token number">4</span> globals
GID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: i0 unknown
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: <span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span> unknown
<span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: i8* unknown
<span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: i8* unknown
------------------------------------------------------------------------
found <span class="token number">18</span> values with <span class="token number">1</span> arguments and <span class="token number">17</span> locals
VID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span>  <span class="token number">0</span><span class="token punctuation">]</span>: i32 argument
<span class="token number">1</span> <span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">]</span>: alloc i64
<span class="token number">2</span> <span class="token punctuation">[</span>  <span class="token number">2</span><span class="token punctuation">]</span>: alloc i64
<span class="token number">3</span> <span class="token punctuation">[</span>  <span class="token number">3</span><span class="token punctuation">]</span>: i64
<span class="token number">4</span> <span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>: i64
<span class="token number">5</span> <span class="token punctuation">[</span>  <span class="token number">5</span><span class="token punctuation">]</span>: i32
<span class="token number">6</span> <span class="token punctuation">[</span>  <span class="token number">6</span><span class="token punctuation">]</span>: i32
<span class="token number">7</span> <span class="token punctuation">[</span>  <span class="token number">7</span><span class="token punctuation">]</span>: i32
<span class="token number">8</span> <span class="token punctuation">[</span>  <span class="token number">8</span><span class="token punctuation">]</span>: i32
<span class="token number">9</span> <span class="token punctuation">[</span>  <span class="token number">9</span><span class="token punctuation">]</span>: i32
<span class="token number">10</span> <span class="token punctuation">[</span> <span class="token number">10</span><span class="token punctuation">]</span>: i32
<span class="token number">11</span> <span class="token punctuation">[</span> <span class="token number">11</span><span class="token punctuation">]</span>: i32
<span class="token number">12</span> <span class="token punctuation">[</span> <span class="token number">12</span><span class="token punctuation">]</span>: i32
<span class="token number">13</span> <span class="token punctuation">[</span> <span class="token number">13</span><span class="token punctuation">]</span>: i32
<span class="token number">14</span> <span class="token punctuation">[</span> <span class="token number">14</span><span class="token punctuation">]</span>: i32
<span class="token number">15</span> <span class="token punctuation">[</span> <span class="token number">15</span><span class="token punctuation">]</span>: i1
<span class="token number">16</span> <span class="token punctuation">[</span> <span class="token number">16</span><span class="token punctuation">]</span>: i64
<span class="token number">17</span> <span class="token punctuation">[</span> <span class="token number">17</span><span class="token punctuation">]</span>: i64
------------------------------------------------------------------------
found a total of <span class="token number">8</span> constants
CID  ID    VALUE
------------------------------------------------------------------------
<span class="token number">0</span> <span class="token punctuation">[</span> <span class="token number">18</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token punctuation">[</span> <span class="token number">19</span><span class="token punctuation">]</span>: <span class="token number">181056448</span><span class="token punctuation">(</span>0xacab3c0<span class="token punctuation">)</span>
<span class="token number">2</span> <span class="token punctuation">[</span> <span class="token number">20</span><span class="token punctuation">]</span>: <span class="token number">3</span><span class="token punctuation">(</span>0x3<span class="token punctuation">)</span>
<span class="token number">3</span> <span class="token punctuation">[</span> <span class="token number">21</span><span class="token punctuation">]</span>: <span class="token number">255</span><span class="token punctuation">(</span>0xff<span class="token punctuation">)</span>
<span class="token number">4</span> <span class="token punctuation">[</span> <span class="token number">22</span><span class="token punctuation">]</span>: <span class="token number">8</span><span class="token punctuation">(</span>0x8<span class="token punctuation">)</span>
<span class="token number">5</span> <span class="token punctuation">[</span> <span class="token number">23</span><span class="token punctuation">]</span>: <span class="token number">24</span><span class="token punctuation">(</span>0x18<span class="token punctuation">)</span>
<span class="token number">6</span> <span class="token punctuation">[</span> <span class="token number">24</span><span class="token punctuation">]</span>: <span class="token number">1</span><span class="token punctuation">(</span>0x1<span class="token punctuation">)</span>
<span class="token number">7</span> <span class="token punctuation">[</span> <span class="token number">25</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
------------------------------------------------------------------------
found a total of <span class="token number">26</span> total values
------------------------------------------------------------------------
FUNCTION ID: F.2 -<span class="token operator">></span> NUMINSTS <span class="token number">22</span>
BB   IDX  OPCODE              <span class="token punctuation">[</span>ID /IID/MOD<span class="token punctuation">]</span>  INST
------------------------------------------------------------------------
<span class="token number">0</span>    <span class="token number">0</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">18</span> -<span class="token operator">></span> <span class="token number">2</span>
<span class="token number">0</span>    <span class="token number">1</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">19</span> -<span class="token operator">></span> <span class="token number">1</span>
<span class="token number">0</span>    <span class="token number">2</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.1

<span class="token number">1</span>    <span class="token number">3</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">1</span> -<span class="token operator">></span> <span class="token number">3</span>
<span class="token number">1</span>    <span class="token number">4</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">2</span> -<span class="token operator">></span> <span class="token number">4</span>
<span class="token number">1</span>    <span class="token number">5</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">3</span> trunc ffffffffffffffff
<span class="token number">1</span>    <span class="token number">6</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">4</span> trunc ffffffffffffffff
<span class="token number">1</span>    <span class="token number">7</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">43</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span>
<span class="token number">1</span>    <span class="token number">8</span>  OP_BC_LSHR          <span class="token punctuation">[</span><span class="token number">9</span>  / <span class="token number">48</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">8</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">>></span> <span class="token number">7</span>
<span class="token number">1</span>    <span class="token number">9</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">58</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">9</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">21</span>
<span class="token number">1</span>   <span class="token number">10</span>  OP_BC_XOR           <span class="token punctuation">[</span><span class="token number">13</span> / <span class="token number">68</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">10</span> <span class="token operator">=</span> <span class="token number">9</span> ^ <span class="token number">5</span>
<span class="token number">1</span>   <span class="token number">11</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">43</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">11</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">&lt;&lt;</span> <span class="token number">22</span>
<span class="token number">1</span>   <span class="token number">12</span>  OP_BC_LSHR          <span class="token punctuation">[</span><span class="token number">9</span>  / <span class="token number">48</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">12</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">>></span> <span class="token number">23</span>
<span class="token number">1</span>   <span class="token number">13</span>  OP_BC_OR            <span class="token punctuation">[</span><span class="token number">12</span> / <span class="token number">63</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">13</span> <span class="token operator">=</span> <span class="token number">11</span> <span class="token operator">|</span> <span class="token number">12</span>
<span class="token number">1</span>   <span class="token number">14</span>  OP_BC_ADD           <span class="token punctuation">[</span><span class="token number">1</span>  /  <span class="token number">8</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">14</span> <span class="token operator">=</span> <span class="token number">6</span> + <span class="token number">24</span>
<span class="token number">1</span>   <span class="token number">15</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">15</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">14</span> <span class="token operator">==</span> <span class="token number">25</span><span class="token punctuation">)</span>
<span class="token number">1</span>   <span class="token number">16</span>  OP_BC_SEXT          <span class="token punctuation">[</span><span class="token number">15</span> / <span class="token number">79</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">16</span> <span class="token operator">=</span> <span class="token number">14</span> sext <span class="token number">20</span>
<span class="token number">1</span>   <span class="token number">17</span>  OP_BC_SEXT          <span class="token punctuation">[</span><span class="token number">15</span> / <span class="token number">79</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">17</span> <span class="token operator">=</span> <span class="token number">13</span> sext <span class="token number">20</span>
<span class="token number">1</span>   <span class="token number">18</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">16</span> -<span class="token operator">></span> <span class="token number">2</span>
<span class="token number">1</span>   <span class="token number">19</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">17</span> -<span class="token operator">></span> <span class="token number">1</span>
<span class="token number">1</span>   <span class="token number">20</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">15</span> ? bb.2 <span class="token builtin class-name">:</span> bb.1

<span class="token number">2</span>   <span class="token number">21</span>  OP_BC_RET           <span class="token punctuation">[</span><span class="token number">19</span> / <span class="token number">98</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  ret <span class="token number">13</span>
------------------------------------------------------------------------</code></pre></div>
<p>このコードには 3 つの BB セクションがあります。</p>
<p>最初のセクションはシンプルで、いくつかの定数の値をローカル変数にコピーしています。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">0</span>    <span class="token number">0</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">18</span> -<span class="token operator">></span> <span class="token number">2</span>
<span class="token number">0</span>    <span class="token number">1</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">19</span> -<span class="token operator">></span> <span class="token number">1</span>
<span class="token number">0</span>    <span class="token number">2</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.1</code></pre></div>
<p>最後のセクションは <code class="language-text">ret 13</code> で ID 13 の変数を返却しています。</p>
<p>真ん中のセクションは以下の実装になっています。</p>
<p><code class="language-text">br 15 ? bb.2 : bb.1</code> というコードが存在していることから、このブロックはループ処理を行うことがわかります。</p>
<p>また、ここで評価している ID 15 の変数には <code class="language-text">OP_BC_ICMP_EQ 15 = (14 == 25)</code> の評価結果が対応しています。</p>
<p>ID 25 は 0x4 の定数なので、恐らく ID 14 の変数がカウンタの役割をして、4 回のループ処理が行われると予想できます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">1</span>    <span class="token number">3</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">1</span> -<span class="token operator">></span> <span class="token number">3</span>
<span class="token number">1</span>    <span class="token number">4</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">2</span> -<span class="token operator">></span> <span class="token number">4</span>
<span class="token number">1</span>    <span class="token number">5</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">3</span> trunc ffffffffffffffff
<span class="token number">1</span>    <span class="token number">6</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">4</span> trunc ffffffffffffffff
<span class="token number">1</span>    <span class="token number">7</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">43</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span>
<span class="token number">1</span>    <span class="token number">8</span>  OP_BC_LSHR          <span class="token punctuation">[</span><span class="token number">9</span>  / <span class="token number">48</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">8</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">>></span> <span class="token number">7</span>
<span class="token number">1</span>    <span class="token number">9</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">58</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">9</span> <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">21</span>
<span class="token number">1</span>   <span class="token number">10</span>  OP_BC_XOR           <span class="token punctuation">[</span><span class="token number">13</span> / <span class="token number">68</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">10</span> <span class="token operator">=</span> <span class="token number">9</span> ^ <span class="token number">5</span>
<span class="token number">1</span>   <span class="token number">11</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">43</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">11</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">&lt;&lt;</span> <span class="token number">22</span>
<span class="token number">1</span>   <span class="token number">12</span>  OP_BC_LSHR          <span class="token punctuation">[</span><span class="token number">9</span>  / <span class="token number">48</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">12</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">>></span> <span class="token number">23</span>
<span class="token number">1</span>   <span class="token number">13</span>  OP_BC_OR            <span class="token punctuation">[</span><span class="token number">12</span> / <span class="token number">63</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">13</span> <span class="token operator">=</span> <span class="token number">11</span> <span class="token operator">|</span> <span class="token number">12</span>
<span class="token number">1</span>   <span class="token number">14</span>  OP_BC_ADD           <span class="token punctuation">[</span><span class="token number">1</span>  /  <span class="token number">8</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">14</span> <span class="token operator">=</span> <span class="token number">6</span> + <span class="token number">24</span>
<span class="token number">1</span>   <span class="token number">15</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">15</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">14</span> <span class="token operator">==</span> <span class="token number">25</span><span class="token punctuation">)</span>
<span class="token number">1</span>   <span class="token number">16</span>  OP_BC_SEXT          <span class="token punctuation">[</span><span class="token number">15</span> / <span class="token number">79</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">16</span> <span class="token operator">=</span> <span class="token number">14</span> sext <span class="token number">20</span>
<span class="token number">1</span>   <span class="token number">17</span>  OP_BC_SEXT          <span class="token punctuation">[</span><span class="token number">15</span> / <span class="token number">79</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">17</span> <span class="token operator">=</span> <span class="token number">13</span> sext <span class="token number">20</span>
<span class="token number">1</span>   <span class="token number">18</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">16</span> -<span class="token operator">></span> <span class="token number">2</span>
<span class="token number">1</span>   <span class="token number">19</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">17</span> -<span class="token operator">></span> <span class="token number">1</span>
<span class="token number">1</span>   <span class="token number">20</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">15</span> ? bb.2 <span class="token builtin class-name">:</span> bb.1</code></pre></div>
<p>ループ処理の中では、いくつかの変数を XOR やシフト演算する実装になっています。</p>
<p><code class="language-text">OP_BC_TRUNC</code> と <code class="language-text">OP_BC_SEXT</code> が少々わかりづらかったですが、おそらく TRUNC は i64 変数を i32 にコピーする際の bit の切り捨て、SEXT は i32 変数を i64 変数にコピーする際の符号拡張を意味しているだけであり、実際は単純な値のコピー処理と考えてよさそうです。</p>
<p>また、ポイントになるのは <code class="language-text">OP_BC_LSHR</code> で論理右シフトされる変数 0 で、<code class="language-text">0 [  0]: i32 argument</code> と記載されている通りここには Func1 から受け取った 32 bit の引数が格納されます。</p>
<p>このような操作を C のコードに落とし込むと以下のようになりました。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token class-name">uint32_t</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> v0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint64_t</span> v1 <span class="token operator">=</span> <span class="token number">0xacab3c0</span><span class="token punctuation">;</span> <span class="token comment">// v19 = 0xacab3c0</span>
    <span class="token class-name">uint64_t</span> v2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// v18 = 0</span>
    <span class="token class-name">uint32_t</span> v3<span class="token punctuation">,</span> v4<span class="token punctuation">,</span> v5<span class="token punctuation">,</span> v6<span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v8<span class="token punctuation">,</span> v9<span class="token punctuation">,</span> v10<span class="token punctuation">,</span> v11<span class="token punctuation">,</span> v12<span class="token punctuation">,</span> v13<span class="token punctuation">,</span> v14<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        v3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span>v1<span class="token punctuation">;</span>
        v4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span>v2<span class="token punctuation">;</span>
        
        v5 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
        v6 <span class="token operator">=</span> v4<span class="token punctuation">;</span>
        v7 <span class="token operator">=</span> v6 <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// v20 = 0x3</span>
        v8 <span class="token operator">=</span> v0 <span class="token operator">>></span> v7<span class="token punctuation">;</span>
        v9 <span class="token operator">=</span> v8 <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span> <span class="token comment">// v21 = 0xFF</span>
        v10 <span class="token operator">=</span> v9 <span class="token operator">^</span> v5<span class="token punctuation">;</span>
        v11 <span class="token operator">=</span> v10 <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">// v22 = 0x8</span>
        v12 <span class="token operator">=</span> v5 <span class="token operator">>></span> <span class="token number">24</span><span class="token punctuation">;</span> <span class="token comment">// v23 = 0x18</span>
        v13 <span class="token operator">=</span> v11 <span class="token operator">|</span> v12<span class="token punctuation">;</span>

        v2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint64_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v6 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// v24 = 1</span>
        v1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint64_t</span><span class="token punctuation">)</span>v13<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> v13<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>どうやら、引数として受け取った 32bit の整数値を 8bit ごとに 4 等分し、各値を使用してシフト演算や論理演算を行った結果を返り値とする関数のようです。</p>
<h3 id="func1-の調査" style="position:relative;"><a href="#func1-%E3%81%AE%E8%AA%BF%E6%9F%BB" aria-label="func1 の調査 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Func1 の調査</h3>
<p>Func2 の実装を読んだところで、Func1 のコードを見ていきます。</p>
<p>Func1 では非常に多くの変数と定数が定義されていますが、特に着目したのは以下の定数です。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">30</span> <span class="token punctuation">[</span><span class="token number">134</span><span class="token punctuation">]</span>: <span class="token number">36</span><span class="token punctuation">(</span>0x24<span class="token punctuation">)</span>
<span class="token number">31</span> <span class="token punctuation">[</span><span class="token number">135</span><span class="token punctuation">]</span>: <span class="token number">1939767458</span><span class="token punctuation">(</span>0x739e80a2<span class="token punctuation">)</span>
<span class="token number">32</span> <span class="token punctuation">[</span><span class="token number">136</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">33</span> <span class="token punctuation">[</span><span class="token number">137</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">34</span> <span class="token punctuation">[</span><span class="token number">138</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">35</span> <span class="token punctuation">[</span><span class="token number">139</span><span class="token punctuation">]</span>: <span class="token number">1</span><span class="token punctuation">(</span>0x1<span class="token punctuation">)</span>
<span class="token number">36</span> <span class="token punctuation">[</span><span class="token number">140</span><span class="token punctuation">]</span>: <span class="token number">984514723</span><span class="token punctuation">(</span>0x3aae80a3<span class="token punctuation">)</span>
<span class="token number">37</span> <span class="token punctuation">[</span><span class="token number">141</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">38</span> <span class="token punctuation">[</span><span class="token number">142</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">39</span> <span class="token punctuation">[</span><span class="token number">143</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">40</span> <span class="token punctuation">[</span><span class="token number">144</span><span class="token punctuation">]</span>: <span class="token number">2</span><span class="token punctuation">(</span>0x2<span class="token punctuation">)</span>
<span class="token number">41</span> <span class="token punctuation">[</span><span class="token number">145</span><span class="token punctuation">]</span>: <span class="token number">1000662943</span><span class="token punctuation">(</span>0x3ba4e79f<span class="token punctuation">)</span>
<span class="token number">42</span> <span class="token punctuation">[</span><span class="token number">146</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">43</span> <span class="token punctuation">[</span><span class="token number">147</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">44</span> <span class="token punctuation">[</span><span class="token number">148</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">45</span> <span class="token punctuation">[</span><span class="token number">149</span><span class="token punctuation">]</span>: <span class="token number">3</span><span class="token punctuation">(</span>0x3<span class="token punctuation">)</span>
<span class="token number">46</span> <span class="token punctuation">[</span><span class="token number">150</span><span class="token punctuation">]</span>: <span class="token number">2025505267</span><span class="token punctuation">(</span>0x78bac1f3<span class="token punctuation">)</span>
<span class="token number">47</span> <span class="token punctuation">[</span><span class="token number">151</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">48</span> <span class="token punctuation">[</span><span class="token number">152</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">49</span> <span class="token punctuation">[</span><span class="token number">153</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">50</span> <span class="token punctuation">[</span><span class="token number">154</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">51</span> <span class="token punctuation">[</span><span class="token number">155</span><span class="token punctuation">]</span>: <span class="token number">1593426419</span><span class="token punctuation">(</span>0x5ef9c1f3<span class="token punctuation">)</span>
<span class="token number">52</span> <span class="token punctuation">[</span><span class="token number">156</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">53</span> <span class="token punctuation">[</span><span class="token number">157</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">54</span> <span class="token punctuation">[</span><span class="token number">158</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">55</span> <span class="token punctuation">[</span><span class="token number">159</span><span class="token punctuation">]</span>: <span class="token number">5</span><span class="token punctuation">(</span>0x5<span class="token punctuation">)</span>
<span class="token number">56</span> <span class="token punctuation">[</span><span class="token number">160</span><span class="token punctuation">]</span>: <span class="token number">1002040479</span><span class="token punctuation">(</span>0x3bb9ec9f<span class="token punctuation">)</span>
<span class="token number">57</span> <span class="token punctuation">[</span><span class="token number">161</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">58</span> <span class="token punctuation">[</span><span class="token number">162</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">59</span> <span class="token punctuation">[</span><span class="token number">163</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">60</span> <span class="token punctuation">[</span><span class="token number">164</span><span class="token punctuation">]</span>: <span class="token number">6</span><span class="token punctuation">(</span>0x6<span class="token punctuation">)</span>
<span class="token number">61</span> <span class="token punctuation">[</span><span class="token number">165</span><span class="token punctuation">]</span>: <span class="token number">1434878964</span><span class="token punctuation">(</span>0x558683f4<span class="token punctuation">)</span>
<span class="token number">62</span> <span class="token punctuation">[</span><span class="token number">166</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">63</span> <span class="token punctuation">[</span><span class="token number">167</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">64</span> <span class="token punctuation">[</span><span class="token number">168</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">65</span> <span class="token punctuation">[</span><span class="token number">169</span><span class="token punctuation">]</span>: <span class="token number">7</span><span class="token punctuation">(</span>0x7<span class="token punctuation">)</span>
<span class="token number">66</span> <span class="token punctuation">[</span><span class="token number">170</span><span class="token punctuation">]</span>: <span class="token number">1442502036</span><span class="token punctuation">(</span>0x55fad594<span class="token punctuation">)</span>
<span class="token number">67</span> <span class="token punctuation">[</span><span class="token number">171</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">68</span> <span class="token punctuation">[</span><span class="token number">172</span><span class="token punctuation">]</span>: <span class="token number">0</span><span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>
<span class="token number">69</span> <span class="token punctuation">[</span><span class="token number">173</span><span class="token punctuation">]</span>: <span class="token number">4</span><span class="token punctuation">(</span>0x4<span class="token punctuation">)</span>
<span class="token number">70</span> <span class="token punctuation">[</span><span class="token number">174</span><span class="token punctuation">]</span>: <span class="token number">8</span><span class="token punctuation">(</span>0x8<span class="token punctuation">)</span>
<span class="token number">71</span> <span class="token punctuation">[</span><span class="token number">175</span><span class="token punctuation">]</span>: <span class="token number">1824513439</span><span class="token punctuation">(</span>0x6cbfdd9f<span class="token punctuation">)</span></code></pre></div>
<p>この中では、0x739e80a2 や 0x3aae80a3 など、合計 9 つの 32bit 整数値が定義されています。</p>
<p>この値は、何らかの形で Flag の検証に使用されそうです。</p>
<p>Func1 は 0 から 7 までの BB ブロックで構成されています。</p>
<p>最初のブロックのコードは以下です。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token number">0</span>    <span class="token number">0</span>  OP_BC_GEPZ          <span class="token punctuation">[</span><span class="token number">36</span> <span class="token operator">/</span><span class="token number">184</span><span class="token operator">/</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">5</span> <span class="token operator">=</span> gepz p<span class="token punctuation">.</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span>
<span class="token number">0</span>    <span class="token number">1</span>  OP_BC_GEPZ          <span class="token punctuation">[</span><span class="token number">36</span> <span class="token operator">/</span><span class="token number">184</span><span class="token operator">/</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">7</span> <span class="token operator">=</span> gepz p<span class="token punctuation">.</span><span class="token number">6</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">)</span>
<span class="token number">0</span>    <span class="token number">2</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> <span class="token operator">/</span><span class="token number">168</span><span class="token operator">/</span>  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">8</span> <span class="token operator">=</span> seek<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">)</span>
<span class="token number">0</span>    <span class="token number">3</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> <span class="token operator">/</span><span class="token number">174</span><span class="token operator">/</span>  <span class="token number">4</span><span class="token punctuation">]</span>  cp <span class="token number">108</span> <span class="token operator">-></span> <span class="token number">2</span>
<span class="token number">0</span>    <span class="token number">4</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> <span class="token operator">/</span> <span class="token number">90</span><span class="token operator">/</span>  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb<span class="token punctuation">.</span><span class="token number">2</span></code></pre></div>
<p><code class="language-text">OP_BC_GEPZ</code> は bytecode_vm.c 内で以下のように定義されています。</p>
<p>GEPZ の GEP は恐らく <em>GetElementPtr</em>  の略称で、LLVM の GEP 命令と同じくポインタアドレス計算を行っているものと思われます。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">DEFINE_OP</span><span class="token punctuation">(</span>OP_BC_GEPZ<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">int64_t</span> ptr<span class="token punctuation">,</span> iptr<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> off<span class="token punctuation">;</span>
    <span class="token function">READ32</span><span class="token punctuation">(</span>off<span class="token punctuation">,</span> inst<span class="token operator">-></span>u<span class="token punctuation">.</span>three<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// negative values checking, valid for intermediate GEP calculations</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>off <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">cli_dbgmsg</span><span class="token punctuation">(</span><span class="token string">"bytecode warning: found GEP with negative offset %d!\n"</span><span class="token punctuation">,</span> off<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>inst<span class="token operator">-></span>interp_op <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// how do negative offsets affect pointer initialization?</span>
        <span class="token function">WRITE64</span><span class="token punctuation">(</span>inst<span class="token operator">-></span>dest<span class="token punctuation">,</span> <span class="token function">ptr_compose</span><span class="token punctuation">(</span>stackid<span class="token punctuation">,</span>
                                        inst<span class="token operator">-></span>u<span class="token punctuation">.</span>three<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> off<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">READ64</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> inst<span class="token operator">-></span>u<span class="token punctuation">.</span>three<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        off <span class="token operator">+=</span> <span class="token punctuation">(</span>ptr <span class="token operator">&amp;</span> <span class="token number">0x00000000ffffffffULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iptr <span class="token operator">=</span> <span class="token punctuation">(</span>ptr <span class="token operator">&amp;</span> <span class="token number">0xffffffff00000000ULL</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">uint64_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span>off<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">WRITE64</span><span class="token punctuation">(</span>inst<span class="token operator">-></span>dest<span class="token punctuation">,</span> iptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>LLVM についてはあまり知識がないですが、リファレンスを読むとポインタアドレスが指す値を取り出す処理のようです。</p>
<p>参考：<a href="https://llvm.org/docs/GetElementPtr.html" target="_blank" rel="nofollow noopener noreferrer">The Often Misunderstood GEP Instruction — LLVM 20.0.0git documentation</a></p>
<p>次の <code class="language-text">8 = seek[3] (106, 107)</code> では、スキャン対象のデータの先頭から 7 バイト分をスキップしています。(ID 106 の定数には 7が、107 の定数には <code class="language-text">SEEK_SET</code> を意味する 0 が格納されています。)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">enum</span> <span class="token punctuation">{</span>
    <span class="token comment">/**set file position to specified absolute position */</span>
    <span class="token constant">SEEK_SET</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token comment">/**set file position relative to current position */</span>
    <span class="token constant">SEEK_CUR</span><span class="token punctuation">,</span>
    <span class="token comment">/**set file position relative to file end*/</span>
    <span class="token constant">SEEK_END</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
\group_file
 * Changes the current file position to the specified one.
 * @sa SEEK_SET, SEEK_CUR, SEEK_END
 * @param[in] pos offset (absolute or relative depending on \p whence param)
 * @param[in] whence one of \p SEEK_SET, \p SEEK_CUR, \p SEEK_END
 * @return absolute position in file
 */</span>
<span class="token class-name">int32_t</span> <span class="token function">seek</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> pos<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> whence<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>参考：<a href="https://github.com/Cisco-Talos/clamav/blob/main/libclamav/bytecode_api.h" target="_blank" rel="nofollow noopener noreferrer">clamav/libclamav/bytecode_api.h at main · Cisco-Talos/clamav</a></p>
<p>すでに Logical シグネチャの設定を見た通り、今回のスキャン対象は <code class="language-text">SECCON{</code> というテキストを含むため、恐らくこの文字列を無視する処理と思われます。</p>
<p>最後の処理では定数 ID 8 の値(0) を変数 ID 2 にコピーし、BB2 にジャンプしています。</p>
<p>BB2 で実装されているコードは以下の通りです。</p>
<p><code class="language-text">br 9 ? bb.2 : bb.3</code> と <code class="language-text">br 17 ? bb.7 : bb.1</code> の定義から、何らかの条件分岐によるループ処理が行われていることがわかります。</p>
<p>BB7 は Fail の処理のようですので、ここでは BB7 にジャンプしない分岐を特定する必要があります。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">1</span>    <span class="token number">5</span>  OP_BC_ICMP_ULT      <span class="token punctuation">[</span><span class="token number">25</span> /129/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">9</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">18</span> <span class="token operator">&lt;</span> <span class="token number">109</span><span class="token punctuation">)</span>
<span class="token number">1</span>    <span class="token number">6</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">18</span> -<span class="token operator">></span> <span class="token number">2</span>
<span class="token number">1</span>    <span class="token number">7</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">9</span> ? bb.2 <span class="token builtin class-name">:</span> bb.3

<span class="token number">2</span>    <span class="token number">8</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">2</span> -<span class="token operator">></span> <span class="token number">10</span>
<span class="token number">2</span>    <span class="token number">9</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">44</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">11</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">&lt;&lt;</span> <span class="token number">110</span>
<span class="token number">2</span>   <span class="token number">10</span>  OP_BC_ASHR          <span class="token punctuation">[</span><span class="token number">10</span> / <span class="token number">54</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">12</span> <span class="token operator">=</span> <span class="token number">11</span> <span class="token operator">>></span> <span class="token number">111</span>
<span class="token number">2</span>   <span class="token number">11</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">13</span> <span class="token operator">=</span> <span class="token number">12</span> trunc ffffffffffffffff
<span class="token number">2</span>   <span class="token number">12</span>  OP_BC_GEPZ          <span class="token punctuation">[</span><span class="token number">36</span> /184/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">14</span> <span class="token operator">=</span> gepz p.4 + <span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span>
<span class="token number">2</span>   <span class="token number">13</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">15</span> <span class="token operator">=</span> gep1 p.14 + <span class="token punctuation">(</span><span class="token number">13</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">2</span>   <span class="token number">14</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">16</span> <span class="token operator">=</span> read<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.15, <span class="token number">113</span><span class="token punctuation">)</span>
<span class="token number">2</span>   <span class="token number">15</span>  OP_BC_ICMP_SLT      <span class="token punctuation">[</span><span class="token number">30</span> /153/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">17</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">&lt;</span> <span class="token number">114</span><span class="token punctuation">)</span>
<span class="token number">2</span>   <span class="token number">16</span>  OP_BC_ADD           <span class="token punctuation">[</span><span class="token number">1</span>  /  <span class="token number">9</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">18</span> <span class="token operator">=</span> <span class="token number">10</span> + <span class="token number">115</span>
<span class="token number">2</span>   <span class="token number">17</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">116</span> -<span class="token operator">></span> <span class="token number">0</span>
<span class="token number">2</span>   <span class="token number">18</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">17</span> ? bb.7 <span class="token builtin class-name">:</span> bb.1</code></pre></div>
<p>分岐処理の部分を抜き出して定数を実際の値と置き換えました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">1</span>    <span class="token number">5</span>  OP_BC_ICMP_ULT      <span class="token punctuation">[</span><span class="token number">25</span> /129/  <span class="token number">4</span><span class="token punctuation">]</span>  v9 <span class="token operator">=</span> <span class="token punctuation">(</span>v18 <span class="token operator">&lt;</span> 0x24<span class="token punctuation">)</span>
<span class="token number">1</span>    <span class="token number">6</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> v18 -<span class="token operator">></span> v2
<span class="token number">1</span>    <span class="token number">7</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">9</span> ? bb.2 <span class="token builtin class-name">:</span> bb.3

<span class="token number">2</span>    <span class="token number">8</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> v2 -<span class="token operator">></span> v10

<span class="token number">2</span>   <span class="token number">14</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  v16 <span class="token operator">=</span> read<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.15, 0x1<span class="token punctuation">)</span>
<span class="token number">2</span>   <span class="token number">15</span>  OP_BC_ICMP_SLT      <span class="token punctuation">[</span><span class="token number">30</span> /153/  <span class="token number">3</span><span class="token punctuation">]</span>  v17 <span class="token operator">=</span> <span class="token punctuation">(</span>v16 <span class="token operator">&lt;</span> 0x1<span class="token punctuation">)</span>
<span class="token number">2</span>   <span class="token number">16</span>  OP_BC_ADD           <span class="token punctuation">[</span><span class="token number">1</span>  /  <span class="token number">9</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  v18 <span class="token operator">=</span> v10 + 0x1

<span class="token number">2</span>   <span class="token number">18</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br v17 ? bb.7 <span class="token builtin class-name">:</span> bb.1</code></pre></div>
<p>これを見ると、v2 変数をカウンタとして 36(0x24) 回のループ処理が行われることがわかります。</p>
<p>read の呼び出しが行われていることから、恐らくスキャン対象の SEEK した位置から 1 文字ずつ読み出す処理を 36 回繰り返しているものと思われます。</p>
<p><code class="language-text">p.15</code> が何を指しているかは不明ですが、read 関数の実装を見る限り読み出したデータの保存先のポインタを指しているようです。(<code class="language-text">p.</code> が付与されている変数はポインタとして扱うことを意味しているのかも？)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">/**
\group_file
 * Reads specified amount of bytes from the current file
 * into a buffer. Also moves current position in the file.
 * @param[in] size amount of bytes to read
 * @param[out] data pointer to buffer where data is read into
 * @return amount read.
 */</span>
<span class="token class-name">int32_t</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span> data<span class="token punctuation">,</span> <span class="token class-name">int32_t</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>36 文字を read してどこかに保存した後は、BB3 のブロックが呼び出されます。</p>
<p>ここでは、さらに 1 文字追加で read し、その文字が変数 ID 119 に格納されている 0x7d(<code class="language-text">}</code>) に一致するかを検証しているようです。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">3</span>   <span class="token number">19</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">19</span> <span class="token operator">=</span> read<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.3, <span class="token number">117</span><span class="token punctuation">)</span>
<span class="token number">3</span>   <span class="token number">20</span>  OP_BC_ICMP_SGT      <span class="token punctuation">[</span><span class="token number">27</span> /138/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">20</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">19</span> <span class="token operator">></span> <span class="token number">118</span><span class="token punctuation">)</span>
<span class="token number">3</span>   <span class="token number">21</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /171/  <span class="token number">1</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">3</span> -<span class="token operator">></span> <span class="token number">21</span>
<span class="token number">3</span>   <span class="token number">22</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /106/  <span class="token number">1</span><span class="token punctuation">]</span>  <span class="token number">22</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">21</span> <span class="token operator">==</span> <span class="token number">119</span><span class="token punctuation">)</span>
<span class="token number">3</span>   <span class="token number">23</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">23</span> <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">&amp;</span> <span class="token number">22</span>
<span class="token number">3</span>   <span class="token number">24</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">120</span> -<span class="token operator">></span> <span class="token number">0</span>
<span class="token number">3</span>   <span class="token number">25</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">23</span> ? bb.4 <span class="token builtin class-name">:</span> bb.7</code></pre></div>
<p>ここまでの情報から、正しい Flag は <code class="language-text">SECCON{&lt;36 文字の文字列>}</code> であることがわかります。</p>
<p>さらに次のブロックでは、もう 1 文字分 read を行い、(おそらく)読み込みに失敗することを確認しています。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">4</span>   <span class="token number">26</span>  OP_BC_CALL_API      <span class="token punctuation">[</span><span class="token number">33</span> /168/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">24</span> <span class="token operator">=</span> read<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>p.3, <span class="token number">121</span><span class="token punctuation">)</span>
<span class="token number">4</span>   <span class="token number">27</span>  OP_BC_ICMP_SGT      <span class="token punctuation">[</span><span class="token number">27</span> /138/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">25</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">></span> <span class="token number">122</span><span class="token punctuation">)</span>
<span class="token number">4</span>   <span class="token number">28</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">123</span> -<span class="token operator">></span> <span class="token number">1</span>
<span class="token number">4</span>   <span class="token number">29</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">124</span> -<span class="token operator">></span> <span class="token number">0</span>
<span class="token number">4</span>   <span class="token number">30</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">25</span> ? bb.7 <span class="token builtin class-name">:</span> bb.5</code></pre></div>
<p>つまり、スキャン対象が <code class="language-text">}</code> で終了することをチェックしているものと思われます。</p>
<p>BB5 のブロックでは、ID 26 の変数をカウンタとして再び何らかのループ処理が行われているようです。</p>
<p>ループ終了の条件分岐(<code class="language-text">OP_BC_ICMP_ULT 42 = (41 &lt; 134)</code>)で使用されている定数 134 は 36(0x24) ですが、ループごとにカウンタに加算される定数 ID 133 は  4(0x4) なので、このループは 9 回呼び出されると思われます。</p>
<p>この中では、先に確認した Func2 の呼び出しも行われます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">5</span>   <span class="token number">31</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">1</span> -<span class="token operator">></span> <span class="token number">26</span>
<span class="token number">5</span>   <span class="token number">32</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">44</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">27</span> <span class="token operator">=</span> <span class="token number">26</span> <span class="token operator">&lt;&lt;</span> <span class="token number">125</span>
<span class="token number">5</span>   <span class="token number">33</span>  OP_BC_ASHR          <span class="token punctuation">[</span><span class="token number">10</span> / <span class="token number">54</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">28</span> <span class="token operator">=</span> <span class="token number">27</span> <span class="token operator">>></span> <span class="token number">126</span>
<span class="token number">5</span>   <span class="token number">34</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">29</span> <span class="token operator">=</span> <span class="token number">28</span> trunc ffffffffffffffff
<span class="token number">5</span>   <span class="token number">35</span>  OP_BC_GEPZ          <span class="token punctuation">[</span><span class="token number">36</span> /184/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">30</span> <span class="token operator">=</span> gepz p.4 + <span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">36</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">31</span> <span class="token operator">=</span> gep1 p.30 + <span class="token punctuation">(</span><span class="token number">29</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">37</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">32</span> <span class="token operator">&lt;</span>- p.31
<span class="token number">5</span>   <span class="token number">38</span>  OP_BC_CALL_DIRECT   <span class="token punctuation">[</span><span class="token number">32</span> /163/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">33</span> <span class="token operator">=</span> call F.2 <span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">39</span>  OP_BC_SHL           <span class="token punctuation">[</span><span class="token number">8</span>  / <span class="token number">44</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">34</span> <span class="token operator">=</span> <span class="token number">26</span> <span class="token operator">&lt;&lt;</span> <span class="token number">128</span>
<span class="token number">5</span>   <span class="token number">40</span>  OP_BC_ASHR          <span class="token punctuation">[</span><span class="token number">10</span> / <span class="token number">54</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">35</span> <span class="token operator">=</span> <span class="token number">34</span> <span class="token operator">>></span> <span class="token number">129</span>
<span class="token number">5</span>   <span class="token number">41</span>  OP_BC_TRUNC         <span class="token punctuation">[</span><span class="token number">14</span> / <span class="token number">73</span>/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">36</span> <span class="token operator">=</span> <span class="token number">35</span> trunc ffffffffffffffff
<span class="token number">5</span>   <span class="token number">42</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">37</span> <span class="token operator">=</span> <span class="token number">130</span> * <span class="token number">131</span>
<span class="token number">5</span>   <span class="token number">43</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">38</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">37</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">44</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">39</span> <span class="token operator">=</span> <span class="token number">132</span> * <span class="token number">36</span>
<span class="token number">5</span>   <span class="token number">45</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">40</span> <span class="token operator">=</span> gep1 p.38 + <span class="token punctuation">(</span><span class="token number">39</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">46</span>  OP_BC_STORE         <span class="token punctuation">[</span><span class="token number">38</span> /193/  <span class="token number">3</span><span class="token punctuation">]</span>  store <span class="token number">33</span> -<span class="token operator">></span> p.40
<span class="token number">5</span>   <span class="token number">47</span>  OP_BC_ADD           <span class="token punctuation">[</span><span class="token number">1</span>  /  <span class="token number">9</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">41</span> <span class="token operator">=</span> <span class="token number">26</span> + <span class="token number">133</span>
<span class="token number">5</span>   <span class="token number">48</span>  OP_BC_ICMP_ULT      <span class="token punctuation">[</span><span class="token number">25</span> /129/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">42</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">41</span> <span class="token operator">&lt;</span> <span class="token number">134</span><span class="token punctuation">)</span>
<span class="token number">5</span>   <span class="token number">49</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">41</span> -<span class="token operator">></span> <span class="token number">1</span>
<span class="token number">5</span>   <span class="token number">50</span>  OP_BC_BRANCH        <span class="token punctuation">[</span><span class="token number">17</span> / <span class="token number">85</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  br <span class="token number">42</span> ? bb.5 <span class="token builtin class-name">:</span> bb.6</code></pre></div>
<p>Func2 呼び出し時の引数は ID 32 の変数ですが、ここに何が入ってくるのか全く分かりません。</p>
<p>しかし、遡った行にある <code class="language-text">OP_BC_GEPZ  30 = gepz p.4 + (127)</code> で参照している p.4 は、入力文字の格納先のポインタを取得した際と同じもののようです。</p>
<p>そのため、問題のメタ的にも入力文字を 4文字(32bit) 分取り出した値が Func2 の引数として与えられているのではないかと予想できます。</p>
<p>この戻り値は、<code class="language-text">OP_BC_STORE  store 33 -> p.40</code> の行で <code class="language-text">OP_BC_GEP1  38 = gep1 p.7 + (37 * 65)</code> から取り出されたポインタアドレスに格納されているようです。</p>
<p>最後のブロックである BB6 では、この p.7 から取り出された値と冒頭で確認した 0x739e80a2 などの 9 つの整数値と順に比較を行い、すべての検証に成功した場合に 1 を返す処理を行っているようです。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">{</span><span class="token punctuation">[</span> 省略 <span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token number">6</span>  <span class="token number">100</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">92</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">91</span> <span class="token operator">==</span> <span class="token number">170</span><span class="token punctuation">)</span>
<span class="token number">6</span>  <span class="token number">101</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">93</span> <span class="token operator">=</span> <span class="token number">86</span> <span class="token operator">&amp;</span> <span class="token number">92</span>
<span class="token number">6</span>  <span class="token number">102</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">94</span> <span class="token operator">=</span> <span class="token number">171</span> * <span class="token number">172</span>
<span class="token number">6</span>  <span class="token number">103</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">95</span> <span class="token operator">=</span> gep1 p.7 + <span class="token punctuation">(</span><span class="token number">94</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>  <span class="token number">104</span>  OP_BC_MUL           <span class="token punctuation">[</span><span class="token number">3</span>  / <span class="token number">18</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">96</span> <span class="token operator">=</span> <span class="token number">173</span> * <span class="token number">174</span>
<span class="token number">6</span>  <span class="token number">105</span>  OP_BC_GEP1          <span class="token punctuation">[</span><span class="token number">35</span> /179/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">97</span> <span class="token operator">=</span> gep1 p.95 + <span class="token punctuation">(</span><span class="token number">96</span> * <span class="token number">65</span><span class="token punctuation">)</span>
<span class="token number">6</span>  <span class="token number">106</span>  OP_BC_LOAD          <span class="token punctuation">[</span><span class="token number">39</span> /198/  <span class="token number">3</span><span class="token punctuation">]</span>  load  <span class="token number">98</span> <span class="token operator">&lt;</span>- p.97
<span class="token number">6</span>  <span class="token number">107</span>  OP_BC_ICMP_EQ       <span class="token punctuation">[</span><span class="token number">21</span> /108/  <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">99</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">98</span> <span class="token operator">==</span> <span class="token number">175</span><span class="token punctuation">)</span>
<span class="token number">6</span>  <span class="token number">108</span>  OP_BC_AND           <span class="token punctuation">[</span><span class="token number">11</span> / <span class="token number">55</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token number">100</span> <span class="token operator">=</span> <span class="token number">93</span> <span class="token operator">&amp;</span> <span class="token number">99</span>
<span class="token number">6</span>  <span class="token number">109</span>  OP_BC_SEXT          <span class="token punctuation">[</span><span class="token number">15</span> / <span class="token number">79</span>/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">101</span> <span class="token operator">=</span> <span class="token number">100</span> sext <span class="token number">1</span>
<span class="token number">6</span>  <span class="token number">110</span>  OP_BC_COPY          <span class="token punctuation">[</span><span class="token number">34</span> /174/  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token function">cp</span> <span class="token number">101</span> -<span class="token operator">></span> <span class="token number">0</span>
<span class="token number">6</span>  <span class="token number">111</span>  OP_BC_JMP           <span class="token punctuation">[</span><span class="token number">18</span> / <span class="token number">90</span>/  <span class="token number">0</span><span class="token punctuation">]</span>  jmp bb.7</code></pre></div>
<p>ここまでの確認結果から、このバイトコードシグネチャでは <code class="language-text">SECCON{&lt;36 文字>}</code> の Flag が記録された任意のファイルをスキャンし、Flag 内の 36 文字を 4 文字ずつ 32bit の整数として取り出して Func2 による計算を行い、その結果がハードコードされた整数値と一致するかを比較していると考えられます。</p>
<h3 id="solver-を作成して-flag-を特定する" style="position:relative;"><a href="#solver-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%81%A6-flag-%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B" aria-label="solver を作成して flag を特定する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Solver を作成して Flag を特定する</h3>
<p>ここまでの確認結果を元に、Func2 の出力がハードコードされた値になる入力を特定する Solver を Z3Py で作成することを試みました。</p>
<p>以下のような Solver を作成してみたのですが、色々とカスタマイズしても SAT を返す値を特定することができません。(恐らく型の扱いを上手くできていないのではないかとは思うのですが原因がわかりませんでした)</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>

s <span class="token operator">=</span> Solver<span class="token punctuation">(</span><span class="token punctuation">)</span>

v0 <span class="token operator">=</span> BitVec<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"v0"</span></span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>  <span class="token comment"># i32 argument</span>
v1<span class="token punctuation">,</span> v2 <span class="token operator">=</span> BitVec<span class="token punctuation">(</span><span class="token string">"v1"</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BitVec<span class="token punctuation">(</span><span class="token string">"v2"</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token comment"># v18 = 0 v19 = 0xacab3c0</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v3 <span class="token operator">=</span> Extract<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>v1<span class="token punctuation">)</span>
    v4 <span class="token operator">=</span> Extract<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>v2<span class="token punctuation">)</span>

    v5 <span class="token operator">=</span> v3
    v6 <span class="token operator">=</span> v4
    v7 <span class="token operator">=</span> v6 <span class="token operator">&lt;&lt;</span> <span class="token number">0x3</span>  <span class="token comment"># v20 = 0x3</span>
    v8 <span class="token operator">=</span> v0 <span class="token operator">>></span> v7  <span class="token comment"># Extend v0 to 64 bits to match operations</span>
    v9 <span class="token operator">=</span> v8 <span class="token operator">&amp;</span> <span class="token number">0xFF</span>  <span class="token comment"># v21 = 0xFF</span>
    v10 <span class="token operator">=</span> v9 <span class="token operator">^</span> v5
    v11 <span class="token operator">=</span> v10 <span class="token operator">&lt;&lt;</span> <span class="token number">0x8</span>  <span class="token comment"># v22 = 0x8</span>
    v12 <span class="token operator">=</span> v5 <span class="token operator">>></span> <span class="token number">0x18</span>  <span class="token comment"># v23 = 0x18</span>
    v13 <span class="token operator">=</span> v11 <span class="token operator">|</span> v12

    v14 <span class="token operator">=</span> v6 <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># v24 = 1</span>
    v2 <span class="token operator">=</span> v14  <span class="token comment"># v16</span>
    v1 <span class="token operator">=</span> v13  <span class="token comment"># v17</span>

ans <span class="token operator">=</span> v13
<span class="token keyword">print</span><span class="token punctuation">(</span>ans<span class="token punctuation">)</span>

s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>v1 <span class="token operator">==</span> <span class="token number">0xacab3c0</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>v2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>ans <span class="token operator">==</span> <span class="token number">1939767458</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> s<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> sat<span class="token punctuation">:</span>
    m <span class="token operator">=</span> s<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span></code></pre></div>
<p>そこで、ctypes で実装した以下の Func2 関数を使用して総当たりで Flag を特定することにしました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> ctypes

<span class="token keyword">def</span> <span class="token function">func2</span><span class="token punctuation">(</span>v0<span class="token punctuation">)</span><span class="token punctuation">:</span>
    v1 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">(</span><span class="token number">0xacab3c0</span><span class="token punctuation">)</span>  <span class="token comment"># v19 = 0xacab3c0</span>
    v2 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># v18 = 0</span>
    
    v3 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    v4 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    v5 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    v6 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    v7 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    v8 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    v9 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    v10 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    v11 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    v12 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    v13 <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        v3<span class="token punctuation">.</span>value <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span>v1<span class="token punctuation">.</span>value <span class="token operator">&amp;</span> <span class="token number">0xFFFFFFFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        v4<span class="token punctuation">.</span>value <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint32<span class="token punctuation">(</span>v2<span class="token punctuation">.</span>value <span class="token operator">&amp;</span> <span class="token number">0xFFFFFFFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        
        v5<span class="token punctuation">.</span>value <span class="token operator">=</span> v3<span class="token punctuation">.</span>value
        v6<span class="token punctuation">.</span>value <span class="token operator">=</span> v4<span class="token punctuation">.</span>value
        
        v7<span class="token punctuation">.</span>value <span class="token operator">=</span> v6<span class="token punctuation">.</span>value <span class="token operator">&lt;&lt;</span> <span class="token number">3</span>  <span class="token comment"># v20 = 0x3</span>
        v8<span class="token punctuation">.</span>value <span class="token operator">=</span> v0 <span class="token operator">>></span> v7<span class="token punctuation">.</span>value
        v9<span class="token punctuation">.</span>value <span class="token operator">=</span> v8<span class="token punctuation">.</span>value <span class="token operator">&amp;</span> <span class="token number">0xFF</span>  <span class="token comment"># v21 = 0xFF</span>
        v10<span class="token punctuation">.</span>value <span class="token operator">=</span> v9<span class="token punctuation">.</span>value <span class="token operator">^</span> v5<span class="token punctuation">.</span>value
        v11<span class="token punctuation">.</span>value <span class="token operator">=</span> v10<span class="token punctuation">.</span>value <span class="token operator">&lt;&lt;</span> <span class="token number">8</span>  <span class="token comment"># v22 = 0x8</span>
        v12<span class="token punctuation">.</span>value <span class="token operator">=</span> v5<span class="token punctuation">.</span>value <span class="token operator">>></span> <span class="token number">24</span>  <span class="token comment"># v23 = 0x18</span>
        v13<span class="token punctuation">.</span>value <span class="token operator">=</span> v11<span class="token punctuation">.</span>value <span class="token operator">|</span> v12<span class="token punctuation">.</span>value
        
        v2<span class="token punctuation">.</span>value <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">(</span>v6<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value  <span class="token comment"># v24 = 1</span>
        v1<span class="token punctuation">.</span>value <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_uint64<span class="token punctuation">(</span>v13<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span>value
    
    <span class="token keyword">return</span> v13<span class="token punctuation">.</span>value

ans <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x739e80a2</span><span class="token punctuation">,</span><span class="token number">0x3aae80a3</span><span class="token punctuation">,</span><span class="token number">0x3ba4e79f</span><span class="token punctuation">,</span><span class="token number">0x78bac1f3</span><span class="token punctuation">,</span><span class="token number">0x5ef9c1f3</span><span class="token punctuation">,</span><span class="token number">0x3bb9ec9f</span><span class="token punctuation">,</span><span class="token number">0x558683f4</span><span class="token punctuation">,</span><span class="token number">0x55fad594</span><span class="token punctuation">,</span><span class="token number">0x6cbfdd9f</span><span class="token punctuation">]</span>
flag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">""</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> d <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                res <span class="token operator">=</span> func2<span class="token punctuation">(</span>
                    a <span class="token operator">&lt;&lt;</span> <span class="token number">24</span> <span class="token operator">|</span> b <span class="token operator">&lt;&lt;</span> <span class="token number">16</span> <span class="token operator">|</span> c <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> d
                <span class="token punctuation">)</span>
                <span class="token keyword">if</span> res <span class="token keyword">in</span> ans<span class="token punctuation">:</span>
                    flag<span class="token punctuation">[</span>ans<span class="token punctuation">.</span>index<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SECCON{"</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"}"</span><span class="token punctuation">)</span></code></pre></div>
<p>書き終わったあたりで ctypes ではなく普通に C で書いた方が早かったかもと思いつつ、この Solver を使用して正しい Flag を特定できました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 597px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/dfab62b5b29855ecb98294833e057946/17602/image-20240816215102126.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 32.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDklEQVQY03VQ2XKEMAzjCBBYypEQcgAL7bal+/8fqNrZ7kNn2geN47GlSE7CZqHMgEtXo24kZN1QbTGMCi54KK3Rdj2aS4uirJBmApkokBPKsoAoBNUyIssyJOd5IoQA7wP2/RoHfd/FKqWEUiOsndF1L7GXskKSJP/jOHZMZoLzDsu6ELGDcxZVVUEIgaZpMJIo70zTFPt+6B9u/hL8+HzHTA6264adxFnQk3ie5yRawhgDrRX0pLFuK7113OU9ntV1/Vvwfv+Ki8frgdvtDeM4YPsherohIyyBbqloNmKeTTTAjg2/CfxZmqYPQY7JPzLJORejc++8J6KNJEvV0hn4rkziuCzwjM1png6/AUvOjCnAafT6AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/dfab62b5b29855ecb98294833e057946/8ac56/image-20240816215102126.webp 240w,
/static/dfab62b5b29855ecb98294833e057946/d3be9/image-20240816215102126.webp 480w,
/static/dfab62b5b29855ecb98294833e057946/9e35d/image-20240816215102126.webp 597w"
              sizes="(max-width: 597px) 100vw, 597px"
              type="image/webp"
            />
          <source
            srcset="/static/dfab62b5b29855ecb98294833e057946/8ff5a/image-20240816215102126.png 240w,
/static/dfab62b5b29855ecb98294833e057946/e85cb/image-20240816215102126.png 480w,
/static/dfab62b5b29855ecb98294833e057946/17602/image-20240816215102126.png 597w"
            sizes="(max-width: 597px) 100vw, 597px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/dfab62b5b29855ecb98294833e057946/17602/image-20240816215102126.png"
            alt="image-20240816215102126"
            title="image-20240816215102126"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>この Flag を使用すると ClamAV のスキャンも突破できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 829px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d70784423799446f0da9c91f3cfddc6d/9d76a/image-20240816215138764.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAASklEQVQI1x3GQQqAIBBA0SCQMm3GadSgdq67//F+0eLBm67hjOfE7oVoMzErqXSiHCRtZOu/VBqbOGu275WUd4oVVBURwasTQuAFujgX4wnx3agAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d70784423799446f0da9c91f3cfddc6d/8ac56/image-20240816215138764.webp 240w,
/static/d70784423799446f0da9c91f3cfddc6d/d3be9/image-20240816215138764.webp 480w,
/static/d70784423799446f0da9c91f3cfddc6d/eb5c2/image-20240816215138764.webp 829w"
              sizes="(max-width: 829px) 100vw, 829px"
              type="image/webp"
            />
          <source
            srcset="/static/d70784423799446f0da9c91f3cfddc6d/8ff5a/image-20240816215138764.png 240w,
/static/d70784423799446f0da9c91f3cfddc6d/e85cb/image-20240816215138764.png 480w,
/static/d70784423799446f0da9c91f3cfddc6d/9d76a/image-20240816215138764.png 829w"
            sizes="(max-width: 829px) 100vw, 829px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d70784423799446f0da9c91f3cfddc6d/9d76a/image-20240816215138764.png"
            alt="image-20240816215138764"
            title="image-20240816215138764"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2 id="まとめ" style="position:relative;"><a href="#%E3%81%BE%E3%81%A8%E3%82%81" aria-label="まとめ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>まとめ</h2>
<p>ClamAV のバイトコードシグネチャについてはいつかちゃんとやろうと思いつつ 1 年くらい経ってしまっていたので無事に消化できてよかったです。</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Aug 16, 2024</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/clam-av/">ClamAV</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/malware/">Malware</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたいCTF Player(Team: 0nePadding)。WinDbgとYARAが好き。OSCP / CISSP / AtCoder 緑 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/kash1064" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/clamav-signature-basic";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-5379d71873e8730fc841.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-76f2006942127b3c7274.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-70ba56c0f46525baa629.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-d19905e5c8fc953958f1.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-6ba68ef37e264f701345.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-0faa242d92f89b71e668.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-5379d71873e8730fc841.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-206f62bbc9a23b5258ed.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-a3c0f166cb4b802ff58f.js" async=""></script></body></html>