<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e71379dda153709d1a9a.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.625rem;margin:.3125rem 0;border:1px solid #999;border-radius:.3125rem}.Sidebar-module--search-container--17C6F{position:relative}.Sidebar-module--search-container-input--27Tw4{width:100%}.Sidebar-module--search-container-submit--WwtLg{position:absolute;width:2.375rem;height:2.375rem;top:calc(50% - 19px);right:0;border:3px solid #999;border-radius:0 .25rem .25rem 0;background:#999}.Sidebar-module--search-container-submit--WwtLg:before{position:absolute;content:"";width:.9375rem;height:.9375rem;top:calc(50% - 9px);left:calc(50% - 9px);border-radius:50%;box-shadow:0 0 0 2px #fff}.Sidebar-module--search-container-submit--WwtLg:after{position:absolute;content:"";width:.5rem;height:.375rem;top:calc(50% + 6px);left:calc(50% + 2px);border-top:2px solid #fff;transform:rotate(45deg)}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">Cryptoverse CTF 2023 Writeup - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content="Cryptoverse CTF 2023 Writeup"/><meta data-react-helmet="true" property="og:site_name" content="Cryptoverse CTF 2023 Writeup - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/83443fae00dbbc167b885d1a51f0946a/ctf-cryptoversectf-2023.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="Cryptoverse CTF 2023 Writeup - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content="Cryptoverse CTF 2023 Writeup"/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/83443fae00dbbc167b885d1a51f0946a/ctf-cryptoversectf-2023.png"/><link as="script" rel="preload" href="/webpack-runtime-a3c0f166cb4b802ff58f.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-93d6bfd65807f14c3c48.js"/><link as="script" rel="preload" href="/app-b20574386961d17fb1fb.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/ctf-cryptoversectf-2023/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Cryptoverse CTF 2023 Writeup</h1><div class="Content-module--content__body--2TrQ-"><p>2023 年の 5 月 6 日から開催されていた Cryptoverse CTF 2023 に 0nePadding で参加してきました。</p>
<p>最終順位は 17 位/ 364 チームでした。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 743px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/835fb6991ec9059a80c7c748f30c993c/f2793/image-20230509225600693.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 42.083333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9UlEQVQoz42S22qEQBBE/RGdi6zGu6igBgKi+Kjfsm/5/MrUrLMrxCx5ONgzdFdXT+v5vo8wDDHPM7Ztw77vWJYFUso/UQahFHQg8H1LcDcoYe7MvSeEMIIaTdOg73sMw4BxHBHH8Vsiw0cU4esW4dOgtYYyTYygRBAEmKYJZVlauq6zMIEN6YoFV/gHjOVDUNjCPM+RJAnqukZRFKiqyn7d2Yky94x2vBw+HLAoTVM7tnPI8XlmI3UUXaGuBDkqC+mMMR2zSZZlJ3e/HT6dupGZzE2v64q2be1y6IwPz7d9935XTr3ArN6q83c4urn4nPgfWPcDPffnlfo9360AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/835fb6991ec9059a80c7c748f30c993c/8ac56/image-20230509225600693.webp 240w,
/static/835fb6991ec9059a80c7c748f30c993c/d3be9/image-20230509225600693.webp 480w,
/static/835fb6991ec9059a80c7c748f30c993c/53666/image-20230509225600693.webp 743w"
              sizes="(max-width: 743px) 100vw, 743px"
              type="image/webp"
            />
          <source
            srcset="/static/835fb6991ec9059a80c7c748f30c993c/8ff5a/image-20230509225600693.png 240w,
/static/835fb6991ec9059a80c7c748f30c993c/e85cb/image-20230509225600693.png 480w,
/static/835fb6991ec9059a80c7c748f30c993c/f2793/image-20230509225600693.png 743w"
            sizes="(max-width: 743px) 100vw, 743px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/835fb6991ec9059a80c7c748f30c993c/f2793/image-20230509225600693.png"
            alt="image-20230509225600693"
            title="image-20230509225600693"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>非常に楽しい CTF で学びも多かったので、いつも通り Writeup を書きます。</p>
<!-- omit in toc -->
<h2 id="もくじ" style="position:relative;"><a href="#%E3%82%82%E3%81%8F%E3%81%98" aria-label="もくじ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>もくじ</h2>
<ul>
<li><a href="#simple-checkinrev">Simple Checkin(Rev)</a></li>
<li><a href="#micro-assemblyrev">Micro Assembly(Rev)</a></li>
<li><a href="#mac-and-cheeserev">Mac and Cheese(Rev)</a></li>
<li><a href="#solid-reverserev">Solid Reverse(Rev)</a></li>
<li><a href="#standard-vmrev">Standard VM(Rev)</a></li>
<li><a href="#%E6%9D%B1%E6%96%B9%E3%83%80%E3%83%B3%E3%83%9E%E3%82%AF%E3%82%AB%E3%82%B0%E3%83%A9rev">東方ダンマクカグラ(Rev)</a></li>
<li><a href="#the-cyber-heistforensic">The Cyber Heist(Forensic)</a></li>
<li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li>
</ul>
<h2 id="simple-checkinrev" style="position:relative;"><a href="#simple-checkinrev" aria-label="simple checkinrev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Simple Checkin(Rev)</h2>
<blockquote>
<p>Just a checkin challenge. Nothing special.</p>
</blockquote>
<p>データセクションの配列を取得して XOR すると Flag が取れます。</p>
<p>以下の Solver で Flag を取得できました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>local_58<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>local_68<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span>local_58<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span></code></pre></div>
<p>Flag は以下でしたが、今まで見た中で一番長い Flag でした。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">cvctf<span class="token punctuation">{</span>i_apologize_for_such_a_long_string_in_this_checkin_challenge,but_it_might_be_a_good_time_to_learn_about_automating_this_process?You_might_need_to_do_it_because_here_is_a_painful_hex:32a16b3a7eef8de1263812.Enjoy<span class="token punctuation">(</span>or_not<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">}</span></code></pre></div>
<h2 id="micro-assemblyrev" style="position:relative;"><a href="#micro-assemblyrev" aria-label="micro assemblyrev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Micro Assembly(Rev)</h2>
<blockquote>
<p>A special message is computed out of this short piece of assembly. Wrap the message you got in <code class="language-text">cvctf{}</code>.</p>
</blockquote>
<p>以下のアセンブリコードが与えられます。</p>
<p>最終的にこのアセンブリコードで取得できる値が Flag になりました。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">main<span class="token operator">:</span>
   PUSH <span class="token operator">%</span>BP
   MOV  <span class="token operator">%</span>SP<span class="token punctuation">,</span> <span class="token operator">%</span>BP
@main_body<span class="token operator">:</span>
   SUB  <span class="token operator">%</span>SP<span class="token punctuation">,</span> $<span class="token number">28</span><span class="token punctuation">,</span> <span class="token operator">%</span>SP
   MOV  $<span class="token number">154</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   MOV  $<span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   MOV  $<span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   MOV  $<span class="token number">228</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   MOV  $<span class="token number">66</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   MOV  $<span class="token number">286</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   MOV  $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
@if0<span class="token operator">:</span>
   DIV  <span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   CMP  <span class="token operator">%</span><span class="token number">12</span><span class="token punctuation">,</span> $<span class="token number">0</span>
   JNE  @false0
@true0<span class="token operator">:</span>
   DIV  <span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   MOV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   JMP  @exit0
@false0<span class="token operator">:</span>
@exit0<span class="token operator">:</span>
   MUL  <span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   ADD  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> $<span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   MOV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   SHL  <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   ADD  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   MOV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
@if1<span class="token operator">:</span>
   DIV  <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   CMP  <span class="token operator">%</span><span class="token number">12</span><span class="token punctuation">,</span> $<span class="token number">1</span>
   JNE  @false1
@true1<span class="token operator">:</span>
   SUB  <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   DIV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   MOV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   JMP  @exit1
@false1<span class="token operator">:</span>
   DIV  <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   MOV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
@exit1<span class="token operator">:</span>
   SUB  <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   MOV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
@if2<span class="token operator">:</span>
   DIV  <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   CMP  <span class="token operator">%</span><span class="token number">12</span><span class="token punctuation">,</span> $<span class="token number">1</span>
   JNE  @false2
@true2<span class="token operator">:</span>
   SUB  <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   DIV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   MOV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   JMP  @exit2
@false2<span class="token operator">:</span>
   DIV  <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   MOV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
@exit2<span class="token operator">:</span>
   SHL  $<span class="token number">11</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   ADD  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> $<span class="token number">11</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   MOV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span>
   LEA  <span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">(</span><span class="token operator">%</span>BP<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">0</span>
   MOV  <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">13</span>
   JMP  @main_exit
@main_exit<span class="token operator">:</span>
   MOV  <span class="token operator">%</span>BP<span class="token punctuation">,</span> <span class="token operator">%</span>SP
   POP  <span class="token operator">%</span>BP
   RET </code></pre></div>
<p>アセンブリコードを上から順になぞりつつ C 言語で書き直すことで Flag を取得しました。</p>
<p>作成したコードは以下です。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">154</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token number">228</span><span class="token punctuation">,</span> e <span class="token operator">=</span> <span class="token number">66</span><span class="token punctuation">,</span> f <span class="token operator">=</span> <span class="token number">286</span><span class="token punctuation">,</span> g <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    a <span class="token operator">=</span> a <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    b <span class="token operator">=</span> b <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

    c <span class="token operator">&lt;&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    c <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>

    d <span class="token operator">=</span> d <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    e <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>

    f <span class="token operator">=</span> f <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
    g <span class="token operator">=</span> <span class="token number">11</span> <span class="token operator">&lt;&lt;</span> g<span class="token punctuation">;</span>
    g <span class="token operator">+=</span> <span class="token number">11</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %d %d %d %d %d %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="mac-and-cheeserev" style="position:relative;"><a href="#mac-and-cheeserev" aria-label="mac and cheeserev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mac and Cheese(Rev)</h2>
<blockquote>
<p>Sorry that I lied, there’s Mac but no Cheese.</p>
</blockquote>
<p>x86 用 macOS バイナリの解析問題でした。</p>
<p>Ghidra でデコンパイルを行ったところ、プログラムは全部で 5 回の数値の入力を受け付け、各入力値が<code class="language-text">FUN_100003e10</code>関数の返す値に一致するかを検証していることがわかりました。</p>
<p>そこで、main 関数から<code class="language-text">FUN_100003e10</code>関数を呼び出す一連の処理を Python で書き起こしました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># void FUN_100003e10(void)</span>
<span class="token comment"># {</span>
<span class="token comment">#   uint uVar1;</span>
  
<span class="token comment">#   uVar1 = DAT_100008018 ^ DAT_100008018 &lt;&lt; 0xb;</span>
<span class="token comment">#   DAT_100008018 = DAT_10000801c;</span>
<span class="token comment">#   DAT_10000801c = DAT_100008020;</span>
<span class="token comment">#   DAT_100008020 = DAT_100008024;</span>
<span class="token comment">#   DAT_100008024 = DAT_100008024 ^ DAT_100008024 >> 0x13 ^ uVar1 ^ uVar1 >> 8;</span>
<span class="token comment">#   return;</span>
<span class="token comment"># }</span>

local10 <span class="token operator">=</span> <span class="token number">0</span>
DAT_100008018 <span class="token operator">=</span> int.from_bytes<span class="token punctuation">(</span>b<span class="token string">'\xff\xd4\xb5\x20'</span>,<span class="token string">'little'</span><span class="token punctuation">)</span>
DAT_10000801c <span class="token operator">=</span> int.from_bytes<span class="token punctuation">(</span>b<span class="token string">'\xc7\x8f\x37\x32'</span>,<span class="token string">'little'</span><span class="token punctuation">)</span>
DAT_100008020 <span class="token operator">=</span> int.from_bytes<span class="token punctuation">(</span>b<span class="token string">'\x67\x87\x5f\xd5'</span>,<span class="token string">'little'</span><span class="token punctuation">)</span>
DAT_100008024 <span class="token operator">=</span> int.from_bytes<span class="token punctuation">(</span>b<span class="token string">'\xad\xa1\x4a\x10'</span>,<span class="token string">'little'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>:

    uVar1 <span class="token operator">=</span> DAT_100008018 ^ DAT_100008018 <span class="token operator">&lt;&lt;</span> 0xb
    DAT_100008018 <span class="token operator">=</span> DAT_10000801c
    DAT_10000801c <span class="token operator">=</span> DAT_100008020
    DAT_100008020 <span class="token operator">=</span> DAT_100008024
    DAT_100008024 <span class="token operator">=</span> DAT_100008024 ^ DAT_100008024 <span class="token operator">>></span> 0x13 ^ uVar1 ^ uVar1 <span class="token operator">>></span> <span class="token number">8</span>

    print<span class="token punctuation">(</span>DAT_100008024<span class="token punctuation">)</span>

    result <span class="token operator">=</span> DAT_100008024
    local10 <span class="token operator">=</span> <span class="token punctuation">(</span>result % 0x539<span class="token punctuation">)</span> + local10</code></pre></div>
<p>しかし、処理としては間違っていないように思うのに Flag を取得することができませんでした。</p>
<p>あとで気づきましたが、Python で数値計算を行う場合は uint32 のサイズからはみ出してしまう場合があり、それが原因で最終的な演算結果に差異が生まれていたようでした。</p>
<p>演算を行っている部分を以下のように修正すると Flag を取得することができました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">uVar1 <span class="token operator">=</span> DAT_100008018 <span class="token operator">^</span> <span class="token punctuation">(</span>DAT_100008018 <span class="token operator">&lt;&lt;</span> <span class="token number">0xb</span><span class="token punctuation">)</span>
uVar1 <span class="token operator">=</span> uVar1 <span class="token operator">&amp;</span> <span class="token number">0xFFFFFFFF</span>
DAT_100008018 <span class="token operator">=</span> DAT_10000801c
DAT_10000801c <span class="token operator">=</span> DAT_100008020
DAT_100008020 <span class="token operator">=</span> DAT_100008024
DAT_100008024 <span class="token operator">=</span> DAT_100008024 <span class="token operator">^</span> <span class="token punctuation">(</span>DAT_100008024 <span class="token operator">>></span> <span class="token number">0x13</span><span class="token punctuation">)</span> <span class="token operator">^</span> uVar1 <span class="token operator">^</span> <span class="token punctuation">(</span>uVar1 <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span>
DAT_100008024 <span class="token operator">=</span> DAT_100008024 <span class="token operator">&amp;</span> <span class="token number">0xFFFFFFFF</span></code></pre></div>
<p>問題を解いているときは上記の修正に思い至らなかったので、最終的には動的解析で Flag を取得しました。</p>
<p>WSL2 で macOS バイナリを動かすために、<a href="https://github.com/darlinghq/darling" target="_blank" rel="nofollow noopener noreferrer">darling</a> を使用しました。</p>
<p>インストールは以下の手順で行いました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 依存モジュールのインストール(deb ファイルでインストールする場合は不要かも)</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> cmake clang bison flex libfuse-dev libudev-dev pkg-config libc6-dev-i386 <span class="token punctuation">\</span>
gcc-multilib libcairo2-dev libgl1-mesa-dev libglu1-mesa-dev libtiff5-dev <span class="token punctuation">\</span>
libfreetype6-dev <span class="token function">git</span> git-lfs libelf-dev libxml2-dev libegl1-mesa-dev libfontconfig1-dev <span class="token punctuation">\</span>
libbsd-dev libxrandr-dev libxcursor-dev libgif-dev libavutil-dev libpulse-dev <span class="token punctuation">\</span>
libavformat-dev libavcodec-dev libswresample-dev libdbus-1-dev libxkbfile-dev <span class="token punctuation">\</span>
libssl-dev python2

<span class="token comment"># deb ファイルのダウンロード</span>
<span class="token function">wget</span> https://github.com/darlinghq/darling/releases/download/v0.1.20220704/darling_0.1.20220704.focal_amd64.deb

<span class="token comment"># インストール</span>
<span class="token function">sudo</span> dpkg -i darling_0.1.20220704.focal_amd64.deb</code></pre></div>
<p>続いて、以下の手順で darling で macOS バイナリを実行することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># シェルの起動</span>
darling shell

<span class="token comment"># macOS バイナリの実行</span>
./challenge</code></pre></div>
<p>ここで実行したアプリケーションのプロセスは、ホスト側の WSL2 から確認できます。</p>
<p>そのため、もう一つシェルを起動して以下のコマンドを実行することで、darling で起動した macOS バイナリに gdb をアタッチできます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> challenge
gdb attach <span class="token operator">&lt;</span>PID<span class="token operator">></span></code></pre></div>
<p>これで動的解析を行うことで Flag を取得できました。</p>
<h2 id="solid-reverserev" style="position:relative;"><a href="#solid-reverserev" aria-label="solid reverserev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Solid Reverse(Rev)</h2>
<blockquote>
<p>Crypto in reverse??</p>
</blockquote>
<p>問題スクリプトとして以下が与えられます。</p>
<p><a href="https://soliditylang.org/" target="_blank" rel="nofollow noopener noreferrer">Solidity</a> という、「Ethereumで実行されるスマート コントラクトを開発するために設計された、静的に型付けされた中括弧プログラミング言語」のコードらしいです。</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="language-solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">ReverseMe</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint</span> goal <span class="token operator">=</span> <span class="token number">0x57e4e375661c72654c31645f78455d19</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">magic1</span><span class="token punctuation">(</span><span class="token builtin">uint</span> x<span class="token punctuation">,</span> <span class="token builtin">uint</span> n<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Something magic</span>
        <span class="token builtin">uint</span> m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> n<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> x <span class="token operator">&amp;</span> m<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">magic2</span><span class="token punctuation">(</span><span class="token builtin">uint</span> x<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Something else magic</span>
        <span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">checkflag</span><span class="token punctuation">(</span><span class="token builtin">bytes16</span> flag<span class="token punctuation">,</span> <span class="token builtin">bytes16</span> y<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">uint128</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">uint128</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">==</span> goal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">modifier</span> <span class="token function">checker</span><span class="token punctuation">(</span><span class="token builtin">bytes16</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token builtin">bytes8</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x3492800100670155</span><span class="token punctuation">,</span> <span class="token string">"Wrong key!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token builtin">uint64</span><span class="token punctuation">(</span><span class="token builtin">uint128</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">uint32</span><span class="token punctuation">(</span><span class="token builtin">uint128</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Wrong key!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">magic1</span><span class="token punctuation">(</span><span class="token builtin">uint128</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x1964</span><span class="token punctuation">,</span> <span class="token string">"Wrong key!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">magic2</span><span class="token punctuation">(</span><span class="token builtin">uint64</span><span class="token punctuation">(</span><span class="token builtin">uint128</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">"Wrong key!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">_</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token builtin">bytes16</span> key<span class="token punctuation">,</span> <span class="token builtin">bytes16</span> flag<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token function">checker</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Main function</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">checkflag</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Flag is wrong!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Ethereum？が正直全く理解できず、実行環境を用意できなかったので、ドキュメントを頼りにコードを静的解析することにしました。</p>
<p>どうやら、<code class="language-text">checker</code>関数の検証を突破できる 16 バイトの値で goal を XOR したものが Flag になるようです。</p>
<p>solidity のドキュメントを読んでいくと、<code class="language-text">bytes8</code>関数などでは、上位ビットが取得され、下位が切り捨てられるという特徴的な動作をすることがわかりました。</p>
<p>つまり、<code class="language-text">require(bytes8(key) == 0x3492800100670155, "Wrong key!");</code>の行から、key の先頭 8 バイトは<code class="language-text">0x3492800100670155</code>に一致することがわかります。</p>
<p>続いて、<code class="language-text">require(uint64(uint128(key)) == uint32(uint128(key)), "Wrong key!");</code>から、key の後半 8 バイトの値は、後半 4 バイトの値と一致することがわかります。</p>
<p>つまり、key の 5 バイト目から 8 バイト目までの値は 0 であることが特定できます。</p>
<p>続いて、<code class="language-text">magic1(uint128(key), 16) == 0x1964</code>は下位 2 バイトの値が 0x1964 と一致することを意味することがわかります。</p>
<p>これは、以下のような処理が 0xFFFF との AND 演算結果を返す処理であるからです。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">uint m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> x <span class="token operator">&amp;</span> m<span class="token punctuation">;</span></code></pre></div>
<p>最後に、以下のように<code class="language-text">magic2</code>関数を Python で書き直して、上位 4 バイトが 0 で、下位 2 バイトが 0x1964 であり、かつ<code class="language-text">magic2(uint64(uint128(key))) == 16</code>を満たすような値を特定しました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">magic2</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> x <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">if</span> x <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
            i <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    <span class="token keyword">return</span> i

<span class="token keyword">print</span><span class="token punctuation">(</span>magic2<span class="token punctuation">(</span><span class="token number">0x0000000000011964</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>最終的に、<code class="language-text">0x0000000000011964</code>が対応する値であることがわかり、key は<code class="language-text">0x34928001006701550000000000011964</code> になることがわかりました。</p>
<p>これで、key と goal を XOR することで Flag を取得できました。</p>
<h2 id="standard-vmrev" style="position:relative;"><a href="#standard-vmrev" aria-label="standard vmrev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Standard VM(Rev)</h2>
<blockquote>
<p>Yet Another Virtual Machine.</p>
</blockquote>
<p>今回唯一の Hard 問でしたがスーパー Easy でした。(たぶん作問ミスかな？)</p>
<p>問題バイナリはユーザ入力を受け取り、Flag の検証を行う問題のようです。</p>
<p>メイン部分のデコンパイル結果は以下のようになりました。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">undefined8 <span class="token function">FUN_00101396</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">int</span> iVar1<span class="token punctuation">;</span>
  undefined8 uVar2<span class="token punctuation">;</span>
  
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Flag: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>DAT_0010200b<span class="token punctuation">,</span><span class="token operator">&amp;</span>DAT_00104110<span class="token punctuation">)</span><span class="token punctuation">;</span>
  uVar2 <span class="token operator">=</span> <span class="token function">FUN_00101209</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">FUN_00101356</span><span class="token punctuation">(</span>uVar2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  iVar1 <span class="token operator">=</span> <span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"N]N_MVdP}dSOT"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>DAT_00104110<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>iVar1 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Correct!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Wrong!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>入力値の検証を行っている箇所は色々複雑な処理をしていそうでしたが、このデコンパイル結果を見た時点で angr で解けそうなことがわかるので解析はしていません。</p>
<p>以下のスクリプトで Flag を取得できました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> angr

proj <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"standard_vm"</span><span class="token punctuation">,</span> auto_load_libs<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"EntryPoint"</span><span class="token punctuation">,</span> proj<span class="token punctuation">.</span>entry<span class="token punctuation">)</span>

<span class="token comment"># initial_state at the entry point of the binary</span>
init_state <span class="token operator">=</span> proj<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>entry_state<span class="token punctuation">(</span>args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'standard_vm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># create simulation</span>
simgr <span class="token operator">=</span> proj<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>init_state<span class="token punctuation">)</span>

simgr<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0x401403</span><span class="token punctuation">)</span><span class="token punctuation">,</span> avoid<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0x401411</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>simgr<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># b'cvctf{MyVMxd}\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'</span></code></pre></div>
<h2 id="東方ダンマクカグラrev" style="position:relative;"><a href="#%E6%9D%B1%E6%96%B9%E3%83%80%E3%83%B3%E3%83%9E%E3%82%AF%E3%82%AB%E3%82%B0%E3%83%A9rev" aria-label="東方ダンマクカグラrev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>東方ダンマクカグラ(Rev)</h2>
<blockquote>
<p>あなたは、東方Projectの人気キャラクターである博麗霊夢を操作し、弾幕バトルに挑戦することになりました。このゲームは、敵の攻撃弾をかわしながら、リズムに合わせて攻撃するという新しいスタイルのゲームです。クリアするとフラッグが表示されます。フラッグを見つけるには、ゲームをリバースエンジニアリングする必要があります。頑張ってください！</p>
</blockquote>
<p>問題文からして日本語な非常に面白い問題でした。</p>
<p>問題バイナリを起動すると、弾幕シューティングのゲーム画面が起動します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 801px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3bc35df7a8e825e9903ef66e9b30fe17/2ad15/image-20230509214254302.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 79.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD2klEQVQ4y1WS2VIbVxCGh6VsDMigXUgghNhBQoA2JBiNltFoGQkksQiEEDYpZ3HlYXKXF0iVL5JcOY5jV0ICMalK4iSP9KWRc5OLrjNnuv/ur/u08uUXL/juxUu+/eobXn39hru3f/LH9V/89tPvXH//MzevfhG7/WA//Mrt6xve/3jH39f/yPmed69vuXtzx7u3Ev/yBmXXWSbn1Ml7TYqBY1SXSdph0AjWyLqLpOx5NkeThB9sEh9PkJpIchU+ob18jmav0grUqU1X0DwNyrNHKM3IKSWvQehhnG0J1nxl2qvHdEI9YpNpVh4uELckKbsSREYW2bUleK5+Lv4LKRDHmNqi7i/SXjnls+1LlM5Wj5q/StyWwpzO0Yl8xHnsUw5WDrlK9HgW79ENtThZMtDdKc4WTHrhDvtzNZLWGJtjG5QDNQ7DXboRSdhcOeZUBBnnjgQe0Vppc7Z6wkWoQ3f9iLJ7l9ZcFWNayAN5Kt4k1XmTSsBAtW1QmNqhIXQt6ai7eYFysHpOL/KUyrROwZUUgc7F2hmH801O56sUbLvodpXGjE7JV0JzZMjLbEtulbo3RsYWl7vW158s11ByU2VJVOBsVsf0pKXtIvveIpfLJmVvjpQljG7dImdLortUDM8ejbk6WWuGhGWLo4BOd6lOdbqA4cuhJCdC0kqGuiTTxkIY0kbFtcPFQp7MZATdEaHi2Cb6IMj2sJ+Sa5eD2So7jyKkRldo+zMy2zydpX0MAVAyj0OczBkcz2apO+TFXNs0vClKDnlBZ5yniyqfLGekyDb65DpNT5TufFZGsYkp8ztfa0urh7QWmtK6ipK1hjGF6MSv0nJHMKyrPJlX6c2mORCxPrFM1RmWIjEhjVCzhWh5YhQl7tAf51nI5FL2srPWoBUsyqN4ElTtUTTLKu3ZHZqyVxV7mJo9xKFnk6tAlNOZqJCvU7DM0XTKiGYSAhGmLgANd0wKRqm6UtR9aZRuUOtTfbwge+jYwHSuSYItzv0xCqNBnge3qE3MoQ570IbdFEcDGGNBiuMBIRXi+xFNxSgJQFnGpOiSrCDOM39UqNYojfvJibA84iM75CKtTKIN2jAtXlTFTmbQgTpgF5+DmhDnRwIcuDbkpdOy9HsoNU+IJ4spjHGhGHB8ECk2MvciuecGbOQkYWHYjibJ80Nyiu/erw46yQr53oCTvSE3dZm1YjqXqViC7ClWCXaSF4KsCHNyvz+zykTftL49/u+c6Pvyg3bRuNBEpw7cJ/fJ2oz5JLuQDQnV4L1Zpfrk/0wV08RffOTpm/7Q1f/XN4lXhX5v2EFKvv8FcO4WiYZZucsAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/3bc35df7a8e825e9903ef66e9b30fe17/8ac56/image-20230509214254302.webp 240w,
/static/3bc35df7a8e825e9903ef66e9b30fe17/d3be9/image-20230509214254302.webp 480w,
/static/3bc35df7a8e825e9903ef66e9b30fe17/99a1d/image-20230509214254302.webp 801w"
              sizes="(max-width: 801px) 100vw, 801px"
              type="image/webp"
            />
          <source
            srcset="/static/3bc35df7a8e825e9903ef66e9b30fe17/8ff5a/image-20230509214254302.png 240w,
/static/3bc35df7a8e825e9903ef66e9b30fe17/e85cb/image-20230509214254302.png 480w,
/static/3bc35df7a8e825e9903ef66e9b30fe17/2ad15/image-20230509214254302.png 801w"
            sizes="(max-width: 801px) 100vw, 801px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/3bc35df7a8e825e9903ef66e9b30fe17/2ad15/image-20230509214254302.png"
            alt="image-20230509214254302"
            title="image-20230509214254302"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>どうやらこれをクリアすると Flag が取得できるそうですが、ゲームデザイン上クリアできない設計になっているようです。</p>
<p>Ghidra でしばらくバイナリを眺めていましたが、関数が多すぎて上手く解析対象を絞り込めませんでした。</p>
<p>そこでアプローチを変えようと思い色々調べたところ、対象の実行ファイルが PyInstaller でビルドされていることに気づきました。</p>
<p>そこで、PyInstaller Extractor を使用してファイルの展開を試みました。</p>
<p>参考：<a href="https://github.com/extremecoders-re/pyinstxtractor" target="_blank" rel="nofollow noopener noreferrer">extremecoders-re/pyinstxtractor: PyInstaller Extractor</a></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">py.exe pyinstxtractor.py Main.exe</code></pre></div>
<p>PyInstaller Extractor でバイナリを展開すると、PyGame を使って作成されていることがわかります。</p>
<p>実行コードを取得するため、以下のオンラインデコンパイラに展開された Main.pyc を突っ込みました。</p>
<p>参考：<a href="https://www.toolnb.com/tools-lang-en/pyc.html" target="_blank" rel="nofollow noopener noreferrer">PyC decompile - Toolnb online toolbox</a></p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># uncompyle6 version 3.5.0</span>
<span class="token comment"># Python bytecode 3.7 (3394)</span>
<span class="token comment"># Decompiled from: Python 2.7.5 (default, Nov 16 2020, 22:23:17) </span>
<span class="token comment"># [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]</span>
<span class="token comment"># Embedded file name: Main.py</span>
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'PYGAME_HIDE_SUPPORT_PROMPT'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'hide'</span>
<span class="token keyword">import</span> pygame<span class="token punctuation">,</span> math<span class="token punctuation">,</span> random<span class="token punctuation">,</span> time

<span class="token keyword">class</span> <span class="token class-name">sizes</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>Width <span class="token operator">=</span> width
        self<span class="token punctuation">.</span>Height <span class="token operator">=</span> height


currentCount <span class="token operator">=</span> <span class="token number">0</span>
currentAnim <span class="token operator">=</span> <span class="token number">1</span>
animLimit <span class="token operator">=</span> <span class="token boolean">False</span>
playerX <span class="token operator">=</span> <span class="token number">400</span>
playerY <span class="token operator">=</span> <span class="token number">450</span>
lastBullet <span class="token operator">=</span> <span class="token number">0</span>
bulletLimit <span class="token operator">=</span> <span class="token number">5000</span>
totalBullets <span class="token operator">=</span> <span class="token number">0</span>
toX <span class="token operator">=</span> <span class="token number">0</span>
toY <span class="token operator">=</span> <span class="token number">0</span>
bullets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
bulletsDirection <span class="token operator">=</span> <span class="token punctuation">[</span>
 <span class="token number">1</span><span class="token punctuation">]</span>
bulletsY <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
bulletsX <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> bullets
    <span class="token keyword">global</span> bulletsX
    <span class="token keyword">global</span> bulletsY
    <span class="token keyword">global</span> currentAnim
    <span class="token keyword">global</span> currentCount
    <span class="token keyword">global</span> lastBullet
    <span class="token keyword">global</span> playerX
    <span class="token keyword">global</span> playerY
    <span class="token keyword">global</span> toX
    <span class="token keyword">global</span> toY
    <span class="token keyword">global</span> totalBullets
    pygame<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pygame<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pygame<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span>music<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'Song.mp3'</span><span class="token punctuation">)</span>
    pygame<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span>music<span class="token punctuation">.</span>play<span class="token punctuation">(</span><span class="token punctuation">)</span>
    screenSizes <span class="token operator">=</span> sizes<span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span>
    screen <span class="token operator">=</span> pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_mode<span class="token punctuation">(</span><span class="token punctuation">(</span>screenSizes<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> screenSizes<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">)</span>
    startBullet <span class="token operator">=</span> pygame<span class="token punctuation">.</span>image<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'Bullet.png'</span><span class="token punctuation">)</span>
    startBullet <span class="token operator">=</span> screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>startBullet<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">450</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    bullets<span class="token punctuation">.</span>append<span class="token punctuation">(</span>startBullet<span class="token punctuation">)</span>
    bulletsX<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">450</span><span class="token punctuation">)</span>
    bulletsY<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
    pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_caption<span class="token punctuation">(</span><span class="token string">'Touhou Danmaku Kagura'</span><span class="token punctuation">)</span>
    pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_icon<span class="token punctuation">(</span>pygame<span class="token punctuation">.</span>image<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'Icon.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    background <span class="token operator">=</span> pygame<span class="token punctuation">.</span>image<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'Background.jpg'</span><span class="token punctuation">)</span>
    background <span class="token operator">=</span> pygame<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>scale<span class="token punctuation">(</span>background<span class="token punctuation">,</span> <span class="token punctuation">(</span>screenSizes<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> screenSizes<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">getPlayerDirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> animLimit
        <span class="token keyword">if</span> toX <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            animLimit <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">'Idle'</span>
        <span class="token keyword">if</span> toX <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">:</span>
            animLimit <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">'Right'</span>
        <span class="token keyword">if</span> toX <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            animLimit <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">'Left'</span>

    <span class="token keyword">def</span> <span class="token function">getAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> currentAnim
        <span class="token keyword">global</span> currentCount
        <span class="token keyword">if</span> currentCount <span class="token operator">>=</span> <span class="token number">150</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> currentAnim <span class="token operator">&lt;=</span> <span class="token number">7</span><span class="token punctuation">:</span>
                currentCount <span class="token operator">=</span> <span class="token number">0</span>
                currentAnim <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">elif</span> animLimit <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
                currentCount <span class="token operator">=</span> <span class="token number">0</span>
                currentAnim <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">loadBullet</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newBullet <span class="token operator">=</span> pygame<span class="token punctuation">.</span>image<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'Bullet.png'</span><span class="token punctuation">)</span>
        newBullet <span class="token operator">=</span> screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>newBullet<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">bullet</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newBullet <span class="token operator">=</span> pygame<span class="token punctuation">.</span>image<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'Bullet.png'</span><span class="token punctuation">)</span>
        newBullet <span class="token operator">=</span> screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>newBullet<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        bulletsDirection<span class="token punctuation">.</span>append<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        bullets<span class="token punctuation">.</span>append<span class="token punctuation">(</span>newBullet<span class="token punctuation">)</span>
        bulletsX<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        bulletsY<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">editDirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> playerX
        <span class="token keyword">global</span> playerY
        <span class="token keyword">if</span> toY <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> playerY <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">pass</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                playerY <span class="token operator">-=</span> <span class="token number">1</span>
        <span class="token keyword">elif</span> toY <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> playerY <span class="token operator">>=</span> screenSizes<span class="token punctuation">.</span>Height <span class="token operator">-</span> <span class="token number">60</span><span class="token punctuation">:</span>
                <span class="token keyword">pass</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                playerY <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> toX <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> playerX <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">pass</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    playerX <span class="token operator">-=</span> <span class="token number">1</span>
            <span class="token keyword">elif</span> toX <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> playerX <span class="token operator">>=</span> screenSizes<span class="token punctuation">.</span>Width <span class="token operator">-</span> <span class="token number">25</span><span class="token punctuation">:</span>
                    <span class="token keyword">pass</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    playerX <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">isCollision</span><span class="token punctuation">(</span>bulletX<span class="token punctuation">,</span> bulletY<span class="token punctuation">)</span><span class="token punctuation">:</span>
        distance <span class="token operator">=</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token builtin">pow</span><span class="token punctuation">(</span>playerX <span class="token operator">-</span> bulletX<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> math<span class="token punctuation">.</span><span class="token builtin">pow</span><span class="token punctuation">(</span>playerY <span class="token operator">-</span> bulletY<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> distance <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">makePlayer</span><span class="token punctuation">(</span>posX<span class="token punctuation">,</span> posY<span class="token punctuation">)</span><span class="token punctuation">:</span>
        getAnimation<span class="token punctuation">(</span><span class="token punctuation">)</span>
        editDirection<span class="token punctuation">(</span><span class="token punctuation">)</span>
        getDir <span class="token operator">=</span> getPlayerDirection<span class="token punctuation">(</span><span class="token punctuation">)</span>
        screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>pygame<span class="token punctuation">.</span>image<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Reimu</span><span class="token interpolation"><span class="token punctuation">{</span>getDir<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>currentAnim<span class="token punctuation">}</span></span><span class="token string">.png"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>posX<span class="token punctuation">,</span> posY<span class="token punctuation">)</span><span class="token punctuation">)</span>

    screen<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>
    isGameRunning <span class="token operator">=</span> <span class="token boolean">True</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> isGameRunning<span class="token punctuation">:</span>
        <span class="token keyword">if</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start <span class="token operator">&lt;=</span> <span class="token number">1800</span><span class="token punctuation">:</span>
            screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>background<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> event <span class="token keyword">in</span> pygame<span class="token punctuation">.</span>event<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> pygame<span class="token punctuation">.</span>QUIT<span class="token punctuation">:</span>
                    isGameRunning <span class="token operator">=</span> <span class="token boolean">False</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> pygame<span class="token punctuation">.</span>KEYDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> pygame<span class="token punctuation">.</span>K_LEFT<span class="token punctuation">:</span>
                        toX <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
                        currentAnim <span class="token operator">=</span> <span class="token number">1</span>
                    <span class="token keyword">elif</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> pygame<span class="token punctuation">.</span>K_RIGHT<span class="token punctuation">:</span>
                        toX <span class="token operator">=</span> <span class="token number">1</span>
                        currentAnim <span class="token operator">=</span> <span class="token number">1</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> pygame<span class="token punctuation">.</span>KEYDOWN<span class="token punctuation">:</span>
                            <span class="token keyword">pass</span>

                <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> pygame<span class="token punctuation">.</span>K_DOWN<span class="token punctuation">:</span>
                    toY <span class="token operator">=</span> <span class="token number">1</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> pygame<span class="token punctuation">.</span>K_UP<span class="token punctuation">:</span>
                    toY <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> pygame<span class="token punctuation">.</span>KEYUP<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> pygame<span class="token punctuation">.</span>K_LEFT<span class="token punctuation">:</span>
                            <span class="token keyword">pass</span>
                    <span class="token keyword">if</span> toX <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                        toX <span class="token operator">=</span> <span class="token number">0</span>
                    <span class="token keyword">elif</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> pygame<span class="token punctuation">.</span>K_RIGHT<span class="token punctuation">:</span>
                        toX <span class="token operator">=</span> toX <span class="token operator">>=</span> <span class="token number">1</span> <span class="token keyword">and</span> <span class="token number">0</span>
                    <span class="token keyword">elif</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> pygame<span class="token punctuation">.</span>K_UP<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> toY <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                            toY <span class="token operator">=</span> <span class="token number">0</span>

                <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> pygame<span class="token punctuation">.</span>K_DOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> toY <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">:</span>
                        toY <span class="token operator">=</span> <span class="token number">0</span>

            currentCount <span class="token operator">+=</span> <span class="token number">1</span>
            lastBullet <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>bullets<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> lastBullet <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">:</span>
                    lastBullet <span class="token operator">=</span> <span class="token number">0</span>
                    <span class="token keyword">if</span> totalBullets <span class="token operator">&lt;=</span> bulletLimit<span class="token punctuation">:</span>
                        totalBullets <span class="token operator">+=</span> <span class="token number">1</span>
                        bullet<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token keyword">try</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> bulletsDirection<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                            bulletsX<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">0.5</span>
                        <span class="token keyword">elif</span> bulletsDirection<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
                            bulletsX<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">0.5</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            bulletsY<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1.5</span>
                            loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
                            <span class="token keyword">if</span> bulletsY<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">600</span><span class="token punctuation">:</span>
                                totalBullets <span class="token operator">-=</span> <span class="token number">1</span>
                                bullets<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                                bulletsX<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                                bulletsY<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

                    <span class="token keyword">except</span><span class="token punctuation">:</span>
                        <span class="token keyword">pass</span>

                    <span class="token keyword">try</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> isCollision<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                            totalBullets <span class="token operator">-=</span> <span class="token number">1</span>
                            isGameRunning <span class="token operator">=</span> <span class="token boolean">False</span>
                            bullets<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                            bulletsX<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                            bulletsY<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                    <span class="token keyword">except</span><span class="token punctuation">:</span>
                        <span class="token keyword">pass</span>

            makePlayer<span class="token punctuation">(</span>playerX<span class="token punctuation">,</span> playerY<span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> isGameRunning<span class="token punctuation">:</span>
        dx <span class="token operator">=</span> <span class="token number">50</span>
        dy <span class="token operator">=</span> <span class="token number">300</span>
        totalBullets <span class="token operator">+=</span> <span class="token number">1</span>
        bullet<span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        dx <span class="token operator">+=</span> <span class="token number">62</span>
        bullet<span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        dx <span class="token operator">+=</span> <span class="token number">62</span>
        bullet<span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">1</span>
            bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">1</span>
            loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">1</span>
            bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">1</span>
            loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
        <span class="token punctuation">{</span><span class="token punctuation">{</span> 省略 <span class="token punctuation">}</span><span class="token punctuation">}</span>
            
        pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p><code class="language-text">while isGameRunning:</code>から始まるループを<code class="language-text">isGameRunning</code>が True のまま突破するとゲームクリアになるようですが、クリア条件は存在していませんでした。</p>
<p>そのため、リバーシング結果からクリア後の処理を特定していきます。</p>
<p>クリア後の処理では以下の 2 パターンの処理を繰り返しているようでした。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># パターン 1</span>
dx <span class="token operator">+=</span> <span class="token number">62</span>
bullet<span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>
<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
    loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># パターン 2</span>
dx <span class="token operator">+=</span> <span class="token number">62</span>
bullet<span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>
<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">1</span>
    bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
    loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
    bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
    loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
    bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">1</span>
    loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">1</span>
    bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">1</span>
    loadBullet<span class="token punctuation">(</span>bulletsX<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bulletsY<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p>この処理では、以下のように 1 と 0 の文字列を画面に出力していました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 580px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/60639679e1c1d9d0f537046d16a21572/b6272/image-20230509220457983.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTUlEQVQ4y7WTO07DQBCGfQLwc9fPuACJggqaJCBEw0sgIZEmAnEFSi7BAajSIBoqKpBbW7bPNfnHrC3HxKmc4vPMzv7779qz1hYfX5QkSUOWZVSWJRVF0cQ+6vk8z6s8TVPSojCkcIWgM+4nCIJ/uSakJCHEYGiu69KQVIYSp9yOYZ8x1/toa2rDetLr4Ku4ybCt53FlaAIHGGAX7LTgmgVsRTfXFawTfEIfjwt05xjul4jzOKZ5FNETeB6N6Mbz6BT1E8wz58gniGNwhvze9+ghhs5xaK82fMTiqe/TK+KnYdCPadI3+AVvlkV3ML7FHWNm4Bq6K+hniO/CoYWu0wvyfWz+1xQkkl+bT4OdjrDzGEzBAU5io+6ypgWvsxAPMT9xBJnYYKXLUn1UXX1TQ2Grpsk1cN1Sulqjda+Lt6Zzm+5do9v6xR6Kwf/lJZ7tydi//vzvAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/60639679e1c1d9d0f537046d16a21572/8ac56/image-20230509220457983.webp 240w,
/static/60639679e1c1d9d0f537046d16a21572/d3be9/image-20230509220457983.webp 480w,
/static/60639679e1c1d9d0f537046d16a21572/4fac6/image-20230509220457983.webp 580w"
              sizes="(max-width: 580px) 100vw, 580px"
              type="image/webp"
            />
          <source
            srcset="/static/60639679e1c1d9d0f537046d16a21572/8ff5a/image-20230509220457983.png 240w,
/static/60639679e1c1d9d0f537046d16a21572/e85cb/image-20230509220457983.png 480w,
/static/60639679e1c1d9d0f537046d16a21572/b6272/image-20230509220457983.png 580w"
            sizes="(max-width: 580px) 100vw, 580px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/60639679e1c1d9d0f537046d16a21572/b6272/image-20230509220457983.png"
            alt="image-20230509220457983"
            title="image-20230509220457983"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>そのため、前述のコードの「パターン 1」を 1 に、「パターン 2」を 0 に置き換えることで以下のバイト列を得ることができました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">11000111110110110001111101001100110111101110100100110011100100110011011110101011110001100111111101</span></code></pre></div>
<p>このバイト列を Cyberchef に突っ込んで Flag を取得できました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 676px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3df8abf6a60ce39c354b2742fb9624f1/9bb7a/image-20230509220645018.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 40.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABFUlEQVQoz41R226DMAzl/z9t0tqXVVsLpSVFjEvIhWsgJGchEk8d3Rwd2Vbi42MnoCXFI0lhtMUyL9AOizaIwisO70fE1xs4Y0jTFNM0QWuNeZ53ERAa45ydcK8jfDcEefNA3qZI6BVR9om4uICKCkVeQEoJzjnquoZw8ep9LIS7E2CucRDSE47ZGz7yA4iMkMgLYu6IxBcSEeLGzhAjg1nMsyKn+Elh2WYoWYlxHmHdkYqh7ijEIKDNjEF3aCeJ/1rAhgqsqyCdimbi4KMjU7WPpfNrLjuOcVQYhsHv8eUOrbF/du27DoQQv6v1U5RSuwiMWfyo1v4OT9j3/perinqVK+keHKHxRVvxZlu++u3xNu4r+wGwHWsd176a1gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/3df8abf6a60ce39c354b2742fb9624f1/8ac56/image-20230509220645018.webp 240w,
/static/3df8abf6a60ce39c354b2742fb9624f1/d3be9/image-20230509220645018.webp 480w,
/static/3df8abf6a60ce39c354b2742fb9624f1/0ed05/image-20230509220645018.webp 676w"
              sizes="(max-width: 676px) 100vw, 676px"
              type="image/webp"
            />
          <source
            srcset="/static/3df8abf6a60ce39c354b2742fb9624f1/8ff5a/image-20230509220645018.png 240w,
/static/3df8abf6a60ce39c354b2742fb9624f1/e85cb/image-20230509220645018.png 480w,
/static/3df8abf6a60ce39c354b2742fb9624f1/9bb7a/image-20230509220645018.png 676w"
            sizes="(max-width: 676px) 100vw, 676px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/3df8abf6a60ce39c354b2742fb9624f1/9bb7a/image-20230509220645018.png"
            alt="image-20230509220645018"
            title="image-20230509220645018"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2 id="the-cyber-heistforensic" style="position:relative;"><a href="#the-cyber-heistforensic" aria-label="the cyber heistforensic permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Cyber Heist(Forensic)</h2>
<blockquote>
<p>A group of hackers has stolen a sensitive piece of data, and it’s up to you to recover it. We only found this USB sniffer capture that was taken during the cyber attack. Can you uncover the message from the hackers left to us?</p>
<p>Note: All alphabetical characters in the flag are lower-case.</p>
</blockquote>
<p>問題バイナリの pcapng ファイルを WireShark で展開すると、USBPcap で取得した一連の通信であることがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 904px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/8c2367d735e1783a34b9afbd3284b0ec/d9217/image-20230509222312992.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 84.58333333333331%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACYElEQVQ4y22UC3OCMBCE+f8/zam1TkGRh6KgCAoqL1GB6+1JqGPLDIMxyZe92wVtt9vRZrOhb12n/X5PruvyMyLLsmi73dJyuaQ1z+N/b70mrLcsmxzHkdvzPHJkz55OpxNpt9uNDocDjUYjOp3PdDweqSxLeT4eD4qiiK7XK2WXCzVNS13byiE6C9D1b1qtVrRYLMjkG3u0pmkoSRIajz8oz3NK05TqupZDMIdFt1stcy3DcAWsHBBjZgyVVFUpB2td1wnw62tCeVHI73cgxnmW9cCONr4vwIW14DZ4ZNs2JSwELA2LsHnGpxVc6pnLRhugFCWe+Ilx9gJEH1H2culSEARyYxzF0bPkOD6QYTCweAMyIO2BRZEPwDAMxRCoXLNRMFFdAgzDPU0mE8q4T3AKJaJUKZnVY/yqEBDTNBloks/q0EckAWZqLZcV7kL6YFOw6U8Pe+CFlSugH/gCNAxdYIAiDSli81QY0nQ6FVPeXU4Gl38VBr0qKERsVpzFO0dsKDmOYzZl9o8pzWBKyYe1bTeY8gSt5DfCjQOGHMYsFyEteNO7yym3AOPfHD5NQVRgCmAq/JJDAHEKkg+FCpAcE1F06Hv46jLigv55rBCQR1/uUDKSjthU1VVMARBtUBkFcCiZw4vIYL3PAUeYceEpwVaxgWtlVQ25AxhAZcprDxHiuTkXIdj/B4jNyBYUoof3+13yCIAypeLDFHDDa23Hll6q91spFSDKch1XgnnhrwqAUAqA6inmFBBG4D1G7/8FYmI+mw85BAAKsQgJqGv+fGWXwRS4+/k5lui8A38A+kwHVKjVVUMAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/8c2367d735e1783a34b9afbd3284b0ec/8ac56/image-20230509222312992.webp 240w,
/static/8c2367d735e1783a34b9afbd3284b0ec/d3be9/image-20230509222312992.webp 480w,
/static/8c2367d735e1783a34b9afbd3284b0ec/82aba/image-20230509222312992.webp 904w"
              sizes="(max-width: 904px) 100vw, 904px"
              type="image/webp"
            />
          <source
            srcset="/static/8c2367d735e1783a34b9afbd3284b0ec/8ff5a/image-20230509222312992.png 240w,
/static/8c2367d735e1783a34b9afbd3284b0ec/e85cb/image-20230509222312992.png 480w,
/static/8c2367d735e1783a34b9afbd3284b0ec/d9217/image-20230509222312992.png 904w"
            sizes="(max-width: 904px) 100vw, 904px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/8c2367d735e1783a34b9afbd3284b0ec/d9217/image-20230509222312992.png"
            alt="image-20230509222312992"
            title="image-20230509222312992"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>ちょうど前回参加した WaniCTF でも似た問題が出たので同じ手法で解けるかと思ったのですが、 <code class="language-text">Leftcver Capture Data</code>を含むパケットが存在しておらず、Flag 取得に至りませんでした。</p>
<p>参考：<a href="/ctf-wanictf-2023#lowkey_messedupforensic">Wani CTF 2023 Writeup - かえるのひみつきち</a></p>
<p>キーボードの通信じゃないのかと思ったので、どのような機器が繋がっているのかを調べることにしました。</p>
<p>以下のようにしてベンダ ID とプロダクト ID から各機器を調べました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">tshark -r ./challenge.pcap -T fields -e usb.idProduct -e usb.idVendor <span class="token operator">|</span> <span class="token function">grep</span> -v <span class="token string">'^\s*$'</span>

<span class="token comment"># https://www.usb.org/sites/default/files/vendor_ids042523.pdf でベンダ ID を調べる</span>
0x2813  0x2109 VIA Labs, Inc
0x0203  0x04d9 Holtek Semiconductor, Inc.
0x0037  0x1532 Razer <span class="token punctuation">(</span>Asia‐Pacific<span class="token punctuation">)</span> Pte Ltd.
0x006d  0x256c GRAPHICS TECHNOLOGY <span class="token punctuation">(</span>HK<span class="token punctuation">)</span> CO., LIMITED</code></pre></div>
<p>その結果、<code class="language-text">Holtek Semiconductor, Inc</code>が Keyaboard などを作成しているメーカーであるという点が気になりました。</p>
<p>そこで、WireShark でこの機器の通信に絞って監査してみたところ、HID Data の値が<code class="language-text">Leftcver Capture Data</code>の値と非常によく似た値であることがわかりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 762px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/11096cf25eefb4afd25ae17a05c1607b/a016c/image-20230509225119158.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 40.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmElEQVQoz21Ra3OqQAzl//8ue++VgiiwoFBAFrA8lKdYReXc7LbTD51mZifZk5PsSVb5Y+tYxAu88AW08hWvRw0qef2kk1fxN1/iJVexLFSJ/yuWX7EKjbiregWjWWPVGNApVnaeB55wmJaJtzBAURWwHRt5mWPrbbHzd4TlEuMpp7sHP3hDnMQIogDMZZIXxZGsVeq6AY85XMeBt/Nwn+7I0gzTbUJZlBiGs4wTnmB+zmibFje6CzuWJSzTxNowwCkvapW267Df7xGFIYIgxDzPKIoCMxXUdY3Lx4csfj8cpB+GAY/HQ8Zt02DrumAOw3ueS0w5nk7UKIDv+7AsG+N4QZZluF5vKElB1/Wk6EYKOTW6fz5yueD5fKKiPGM2TFKZ0lSCpzjuFpqmY7MxqaEFh0ZnzCGSBV1fwbaZLBBnvdlIz4gjlFmUExzBNYw1XOqlCDWu69ALKeJ4jzAKEUWRVNLROoRC4fu+R9u2Mk6SFAdagdhbQh96Pp8lfxxHKH0/YJomGvEqAZEUR+zyNxN4VVXfY/+0/2Q/ThCBcq7YAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/11096cf25eefb4afd25ae17a05c1607b/8ac56/image-20230509225119158.webp 240w,
/static/11096cf25eefb4afd25ae17a05c1607b/d3be9/image-20230509225119158.webp 480w,
/static/11096cf25eefb4afd25ae17a05c1607b/093df/image-20230509225119158.webp 762w"
              sizes="(max-width: 762px) 100vw, 762px"
              type="image/webp"
            />
          <source
            srcset="/static/11096cf25eefb4afd25ae17a05c1607b/8ff5a/image-20230509225119158.png 240w,
/static/11096cf25eefb4afd25ae17a05c1607b/e85cb/image-20230509225119158.png 480w,
/static/11096cf25eefb4afd25ae17a05c1607b/a016c/image-20230509225119158.png 762w"
            sizes="(max-width: 762px) 100vw, 762px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/11096cf25eefb4afd25ae17a05c1607b/a016c/image-20230509225119158.png"
            alt="image-20230509225119158"
            title="image-20230509225119158"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>そのため、tshark を使ってこのデバイスの<code class="language-text">HID Data</code>のみを抽出し、<code class="language-text">keystrokes.txt</code>に情報を抽出し、Flag を取得できました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># HID Data を取得</span>
tshark -r challenge.pcap -Y <span class="token string">'usbhid.data &amp;&amp; usb.addr == "1.2.1"'</span> -T fields -e usbhid.data <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/../:&amp;/g2'</span> <span class="token operator">></span> keystrokes.txt

<span class="token comment"># keystrokes.txt からキー入力を解析</span>
python3 solver.py ./keystrokes.txt</code></pre></div>
<p>solver.py は以下を使用しました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token keyword">import</span> sys

<span class="token comment">#More symbols in https://www.fileformat.info/search/google.htm?q=capslock+symbol&amp;domains=www.fileformat.info&amp;sitesearch=www.fileformat.info&amp;client=pub-6975096118196151&amp;forid=1&amp;channel=1657057343&amp;ie=UTF-8&amp;oe=UTF-8&amp;cof=GALT%3A%23008000%3BGL%3A1%3BDIV%3A%23336699%3BVLC%3A663399%3BAH%3Acenter%3BBGC%3AFFFFFF%3BLBGC%3A336699%3BALC%3A0000FF%3BLC%3A0000FF%3BT%3A000000%3BGFNT%3A0000FF%3BGIMP%3A0000FF%3BFORID%3A11&amp;hl=en</span>
KEY_CODES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token number">0x04</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x05</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x06</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x07</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x08</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x09</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x0A</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x0B</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'H'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x0C</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x0D</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'j'</span><span class="token punctuation">,</span> <span class="token string">'J'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x0E</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">'K'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x0F</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">'L'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x10</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x11</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x12</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x13</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'P'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x14</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'q'</span><span class="token punctuation">,</span> <span class="token string">'Q'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x15</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'R'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x16</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token string">'S'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x17</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x18</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x19</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x1A</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token string">'W'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x1B</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x1C</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x1D</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'Z'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x1E</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'!'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x1F</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'@'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x20</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'#'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x21</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'$'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x22</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x23</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'^'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x24</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'&amp;'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x25</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x26</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x27</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x28</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x29</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'␛'</span><span class="token punctuation">,</span><span class="token string">'␛'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x2a</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'⌫'</span><span class="token punctuation">,</span> <span class="token string">'⌫'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x2b</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'\t'</span><span class="token punctuation">,</span><span class="token string">'\t'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x2C</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x2D</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x2E</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x2F</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'['</span><span class="token punctuation">,</span> <span class="token string">'{'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x30</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">']'</span><span class="token punctuation">,</span> <span class="token string">'}'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x32</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'#'</span><span class="token punctuation">,</span><span class="token string">'~'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x33</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">';'</span><span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x34</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'\''</span><span class="token punctuation">,</span> <span class="token string">'"'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x36</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'&lt;'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x37</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'>'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x38</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x39</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'⇪'</span><span class="token punctuation">,</span><span class="token string">'⇪'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x4f</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">u'→'</span><span class="token punctuation">,</span><span class="token string">u'→'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x50</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">u'←'</span><span class="token punctuation">,</span><span class="token string">u'←'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x51</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">u'↓'</span><span class="token punctuation">,</span><span class="token string">u'↓'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token number">0x52</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">u'↑'</span><span class="token punctuation">,</span><span class="token string">u'↑'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>


<span class="token comment">#tshark -r ./usb.pcap -Y 'usb.capdata &amp;&amp; usb.data_len == 8' -T fields -e usb.capdata | sed 's/../:&amp;/g2' > keyboards.txt</span>
<span class="token keyword">def</span> <span class="token function">read_use</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        datas <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    datas <span class="token operator">=</span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> d <span class="token keyword">in</span> datas <span class="token keyword">if</span> d<span class="token punctuation">]</span> 
    cursor_x <span class="token operator">=</span> <span class="token number">0</span>
    cursor_y <span class="token operator">=</span> <span class="token number">0</span>
    lines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    output <span class="token operator">=</span> <span class="token string">''</span>
    skip_next <span class="token operator">=</span> <span class="token boolean">False</span>
    lines<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> data <span class="token keyword">in</span> datas<span class="token punctuation">:</span>
        shift <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token comment"># 0x2 is left shift 0x20 is right shift</span>
        key <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> skip_next<span class="token punctuation">:</span>
            skip_next <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">continue</span>
        
        <span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        
        <span class="token comment">#If you don't like output get a more verbose output here (maybe you need to map new rekeys or remap some of them)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> key <span class="token keyword">in</span> KEY_CODES<span class="token punctuation">:</span>
            <span class="token comment">#print("Not found: "+str(key))</span>
            <span class="token keyword">continue</span>
        
        <span class="token keyword">if</span> shift <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            shift<span class="token operator">=</span><span class="token number">1</span>
            skip_next <span class="token operator">=</span> <span class="token boolean">True</span>

        <span class="token keyword">if</span> KEY_CODES<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>shift<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">u'↑'</span><span class="token punctuation">:</span>
            lines<span class="token punctuation">[</span>cursor_y<span class="token punctuation">]</span> <span class="token operator">+=</span> output
            output <span class="token operator">=</span> <span class="token string">''</span>
            cursor_y <span class="token operator">-=</span> <span class="token number">1</span>
        
        <span class="token keyword">elif</span> KEY_CODES<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>shift<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">u'↓'</span><span class="token punctuation">:</span>
            lines<span class="token punctuation">[</span>cursor_y<span class="token punctuation">]</span> <span class="token operator">+=</span> output
            output <span class="token operator">=</span> <span class="token string">''</span>
            cursor_y <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token keyword">elif</span> KEY_CODES<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>shift<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">u'→'</span><span class="token punctuation">:</span>
            cursor_x <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token keyword">elif</span> KEY_CODES<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>shift<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">u'←'</span><span class="token punctuation">:</span>
            cursor_x <span class="token operator">-=</span> <span class="token number">1</span>

        <span class="token keyword">elif</span> KEY_CODES<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>shift<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">:</span>
            lines<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
            lines<span class="token punctuation">[</span>cursor_y<span class="token punctuation">]</span> <span class="token operator">+=</span> output
            cursor_x <span class="token operator">=</span> <span class="token number">0</span>
            cursor_y <span class="token operator">+=</span> <span class="token number">1</span>
            output <span class="token operator">=</span> <span class="token string">''</span>

        <span class="token keyword">elif</span> KEY_CODES<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>shift<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'[BACKSPACE]'</span><span class="token punctuation">:</span>
            output <span class="token operator">=</span> output<span class="token punctuation">[</span><span class="token punctuation">:</span>cursor_x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> output<span class="token punctuation">[</span>cursor_x<span class="token punctuation">:</span><span class="token punctuation">]</span>
            cursor_x <span class="token operator">-=</span> <span class="token number">1</span>
        
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            output <span class="token operator">=</span> output<span class="token punctuation">[</span><span class="token punctuation">:</span>cursor_x<span class="token punctuation">]</span> <span class="token operator">+</span> KEY_CODES<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>shift<span class="token punctuation">]</span> <span class="token operator">+</span> output<span class="token punctuation">[</span>cursor_x<span class="token punctuation">:</span><span class="token punctuation">]</span>
            cursor_x <span class="token operator">+=</span> <span class="token number">1</span>
    
    <span class="token keyword">if</span> lines <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> output
    
    <span class="token keyword">if</span> output <span class="token operator">!=</span> <span class="token string">''</span> <span class="token keyword">and</span> output <span class="token keyword">not</span> <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
        lines<span class="token punctuation">[</span>cursor_y<span class="token punctuation">]</span> <span class="token operator">+=</span> output
    
    <span class="token keyword">return</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>lines<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Missing file to read...'</span><span class="token punctuation">)</span>
        exit<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>read_use<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<h2 id="まとめ" style="position:relative;"><a href="#%E3%81%BE%E3%81%A8%E3%82%81" aria-label="まとめ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>まとめ</h2></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->May 9, 2023</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/ctf/">CTF</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/rev/">Rev</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/forensic/">Forensic</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/web/">Web</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたいCTF Player(Team: 0nePadding)。WinDbgとYARAが好き。OSCP / CISSP / AtCoder 緑 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/kash1064" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ctf-cryptoversectf-2023";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-b20574386961d17fb1fb.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-76f2006942127b3c7274.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-70ba56c0f46525baa629.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-d19905e5c8fc953958f1.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-6ba68ef37e264f701345.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-0faa242d92f89b71e668.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-b20574386961d17fb1fb.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-93d6bfd65807f14c3c48.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-a3c0f166cb4b802ff58f.js" async=""></script></body></html>