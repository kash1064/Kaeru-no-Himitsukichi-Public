<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e71379dda153709d1a9a.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.625rem;margin:.3125rem 0;border:1px solid #999;border-radius:.3125rem}.Sidebar-module--search-container--17C6F{position:relative}.Sidebar-module--search-container-input--27Tw4{width:100%}.Sidebar-module--search-container-submit--WwtLg{position:absolute;width:2.375rem;height:2.375rem;top:calc(50% - 19px);right:0;border:3px solid #999;border-radius:0 .25rem .25rem 0;background:#999}.Sidebar-module--search-container-submit--WwtLg:before{position:absolute;content:"";width:.9375rem;height:.9375rem;top:calc(50% - 9px);left:calc(50% - 9px);border-radius:50%;box-shadow:0 0 0 2px #fff}.Sidebar-module--search-container-submit--WwtLg:after{position:absolute;content:"";width:.5rem;height:.375rem;top:calc(50% + 6px);left:calc(50% + 2px);border-top:2px solid #fff;transform:rotate(45deg)}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">【CTF入門】ELFバイナリのリバースエンジニアリングに入門してみよう - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content=""/><meta data-react-helmet="true" property="og:site_name" content="【CTF入門】ELFバイナリのリバースエンジニアリングに入門してみよう - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/334bd91f01f5d703919e643c6130dca6/ctf-elf-training.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="【CTF入門】ELFバイナリのリバースエンジニアリングに入門してみよう - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content=""/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/334bd91f01f5d703919e643c6130dca6/ctf-elf-training.png"/><link as="script" rel="preload" href="/webpack-runtime-a3c0f166cb4b802ff58f.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-ccbc7c7848e640d6928d.js"/><link as="script" rel="preload" href="/app-6aedca512ffc346655cd.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/ctf-elf-training/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">【CTF入門】ELFバイナリのリバースエンジニアリングに入門してみよう</h1><div class="Content-module--content__body--2TrQ-"><p>CTFの初心者向けにELFバイナリの基本的な解析手法を解説します。</p>
<p>この記事は、私が個人的に開催する勉強会の資料として作成しました。</p>
<!-- omit in toc -->
<h2 id="もくじ" style="position:relative;"><a href="#%E3%82%82%E3%81%8F%E3%81%98" aria-label="もくじ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>もくじ</h2>
<ul>
<li><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E7%9A%84">この記事の目的</a></li>
<li><a href="#%E5%AF%BE%E8%B1%A1%E8%80%85">対象者</a></li>
<li>
<p><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99">事前準備</a></p>
<ul>
<li><a href="#%E5%95%8F%E9%A1%8C%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">問題ファイルのダウンロード</a></li>
</ul>
</li>
<li>
<p><a href="#%E8%A1%A8%E5%B1%A4%E8%A7%A3%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%86">表層解析を行う</a></p>
<ul>
<li><a href="#file">file</a></li>
<li><a href="#strings">strings</a></li>
<li><a href="#readelf">readelf</a></li>
</ul>
</li>
<li>
<p><a href="#%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">バイナリを実行してみる</a></p>
<ul>
<li><a href="#elf%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A8%E3%81%AF">ELFファイルとは</a></li>
<li><a href="#%E5%AE%9F%E8%A1%8C%E6%A8%A9%E9%99%90%E3%82%92%E4%B8%8E%E3%81%88%E3%82%8B">実行権限を与える</a></li>
</ul>
</li>
<li>
<p><a href="#%E9%9D%99%E7%9A%84%E8%A7%A3%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%86">静的解析を行う</a></p>
<ul>
<li><a href="#radare2">radare2</a></li>
</ul>
</li>
<li>
<p><a href="#ghidra%E3%81%A7main%E9%96%A2%E6%95%B0%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B">Ghidraでmain関数を解析する</a></p>
<ul>
<li><a href="#%E3%82%A8%E3%83%B3%E3%83%88%E3%83%AA%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E8%A6%8B%E3%81%A4%E3%81%91%E3%82%8B">エントリポイントを見つける</a></li>
<li><a href="#rva--va--offset%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">RVA / VA / Offsetについて</a></li>
<li><a href="#%E3%82%A8%E3%83%B3%E3%83%88%E3%83%AA%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%8B%E3%82%89main%E9%96%A2%E6%95%B0%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B">エントリポイントからmain関数を特定する</a></li>
<li><a href="#main%E9%96%A2%E6%95%B0%E3%81%AE%E3%83%87%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E7%B5%90%E6%9E%9C%E3%82%92%E8%A6%8B%E3%82%8B">main関数のデコンパイル結果を見る</a></li>
<li><a href="#%E6%A8%99%E6%BA%96%E5%85%A5%E5%8A%9B%E3%81%AE%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A">標準入力の受け取り</a></li>
<li><a href="#%E6%94%B9%E8%A1%8C%E6%96%87%E5%AD%97%E3%81%AE%E5%89%8A%E9%99%A4">改行文字の削除</a></li>
<li><a href="#%E3%83%AB%E3%83%BC%E3%83%97%E5%87%A6%E7%90%86%E3%81%A7%E6%96%87%E5%AD%97%E5%88%97%E3%82%92xor%E6%9A%97%E5%8F%B7%E5%8C%96">ループ処理で文字列をXOR暗号化</a></li>
<li><a href="#%E6%9A%97%E5%8F%B7%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E3%83%90%E3%82%A4%E3%83%88%E5%88%97%E3%82%92%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%99%E3%82%8B">暗号化されたバイト列をチェックする</a></li>
<li><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%80%A4%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B">データセクションの値を取得する</a></li>
</ul>
</li>
<li>
<p><a href="#xor%E6%9A%97%E5%8F%B7%E5%8C%96%E6%99%82%E3%81%AE%E9%96%A2%E6%95%B0%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B">XOR暗号化時の関数を解析する</a></p>
<ul>
<li><a href="#ida-free%E3%82%92%E4%BD%BF%E3%81%86">IDA Freeを使う</a></li>
<li><a href="#xor%E6%9A%97%E5%8F%B7%E5%8C%96%E3%81%AE%E6%8C%99%E5%8B%95%E3%82%92%E8%A6%8B%E6%8A%9C%E3%81%8F">XOR暗号化の挙動を見抜く</a></li>
</ul>
</li>
<li>
<p><a href="#gdb%E3%81%A7%E5%8B%95%E7%9A%84%E8%A7%A3%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%86">gdbで動的解析を行う</a></p>
<ul>
<li><a href="#gdb%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%89%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B">gdbのロードアドレスを特定する</a></li>
<li><a href="#%E3%83%96%E3%83%AC%E3%83%BC%E3%82%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">ブレークポイントを設定する</a></li>
<li><a href="#ghidra%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%83%99%E3%83%BC%E3%82%B9%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B">Ghidraのイメージベースを変更する</a></li>
<li><a href="#gdb%E3%81%A7%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%86%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E4%B8%80%E9%83%A8%E3%81%AE%E3%81%BF">gdbでよく使うコマンド(一部のみ)</a></li>
<li><a href="#%E8%A7%A3%E6%9E%90%E3%81%AE%E6%96%B9%E9%87%9D%E3%82%92%E7%AB%8B%E3%81%A6%E3%82%8B">解析の方針を立てる</a></li>
<li><a href="#x86_64%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E3%81%AE%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">x86_64アーキテクチャのレジスタについて</a></li>
<li><a href="#%E9%96%A2%E6%95%B0%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B">関数の戻り値を特定する</a></li>
</ul>
</li>
<li>
<p><a href="#gdb%E3%82%92%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%99%E3%82%8B">gdbを自動化する</a></p>
<ul>
<li><a href="#gdb-python%E3%82%92%E4%BD%BF%E3%81%86">gdb-pythonを使う</a></li>
<li><a href="#flag%E5%8F%96%E5%BE%97">Flag取得</a></li>
</ul>
</li>
<li>
<p><a href="#%E3%81%8A%E3%81%BE%E3%81%91%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%86gdb%E3%81%AE%E3%83%86%E3%82%AF%E3%83%8B%E3%83%83%E3%82%AF">おまけ：よく使うgdbのテクニック</a></p>
<ul>
<li><a href="#efrags%E3%82%92%E6%9B%B8%E3%81%8D%E6%8F%9B%E3%81%88%E3%81%A6%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90%E3%82%92%E3%83%90%E3%82%A4%E3%83%91%E3%82%B9%E3%81%99%E3%82%8B">EFRAGSを書き換えて条件分岐をバイパスする</a></li>
<li><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E4%B8%AD%E3%81%8B%E3%82%89%E6%83%85%E5%A0%B1%E3%82%92%E6%8A%9C%E3%81%8D%E5%87%BA%E3%81%99">メモリの中から情報を抜き出す</a></li>
</ul>
</li>
<li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li>
<li>
<p><a href="#%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E3%81%AE%E6%9B%B8%E7%B1%8D--web%E3%82%B5%E3%82%A4%E3%83%88">おすすめの書籍 / WEBサイト</a></p>
<ul>
<li><a href="#%E6%9B%B8%E7%B1%8D">書籍</a></li>
<li><a href="#web%E3%82%B5%E3%82%A4%E3%83%88">WEBサイト</a></li>
</ul>
</li>
</ul>
<h2 id="この記事の目的" style="position:relative;"><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E7%9A%84" aria-label="この記事の目的 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>この記事の目的</h2>
<ul>
<li>バイナリ解析に興味がある入門者向けに、GDBやGhidraを使ったELFバイナリの解析手法を紹介します</li>
</ul>
<h2 id="対象者" style="position:relative;"><a href="#%E5%AF%BE%E8%B1%A1%E8%80%85" aria-label="対象者 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>対象者</h2>
<ul>
<li>CTFやバイナリ解析に興味がある</li>
<li>
<p>コンピュータアーキテクチャやELFファイルに関する基礎知識がある</p>
<p>※ この記事はGDBやGhidraの使い方にフォーカスするため、基礎事項に関する詳細な解説は行いません。</p>
<p>※ CやPythonが雰囲気で読める、CPUやレジスタ、メモリなどの用語と主な用途を知っている、Linuxシステムの環境構築を独力で行える、くらいのレベル感を想定してます</p>
</li>
</ul>
<h2 id="事前準備" style="position:relative;"><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99" aria-label="事前準備 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>事前準備</h2>
<p>x86_64プラットフォームのLinux環境で、以下のアプリケーションをインストールしておく必要があります。</p>
<ul>
<li><a href="https://ghidra-sre.org/" target="_blank" rel="nofollow noopener noreferrer">Ghidra</a></li>
<li><a href="https://hex-rays.com/ida-free/" target="_blank" rel="nofollow noopener noreferrer">IDA Free</a></li>
<li><a href="https://www.gnu.org/software/gdb/" target="_blank" rel="nofollow noopener noreferrer">gdb</a></li>
<li><a href="https://github.com/longld/peda" target="_blank" rel="nofollow noopener noreferrer">gdb-peda</a></li>
<li><a href="https://github.com/radareorg/radare2/releases" target="_blank" rel="nofollow noopener noreferrer">radare2</a></li>
</ul>
<p>この記事の手順は以下の環境で再現していますが、アプリケーションのバージョンについては多少差異があっても特に問題ないと思います。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 環境</span>
Ubuntu20.04 64bit
Ghidra <span class="token number">10.1</span>-BETA
IDA Free <span class="token number">7.6</span>
gdb <span class="token punctuation">(</span>Ubuntu <span class="token number">9.2</span>-0ubuntu1~20.04<span class="token punctuation">)</span> <span class="token number">9.2</span>
radare2 <span class="token number">4.2</span>.1</code></pre></div>
<p>radare2とIDAFreeは一応インストールしてますが、軽く紹介する程度にとどめるのでインストールしなくても問題はないです。</p>
<h3 id="問題ファイルのダウンロード" style="position:relative;"><a href="#%E5%95%8F%E9%A1%8C%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89" aria-label="問題ファイルのダウンロード permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>問題ファイルのダウンロード</h3>
<p>この記事で使用するバイナリは以下からダウンロードできます。</p>
<p>問題バイナリ：<a href="/file/revvy_chevy">revvy_chevy</a></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># Description</span>
<span class="token number">1</span> Flag, <span class="token number">2</span> Flag, Red Flag, Blue Flag. Encrypting flags is as easy as making a rhyme</code></pre></div>
<p>なお、MetaCTFの運営にコンタクトを取り、MetaCTFのURLを記事に記載することを条件にこちらのブログでの問題バイナリの再配布について快諾いただいております。</p>
<p>CTFリンク：<a href="https://metactf.com/" target="_blank" rel="nofollow noopener noreferrer">MetaCTF | Cybersecurity Capture the Flag Competition</a></p>
<p>もし再々配布を検討される場合は、忘れずに上記リンクを記載いただければと思います。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">wget</span> https://kashiwaba-yuki.com/file/revvy_chevy</code></pre></div>
<p>Linux環境で上記のコマンドを実行して問題バイナリをダウンロードしてください。</p>
<p>それでは、さっそく解析を始めていきましょう。</p>
<h2 id="表層解析を行う" style="position:relative;"><a href="#%E8%A1%A8%E5%B1%A4%E8%A7%A3%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%86" aria-label="表層解析を行う permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>表層解析を行う</h2>
<p>まずはダウンロードしたバイナリの表層解析を行いましょう。</p>
<p>表層解析とは、ファイルそのものの持つ情報を解析する手法です。</p>
<p>リバースエンジニアリングなどを行う静的解析や、実際にプログラムを実行する動的解析を行う前にファイルの概要を調べるために表層解析を行います。</p>
<p>今回は、<code class="language-text">file</code>と<code class="language-text">strings</code>コマンドを使って、バイナリのファイルの種類と可読文字列を調査してみます。</p>
<h3 id="file" style="position:relative;"><a href="#file" aria-label="file permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>file</h3>
<p><code class="language-text">file</code>コマンドはファイルのタイプを取得するコマンドであり、以下の順番でファイルに対してチェックを行い、最初にマッチした結果を元にファイルタイプを取得します。</p>
<ul>
<li>ファイルシステムテスト</li>
<li>マジックナンバーテスト</li>
<li>言語テスト</li>
</ul>
<p>実際の出力結果は次のようになります。</p>
<p>今回は、64bitのELFバイナリであることが特定されました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># file コマンドでバイナリの種類を調べる</span>
$ <span class="token function">file</span> revvy_chevy 
revvy_chevy: ELF <span class="token number">64</span>-bit LSB shared object, x86-64, version <span class="token number">1</span> <span class="token punctuation">(</span>SYSV<span class="token punctuation">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID<span class="token punctuation">[</span>sha1<span class="token punctuation">]</span><span class="token operator">=</span>271c2040193241b806252d57ce67d110b6c8e78c, <span class="token keyword">for</span> GNU/Linux <span class="token number">3.2</span>.0, stripped</code></pre></div>
<p><code class="language-text">file</code>コマンドの詳細については以下を参照してください。</p>
<p>参考：<a href="https://linuxjm.osdn.jp/html/file/man1/file.1.html" target="_blank" rel="nofollow noopener noreferrer">Man page of FILE</a></p>
<p>特に、<code class="language-text">file</code>コマンドのテストの中で最も優先度の高いファイルシステムテストは、<code class="language-text">stat</code>システムコールの結果を元にしています。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">stat</span> revvy_chevy 
File: revvy_chevy
Size: <span class="token number">14480</span>     	
Blocks: <span class="token number">32</span>         
IO Block: <span class="token number">4096</span>   
regular <span class="token function">file</span>
Device: fd00h/64768d	Inode: <span class="token number">918235</span>      Links: <span class="token number">1</span>
Access: <span class="token punctuation">(</span>0664/-rw-rw-r--<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span> <span class="token number">1000</span>/  ubuntu<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span> <span class="token number">1000</span>/  ubuntu<span class="token punctuation">)</span>
Access: <span class="token number">2021</span>-12-11 <span class="token number">12</span>:58:48.991810253 +0900
Modify: <span class="token number">2021</span>-12-06 <span class="token number">23</span>:58:52.000000000 +0900
Change: <span class="token number">2021</span>-12-11 <span class="token number">12</span>:58:45.839677244 +0900
Birth: -</code></pre></div>
<p>参考：<a href="https://linuxjm.osdn.jp/html/LDP_man-pages/man2/stat.2.html" target="_blank" rel="nofollow noopener noreferrer">Man page of STAT</a></p>
<h3 id="strings" style="position:relative;"><a href="#strings" aria-label="strings permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>strings</h3>
<p><code class="language-text">strings</code> コマンドは、解析対象ファイルのバイナリに含まれる可読文字列(ASCII空間のプリンタブルなバイト値)を一覧参照することができるコマンドです。</p>
<p>デフォルトでは、4文字以上の可読文字列が見つかった場合に出力される仕様です。</p>
<p>表層解析においては、<code class="language-text">strings</code>コマンドの出力結果から使用しているライブラリや関数名、定義されているテキストなどの解析に役立つ情報が取得できる場合があります。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># strings コマンドでバイナリの中の可読文字列を取得する</span>
$ strings revvy_chevy 
<span class="token punctuation">{</span><span class="token punctuation">{</span> 省略 <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre></div>
<p>詳しくはマニュアルページを参照してください。</p>
<p>参考：<a href="https://linuxjm.osdn.jp/html/GNU_binutils/man1/strings.1.html" target="_blank" rel="nofollow noopener noreferrer">Man page of strings</a></p>
<h3 id="readelf" style="position:relative;"><a href="#readelf" aria-label="readelf permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>readelf</h3>
<p><code class="language-text">readelf</code>コマンドは、ELFファイルの概要について取得するためのコマンドです。</p>
<p>ELFヘッダ内の情報やセクションヘッダ、セグメントなどの情報をフォーマットして表示することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ readelf -a revvy_chevy</code></pre></div>
<p>参考：<a href="https://man7.org/linux/man-pages/man1/readelf.1.html" target="_blank" rel="nofollow noopener noreferrer">readelf(1) - Linux manual page</a></p>
<h2 id="バイナリを実行してみる" style="position:relative;"><a href="#%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B" aria-label="バイナリを実行してみる permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>バイナリを実行してみる</h2>
<p>表層解析の結果から、ダウンロードしたファイルはELF形式の実行可能ファイルであることがわかりました。</p>
<h3 id="elfファイルとは" style="position:relative;"><a href="#elf%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A8%E3%81%AF" aria-label="elfファイルとは permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ELFファイルとは</h3>
<p>ちなみにELFとは、<code class="language-text">Executable and Linkable Format</code>の略で、主にLinuxやUNIXシステムで使用されることの多い実行可能ファイルの形式です。</p>
<p>ELFバイナリは、52バイト(32bitの場合)または64バイト(64bitの場合)の長さのELFヘッダを持ちます。</p>
<p>ELFヘッダのフォーマットを知ることはELFバイナリの解析を行う上で非常に役に立つ場合があります。</p>
<p>ELFヘッダの詳細については、以下の英語版のWikipediaの情報が非常に充実しておりわかりやすいのでおすすめです。</p>
<p>参考：<a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format" target="_blank" rel="nofollow noopener noreferrer">Executable and Linkable Format - Wikipedia</a></p>
<h3 id="実行権限を与える" style="position:relative;"><a href="#%E5%AE%9F%E8%A1%8C%E6%A8%A9%E9%99%90%E3%82%92%E4%B8%8E%E3%81%88%E3%82%8B" aria-label="実行権限を与える permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>実行権限を与える</h3>
<p>Linuxシステムの場合、ファイルにはパーミッションが設定され、所有者(ユーザとグループ)と許可される操作(読み取り/書き込み/実行)の2つの観点からアクセス制限が行われています。</p>
<p>デフォルトの構成のLinuxシステムの場合、今回ダウンロードしたファイルにはまだ実行権限が与えられていないため、まずは実行権限を与える必要があります。</p>
<p>ファイルの所有者と権限については<code class="language-text">ls -l</code>コマンドで確認することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">ls</span> -l
total <span class="token number">16</span>
-rw-rw-r-- <span class="token number">1</span> ubuntu ubuntu <span class="token number">14480</span> <span class="token number">12</span>月  <span class="token number">6</span> <span class="token number">23</span>:58 revvy_chevy</code></pre></div>
<p>詳細については以下を参照します。</p>
<p>参考：<a href="https://linuxjm.osdn.jp/html/gnumaniak/man1/ls.1.html" target="_blank" rel="nofollow noopener noreferrer">Man page of LS</a></p>
<p>参考：<a href="https://linuxize.com/post/understanding-linux-file-permissions/" target="_blank" rel="nofollow noopener noreferrer">Understanding Linux File Permissions | Linuxize</a></p>
<p>また、ファイルに実行権限を付与するためには<code class="language-text">chmod +x</code>コマンドを利用します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">chmod</span> +x revvy_chevy 
$ <span class="token function">ls</span> -l
total <span class="token number">16</span>
-rwxrwxr-x <span class="token number">1</span> ubuntu ubuntu <span class="token number">14480</span> <span class="token number">12</span>月  <span class="token number">6</span> <span class="token number">23</span>:58 revvy_chevy</code></pre></div>
<p>参考：<a href="https://linuxjm.osdn.jp/html/GNU_fileutils/man1/chmod.1.html" target="_blank" rel="nofollow noopener noreferrer">Man page of CHMOD</a></p>
<p>上記のように<code class="language-text">ls -l</code>コマンドで権限を確認した際に<code class="language-text">x</code>が付与されていれば実行権限が与えられていることがわかります。</p>
<p>それでは実行してみましょう。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ ./revvy_chevy 
What<span class="token string">'s the flag? &lt;input text>
That'</span>s not it<span class="token punctuation">..</span>.</code></pre></div>
<p>問題バイナリを実行すると、文字列の入力を求められます。</p>
<p>適当な文字列を入力してみると、<code class="language-text">That's not it...</code>と表示されました。</p>
<p>この結果から、恐らくプログラムの中では、入力された文字列とFlagが一致するかを比較する処理を行っていそうであることが想像できます。</p>
<h2 id="静的解析を行う" style="position:relative;"><a href="#%E9%9D%99%E7%9A%84%E8%A7%A3%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%86" aria-label="静的解析を行う permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>静的解析を行う</h2>
<h3 id="radare2" style="position:relative;"><a href="#radare2" aria-label="radare2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>radare2</h3>
<p>radare2は、高機能な解析ツールであり、CUIから逆アセンブルやバイナリパッチの適用、データの比較や検索、デコンパイルなど、様々な処理を呼び出すことができます。</p>
<p><code class="language-text">radare2 revvy_chevy</code>コマンドでradare2を起動し、<code class="language-text">aaa</code>コマンドを呼び出すことで解析をスタートします。</p>
<p>解析が完了後、<code class="language-text">afl</code>コマンドを呼び出すことで、バイナリ内の関数が一覧されます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ radare2 revvy_chevy
<span class="token comment"># aaa コマンド</span>
<span class="token punctuation">[</span>0x00001100<span class="token punctuation">]</span><span class="token operator">></span> aaa
<span class="token punctuation">[</span>Cannot <span class="token function">find</span> <span class="token keyword">function</span> at 0x00001100 sym. and entry0 <span class="token punctuation">(</span>aa<span class="token punctuation">)</span>
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Analyze all flags starting with sym. and entry0 <span class="token punctuation">(</span>aa<span class="token punctuation">)</span>
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Analyze <span class="token keyword">function</span> calls <span class="token punctuation">(</span>aac<span class="token punctuation">)</span>
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Analyze len bytes of instructions <span class="token keyword">for</span> references <span class="token punctuation">(</span>aar<span class="token punctuation">)</span>
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Check <span class="token keyword">for</span> objc references
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Check <span class="token keyword">for</span> vtables
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Type matching analysis <span class="token keyword">for</span> all functions <span class="token punctuation">(</span>aaft<span class="token punctuation">)</span>
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Propagate noreturn information
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Use -AA or aaaa to perform additional experimental analysis.

<span class="token comment"># afl コマンドで関数をリストアップ</span>
<span class="token punctuation">[</span>0x00001100<span class="token punctuation">]</span><span class="token operator">></span> afl
0x00001130    <span class="token number">4</span> <span class="token number">41</span>   -<span class="token operator">></span> <span class="token number">34</span>   fcn.00001130</code></pre></div>
<p>なお、radare2のコマンドについてはヘルプがかなりわかりやすいので、<code class="language-text">a -h</code>のようにオプションを付けてヘルプを呼び出してみると良いと思います。</p>
<p>また、以下のWEBサイトも参考になります。</p>
<p>参考：<a href="https://book.rada.re/first_steps/commandline_flags.html" target="_blank" rel="nofollow noopener noreferrer">Command-line Flags - The Official Radare2 Book</a></p>
<p>radare2を使って関数の逆アセンブルとデコンパイルを行うには以下のコマンドを実行します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 関数のオフセットを実行すると、そのアドレスに移動する</span>
<span class="token punctuation">[</span>0x00001100<span class="token punctuation">]</span><span class="token operator">></span> afl
0x00001130    <span class="token number">4</span> <span class="token number">41</span>   -<span class="token operator">></span> <span class="token number">34</span>   fcn.00001130
<span class="token punctuation">[</span>0x00001100<span class="token punctuation">]</span><span class="token operator">></span> 0x00001130

<span class="token comment"># 関数の開始アドレスで pdf コマンドを実行すると逆アセンブル結果を取得できる</span>
<span class="token punctuation">[</span>0x00001130<span class="token punctuation">]</span><span class="token operator">></span> pdf
            <span class="token punctuation">;</span> CALL XREF from entry.fini0 @ +0x27
┌ <span class="token number">34</span>: fcn.00001130 <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
│           0x00001130      488d3de12e00.  lea rdi, qword <span class="token punctuation">[</span>0x00004018<span class="token punctuation">]</span>
│           0x00001137      488d05da2e00.  lea rax, qword <span class="token punctuation">[</span>0x00004018<span class="token punctuation">]</span>
│           0x0000113e      4839f8         <span class="token function">cmp</span> rax, rdi
│       ┌─<span class="token operator">&lt;</span> 0x00001141      <span class="token number">7415</span>           je 0x1158
│       │   0x00001143      488b058e2e00.  mov rax, qword <span class="token punctuation">[</span>reloc._ITM_deregisterTMCloneTable<span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token punctuation">[</span>0x3fd8:8<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>
│       │   0x0000114a      4885c0         <span class="token builtin class-name">test</span> rax, rax
│      ┌──<span class="token operator">&lt;</span> 0x0000114d      <span class="token number">7409</span>           je 0x1158
│      ││   0x0000114f      ffe0           jmp rax
<span class="token punctuation">..</span>
│      ││   <span class="token punctuation">;</span> CODE XREFS from fcn.00001130 @ 0x1141, 0x114d
└      └└─<span class="token operator">></span> 0x00001158      c3             ret

<span class="token comment"># 関数の開始アドレスで pdc コマンドを実行するとデコンパイル結果を取得できる</span>
<span class="token punctuation">[</span>0x00001130<span class="token punctuation">]</span><span class="token operator">></span> pdc
<span class="token keyword">function</span> fcn.<span class="token function-name function">00001130</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    //  <span class="token number">4</span> basic blocks
    loc_0x1130:
         //CALL XREF from entry.fini0 @ +0x27
       rdi <span class="token operator">=</span> qword <span class="token punctuation">[</span>0x00004018<span class="token punctuation">]</span>
       rax <span class="token operator">=</span> qword <span class="token punctuation">[</span>0x00004018<span class="token punctuation">]</span>
       var <span class="token operator">=</span> rax - rdi
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>var<span class="token punctuation">)</span> goto 0x1158    //likely
       <span class="token punctuation">{</span>
        loc_0x1158:
           //CODE XREFS from fcn.00001130 @ 0x1141, 0x114d
           <span class="token builtin class-name">return</span>
        loc_0x1143:
           rax <span class="token operator">=</span> qword <span class="token punctuation">[</span>reloc._ITM_deregisterTMCloneTable<span class="token punctuation">]</span> //<span class="token punctuation">[</span>0x3fd8:8<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>
           var <span class="token operator">=</span> rax <span class="token operator">&amp;</span> rax
           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>var<span class="token punctuation">)</span> goto 0x1158    //likely
      <span class="token punctuation">}</span>
      <span class="token builtin class-name">return</span><span class="token punctuation">;</span>
    loc_0x114f:
       goto rax
<span class="token punctuation">(</span>break<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>続いてはGUIから逆アセンブル結果やデコンパイル結果を確認してみましょう。</p>
<h2 id="ghidraでmain関数を解析する" style="position:relative;"><a href="#ghidra%E3%81%A7main%E9%96%A2%E6%95%B0%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B" aria-label="ghidraでmain関数を解析する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ghidraでmain関数を解析する</h2>
<p>GhidaはNSAの開発したOSSのリバースエンジニアリングツールです。</p>
<p>公式のインストール方法でセットアップしている場合、<code class="language-text">ghidraRun</code>で起動することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ ghidraRun</code></pre></div>
<p>参考：<a href="https://ghidra-sre.org/" target="_blank" rel="nofollow noopener noreferrer">Ghidra</a></p>
<p>GhidraのGUIが起動したら、左上の[File]から[Import File]を選択して問題バイナリをロードします。</p>
<p>ロードが完了したらインポートされたファイル名をクリックして解析を開始します。</p>
<p>Ghidraの詳細な使い方は、[Help]の[Content]から開けるヘルプツールが結構詳しく書いてあるのでおすすめです。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d20ea907f1aa45ddb3cf7ab760d61380/0b533/image-31.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 68.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAARlAAAEZQAGA43XUAAADB0lEQVQ4y52TW2yURRTHv1dpfYGkkfiomNQnQKoPJrxKojEGY0KlIuVaLBCgKZKGAmIxhgcSFC3aQAiQEEhIAdOml+22QApYROXS7rL3r3vrfrvfdW/dZeHH7Nd1FfCJk/wyZ87MnJk5/xlp19YWdrRuoGXjOvbs2sa3nV9zuGsf3x3ooHP3zgo76NzTxqH2VrY3zKd18Ty2vlNL69Iatix+hS1L5rFZ0CKQPKEwiqrhCcpMujwkkjq6mbExrDl0M42VnSUWjXBk1SK+X/EqHe/X0vZuDW0NgvdqbbYvq0H6/f4Ubp/Mg0k3E7fv4AvIYgOdpGpUUVI6mpEhEAiw+5NFtCyv44uG12hcUkfj0grLFrKpYQFS8TGYmRzpdIZkUiWTzfGEZ+2fvm5YXOkbZNg5hsMxgtPpxOEcZWjYwdWbE/zQ/iXS3IpnUzwR/ecpWzqXx+WK4fUaRA3wRQqUHv277sqPeysJXzjT/5tlWiiaRc7KE/z1FwKXfmNWxEuPivb45aMdSEk9I2qkihqZmLYI6aoYZd8UpbAE6UKRsKi3p+sgkZ5ufM2fE1j1KXrvxeqGfcfECe8+9BGSw8QTSSGAECOlVUmJfjk+HYmLTTXCiop75Qd4279ClB5zfIjw2qbq/fp/EgmN/Cy6lUVRFBKJhM1//Ug0SiAkE4lEmVY0NM89oo2foZw4wnTzh2inTlYTDvzcidTXfZDLxw4wdf8uQbHQ5/Xhdj+0n4jf7ycYDBIKhexWdt0in/SRGx8htn4NVu+lioiP7Xawex/S8Y/q6P74dbSYbAdLpZKoWdb2i8WiTaFQbgtkA/0Y13pQe3swRgYoVubkc3Pzh4/vRzq7+i3ONNWjRYN2sDCbFwnFzzAN4rEouiauqaZsyu9QNdJoQm3NMEglZsS4ijITp/yeHeWE51a/wemmt8kYalWtbImXstGTh5DON73JhbX1TA6dQ74zhv/WIN7xftS/nSiuq0T+HCVxbwzdc4P4g5vIf4zYhG47CAr8E8N4bgwQ+us6F79p5ilpPrLirsV0LQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d20ea907f1aa45ddb3cf7ab760d61380/8ac56/image-31.webp 240w,
/static/d20ea907f1aa45ddb3cf7ab760d61380/d3be9/image-31.webp 480w,
/static/d20ea907f1aa45ddb3cf7ab760d61380/b0a15/image-31.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/d20ea907f1aa45ddb3cf7ab760d61380/8ff5a/image-31.png 240w,
/static/d20ea907f1aa45ddb3cf7ab760d61380/e85cb/image-31.png 480w,
/static/d20ea907f1aa45ddb3cf7ab760d61380/0b533/image-31.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d20ea907f1aa45ddb3cf7ab760d61380/0b533/image-31.png"
            alt="2021/12/image-31.png"
            title="2021/12/image-31.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>日本語の情報が欲しい場合は、WEBにはあまり体系化された情報が落ちていないので、<a href="https://amzn.to/3robIsL" target="_blank" rel="nofollow noopener noreferrer">Ghidra実践ガイド</a>を読むのがいいと思います。</p>
<h3 id="エントリポイントを見つける" style="position:relative;"><a href="#%E3%82%A8%E3%83%B3%E3%83%88%E3%83%AA%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E8%A6%8B%E3%81%A4%E3%81%91%E3%82%8B" aria-label="エントリポイントを見つける permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>エントリポイントを見つける</h3>
<p>Ghidraの解析ウィンドウを開いたら、まずはmain関数の逆アセンブル結果とデコンパイル結果を見つけたいと思います。</p>
<p>しかし、デフォルトの画面で左側にあるシンボルツリーからFunctionsの一覧を探したものの、main関数は見つけられませんでした。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 433px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/5ff45b653d46d7f7a557b5847605951b/55fc0/image-32.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 119.58333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAACzElEQVQ4y52VWW/TQBRG83/hF7QgsbzBIzyCEA9QBAgQdEFsoq1Ek4pWaWkcx9mdZvMSp0lsJ8Qzh0mCaENS0mLpypY8c+a768SuXX/NlatvWV7aYGlpjVu337O8vMqNm+vcufuBe/e/8ODhFk+efuPV6wQb7/f4unlAInHEjyODVCrN1+1Ntr/H2dzcIvZufZ9Hj16y8iLByrMEaxtHfPyc49PnLFvbBXbiJb7vmSQPj0mlaxi5BsWyxXHVwXI8GpZNqVymaTuk9Qwx98SlXnqO5Vao14oMBh3+92m128QajotxsEpRy3Jca5IvVun0BvS6UsEFQsgpk3LWhBBjoOO2iPnhAKvVp1vp0LOhmpY0DUG9Keh2pFo22sRc0Fn7A+wFoZIa4NcDZD1CZiKoTE5k7sbTA8ZLYBroh30V3C6tkgc1tTilgKE8N06Tvaf/Z4BBf0DdamNlm4QW2ClBS7lr2wLHVu6rb88TWJbAbYnFCgMVw7rdoapbFCoD9lN9jpTKw8MITROqziJ0PSKZjNQGcUGXXZ8f+xYfdvJs7RVonwh6PUmoXI+iSXZH71O3/+GyH/Rx2yF9lZSKiVIzUTWyUimajteZjJ6vUAEdLyCo+ZimQFdZzijL5wVmJZopmwsqnADLZYFhTGKmZwTFkUI5C5zK+rwYOl6fsDpSKFU/ijFQ0yKKxWmFXATY9UNVDh5BYwQcklEKM8ZwrHAUgksDaw0bzXhD7jhLIVcgUJ0zk005xs4v9L+Bo/Gzn3zMgX5AXgFN01SF7DEcDs9A5Txx84G9IKDTMumcdFTdhXS7Xfye/2eCSDldyAuB/cHPf/StXDgDZ4Ch6uWJS/NH0qKxNTO+JsCLqVnkyRg4+B38y6g5b2J7LQU0cjly+TzVWgNbnWCrK+Gy5rguNcslqZeI7e7uEo/H0dK6ur0qqt3MS1vZrKBli3xKaPwCuqEqtxIWjbEAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/5ff45b653d46d7f7a557b5847605951b/8ac56/image-32.webp 240w,
/static/5ff45b653d46d7f7a557b5847605951b/aff3a/image-32.webp 433w"
              sizes="(max-width: 433px) 100vw, 433px"
              type="image/webp"
            />
          <source
            srcset="/static/5ff45b653d46d7f7a557b5847605951b/8ff5a/image-32.png 240w,
/static/5ff45b653d46d7f7a557b5847605951b/55fc0/image-32.png 433w"
            sizes="(max-width: 433px) 100vw, 433px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/5ff45b653d46d7f7a557b5847605951b/55fc0/image-32.png"
            alt="2021/12/image-32.png"
            title="2021/12/image-32.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>そのため、エントリポイントの逆アセンブル結果から、main関数のアドレスを特定していきます。</p>
<p>エントリポイントとは、ELFバイナリが実行されたときにまず初めに呼び出される関数です。</p>
<p>エントリポイントのファイルオフセットは、ELFヘッダの25バイト目から8バイト分の領域を使って定義されています。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c63d79134c96c957016e029ea8f76673/0b533/image-33.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAARlAAAEZQAGA43XUAAABwElEQVQoz22SS0/bUBCFvUA8V6hUYgOUR6I0sZ2EOsRJSBwnToJjO7FsJ+EpFjyE1EKR+AGsQaIVCwRqoRWb/s3TmRskWLC4Gt+ZO9+cObJU0xRUcnGUlBjWlTjK2RhKSxnoKxYK8Rr0uAUjYcKVq4jyDjy1BjtpwE4Z4ttVTax9SMJaKaIZK0Harw7QURrw0y20qTHItuGkTIRaC36mjkhr4uriEv/un/H7+g5/f/7Cnx8PeL59xNPNPYx5DZ9H5iCPfUJydAHSdsWHIxuI9DY6DNAddNJ19HSX7g0Emo09M8Rp7wjnmyf4Fh7ie/8YX4MDnFGuOJtGimDpqWWodKTdagBXMdEvMMB6AdUR5GwBDNfa8GgAr9ileitRFnWOfNemE5DHF6FOLosj7RhDIDe65EmPFbLSPCnONoRv/mpTHB7apdyg5InaVtmH/lEmhS/ACQLyOmxuSIr4ca/gicl9igzhAT7l3wI5umodW+td5GdS5N8bhXtmJFYKtA3yzsKg2Bk2FQn4pTUErjbIZ1PkhEKKHr3dfk/hJk1xaGX2yE5WyLsNaq6KAWwBQ3kDBnCOwWFuGCOyiX+ZVw+X8B+vXxjBc3ZbkgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/c63d79134c96c957016e029ea8f76673/8ac56/image-33.webp 240w,
/static/c63d79134c96c957016e029ea8f76673/d3be9/image-33.webp 480w,
/static/c63d79134c96c957016e029ea8f76673/b0a15/image-33.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/c63d79134c96c957016e029ea8f76673/8ff5a/image-33.png 240w,
/static/c63d79134c96c957016e029ea8f76673/e85cb/image-33.png 480w,
/static/c63d79134c96c957016e029ea8f76673/0b533/image-33.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/c63d79134c96c957016e029ea8f76673/0b533/image-33.png"
            alt="2021/12/image-33.png"
            title="2021/12/image-33.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>※ リトルエンディアン形式で<code class="language-text">0x1100</code>がエントリポイントのアドレスです。</p>
<p>前述した<code class="language-text">readelf</code>コマンドの<code class="language-text">-h</code>を利用することで、ELFヘッダ内の情報を簡単に参照することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ readelf -h revvy_chevy
ELF Header:
  Magic:   7f <span class="token number">45</span> 4c <span class="token number">46</span> 02 01 01 00 00 00 00 00 00 00 00 00 
  Class:                             ELF64
  Data:                              <span class="token number">2</span>'s complement, little endian
  Version:                           <span class="token number">1</span> <span class="token punctuation">(</span>current<span class="token punctuation">)</span>
  OS/ABI:                            UNIX - System V
  ABI Version:                       <span class="token number">0</span>
  Type:                              DYN <span class="token punctuation">(</span>Shared object <span class="token function">file</span><span class="token punctuation">)</span>
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x1100
  Start of program headers:          <span class="token number">64</span> <span class="token punctuation">(</span>bytes into <span class="token function">file</span><span class="token punctuation">)</span>
  Start of section headers:          <span class="token number">12624</span> <span class="token punctuation">(</span>bytes into <span class="token function">file</span><span class="token punctuation">)</span>
  Flags:                             0x0
  Size of this header:               <span class="token number">64</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
  Size of program headers:           <span class="token number">56</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
  Number of program headers:         <span class="token number">13</span>
  Size of section headers:           <span class="token number">64</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
  Number of section headers:         <span class="token number">29</span>
  Section header string table index: <span class="token number">28</span></code></pre></div>
<p>ここで、エントリポイントのアドレスが<code class="language-text">0x1100</code>であることがわかったので、Ghidraのシンボルツリーから<code class="language-text">entry</code>関数のアドレスを開いてみましょう。</p>
<p><code class="language-text">entry</code>関数の逆アセンブル結果とデコンパイル結果が表示されましたが、アドレスを見ると<code class="language-text">0x1100</code>ではなく<code class="language-text">0x101100</code>になっています。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7510255b616b62e8ea1b8b82301bd8f2/0b533/image-35.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 52.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAARlAAAEZQAGA43XUAAAB5UlEQVQoz32S627TQBCF/f6PhITKDwQqCClAaVDTNo5jO3Z8Xd/WXu/6Y9KmtEXASGdnbe8cn7Mz3tt3W95c3HLx3ufjp4Avq4j1JiWIS8IkZxul3O8PXF2vubz8wOrrmqtv19xsfOIwJUlKkjQjy3OiKMYzQDFCPUNcGilu8aMe/zAQK8uhsSSN43DM6HrLMBom07LgpHJhWSSfcA6vkkOhEEUnskSxCRV+1hNVo7zXhIVmX/TcbXdUlabtDEXWoaoa3Xborhe09NNEZyY8pR1+MbBNe4JkZBsPQnwiNBzUTCAkP9OCz6sVfaexi4WzqJf4rdDYhfXujs1OkVeWY9mjBsVgHMMkMAuNNnyXO7TWPhSJ0Yf1JZblEd7pQBiExHJvvdjvuoG2yXD2+bfOWX4IoTHzI+Gy/AUPH/CcLErVBMFErRyzNdT1yPHozkrAOsfN7S3z/Ez4Kp6enwiLosD3NU3rRIWhaTpyab0Wq1q6qvUkY/IH4SvHLwndQivdmqZZMMq+Z9CjFBtG6dw0SR5H9vtA1Ntz/fJPeE+qZ2lO04yidqRuR7H52ADjDGae2EfRWc7/w6tUy30Qc32T48sMJlnN/SFinx5RdUNRVWK/ZLsLSPNapqARKI7FGed9LrkoS34BMSBNxJrnD3wAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/7510255b616b62e8ea1b8b82301bd8f2/8ac56/image-35.webp 240w,
/static/7510255b616b62e8ea1b8b82301bd8f2/d3be9/image-35.webp 480w,
/static/7510255b616b62e8ea1b8b82301bd8f2/b0a15/image-35.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/7510255b616b62e8ea1b8b82301bd8f2/8ff5a/image-35.png 240w,
/static/7510255b616b62e8ea1b8b82301bd8f2/e85cb/image-35.png 480w,
/static/7510255b616b62e8ea1b8b82301bd8f2/0b533/image-35.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/7510255b616b62e8ea1b8b82301bd8f2/0b533/image-35.png"
            alt="2021/12/image-35.png"
            title="2021/12/image-35.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>これは、Ghidraのアドレスとして表示されるのはバイナリの実際のアドレスではなく、RVA(相対仮想アドレス)と呼ばれるアドレスだからです。</p>
<p>RVAは、仮想アドレスにベースアドレスやイメージベースと呼ばれるアドレスを加算したものです。</p>
<p>GhidraでELFファイルをロードする際に[Options]から[Image Base]の欄を確認すると、デフォルトで<code class="language-text">0x100000</code>となっていたことがわかります。</p>
<p>そのため、このイメージベースに実際の仮想アドレス<code class="language-text">0x1100</code>を加算した<code class="language-text">0x101100</code>が、GhidraにRVAとして表示されているというわけです。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/83d8750d5cf9aaca6bb1b983c6853b55/0b533/image-34.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAARlAAAEZQAGA43XUAAACYUlEQVQoz11STW/TQBD1D6YSpWkT9SNNDy1N0gIn7hx75cSFMwRUaFrbseOPeP25tuOP2E6rIqHHeC2EhKWn9c7uzrx5b6SL8wvs7b7EYHCAQf8Aw+MjjE6HmE7GePvmGq8vzjE8OcZoeNKBzo6PDnFzc4MkTbEunlHVDR6fUjz/qiH9uL/Dz7kM22XwogDrdY4sL5BlRbf+RbvPcrHmRQk/jMDjGM0WqJvf2JRbpGUB6ev9F3ybq7DsFXTDwop5sFYubOd/eOKs/XdcH7Pvt5jNZkiTDdI8R7GuUKRbSH4QwuMZPn76jN7+Pi4vx5hMrwSmV9cYT6a4HE8wGp3h9HSE/X4fr3o9vNjZweHhAGdnI/RJqt7eLj68fwepqokzfZtyAx5FYI6DhaZj/qAQZMiqBnWhQdFNyLqFhapAJei6Dk2jM3UBz/fBefdWqpouYV3XcBwGVVFgWgZM20LEOXLSpShLJFkJ24vgex5c14VC92RZFsVbc7L1GhERkraPTyJh09SkR0JBDsZSeF5GVTe0J/ACKz+ERToGJBGnQrZlY0ksl4aBkBK1SYMggOQGMYqqQRSndMDpcUoGcWi6i7ni4E5hYG4ML+TCGM/zEZO7PrVp2zYM00RMRKqq7hi2Dt8qBgzLgUMu8iQlJGIkQoGEHlCMCjouTQAxY4zBpEQWJTRpz+lOlmUIwxDSkj0gSYhlQVrRfOV5O2eFWLtYF08oqb40BYuSDLTcAAF1w/wIFvOFzjFJIQWkTdtGW9Uhl/6trjCp/V+tViLe6ta22Wqlkuv3iyUeNIPmlgl2HnXwB7gBAouispHdAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/83d8750d5cf9aaca6bb1b983c6853b55/8ac56/image-34.webp 240w,
/static/83d8750d5cf9aaca6bb1b983c6853b55/d3be9/image-34.webp 480w,
/static/83d8750d5cf9aaca6bb1b983c6853b55/b0a15/image-34.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/83d8750d5cf9aaca6bb1b983c6853b55/8ff5a/image-34.png 240w,
/static/83d8750d5cf9aaca6bb1b983c6853b55/e85cb/image-34.png 480w,
/static/83d8750d5cf9aaca6bb1b983c6853b55/0b533/image-34.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/83d8750d5cf9aaca6bb1b983c6853b55/0b533/image-34.png"
            alt="2021/12/image-34.png"
            title="2021/12/image-34.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>ちなみに、Ghidraのイメージベースの設定は任意に変更ができます。</p>
<p>そのため、このアドレスを<code class="language-text">0x555555555000</code>などに設定しておくことで、gdbなどと併用する場合に表示されるアドレスをそろえることもできます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/cf30037c5f57e03e2822dfb9977a3d08/0b533/image-36.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 47.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAARlAAAEZQAGA43XUAAABoElEQVQoz41TaW+bQBTk//+2qm1qR7HByxHHCMyxh4G9mT7jplWlNsqTht0PO/OuIUmzDE9PO9R1h77v0Q09hJSQQmAcR4ycgzGG/X6HY1ogz3KUZY22GdE0HEoo3OYbhFL0niPR1uFUXLBYQJsVUltoF+EjEFZsZ0/CalqxGIPJzXAxYg0WMTqsq4end++R8DmglgThkL0qnCqFtJAomxkXbnEeLV5SBik1Fu3BpaWqNLSaCAucsTAhINyTrCsSqSPeuCMYsFogbyZU/UJiBudhQUX4vn+B954IER/FJiiWsIm8tgZVrenUqClBqyJVbnG8Dviy+/Eg/CL9D1vL92F+/faM5howUFVqErDBbLPzNERDl/TEfhP+LbQ+st0F53nC8XBC3wXMs8Oy3NBdDaz90wZjxV+CH0ViaHN1fQXLPbQOMIZavhhw7hFo2M4FnN/OtNH4YbvvSCJ9hp6TEIhEVolhI8e4kuADbdvis5GwokKWV+TFCs+HDIesQMpK5EWJoryjouoLdN3D+MMwbIbnZHhO5hcEST+Col0IPuAnmRQCBVKSxxMAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/cf30037c5f57e03e2822dfb9977a3d08/8ac56/image-36.webp 240w,
/static/cf30037c5f57e03e2822dfb9977a3d08/d3be9/image-36.webp 480w,
/static/cf30037c5f57e03e2822dfb9977a3d08/b0a15/image-36.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/cf30037c5f57e03e2822dfb9977a3d08/8ff5a/image-36.png 240w,
/static/cf30037c5f57e03e2822dfb9977a3d08/e85cb/image-36.png 480w,
/static/cf30037c5f57e03e2822dfb9977a3d08/0b533/image-36.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/cf30037c5f57e03e2822dfb9977a3d08/0b533/image-36.png"
            alt="2021/12/image-36.png"
            title="2021/12/image-36.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>上記の画像はイメージベースを<code class="language-text">0x555555555000</code>に設定した場合のエントリポイントの逆アセンブル結果です。</p>
<h3 id="rva--va--offsetについて" style="position:relative;"><a href="#rva--va--offset%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" aria-label="rva  va  offsetについて permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RVA / VA / Offsetについて</h3>
<p>ここまでなんとなくRVAやアドレス(仮想アドレス)、オフセットといった用語を使ってきたので軽く整理しておこうと思います。</p>
<p>まずファイルオフセットはシンプルにバイナリの先頭から何バイト目かという位置を表します。</p>
<p>バイナリエディタで開いた時に0x100バイト目にあるデータのファイルオフセットは、同じく0x100になります。</p>
<p>次に仮想アドレス（VA）についてです。</p>
<p>この記事では仮想アドレスの詳細については触れませんが、簡単に言えば「ファイルオフセットに各セクションの開始位置を加算」したものが仮想アドレスとなります。</p>
<p>プログラムがOSで実行されるとき、当然実行されるプログラムはメモリに展開されるわけですが、この時実際のメモリアドレス（物理アドレス）に展開してしまうと、複数のアプリケーションを平行して稼働させる必要のあるシステムではメモリアドレスの競合など、様々な弊害が発生します。</p>
<p>これらの問題を回避するため、LinuxなどのOSで実行されるアプリケーションがメモリアドレスを参照するときは、物理アドレスではなく、仮想アドレス（VA）と呼ばれるアドレスを参照します。</p>
<p>この仮想アドレスは、各セクションの先頭にオフセットを加算したものとなります。</p>
<p>例えば、セクションの境界が0x1000に設定されている.dataセクションに存在するデータのファイルオフセットが0x3000の場合、仮想アドレスは0x4000になります。</p>
<p>そして最後、RVAですが、これは前述した通り仮想アドレスにさらにイメージベースのアドレスを加算したアドレスです。</p>
<p>参考：<a href="https://tech-zealots.com/malware-analysis/understanding-concepts-of-va-rva-and-offset/" target="_blank" rel="nofollow noopener noreferrer">Understanding Concepts Of VA, RVA and Offset | Tech Zealots</a></p>
<p>各アドレスとオフセットの違いや用途については少々わかりづらいとは思いますが、入門的なCTFの問題を解くためにはあまり使わないので、難しい場合は一旦飛ばしてもらって問題ありません。</p>
<p>バイナリを触っていくうちにイメージがつくようになると思います。</p>
<h3 id="エントリポイントからmain関数を特定する" style="position:relative;"><a href="#%E3%82%A8%E3%83%B3%E3%83%88%E3%83%AA%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%8B%E3%82%89main%E9%96%A2%E6%95%B0%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B" aria-label="エントリポイントからmain関数を特定する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>エントリポイントからmain関数を特定する</h3>
<p>話を解析に戻します。</p>
<p>エントリポイントのデコンパイル結果を見ると<code class="language-text">__libc_start_main</code>が存在することがわかります。</p>
<p>この関数は、ELFバイナリが実行されるときに必ず最初に呼び出される初期化ルーチンです。</p>
<p>そして、この<code class="language-text">__libc_start_main</code>の第一引数にはmain関数のアドレスが渡されることが決まっています。</p>
<p>つまり、<code class="language-text">__libc_start_main</code>の第一引数を調べれば、今回の問題バイナリのようにシンボル情報がないバイナリであってもmain関数のアドレスを特定することができるようになるのです。</p>
<p>参考：<a href="https://refspecs.linuxbase.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/baselib---libc-start-main-.html" target="_blank" rel="nofollow noopener noreferrer">_<em>libc</em>start_main</a></p>
<p>参考：<a href="https://stackoverflow.com/questions/9885545/how-to-find-the-main-functions-entry-point-of-elf-executable-file-without-any-s" target="_blank" rel="nofollow noopener noreferrer">linux - How to find the main function’s entry point of elf executable file without any symbolic information? - Stack Overflow</a></p>
<p>というわけで、<code class="language-text">FUN_00101208</code>がmain関数であることが特定できました。</p>
<p>このままでは分かりづらいので、<code class="language-text">FUN_00101208</code>を右クリックして[Rename Function]から関数名をmainに変更しておきましょう。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ab02e5c74c2e877478451166cc7a396c/0b533/image-37.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 115.41666666666669%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAARlAAAEZQAGA43XUAAADcElEQVQ4y5VV246bVhT1d6fvjRSllRpFrfKS16QT9WGkPLWqmlZRlUx9w8bG4xv3O+ZyMBg4wOqGNFE7M/JMj7R1MJh11l577c3ghxfv8eirX/Hdsw94/vwjXr4c4tXrMS4uJri8nOHnX5Z49/s1/nh/jQ9XGwhzGbudBVGWICkbKJqN4XSO4WiKyVTA4HqtwHYSaLqAlTqDpGnY2kdYyRFmfESQ5khYhjwvURQVirJCVXEUVYmSorvOTyd6VkLaqhjougFe1yizCOLlTxi/foXJj28weXOB3du3sGYzBDED5zXuW1vdx8AwdIRpA9d0sHrxPa6+fgzh228wevIEi6dPof/2Dn6SoiRm3Wrb9s7oATUXA9MyESUchpdiqam4ktYYr3f4c7bAeCvDiRgsy6X0+BfAf6//AOoeBrIsI2I1FDOGKIoQ50sostaHrpkwLQ+q8VBAYigIApJjg8XuiMlMwnQ2h0pAfhDB80NYTgDN/B8MO8CYNJTkHOOpCEEQsSd2rhdQ+HBcHzrp+2DA6XSKuGeYYb4ysFgK2O03iOIUIenXRXfN6+YWwM3fa/WflEPWYLJKsdEYsmwHlip32uImu5uAm67Kw9GI0mkRJgmZ16NgqHmDpuFom4qiRlVzYsjvZdinPByNCaCC43jwyDq6m0DxTRxSC06yg5eo8FkAdmIPACSGfw3H1AUZga1g+xqORYam5ajbBryLhrRrH5Zyz1BcSNSPCaJoCT9SkFfF53/eeunzi2cZCjORAKmaoQSPAE/8dLZf77XNx6sR6pqsES3gHWwyeUEHNNS7JWl7Qkly5LTnnFOhblvnVpUF6oyy5GRgtQfUTQbTzWAdTMSJg7yIERcpkqIgrflZQEW3qZcVFVVZIwhChEcPZf0p5Rbt2ZTvAjQsAlwsJeRZBcYYpURzkWpS0gGcvMh5SfdooNYlVbu+d3zpJgF2w6Ale9iuQammdEoO3UpgeTHpqlDX6NTrFkVAwFVvobOAe1np2RxCMm+WIDvxnmWW11Ssqi9Ed2DHvkVz1gGG5XwC7FaShD2oZaZYb1O4bkhShFTpjDRm/TeDHen7kZ8QsxKnPCIijOQ50jPWS6NoMgazxQqGn2JPdK9Vk7ykQlJ1qI4PzT1AtoJ+V+wIeyum+xF2ZkR70IdNI84LfLi+j4Uk4W/Mb9XGocpyAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/ab02e5c74c2e877478451166cc7a396c/8ac56/image-37.webp 240w,
/static/ab02e5c74c2e877478451166cc7a396c/d3be9/image-37.webp 480w,
/static/ab02e5c74c2e877478451166cc7a396c/b0a15/image-37.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/ab02e5c74c2e877478451166cc7a396c/8ff5a/image-37.png 240w,
/static/ab02e5c74c2e877478451166cc7a396c/e85cb/image-37.png 480w,
/static/ab02e5c74c2e877478451166cc7a396c/0b533/image-37.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/ab02e5c74c2e877478451166cc7a396c/0b533/image-37.png"
            alt="2021/12/image-37.png"
            title="2021/12/image-37.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Ghidaを使って解析を行う場合には、関数名や変数名を任意に変更ができるので、その都度分かりやすい名前に変更してあげるとより効率的に解析を進めることができます。</p>
<h3 id="main関数のデコンパイル結果を見る" style="position:relative;"><a href="#main%E9%96%A2%E6%95%B0%E3%81%AE%E3%83%87%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E7%B5%90%E6%9E%9C%E3%82%92%E8%A6%8B%E3%82%8B" aria-label="main関数のデコンパイル結果を見る permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>main関数のデコンパイル結果を見る</h3>
<p>まずはmain関数のデコンパイル結果を見てみましょう。（長いのでローカル変数の定義などはカットしてます）</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token comment">/* 中略 */</span> 
  local_20 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>in_FS_OFFSET <span class="token operator">+</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token comment">/* ユーザからの標準入力(stdin)を受けとって local_68 に格納している */</span> 
  <span class="token function">__printf_chk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"What\'s the flag? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* 中略 */</span> 
  pcVar3 <span class="token operator">=</span> <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>local_68<span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pcVar3 <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>				    
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"no!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iVar2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token comment">/* 改行文字を特定し、ヌル文字に変更 */</span> 
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    sVar4 <span class="token operator">=</span> <span class="token function">strcspn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>local_68<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	 
    <span class="token operator">*</span><span class="token punctuation">(</span>undefined <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>local_68 <span class="token operator">+</span> sVar4<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    lVar5 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  
  <span class="token comment">/* 謎のループ処理 */</span> 
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      cVar1 <span class="token operator">=</span> <span class="token function">FUN_001011e9</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">*</span><span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>local_68 <span class="token operator">+</span> lVar5<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>local_68 <span class="token operator">+</span> lVar5<span class="token punctuation">)</span> <span class="token operator">^</span> cVar1 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>lVar5<span class="token punctuation">;</span>
      lVar5 <span class="token operator">=</span> lVar5 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>lVar5 <span class="token operator">!=</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">/* local_68 の値とPTR_DAT_00104010の値を 0x40 バイト分比較する */</span>
    iVar2 <span class="token operator">=</span> <span class="token function">memcmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>local_68<span class="token punctuation">,</span>PTR_DAT_00104010<span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>iVar2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"You got it!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"That\'s not it..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      iVar2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* 中略 */</span> 
<span class="token punctuation">}</span></code></pre></div>
<p>上記より、このmain関数は大きく以下の4つの処理に分割されていることがわかります。</p>
<ul>
<li>ユーザからの標準入力(stdin)を受けとって <code class="language-text">local_68</code>に格納している</li>
<li>改行文字を特定し、ヌル文字に変更（バイト列が文字列として評価される場合、0は<code class="language-text">\0</code>と同値として扱われます）
参考：<a href="https://stackoverflow.com/questions/1296843/what-is-the-difference-between-null-0-and-0" target="_blank" rel="nofollow noopener noreferrer">c - What is the difference between NULL, ‘\0’ and 0? - Stack Overflow</a></li>
<li>謎のループ処理</li>
<li>local<em>68 の値とPTR</em>DAT_00104010の値を 0x40 バイト分比較する</li>
</ul>
<p>まずは<code class="language-text">local_68</code>の変数名を<code class="language-text">input_text</code>などに変更してから順番に解析を進めていきましょう。</p>
<h3 id="標準入力の受け取り" style="position:relative;"><a href="#%E6%A8%99%E6%BA%96%E5%85%A5%E5%8A%9B%E3%81%AE%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A" aria-label="標準入力の受け取り permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>標準入力の受け取り</h3>
<p>最初に見ていくのは以下のコードです。</p>
<p><code class="language-text">fgets</code>関数で最大0x40文字分の入力を標準入力から受け取り、変数<code class="language-text">input_text</code>に格納します。</p>
<p>もし読み取りに失敗した場合は、<code class="language-text">no!!</code>という文字列を出力して終了します。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">pcVar3 <span class="token operator">=</span> <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>input_text<span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pcVar3 <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>				    
	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"no!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	iVar2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">fgets</code>関数は、ストリーム（FILEオブジェクト）から指定したバイト数のデータを読み取ることのできる関数です。</p>
<p>参考：<a href="https://www.tutorialspoint.com/c_standard_library/c_function_fgets.htm" target="_blank" rel="nofollow noopener noreferrer">C library function - fgets()</a></p>
<p>なぜこの関数でユーザの入力を受け取ることができるかというと、LinuxやUNIX系のシステムでは、ほとんどのデバイスがファイルとして抽象化されて扱われるからです。</p>
<p>Linuxシステムでは、以下のマニュアルに記載されているようにFILEオブジェクト<code class="language-text">stdin</code>が標準入力を受け取るインプットストリームとして定義されています。</p>
<p>参考：<a href="https://man7.org/linux/man-pages/man3/stdout.3.html" target="_blank" rel="nofollow noopener noreferrer">stdin(3) - Linux manual page</a></p>
<p>そのため<code class="language-text">fgets</code>関数で入力値を受け取ることができるのです。</p>
<p>より詳しく知りたい方は、以下の書籍などがわかりやすくて参考になると思います。</p>
<p>参考：<a href="https://amzn.to/3oMmsPY" target="_blank" rel="nofollow noopener noreferrer">動かしながらゼロから学ぶ Linuxカーネルの教科書</a></p>
<h3 id="改行文字の削除" style="position:relative;"><a href="#%E6%94%B9%E8%A1%8C%E6%96%87%E5%AD%97%E3%81%AE%E5%89%8A%E9%99%A4" aria-label="改行文字の削除 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>改行文字の削除</h3>
<p>次に焦点とするのはこの部分です。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">sVar4 <span class="token operator">=</span> <span class="token function">strcspn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>input_text<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	 
<span class="token operator">*</span><span class="token punctuation">(</span>undefined <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>input_text <span class="token operator">+</span> sVar4<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">strcspn</code>関数は、第一引数として受け取った文字列の中から、第二引数(reject)として受け取った文字を含まない文字だけで構成される最初の文字列の長さを返却する関数です。</p>
<p>つまり、<code class="language-text">strcspn</code>関数を使うと、任意の文字が最初に登場する場所を特定することができます。</p>
<p>今回は、標準入力から受け取った文字列の中から、改行文字<code class="language-text">\n</code>の位置を特定し、改行文字の存在する場所のバイトを0に変更しています。</p>
<p>なぜこのようなことをしているかというと、標準入力から受け取った文字列には改行文字が含まれているためです。</p>
<p>実際にメモリの中身を見てみると、以下のように改行文字<code class="language-text">0x0a</code>が入力文字の後に続いていることがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/672f64caed316a94d051034a865f6586/0b533/image-38.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 68.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAARlAAAEZQAGA43XUAAACWklEQVQ4y41TaVOjQBDNl1010dJcJMaVAAMknAOEEEhiNgc5XPcoa/f//5W3zaBWdN0qP7wamOl5069fdyWUGJbKBAt5BN5SEbRV8LaCoEvfUh9BR0PYM2hVkTRUHE5l5DW5jO0qIr44i7sD+DUdlcNwiXv7Kx7cFZb9BN6phqRpIagZyKQBYUj/BsJzDc5nBvvUgFs1welcoGrQHQbvTIdfZaj85DkeR3v8Tu6xM6ZwTxRktzbCho5UsTA3XMxNB6lsIaSsJjI91LcwkVykHQ/jpk1kGpFpYq388Df4FW6JdIcNS8XmisUYtywcvCm29gRTmUhlLnDHOPiVKpQUsSUZE/CKDAvCx2iHP+MDtnpGGarYaBnCCxP7wQI5y2B/UkiuUpKcaELiM8kxBOF3b4WVOUPuLDFTqIaXA6qZjcWXCCs1wbwXiO9ij9fKOomsnrM7gpBcGBG0DfjkdnBduGkibjjYmnNs9ClyyvIh2GNxW5TBRUgPelVdOPoaRmnKQknhNkPw7hh+h8ivbKy1CdbqhIgtZN0AKaHI7rhe/0NlyWZw2zH4dQJ+M0VQd3AY3mF2zeGQ46UUtbxwxo4kPktnryWvBCE1dTeB/0S4H8xF7YoWenn9Tb1ekx8RLtQMTpEhSea9lFrCoX6ck1QfNjnrPxnxUVSyXoS4xkSbeETG6zRqLYas42NUt+AW0t414R1TitHL+2PcNYcYN2g6pAgRdX/UcRFLARLJw+iSIbo0X6bhX+lvJK8ljsVNTBMww85a4puX495dI6rb8M9phi90BBfGhxwuYv4CuXyShJ/DfxwAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/672f64caed316a94d051034a865f6586/8ac56/image-38.webp 240w,
/static/672f64caed316a94d051034a865f6586/d3be9/image-38.webp 480w,
/static/672f64caed316a94d051034a865f6586/b0a15/image-38.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/672f64caed316a94d051034a865f6586/8ff5a/image-38.png 240w,
/static/672f64caed316a94d051034a865f6586/e85cb/image-38.png 480w,
/static/672f64caed316a94d051034a865f6586/0b533/image-38.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/672f64caed316a94d051034a865f6586/0b533/image-38.png"
            alt="2021/12/image-38.png"
            title="2021/12/image-38.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p><code class="language-text">0x0a</code>は、LF（ラインフィード）というASCIIで定義された制御文字を意味します。</p>
<p>参考：<a href="https://www.tohoho-web.com/wwwxx011.htm" target="_blank" rel="nofollow noopener noreferrer">改行コードについて - とほほのWWW入門</a></p>
<p>次に、実際に置換処理が行われた行まで実行を進めてみると、改行文字がメモリから消去されたことがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/dc631afeaeb42eb8be848e9f570f9cff/0b533/image-39.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 57.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAARlAAAEZQAGA43XUAAAB70lEQVQoz42T2XLaQBBF9RQbTAgYidVgbQghpGEktLODcIGdSuIk//8rN42UpJxKiP1walTqmTt9u3sErzXEahBgq0Zw2waiqozsRoUranBbtEoGZn2bvnXM6gr21/c4VFQEdG7WJdpDcEnJ47xqQDiZWzxO1vg43eOgpZhcUbBpUVCHL40R9WwkA4aoQ/9qOphEIj0LoWgjbNgIbidgJQ3ONVHWIDzZW3x2M3wNjjgMUwooCM631jSEA4MggcYIvmgioAvC5hjT92q+zykVsLJaUFJJcLLDJ77Hs3/EgzGHfSVjpXhkb4TdKEA2DmkzHSyfRQrOGbHyC0qFmJML2jt8cff4Hp5wMpew391jIXO4dR1rnWNjuphKMvit8rfQPxDWA2qGxOF3fHjtGVjVxPLOx0aOkHY41kqKoOnl9WE3+mUqw3wVHswNLJGEeinY3QKsbuNIme61JK+TR53jFT23w96AsFES2CLZ6kREDFazSCzGoufBIvvOz9q8ZvW35Wy4xET0MO3GRAL2wUJG2a36s1zwV9GdF4W/lF3elAXVyyGRaY3mqcFJ0MS85yJusf/X7ALCRl0grY0QSwy8FSDs0GvpG5h3PcRNp2jGm9ALywk1IW5yJNoKTyzDNxrwZ+8Avz6mVyP/MWevcbb8A3W3V/ixMCVVAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/dc631afeaeb42eb8be848e9f570f9cff/8ac56/image-39.webp 240w,
/static/dc631afeaeb42eb8be848e9f570f9cff/d3be9/image-39.webp 480w,
/static/dc631afeaeb42eb8be848e9f570f9cff/b0a15/image-39.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/dc631afeaeb42eb8be848e9f570f9cff/8ff5a/image-39.png 240w,
/static/dc631afeaeb42eb8be848e9f570f9cff/e85cb/image-39.png 480w,
/static/dc631afeaeb42eb8be848e9f570f9cff/0b533/image-39.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/dc631afeaeb42eb8be848e9f570f9cff/0b533/image-39.png"
            alt="2021/12/image-39.png"
            title="2021/12/image-39.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>GDBの使い方については後述します。</p>
<h3 id="ループ処理で文字列をxor暗号化" style="position:relative;"><a href="#%E3%83%AB%E3%83%BC%E3%83%97%E5%87%A6%E7%90%86%E3%81%A7%E6%96%87%E5%AD%97%E5%88%97%E3%82%92xor%E6%9A%97%E5%8F%B7%E5%8C%96" aria-label="ループ処理で文字列をxor暗号化 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ループ処理で文字列をXOR暗号化</h3>
<p>次の処理を見ると、謎の関数<code class="language-text">FUN_001011e9</code>の戻り値にループカウンタ<code class="language-text">lVar5</code>を加算した値を使って標準入力から受け取った文字列をXOR暗号化していることがわかります。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">do</span> <span class="token punctuation">{</span>
    cVar1 <span class="token operator">=</span> <span class="token function">FUN_001011e9</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>input_text <span class="token operator">+</span> lVar5<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>input_text <span class="token operator">+</span> lVar5<span class="token punctuation">)</span> <span class="token operator">^</span> cVar1 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>lVar5<span class="token punctuation">;</span>
    lVar5 <span class="token operator">=</span> lVar5 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>lVar5 <span class="token operator">!=</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>XOR暗号についての詳細は割愛します。</p>
<p>参考：<a href="https://gist.github.com/matsubara0507/fada4760f42cd6a52c95" target="_blank" rel="nofollow noopener noreferrer">たのしいXOR暗号入門</a></p>
<h3 id="暗号化されたバイト列をチェックする" style="position:relative;"><a href="#%E6%9A%97%E5%8F%B7%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E3%83%90%E3%82%A4%E3%83%88%E5%88%97%E3%82%92%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%99%E3%82%8B" aria-label="暗号化されたバイト列をチェックする permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>暗号化されたバイト列をチェックする</h3>
<p>ここでは、先ほどXOR暗号化された<code class="language-text">input_text</code>と<code class="language-text">PTR_DAT_00104010</code>に定義されたバイト列を0x40バイト分比較して、一致するかどうかをチェックしています。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">iVar2 <span class="token operator">=</span> <span class="token function">memcmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input_text<span class="token punctuation">,</span>PTR_DAT_00104010<span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>iVar2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"You got it!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"That\'s not it..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iVar2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>恐らく、最初の入力で与えられた文字列が正しいフラグの場合は、XOR暗号化された結果と<code class="language-text">PTR_DAT_00104010</code>に定義されているバイト値と同じになるのだと思われます。</p>
<h3 id="データセクションの値を取得する" style="position:relative;"><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%80%A4%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B" aria-label="データセクションの値を取得する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>データセクションの値を取得する</h3>
<p>続いて、<code class="language-text">PTR_DAT_00104010</code>に定義されている値を確認していきましょう。</p>
<p>ELFバイナリの場合、事前定義された文字列などのデータは<code class="language-text">.data</code>セクションに格納されます。</p>
<p>参考：<a href="https://en.wikipedia.org/wiki/Data_segment" target="_blank" rel="nofollow noopener noreferrer">Data segment - Wikipedia</a></p>
<p><code class="language-text">.data</code>セクションは読み書きが可能な領域なので、書き換え可能な変数などがこのセクションに格納されます。</p>
<p>Ghidaのデコンパイル結果から<code class="language-text">PTR_DAT_00104010</code>をクリックすることでも、このデータが定義されたセクションにジャンプすることが可能ですが、せっかくなので<code class="language-text">.data</code>セクションのオフセットを先に特定しようと思います。</p>
<p>まずは<code class="language-text">readelf -S</code>を使って表層解析を行います。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ readelf -S revvy_chevy 
There are <span class="token number">29</span> section headers, starting at offset 0x3150:

Section Headers:
  <span class="token punctuation">[</span>Nr<span class="token punctuation">]</span> Name              Type             Address           Offset       Size              EntSize          Flags  Link  Info  Align
  <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> .data             PROGBITS         0000000000004000  00003000       0000000000000018  0000000000000000  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span></code></pre></div>
<p>この出力結果から、仮想アドレス<code class="language-text">0x4000</code>から0x18バイト分の範囲に<code class="language-text">.data</code>セクションが存在することがわかりました。</p>
<p>続いて今度はradare2の解析で<code class="language-text">iS</code>コマンドを使ってセクションテーブルを取得してみます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span>0x00001100<span class="token punctuation">]</span><span class="token operator">></span> iS
<span class="token punctuation">[</span>Sections<span class="token punctuation">]</span>

nth paddr        size vaddr       vsize perm name
―――――――――――――――――――――――――――――――――――――――――――――――――
<span class="token number">0</span>   0x00000000    0x0 0x00000000    0x0 ---- 
<span class="token number">1</span>   0x00000318   0x1c 0x00000318   0x1c -r-- .interp
<span class="token number">2</span>   0x00000338   0x20 0x00000338   0x20 -r-- .note.gnu.property
<span class="token number">3</span>   0x00000358   0x24 0x00000358   0x24 -r-- .note.gnu.build_id
<span class="token number">4</span>   0x0000037c   0x20 0x0000037c   0x20 -r-- .note.ABI_tag
<span class="token number">5</span>   0x000003a0   0x28 0x000003a0   0x28 -r-- .gnu.hash
<span class="token number">6</span>   0x000003c8  0x138 0x000003c8  0x138 -r-- .dynsym
<span class="token number">7</span>   0x00000500   0xd1 0x00000500   0xd1 -r-- .dynstr
<span class="token number">8</span>   0x000005d2   0x1a 0x000005d2   0x1a -r-- .gnu.version
<span class="token number">9</span>   0x000005f0   0x40 0x000005f0   0x40 -r-- .gnu.version_r
<span class="token number">10</span>  0x00000630   0xf0 0x00000630   0xf0 -r-- .rela.dyn
<span class="token number">11</span>  0x00000720   0x90 0x00000720   0x90 -r-- .rela.plt
<span class="token number">12</span>  0x00001000   0x1b 0x00001000   0x1b -r-x .init
<span class="token number">13</span>  0x00001020   0x70 0x00001020   0x70 -r-x .plt
<span class="token number">14</span>  0x00001090   0x10 0x00001090   0x10 -r-x .plt.got
<span class="token number">15</span>  0x000010a0   0x60 0x000010a0   0x60 -r-x .plt.sec
<span class="token number">16</span>  0x00001100  0x2b5 0x00001100  0x2b5 -r-x .text
<span class="token number">17</span>  0x000013b8    0xd 0x000013b8    0xd -r-x .fini
<span class="token number">18</span>  0x00002000   0x81 0x00002000   0x81 -r-- .rodata
<span class="token number">19</span>  0x00002084   0x4c 0x00002084   0x4c -r-- .eh_frame_hdr
<span class="token number">20</span>  0x000020d0  0x128 0x000020d0  0x128 -r-- .eh_frame
<span class="token number">21</span>  0x00002d90    0x8 0x00003d90    0x8 -rw- .init_array
<span class="token number">22</span>  0x00002d98    0x8 0x00003d98    0x8 -rw- .fini_array
<span class="token number">23</span>  0x00002da0  0x1f0 0x00003da0  0x1f0 -rw- .dynamic
<span class="token number">24</span>  0x00002f90   0x70 0x00003f90   0x70 -rw- .got
<span class="token number">25</span>  0x00003000   0x18 0x00004000   0x18 -rw- .data
<span class="token number">26</span>  0x00003018    0x0 0x00004020   0x10 -rw- .bss
<span class="token number">27</span>  0x00003018   0x2a 0x00000000   0x2a ---- .comment
<span class="token number">28</span>  0x00003042  0x10a 0x00000000  0x10a ---- .shstrtab</code></pre></div>
<p>こちらの結果でも、仮想アドレス<code class="language-text">0x4000</code>から0x18バイト分の範囲に<code class="language-text">.data</code>セクションが存在することがわかりました。</p>
<p>というわけで、実際にGhidraでRVA<code class="language-text">0x104000</code>の逆アセンブル結果を見てみます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/962c13d85d306c44871ed4059475a46b/0b533/image-40.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 73.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAARlAAAEZQAGA43XUAAAB0klEQVQ4y61UaW/bMAzN//9nXVqgGBAUOdolzuX70GFJlOw3Wl4DDM2wDw3tB5qS9UQ+yl48v7zg6ccSy+UzVqsVNpst1ust3lYbvO8+sP91QHI44nQ8I80y5HmBsqzQNC3qukaaXuP44XhCkuyxwD0bgCZV6PIesjKQtUHwI/5n2lgsnHOwDPIEISSIBoZHVWkobUHBYxwnsjHe1lto0jxO6GwHYQVa00IaAaV6LLz38GHgQOH19SeKws27KULPGxW6jfFMOvthHGY/hPgc2I98KX2X0MaFzgXQ4FH27a2kT9J/2Y2QfMBU+uVygRQ+6iU6g04YNFLDWn6HQlzkeRMXHGfloZ3iKgwssWzecFJ6JrRECJzlpGWWB54YIJVlTR20Jn52MEw65edYO+Nd1FYYCWX6KI2mHmIm5Gb0hHNDSAqFdeKR5ITdWWF30TiwBKfKIZcBmQg4tT2SRrE3eC9r7EuDQo4o1IhLpWZCZQiFIFx5YHvwSJsQ41J6XGsXUevwBZXi03CLB2TNn5Idl/w9m5ulP5syEU4d/A7+6nIkxAMJrXtMhlKzhiGEeA4fYf30LRtjULcdrkWDtOq+ouS5srs/x8iqFlXdoOa/z/ma4jczAo61zxnO7QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/962c13d85d306c44871ed4059475a46b/8ac56/image-40.webp 240w,
/static/962c13d85d306c44871ed4059475a46b/d3be9/image-40.webp 480w,
/static/962c13d85d306c44871ed4059475a46b/b0a15/image-40.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/962c13d85d306c44871ed4059475a46b/8ff5a/image-40.png 240w,
/static/962c13d85d306c44871ed4059475a46b/e85cb/image-40.png 480w,
/static/962c13d85d306c44871ed4059475a46b/0b533/image-40.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/962c13d85d306c44871ed4059475a46b/0b533/image-40.png"
            alt="2021/12/image-40.png"
            title="2021/12/image-40.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>0x18バイト目までの範囲でデータが格納されています。</p>
<p>今回のターゲットは<code class="language-text">PTR_DAT_00104010</code>の値ですが、.dataセクションにはポインタとして格納されているようです。</p>
<p>そのため、このポインタが指している<code class="language-text">DAT_00102040</code>にさらにジャンプしてみます。</p>
<p>バイト列が格納されていますね。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9ad5b785a98ef92dd33995f354f871a0/0b533/image-41.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 85.83333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAARlAAAEZQAGA43XUAAABzklEQVQ4y5WU227iMBCGef9n6QO0V7viplK1q24FSC0FtiTk4DhH0tiOc/g7MZQSiiAdaeRxrHz652CPxuM5fv1eYTxe4ObmHrd3czw8rI3//bfGn6f/eH1lWK0YLJvD82JwniBNM6RJF3MEYQjGfDy/zDFq6hKdpaqGHcSIigYZfdqwAgEFoaywLbvzFpkCvLwAe1dwtwWsJIObCdgEj0WLteNjlOfvKHWNNBd4fJrB8Qoo3SIhWCYUvG1m9lI3tDZmNXH1FUv6v6xaWI6HkRACdd2gLBVm0xmlIIziUlVQpD4SKYbaxt0DKwJKpTAlYBDsgFJUkBWlXGRm37btRe8BawOUBsi5NIeKaicqhUTmB+A5Owa+bfw+cHYElHKnMBJ9hWi/A7EHLm32XWEYfgEVAY8VnlN5AXhSwz3wtIaXFfpDgOlV4Kfy1dWUa20U7jhDUvYvA7umxGI7WKG1ORmbyWRKd1IcAVUPeG1seoOtqIYGGIj+2PxgsG3nAKwJsFPIebG/KfoAvAbrATtl3V5rbQY7CpU51GUD3Vb0yuSD77LjUVPiODZvm+UyPE6esXgL4NN7Z7sRbMaxpLp4QQKPn3fGI2pkBE4+XyzxAXQZI0VnO6DXAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/9ad5b785a98ef92dd33995f354f871a0/8ac56/image-41.webp 240w,
/static/9ad5b785a98ef92dd33995f354f871a0/d3be9/image-41.webp 480w,
/static/9ad5b785a98ef92dd33995f354f871a0/b0a15/image-41.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/9ad5b785a98ef92dd33995f354f871a0/8ff5a/image-41.png 240w,
/static/9ad5b785a98ef92dd33995f354f871a0/e85cb/image-41.png 480w,
/static/9ad5b785a98ef92dd33995f354f871a0/0b533/image-41.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/9ad5b785a98ef92dd33995f354f871a0/0b533/image-41.png"
            alt="2021/12/image-41.png"
            title="2021/12/image-41.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>最終的に<code class="language-text">iVar2 = memcmp(&amp;input_text,PTR_DAT_00104010,0x40);</code>の行では、このアドレス<code class="language-text">0x104010</code>の先頭から0x40バイト分のデータを参照しています。</p>
<p>このままだと見づらいので、Ghidraの機能を使ってこのデータを整形して取得します。</p>
<p>今回は後でPythonスクリプトで使いたいので、Pythonの配列形式で取得することにしました。</p>
<p>まずは<code class="language-text">0x104000</code>から0x40バイト分の範囲を選択して右クリックします。</p>
<p>次に[Copy Special]を押して、[Python List]を選択します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3f51f7a9ce08c748b38830f87a23237c/0b533/image-42.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 78.75000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAARlAAAEZQAGA43XUAAACvElEQVQ4y3WT3VPaUBDF/f+nD31ApdM+tQrYqkASRFFxHAeFkAQIoK0KIiqEfEFAKAbJ6SYgiFbubDKX3PnNObvnLsW4CwQYAZ+5KD6FNvElsY/vqQOsnSbx45Te6X2E5WOw5yfYu04heZvGSYNHRhfB6zxSjROklDQObpPI1SQsgX4KGgg+rcNX9iFgMWDBYMuOYJvW2jBEu+hsRaYrPK2I95Whk2FkewQcDx3UR/cI9kJYlv0ImRwBOWwPWIRtBsHHTbBjDpwTmxXrcAvl/hchrNjNYcmxHdw9PyDwGMRK0Y+NzhT4l1Q6YVK44R0Oz7S5mth3UPe78BoYJKCrMGjOgXvNQyTujsiKCLGfQ8YSke4JiD3H51B8BOy7wFUEjMmhrQGD/O8iZKGEUuEcatOAqVpoqTp27YTXt9fAiAeUFoG+wir1kJ0BpasCLi+vULmpQlFb0HQDTb2F3dF7oKtQfKvQRwpDbXY6FAbC+jeUl/142NmBaRjQNBNNrfWBwii1g3/bQxc4tyz+kVGt1EmZSQp1KC0d9WYT8acE4RaB7v64d/Z+KK+BwoWEbEZALp/HdaUC3QXr6qJCZw486mUo2DYIeE+xCWClRLGxOG+CW4Mo+HIW2TQPURRRq9XIdhstQ531cHIFJhX1gGkK9tMY988NbPR+wl/8is1OHDHEEenHwJeykAQJpXIJiqLAIIUNGk7CPvTCHBvTWSfuvd39kcW/B/5qx7EzBYoXeQhZCQW5SH3UoakGGpr6IfC4y7uWnQXLoc6LZQa5ywLkvEwKy6hUq55lhWITt/cmlp2pZYf17nmym3lz9VxgOzaJzZBFuiSgKJ/junpDE1apDNSV5n+H4sXGomCP7BH69gDGyIQxNNAZWzBHbah9AzmymkqdQZTyUCk2KllWWhoMuw2LVseh50vR0roG/gHXUlMEvl5jCQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/3f51f7a9ce08c748b38830f87a23237c/8ac56/image-42.webp 240w,
/static/3f51f7a9ce08c748b38830f87a23237c/d3be9/image-42.webp 480w,
/static/3f51f7a9ce08c748b38830f87a23237c/b0a15/image-42.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/3f51f7a9ce08c748b38830f87a23237c/8ff5a/image-42.png 240w,
/static/3f51f7a9ce08c748b38830f87a23237c/e85cb/image-42.png 480w,
/static/3f51f7a9ce08c748b38830f87a23237c/0b533/image-42.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/3f51f7a9ce08c748b38830f87a23237c/0b533/image-42.png"
            alt="2021/12/image-42.png"
            title="2021/12/image-42.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>すると、次のようにPythonの配列として利用できる形式でバイナリデータを取得することができました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span> 0x74, 0x1a, 0x95, 0x4e, 0xba, 0xdb, 0x47, 0x64, 0x09, 0x2d, 0xd1, 0xbf, 0x8a, 0x9d, 0xde, 0x5a, 0xd7, 0x5c, 0x93, 0x16, 0x09, 0x3b, 0x30, 0x6f, 0x97, 0x40, 0xd0, 0x7c, 0x57, 0xdb, 0xde, 0x0c, 0x09, 0xa0, 0x84, 0x9b, 0x8a, 0x76, 0x2f, 0xb1, 0x57, 0xa2, 0xe1, 0x4f, 0xb9, 0x6f, 0x81, 0xbf, 0xb9, 0xbf, 0xe1, 0xef, 0x79, 0xcf, 0x01, 0xdf, 0xf9, 0x9f, 0xe1, 0x8f, 0x39, 0x2f, 0x81, 0xff, 0x00 <span class="token punctuation">]</span></code></pre></div>
<p>他にも様々なデータ型への変換やコピーの方法があるので、必要に応じて使い分けると解析をスムーズに行うことができます。</p>
<h2 id="xor暗号化時の関数を解析する" style="position:relative;"><a href="#xor%E6%9A%97%E5%8F%B7%E5%8C%96%E6%99%82%E3%81%AE%E9%96%A2%E6%95%B0%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B" aria-label="xor暗号化時の関数を解析する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>XOR暗号化時の関数を解析する</h2>
<p>もう少し静的解析を続けていきます。</p>
<p>先ほど解析した以下のXOR暗号化を行う処理の中に、<code class="language-text">FUN_001011e9</code>という関数を実行している行がありました。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">do</span> <span class="token punctuation">{</span>
    cVar1 <span class="token operator">=</span> <span class="token function">FUN_001011e9</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>input_text <span class="token operator">+</span> lVar5<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>input_text <span class="token operator">+</span> lVar5<span class="token punctuation">)</span> <span class="token operator">^</span> cVar1 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>lVar5<span class="token punctuation">;</span>
    lVar5 <span class="token operator">=</span> lVar5 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>lVar5 <span class="token operator">!=</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ここからは、この関数の処理を追っていきます。</p>
<p>Ghidraのデコンパイル結果を見てみると、たった一行だけのシンプルな関数でした。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">FUN_001011e9</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  DAT_0010402c <span class="token operator">=</span> DAT_0010402c <span class="token operator">*</span> <span class="token number">0x41c64e6d</span> <span class="token operator">+</span> <span class="token number">0x3039</span> <span class="token operator">&amp;</span> <span class="token number">0x7fffffff</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">DAT_0010402c</code>は未定義の変数でしたので、<code class="language-text">valiable</code>などの適当な名前に置き換えておきます。</p>
<p>さて、ここで一つ疑問が出てきました。</p>
<p>呼び出し元の<code class="language-text">cVar1 = FUN_001011e9();</code>というデコンパイル結果を見ると、この関数の戻り値が<code class="language-text">cVar1</code>に格納されるように見えます。</p>
<p>しかし、実際にこの関数のデコンパイル結果を見てみると戻り値のない<code class="language-text">void</code>関数になっています。</p>
<p>これはどちらが正しいのでしょうか。</p>
<p>アセンブリを読んだり動的解析で特定しても良いですが、今回はIDA Freeによるデコンパイル結果も見てみようと思います。</p>
<h3 id="ida-freeを使う" style="position:relative;"><a href="#ida-free%E3%82%92%E4%BD%BF%E3%81%86" aria-label="ida freeを使う permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IDA Freeを使う</h3>
<p>せっかく事前にインストールをお願いしているので、IDA Freeの解析結果も見てみましょう。</p>
<p>IDAに関する詳細な説明は割愛しますので、以下のコマンドで起動し、問題バイナリをインポートしてください。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ ida64</code></pre></div>
<p>Ghidraで解析したときとは異なり、初めからmain関数のシンボルを特定してくれていますね。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/68f905ac0b6132edf6784dd5638f4d55/0b533/image-43.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 57.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAARlAAAEZQAGA43XUAAACW0lEQVQoz11SSXKcQBDk/3c/wZJ10QPsgw8+edPIsmTPxqzsS9M0DTTNkk5G0kEmIqOAqsjKqixn7W5xv3Gx2blYr56wXC+xdTd4XD7i9leEq4cQ7x72uP29xXr9BdvdHU5egDA64/7bAu+vrnB9c4MPxPXNBzhFVKBRHbrKohE1SqnRdh1a0wBEX2vYuoA1NbQZoZsGx3iHw1lA6ArzMxGd7S/R8X6eMPkDpmAE/AmDGmGZ6pk1c+ELLL8HxrozWG0W8IIYumXz1qC3FlJK5jo4yhOY5ICx6AGilg30MKAdJzTj+AbtNKFsLcKw5opSRJkkocXI+rKqoKnS6fD2UaaD7Cw0BVfD9AY1VQoS+L7E4zrE2vfQ9c8MSmuUM2Hz/SPM4jNawv74BOH+geBsZT9CEq9R2hGKpFlDhUGFxWaFu/MDamMuhBV3KzoS9lGEIUkvmJIEBWNiBwguMSfRDEGiYlZH1REJj8ccy02MmCNXVXcZuVAKibFwjoszDE1ByjYJ15i2CNkppQsJVaUkDuoOqyBHolukUiGIMuxPMc6phE8ir1Q40pSgpSkpO43ZgCGl7UkPXVoEJAq7iRgR0asDjdrvU2w3AmlSQtVUIwX8l/yMkAK8WWEucmjeWsWlat5Vqip4JHuFT5zbEaswx9e/LnZxBk8UOBTq8v9SZ1hjBhxpmKM46dYPcBICinuKTI99M+DQPmN+P9HIJzE76yHLKyRlhd1cw0Ofa45zJOGO+3WSxsDlkZ5ziYQ7iJVGXMj/UCDMcqSZuCBj85gq51zC3eW8QcEJ80rjH5CFjbBayOzRAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/68f905ac0b6132edf6784dd5638f4d55/8ac56/image-43.webp 240w,
/static/68f905ac0b6132edf6784dd5638f4d55/d3be9/image-43.webp 480w,
/static/68f905ac0b6132edf6784dd5638f4d55/b0a15/image-43.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/68f905ac0b6132edf6784dd5638f4d55/8ff5a/image-43.png 240w,
/static/68f905ac0b6132edf6784dd5638f4d55/e85cb/image-43.png 480w,
/static/68f905ac0b6132edf6784dd5638f4d55/0b533/image-43.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/68f905ac0b6132edf6784dd5638f4d55/0b533/image-43.png"
            alt="2021/12/image-43.png"
            title="2021/12/image-43.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>IDAでは、逆アセンブル結果が出力されている画面で[F5]キーを押すとデコンパイルを行ってくれます。</p>
<p>Ghidraの時と同じ行からXOR暗号化時に実行されている関数を特定してデコンパイル結果を確認すると、以下のようにint64型の戻り値を返すことがわかりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/cdd4bfe4f7829d4cc5c5b5f7fb8885ba/0b533/image-44.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 32.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAARlAAAEZQAGA43XUAAABFUlEQVQoz6WQTW6DMBCFOXpv0HO09+ii3aWKsiAEsJ2Af8HQAOYnvE6pqkpdpiM9eeZJ82meI+UUGI+RpCcUUsJVDvlFgikPoxWEOG+yrsIgEsSZhnQNuOC0k+JSFqh8DV5KxGeHiIsnpNkDcvZC4IJ6hkuh4L2HI4h1DtY6VFUNT73WFsZaKEVgqaC03mZtDMkialuGaXrEEJ7R9x/oug7jCISAuyqqfYcsv1GECZx3OCYGu/cSx6NBlgUcDgv2+xsYC0hOFWLyufDY7Uq8vgnkeU0HLBtsXVdEUje01FDUHmW5oq4DxR0oYk/XjmjbG3nrphAWer/963Wkr+hgzJWA8y9wuDfbn/qCbZHnZd6G/+oH+glXMxfaQoF2fgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/cdd4bfe4f7829d4cc5c5b5f7fb8885ba/8ac56/image-44.webp 240w,
/static/cdd4bfe4f7829d4cc5c5b5f7fb8885ba/d3be9/image-44.webp 480w,
/static/cdd4bfe4f7829d4cc5c5b5f7fb8885ba/b0a15/image-44.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/cdd4bfe4f7829d4cc5c5b5f7fb8885ba/8ff5a/image-44.png 240w,
/static/cdd4bfe4f7829d4cc5c5b5f7fb8885ba/e85cb/image-44.png 480w,
/static/cdd4bfe4f7829d4cc5c5b5f7fb8885ba/0b533/image-44.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/cdd4bfe4f7829d4cc5c5b5f7fb8885ba/0b533/image-44.png"
            alt="2021/12/image-44.png"
            title="2021/12/image-44.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>このように、デコンパイルの結果はデコンパイラによって異なっていたり、そもそも間違った結果が出る場合もあります。</p>
<p>そのため、デコンパイラを妄信せず困ったときにはアセンブリを丁寧に読んだり他のツールの結果と見比べてみたりするのがおすすめです。</p>
<h3 id="xor暗号化の挙動を見抜く" style="position:relative;"><a href="#xor%E6%9A%97%E5%8F%B7%E5%8C%96%E3%81%AE%E6%8C%99%E5%8B%95%E3%82%92%E8%A6%8B%E6%8A%9C%E3%81%8F" aria-label="xor暗号化の挙動を見抜く permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>XOR暗号化の挙動を見抜く</h3>
<p>さて、これでこの戻り値<code class="language-text">cVar1</code>にループカウンタ<code class="language-text">lVar5</code>を加算した値を利用して<code class="language-text">input_text</code>を先頭から1文字ずつXOR暗号化を行っていることがわかりました。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token operator">*</span><span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>input_text <span class="token operator">+</span> lVar5<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>input_text <span class="token operator">+</span> lVar5<span class="token punctuation">)</span> <span class="token operator">^</span> cVar1 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>lVar5<span class="token punctuation">;</span></code></pre></div>
<p>最終的にこの暗号化結果が以下のバイト列になる入力を見つけることができればFlagが取得できそうです。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span> 0x74, 0x1a, 0x95, 0x4e, 0xba, 0xdb, 0x47, 0x64, 0x09, 0x2d, 0xd1, 0xbf, 0x8a, 0x9d, 0xde, 0x5a, 0xd7, 0x5c, 0x93, 0x16, 0x09, 0x3b, 0x30, 0x6f, 0x97, 0x40, 0xd0, 0x7c, 0x57, 0xdb, 0xde, 0x0c, 0x09, 0xa0, 0x84, 0x9b, 0x8a, 0x76, 0x2f, 0xb1, 0x57, 0xa2, 0xe1, 0x4f, 0xb9, 0x6f, 0x81, 0xbf, 0xb9, 0xbf, 0xe1, 0xef, 0x79, 0xcf, 0x01, 0xdf, 0xf9, 0x9f, 0xe1, 0x8f, 0x39, 0x2f, 0x81, 0xff, 0x00 <span class="token punctuation">]</span></code></pre></div>
<p>このまま静的解析でFlagを特定することもできますが、結構面倒なのでここからは動的解析を行っていきます。</p>
<p>動的解析とは、実際に実行ファイルを動かしながら解析を行う方法です。</p>
<p>今回はgdbというデバッガを使って動的解析を行い、Flagを特定していきたいと思います。</p>
<h2 id="gdbで動的解析を行う" style="position:relative;"><a href="#gdb%E3%81%A7%E5%8B%95%E7%9A%84%E8%A7%A3%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%86" aria-label="gdbで動的解析を行う permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>gdbで動的解析を行う</h2>
<p>まずはgdbで問題バイナリを開いてみましょう。</p>
<p>すでにgdb-pedaを導入している場合は、色付けされたコンソールが開きます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ gdb ./revvy_chevy</code></pre></div>
<p>gdb-pedaの詳細は割愛しますが、gdbのレジスタやメモリ情報などを綺麗に可視化してくれる拡張機能のようなものだと思ってください。</p>
<p>参考：<a href="https://github.com/longld/peda" target="_blank" rel="nofollow noopener noreferrer">longld/peda: PEDA - Python Exploit Development Assistance for GDB</a></p>
<p>gdbでCTFの問題を解く際の基本的な操作は次のようになります。</p>
<ul>
<li><strong>怪しい箇所や動きを把握したい箇所にブレークポイントを設定する</strong></li>
<li><strong>ブレークポイントで処理を停止して、メモリやレジスタの情報を参照する</strong></li>
<li><strong>Flagを取得するために、実行中のプログラムのメモリやレジスタのデータを改ざんして、本来は実行されない処理を呼び出す</strong></li>
</ul>
<h3 id="gdbのロードアドレスを特定する" style="position:relative;"><a href="#gdb%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%89%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B" aria-label="gdbのロードアドレスを特定する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>gdbのロードアドレスを特定する</h3>
<p>まずはmain関数にブレークポイントを設定してみます。</p>
<p>gdbでは、以下のいずれかのコマンドでブレークポイントの設定が可能です。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">b <span class="token operator">&lt;</span>ブレークポイント対象<span class="token operator">></span>
<span class="token builtin class-name">break</span> <span class="token operator">&lt;</span>ブレークポイント対象<span class="token operator">></span></code></pre></div>
<p>ブレークポイント対象には、関数名や現在のファイルの行番号、停止時点からのオフセット、メモリアドレスなどを指定することができます。</p>
<p>今回の問題のように、CTFの場合はシンボル情報が与えられていない場合が多いので、基本的にはメモリアドレスでのブレークポイントの設定が主になるかと思います。</p>
<p>先ほどGhidraでmain関数を特定したときは、main関数のアドレスは<code class="language-text">0x1208</code>でしたね。</p>
<p>しかし、このアドレスをgdbで指定しても、main関数にブレークポイントを設定することはできません。</p>
<p>gdbでブレークポイントを設定するときは、gdbがプログラムを実行したときに読み込むRVAを指定 してあげる必要があります。</p>
<p>main関数のアドレスは<code class="language-text">0x1208</code>は仮想アドレス(VA)ですので、RVAを特定するためにgdbが実行されたときにメモリを展開するベースアドレスを特定していきます。</p>
<p>ベースアドレスを特定するために、とりあえず問題バイナリをgdbから実行してみます。</p>
<p><code class="language-text">run</code>コマンドで実行すると、先ほど同様標準入力を求められます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ run
Starting program: /home/parrot/Downloads/revvy_chevy 
What's the flag? </code></pre></div>
<p>ここで[Ctrl+C]を押してプログラムの処理を中断しましょう。</p>
<p>[Ctrl+C]キーを押すことでキーボード割込みSIGINTが発生して、プログラムの実行を中断し、gdbを操作できるようになります。</p>
<p>この状態で<code class="language-text">info proc mappings</code>コマンドを実行します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ info proc mappings 
process <span class="token number">1971</span>
Mapped address spaces:
          Start Addr           End Addr       Size     Offset objfile
      0x555555554000     0x555555555000     0x1000        0x0 /home/parrot/Downloads/revvy_chevy
      0x555555555000     0x555555556000     0x1000     0x1000 /home/parrot/Downloads/revvy_chevy
      0x555555556000     0x555555557000     0x1000     0x2000 /home/parrot/Downloads/revvy_chevy
      0x555555557000     0x555555558000     0x1000     0x2000 /home/parrot/Downloads/revvy_chevy
      0x555555558000     0x555555559000     0x1000     0x3000 /home/parrot/Downloads/revvy_chevy
  	  /* 省略 */</code></pre></div>
<p>すると、問題バイナリのオフセットと、gdbがロードするメモリアドレスのマッピング情報が確認できます。</p>
<p>ファイルオフセット<code class="language-text">0x1000</code>が<code class="language-text">0x555555555000</code>にマッピングされているようです。</p>
<p>readelfやradare2で表層解析を行った結果から<code class="language-text">.text</code>セクションのアドレスは<code class="language-text">0x1100</code>であることがわかっているため、<code class="language-text">0x1100</code>がgdb実行時の<code class="language-text">0x555555555100</code>に対応します。</p>
<p>少しわかりづらいかもしれませんが、アドレス<code class="language-text">0x1100</code>がgdb実行時の<code class="language-text">0x555555555100</code>にロードされるということは、main関数のアドレス<code class="language-text">0x1208</code>はgdb上の<code class="language-text">0x555555555208</code>にロードされるというわけです。</p>
<h3 id="ブレークポイントを設定する" style="position:relative;"><a href="#%E3%83%96%E3%83%AC%E3%83%BC%E3%82%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B" aria-label="ブレークポイントを設定する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ブレークポイントを設定する</h3>
<p>これでmain関数のRVAを特定できたので、さっそくブレークポイントを設定して実行してみましょう。</p>
<p>以下のコマンドでブレークポイントを設定します。</p>
<p>アドレスを指定してブレークポイントを設定する場合は<code class="language-text">*</code>を付ける必要があります。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ b *0x555555555208
Breakpoint <span class="token number">1</span> at 0x555555555208</code></pre></div>
<p>ブレークポイントの設定は、<code class="language-text">i breakpoint</code>で確認可能です。</p>
<p>今回は使用しませんが、<code class="language-text">Num</code>の値がブレークポイントのIDとなるので、これを使用して<code class="language-text">delete &lt;Num></code>もしくは<code class="language-text">d &lt;Num></code>コマンドを使ってブレークポイントを削除することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">i breakpoints 
Num     Type           Disp     Enb Address            What
<span class="token number">1</span>       breakpoint     keep y   0x0000555555555208</code></pre></div>
<p>ブレークポイントが設定されたことが確認できたので、<code class="language-text">run</code>コマンドを呼び出しましょう。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/59ec8e486270cce47644255bfe5bfac0/2bef9/image-46-1024x914.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 89.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAARlAAAEZQAGA43XUAAACrElEQVQ4y5VU2W7jMBDz1+SwY/mQrMNnnGt7oEVR9P9/hctR6jTZBRbYh4ElxxqRHDKJGQNaH6BrjaqsYIyGDwGK61wV2O12rAzr9RqbzYbPTVzLU/bb7fZWsk+auUe/PyFMR7T7M2pt4PoZHdfdfME0DTgeue8C+r5FVZUoyyJWUajvS9a35omdOwTnYWpDdA2C92iJMCcyledQSkXUUk1jYG0TG12blhG97G8I69bCNRaWzQzRheDQBY88y1hppCwHliaCcKEovymVo66rn4a6c/C8OeOLPE3jQa1r6pdjRSrSoCiu9Far1Y3efT1S3nfoSFMRkeKNuq4jvXQRm5fcC/+viggdG05jH1+kkUYWqWz/uP1ftTSLCCtStt5GVFmp0FrR0yCtC3TWofEOaaUoS4NT16GiHLu65Le0lOZQKM29fRLnHH49XfDy+gTHwzLVhoc91+fzEfNhhnMWmhdWVYU0zaKmhrrL91rrB5TJSLofH2/4+vqArFNq2Z73ML6Jtsk46cVz6hvNYhV5L+8eKLdtwPv7Kz4/3zEMXfx4Ooy83UbfLToudT/ZpRa6KQeYGNKb5z3TcIgNcqKSSYtpL5cT+nGIZhbaGdFn2e46eZbQl7ofXvLy+gzfT/DDAWE8orGe+gUM40STd9w7uNCi7QeEjjEdembdRw2FXde1USoxt3g2eSPdfj7F7A5HDoax63ngMJI20yPopmmkCwwHY+Iho+uon7Xcx/hdEyPsEpluOwq6Axs+wzLXA/8IrGSXBz2p1jEt1/hJxkUr8aw4QrT70ZOUp/0E4wKrhW1HVPW1UXBXPwotoSjabb6Ts2gX19R1u73zoTRsDCkUJZrQo+Kfg2YUnfdxCEv0Iqq/KovPB2NLAkQzmaIq2bjSKPhUvCDPd9GH/xO93yWjNWbpb/9EAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/59ec8e486270cce47644255bfe5bfac0/8ac56/image-46-1024x914.webp 240w,
/static/59ec8e486270cce47644255bfe5bfac0/d3be9/image-46-1024x914.webp 480w,
/static/59ec8e486270cce47644255bfe5bfac0/e46b2/image-46-1024x914.webp 960w,
/static/59ec8e486270cce47644255bfe5bfac0/a9a89/image-46-1024x914.webp 1024w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/59ec8e486270cce47644255bfe5bfac0/8ff5a/image-46-1024x914.png 240w,
/static/59ec8e486270cce47644255bfe5bfac0/e85cb/image-46-1024x914.png 480w,
/static/59ec8e486270cce47644255bfe5bfac0/d9199/image-46-1024x914.png 960w,
/static/59ec8e486270cce47644255bfe5bfac0/2bef9/image-46-1024x914.png 1024w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/59ec8e486270cce47644255bfe5bfac0/d9199/image-46-1024x914.png"
            alt="2021/12/image-46-1024x914.png"
            title="2021/12/image-46-1024x914.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>main関数の呼び出しタイミングで処理が停止し、gdb-pedaによってレジスタやスタックの情報が表示されました。</p>
<p>ちなみに<code class="language-text">run</code>コマンドはgdbからプロセスを起動するコマンドで、実行時にコマンドライン引数を与えたい場合は<code class="language-text">run &lt;コマンドライン引数></code>のようにして呼び出します。</p>
<h3 id="ghidraのイメージベースを変更する" style="position:relative;"><a href="#ghidra%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%83%99%E3%83%BC%E3%82%B9%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B" aria-label="ghidraのイメージベースを変更する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ghidraのイメージベースを変更する</h3>
<p>ここからはGhidraのデコンパイル結果とgdbを対応させながら解析を進めていくので、Ghidraのベースアドレスをgdbに合わせて<code class="language-text">0x555555554000</code>に変更しておきましょう。</p>
<p>Ghidraのベースアドレスの変更は、ファイルインポート時の[Options]から行うか、[Window]>[Memory Map]を開いて、右側にある[Set Image Base]ボタンから変更できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/67fe8c8bb0b1f268968790135c4af31e/0b533/image-47.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 91.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAARlAAAEZQAGA43XUAAAEWElEQVQ4y12Ue0yTZxSHv6pTQQQp4AbqdPMu6Bx4WXTgyBxDRd1ccM4su2UxJmabxgtTUZEquika/zCZm85ApoCIlIsUKCi3OJ2ZmukWY7zgUIyTUlpov7a0PDttGTrf5OS8pz15ct7v/M5RFi/7lOQlK5n/7gfMT17OOwtSSUhcSvKCFSxcnMpbSe+TmLyElPc+IT5xEdPjEpk0ZQ4DtVNRhsWihMaJjxEfjRL4MkpJSQW379zjyo3b/HGzmSt/3qHx0nXqGq9Rd/GqLz50+DhbNu8m5+gpDh78kfR0HcO0kSj9tGgCRqIEjUMJnizQaSg1xnq6PWCyQ7vdjcUJD6xmbrU+4W+zFRU4mnuGigoj/x2LxUxk1GgUZQAaTYD4wSiaIJQBWpSqqnN02Z20ttu5ee8x1/6y0WqSuE2l1aziEsBPOYXo9RU+mMfj4f79FsLD5XnKIPr1D/LBNJohvliA53E6XdhVB/eam7F29hWCu9cXnTmLsaau73erJIUNf8UPUIKeVuj1fqAT1a6iLynlxEk9lVVGiovPoi8ro6Gxie0Zu8nau5+6+gaqjbXkF5xmzNgYgkMi0WqjCNWOJGzEq4QMl+9ZVd1boQA/W7WWCZNnMCV6JuMnzWDchDjGTZxB7MxEn02ZOsdn0VPnMj12HtNej+e12ASxecTNTmRizEw/0OVy0dVl4+jPuWzLzGZjxiEydfvZtSubHRnfkbric1KWfiT+CxYt/VBktoyvv9nKuvXbWZ+2gw1pmWTs3E+SSEyplKa43W7M5g4ePTZh6nTRYlJps9ixuzz8fuMObyelEp+Qwtw3FzHrjSQWpizn4vX7dNg9WLocmCw2RCjo9hzwd9kLNJnaefTELJAeOu0uOrqcCE+Ad5k1eyGxcfMFtoDomATi56bQcLWZDrUHq+S2d6r0CDBj177/Ay02p18az3T47mM7ur2HyfnlFLkniyg9WyvN+ZVbj1SkQF+u2pucmZXtf3J3t//J5YZzFJca0ZfX+MwbH8urIOvAEfILSzmWU4DB2Eh902WKDBeoPn+J8w2/YTx3gYuXr7N6zYanTfFaU9MlSksr0RcZOJ0vsik2UFNdz+YtOnZmfk9NTT3l5dXk5BYQFTWegIAwhgZHEhw+lqHa0QRKrBhl9Lyycbm6efY4rD24bP57Xn7Jc8K2EhY2QoTcX8YtVGY6GCUgXO4hfmF7YaqqSmKXmAebzTs5LswSez/P8dw8yssMfcCWlodEjJIN88JL9PNCZEI0SiCaAUNRDIZagTnERCYy0+3tHpwONz0ysw6nv0kn8gopewb44MFDwiNlwwSMQfOiiDlCVljoZDSDh6PUN1zg+eN2iBz+UelsU31xQWEJhsravv/bTCYiwr1PVtAMEsiQUSiDIuTpUqFOl80PR3JI26wjffsetqRn+e4bN+1k7bptbJIpWPnxar5ctY6t27LY9G0ma75KIygkqnc5DPStMZ/XBPIvaq/fVXR6p6gAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/67fe8c8bb0b1f268968790135c4af31e/8ac56/image-47.webp 240w,
/static/67fe8c8bb0b1f268968790135c4af31e/d3be9/image-47.webp 480w,
/static/67fe8c8bb0b1f268968790135c4af31e/b0a15/image-47.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/67fe8c8bb0b1f268968790135c4af31e/8ff5a/image-47.png 240w,
/static/67fe8c8bb0b1f268968790135c4af31e/e85cb/image-47.png 480w,
/static/67fe8c8bb0b1f268968790135c4af31e/0b533/image-47.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/67fe8c8bb0b1f268968790135c4af31e/0b533/image-47.png"
            alt="2021/12/image-47.png"
            title="2021/12/image-47.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>これでmain関数のアドレスも、gdbにロードされるアドレスと同じ<code class="language-text">0x555555555208</code>に変更されたので、対応が分かりやすくなりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 824px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/17181c775952044021d3f1860e572160/c1c45/image-48.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 109.16666666666669%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD0UlEQVQ4y31V227bRhTU7zZFYRSJnSIoegGKNmid3hDJMdAm6UP7Bf2GPiQP7oOR1HasUKQkikvxfucuOZ1dyrJUAxWwXmIvs3PmzDkefXDvB3z+xZ84PPwDR0e/46ODX3Hvw+c4OPgFDx6c4uP7Exx+MsbRwx9x/+gYDx8d49FnHJ8+xk8/n+Kbr5/gu+On+PKr7/Ht4ycYnTx7Cf1brwNkWYo0DeH7QJ6bZTRNb+a6LZA2BRql0CmgH5bv/EZPx8/Nx9L14HkC87kNZ14bUCkVkqRG13V8oEBZ1ny0RRBWXC8hVWOAe/7pNmM03gBac4E1D/tpjajoQRyEhcI6JUAuEfM7KiT3K4R5g6hUZn2dNeZeXPFOtQP43hHgwwjKHise0N+2n+F6sYYrEszWOZyggCMyLDh7SWPGKtYzz/NezDs7gB4iLujN6TwhE4VVVMNyYvheAcvN4PglYjLX5zTAzbDjBKJoYcXxPmDIw+tQYn5JwICvZh2WVoHFrIBrk5VLOeoBTIPeAJ+tplikBf5evf8PQx4WQQPrPITwqU0iYV/GmF+ncN6lWDrFFvAGVM+vlxewkwRv/CVtc/Jyj6Hn15ie+fBETcAO1psI9kVsgBdWvgeoNdPjL+ccTpLiXDgYTSYvtkmhvswmDLuA4QYUbE3GfiDJnA6gHGF1G7LIW7hZCSuKMKOOZ+701tiWvcLUFriYLSl+C5HCAL6zM/g5/dh0oIMMI20pPfyCGc5pI1roMnAZMhmOJ4OGLo399u0/ePX6FWazFPQxyoohWwnatkWSCVRSGvMqGl3PN9XS7ZTNFnC1Eqb8PG+J6bTB1ZWuFF0h1AE0bRow5AB1XSKtcoIqs94bsGHuTaVsAZnlKEYY+nAcaibM2yhYHbr00jRFVeZomwqSa3VRkJk0d/sN236XoUvA+XxBdle4vi6xXA4MI6rf9x1r2EcU56xnhYzJiKhvEJRkPIDqRxUbx17IYUj/CZfADTUdAAtWgH67yBNUFRuF6iAbCcU9vd91/ZalBh1NNj7UIbtEse0pGVbUE4aZZqgB67ULGQfoqhJdlqBXcq9taXaG4bPT37YMhfCxWDhkWBsNldLaNQNwHDLzKUPO0TDkvKygerVlt83y5OTFFrAsS46MtlEENUfZYJW5UBKgrpkQ2UBVClVdQ3ZqJyl3siwofMbGGTEhkkyHkKtKbpKS8btglmuTZf3ALuCtD8e3tgmCISmW1ZAlNp26NYAxW1NG7WoNyn6ZZQy9k/8HKBgOs8e27nmdsY0OWakhlGFPe1INmdb/W/r+DuC/tSpvqIth0MsAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/17181c775952044021d3f1860e572160/8ac56/image-48.webp 240w,
/static/17181c775952044021d3f1860e572160/d3be9/image-48.webp 480w,
/static/17181c775952044021d3f1860e572160/5758c/image-48.webp 824w"
              sizes="(max-width: 824px) 100vw, 824px"
              type="image/webp"
            />
          <source
            srcset="/static/17181c775952044021d3f1860e572160/8ff5a/image-48.png 240w,
/static/17181c775952044021d3f1860e572160/e85cb/image-48.png 480w,
/static/17181c775952044021d3f1860e572160/c1c45/image-48.png 824w"
            sizes="(max-width: 824px) 100vw, 824px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/17181c775952044021d3f1860e572160/c1c45/image-48.png"
            alt="2021/12/image-48.png"
            title="2021/12/image-48.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h3 id="gdbでよく使うコマンド一部のみ" style="position:relative;"><a href="#gdb%E3%81%A7%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%86%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E4%B8%80%E9%83%A8%E3%81%AE%E3%81%BF" aria-label="gdbでよく使うコマンド一部のみ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>gdbでよく使うコマンド(一部のみ)</h3>
<p>ここから本格的に動的解析を進めていきますが、先にgdb操作でよく使うコマンドを整理しておきます。</p>
<p>今回はごく一部のコマンドのみしか紹介しませんが、詳しくは<a href="https://amzn.to/3lkunSs" target="_blank" rel="nofollow noopener noreferrer">Debug Hacks</a>などが参考になると思います。</p>
<table>
<thead>
<tr>
<th align="center">コマンド</th>
<th align="center">用途</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">break &#x3C;ブレークポイント><br />b &#x3C;ブレークポイント></td>
<td align="center">ブレークポイントを設定する<br />アドレスを指定する場合は<code class="language-text">*</code>が必要</td>
</tr>
<tr>
<td align="center">info &#x3C;引数><br />i &#x3C;引数></td>
<td align="center">実行中プロセスの情報を表示する<br />引数無しで実行するとヘルプが表示される</td>
</tr>
<tr>
<td align="center">run &#x3C;コマンドライン引数></td>
<td align="center">プロセスを実行する</td>
</tr>
<tr>
<td align="center">p/&#x3C;フォーマット> $eax<br />p/&#x3C;フォーマット> 変数</td>
<td align="center">変数やレジスタの値を表示する<br />フォーマットには x / d / c / s / i などを利用することが多い</td>
</tr>
<tr>
<td align="center">x/&#x3C;フォーマット> &#x3C;メモリアドレス></td>
<td align="center">メモリの中身を表示する<br />$ecxなどのようにレジスタの参照しているアドレスを確認することもできる</td>
</tr>
<tr>
<td align="center">next<br />n</td>
<td align="center">一行ずつ実行する<br />関数の呼び出し先にはジャンプしない</td>
</tr>
<tr>
<td align="center">step<br />s</td>
<td align="center">処理を一つずつ実行する<br />関数の呼び出し先にもジャンプする</td>
</tr>
<tr>
<td align="center">continue<br />c</td>
<td align="center">プロセスの実行を再開する</td>
</tr>
<tr>
<td align="center">finish</td>
<td align="center">今いる関数を終了するまで実行する</td>
</tr>
<tr>
<td align="center">until<br />u</td>
<td align="center">指定した行まで実行する</td>
</tr>
</tbody>
</table>
<p>実際に使用する場合は、以下のチートシートなども参考になると思います。</p>
<p>参考：<a href="https://darkdust.net/files/GDB%20Cheat%20Sheet.pdf" target="_blank" rel="nofollow noopener noreferrer">GDB Cheat Sheet</a></p>
<h3 id="解析の方針を立てる" style="position:relative;"><a href="#%E8%A7%A3%E6%9E%90%E3%81%AE%E6%96%B9%E9%87%9D%E3%82%92%E7%AB%8B%E3%81%A6%E3%82%8B" aria-label="解析の方針を立てる permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解析の方針を立てる</h3>
<p>とりあえずgdbを使ってブレークポイントを設定することができるようになりましたが、闇雲にブレークポイントを設定してもFlagを特定するのは非常に困難です。</p>
<p>そのため、まずは静的解析の結果から解析方針を立てていこうと思います。</p>
<p>今わかっている情報は以下の通りです。</p>
<ul>
<li>ユーザから入力された文字列をXOR暗号化してPTR<em>DAT</em>00104010(イメージベースが<code class="language-text">0x100000</code>だった時の名前)のバイト列と比較する</li>
<li>XOR暗号化は一文字ずつ行われ、キーには関数FUN_001011e9(イメージベースが<code class="language-text">0x100000</code>だった時の名前)の戻り値にループカウンタ<code class="language-text">lVar5</code>を加算した値をが利用される</li>
</ul>
<p>XOR暗号は、暗号化と復号に同じキーを利用します。</p>
<p>つまり、<code class="language-text">A ^ K = B</code>という方法で暗号化した場合は、<code class="language-text">B ^ K = A</code>の式で元のデータを復号することができます。</p>
<p>このような理由から、問題バイナリが暗号化に使用しているキーさえ特定することができれば、PTR<em>DAT</em>00104010(イメージベースが<code class="language-text">0x100000</code>だった時の名前)に格納されているバイト列に対してXOR演算を行うことで、元のFlag文字列を特定することができます。</p>
<p>ここで、XOR暗号に使用するキーの元になる値は一文字ごとに以下のコードで生成されていました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">DAT_0010402c <span class="token operator">=</span> DAT_0010402c * 0x41c64e6d + 0x3039 <span class="token operator">&amp;</span> 0x7fffffff<span class="token punctuation">;</span></code></pre></div>
<p>もちろんここから静的解析でキーを特定することもできますが、少々面倒なので動的解析でキーを特定していきます。</p>
<p>言い換えると、動的解析を利用して関数FUN_001011e9(イメージベースが<code class="language-text">0x100000</code>だった時の名前)の戻り値を特定していこうということです。</p>
<h3 id="x86_64アーキテクチャのレジスタについて" style="position:relative;"><a href="#x86_64%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E3%81%AE%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" aria-label="x86_64アーキテクチャのレジスタについて permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>x86_64アーキテクチャのレジスタについて</h3>
<p>関数の戻り値をgdbで特定する前に、少しだけレジスタについて触れておきます。</p>
<p>x86_64アーキテクチャとは、Intelのx86アーキテクチャを64ビットに拡張したものです。</p>
<p>x86_64アーキテクチャのCPUには、64bitの汎用レジスタが16個、64bitのRPIレジスタとRFRAGSレジスタが1個ずつ、128bitのXMMレジスタが16個搭載されています。</p>
<p>主なレジスタの用途については下記に整理しておきます。</p>
<table>
<thead>
<tr>
<th align="center">レジスタ</th>
<th align="center">用途</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">RAX<br />（アキュムレータ）</td>
<td align="center">主に演算結果、関数の戻り値などが格納される汎用レジスタです<br />下位32bitをEAXレジスタとして利用します</td>
</tr>
<tr>
<td align="center">RBX<br />（ベースレジスタ）</td>
<td align="center">主にデータへのポインタが格納される汎用レジスタです<br />下位32bitをEBXレジスタとして利用します</td>
</tr>
<tr>
<td align="center">RCX<br />（カウンタレジスタ）</td>
<td align="center">主に文字列やループカウンタが格納される汎用レジスタです<br />下位32bitをECXレジスタとして利用します</td>
</tr>
<tr>
<td align="center">RDX<br />（データレジスタ）</td>
<td align="center">主にI/Oポインタの計算時に変数として利用されます<br />下位32bitをEDXレジスタとして利用します</td>
</tr>
<tr>
<td align="center">RSI<br />（ソースインデックス）</td>
<td align="center">主に文字列のコピー先などに使用されます<br />下位32bitをESIレジスタとして利用します</td>
</tr>
<tr>
<td align="center">RDI<br />（ディスティネーションインデックス）</td>
<td align="center">主に文字列操作時の宛先指定に使用されます<br />下位32bitをEDIレジスタとして利用します</td>
</tr>
<tr>
<td align="center">RSP<br />（スタックポインタレジスタ）</td>
<td align="center">スタックポインタとして使用されます<br />下位32bitをESPレジスタとして利用します</td>
</tr>
<tr>
<td align="center">RBP<br />（ベースポインタレジスタ）</td>
<td align="center">スタック上のデータへのポインタとして使用されます<br />下位32bitをEBPレジスタとして利用します</td>
</tr>
<tr>
<td align="center">RIP<br />（インストラクションレジスタ）</td>
<td align="center">命令セットが格納されます</td>
</tr>
<tr>
<td align="center">RFLAGS<br />（フラグレジスタ）</td>
<td align="center">下位32bitがEFRAGSと同様にフラグレジスタとして使用されます</td>
</tr>
</tbody>
</table>
<p>参考：<a href="https://amzn.to/3lkunSs" target="_blank" rel="nofollow noopener noreferrer">Debug Hacks -デバッグを極めるテクニック&#x26;ツール</a></p>
<p>参考：<a href="https://amzn.to/3o7g5Gj" target="_blank" rel="nofollow noopener noreferrer">詳解セキュリティコンテスト</a></p>
<p>各レジスタやアーキテクチャの詳細についてはここでは割愛しますが、関数実行後の戻り値はRAXレジスタに格納されるため、CALL命令の直後のRAXレジスタを参照することが、関数の結果を取得する際の基本方針になります。</p>
<h3 id="関数の戻り値を特定する" style="position:relative;"><a href="#%E9%96%A2%E6%95%B0%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B" aria-label="関数の戻り値を特定する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>関数の戻り値を特定する</h3>
<p>Ghidraの結果から、キーを生成している関数を呼び出しているアドレスは、<code class="language-text">0x5555555552b3</code>であることがわかります。</p>
<p>つまり、その次の命令である<code class="language-text">0x5555555552b8</code>時点のRAXレジスタに格納されている値が、この関数の戻り値であるということがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/95f8a3a684ff495a86e22079911cfeda/2bef9/image-49-1024x657.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 64.16666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAARlAAAEZQAGA43XUAAACoklEQVQ4y02TWW8TZxiF86t7hxICtCUIqf+lqrhBQhVSJVoSYgczjh2H2I6X8ezrt8w38/SdIQRGOtJc2GfO9h4ppQmCSLBjuVTsdqCUxbmGrEyoCkX/eNdznj8/I8rh9j7D6C1d2/H96bpv70dKKcIwJo5DtltNUYC1Dtc02CLD1dUj4emzM4xtieKYpMipTEqpE3SjH0mPeoXb7Z7JZMxikZGLgqLQaC3KfZ8wKIcfT4Xw+OkrGptxCNdCpLFOCVlN07ofhHWtOBx6dWtWq1qsQ1Vb+aOliiOyIKEVxdP5jSh8LVEkJNmSjh92f7Y9EPqHA6v1naAkToRQGWxjSNMAoyQDHGPP48Vvf2BNhh+siVKJp8rQtqSyhvZ7hlVVk4YZVVpSxB1WIitih8odbeMev764vuNELFvbkORSlhSnbW9b0DYDYY+B8Dy44J/wPX9vrzgvp5xXI0ZqxCT/wJfyIzfM+PP6DcenZ3SmI00UpWSta43TOVbLEh4SOFJi+XIz4s34L94vPC7DDVfpnBs945P/L9N8wh23vB2/45enJ1y3Hv9FH/kQeJxHEzwzFkz4rKd8Vl++zcbfBEyvJqwWtdiFMhG72klWEXXZPVhe8uT0d/IuYbFf4G1nrPI7dibiXrDRByIb9aVIs2EkZQQsV9K4tKxNP2xpWXxlkq2V7X0ajSVDsdxAFEneKqeV8Q9Wf8LQ8n7vc3s7Z72u5Er6HUrLxlCGPnWSPwx7xq8vzmhbyGTUqlFShpUiGuFxgnZgHErZ7Xzm8ylfvxYyFbFcGowQBvvgcdgXl96g0LmOuk5l+ApVyTWpUkTUKG3o3MNs+mHvdhvu7xWJ7LCWYTvZlsoiOb16IJx4M45PXiIXSZq11ELWSL5yKMjBSNsCWcD/JWXPeFf1UcgAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/95f8a3a684ff495a86e22079911cfeda/8ac56/image-49-1024x657.webp 240w,
/static/95f8a3a684ff495a86e22079911cfeda/d3be9/image-49-1024x657.webp 480w,
/static/95f8a3a684ff495a86e22079911cfeda/e46b2/image-49-1024x657.webp 960w,
/static/95f8a3a684ff495a86e22079911cfeda/a9a89/image-49-1024x657.webp 1024w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/95f8a3a684ff495a86e22079911cfeda/8ff5a/image-49-1024x657.png 240w,
/static/95f8a3a684ff495a86e22079911cfeda/e85cb/image-49-1024x657.png 480w,
/static/95f8a3a684ff495a86e22079911cfeda/d9199/image-49-1024x657.png 960w,
/static/95f8a3a684ff495a86e22079911cfeda/2bef9/image-49-1024x657.png 1024w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/95f8a3a684ff495a86e22079911cfeda/d9199/image-49-1024x657.png"
            alt="2021/12/image-49-1024x657.png"
            title="2021/12/image-49-1024x657.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p><code class="language-text">0x5555555552b8</code>では、キーを生成している関数の戻り値にさらにEBXの値を格納しています。</p>
<p>これが最終的にXOR暗号を行うためのキーになります。</p>
<p>ADD命令の演算結果は、関数の戻り値と同様にアキュムレータ（RAX）に格納されます。</p>
<p>そこで、gdbで<code class="language-text">0x5555555552ba</code>にブレークポイントを設定して実行してみましょう。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ b *0x5555555552ba
$ run</code></pre></div>
<p>RAXレジスタの値が<code class="language-text">0x3039</code>であることがわかりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 882px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2be958fb5687e7e5eee58a87bf7d710d/90712/image-51.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 71.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFElEQVQ4y31TWZLiMBTLYSALZN+8ZHEgDTQNNNX3P4xGNgUzUPR8qOLYid6T9OzVc4ftdoKUAlmWIU1TRFGE1Wr1hCh6Xttv3sErjYIZe6z54XKxQOD7CMMQvh8gCP4iDOyef1vz/Dd41UajGw1kb1AL7ZDnOYahQ99rh65TKMsC0zQ6JbYT+/PbDq1koQd0wxa6n6D6Deq6wn4/43T6JA44HvfQWuF6Pbn9JIn/I7kXKEjQ9gpi0Gi0gBAtRjPgdP4i2QGHzz19NpjnDTYb4wpaL9916RWDgB5H6MmQdECltAumkRqyG9ixQSMkSUo0Tf2Qeyd7JfXKUWKkT6bTyOIYCSsXRf7o4l0Qv8l9EBoGkNtxYZIxSdIsRcEQbPI23cgSBTcyS75gkaWdhiD8B4GDV207GPpjfYtpdpisUTHlkgVWKc3nexSvsc4S917kGfq2RVuWbs8hJfIEMZ9eSaJWS46EwcAgCvokG4bSseumcmeCa+ttXGSo6hqGa0XShCrSO6oSGeHlrHi9nh1+fr6hlcRiuWRAEinPxh1v0dQhrnKs2G3g3yT7v0m2Ui+XrwehImEYhejnETmTnS57SK5T3aCg33YqqkkhYQHn72sotsPz+ehILdq2ccZLys3oqVECvWhQ5ini9fPsvY6Ou3oZCT8+tu4G7HazGxd7IEWNjCabTmJQ9LkqkDAc9/ObObw//wB+7blQheitHAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/2be958fb5687e7e5eee58a87bf7d710d/8ac56/image-51.webp 240w,
/static/2be958fb5687e7e5eee58a87bf7d710d/d3be9/image-51.webp 480w,
/static/2be958fb5687e7e5eee58a87bf7d710d/9d646/image-51.webp 882w"
              sizes="(max-width: 882px) 100vw, 882px"
              type="image/webp"
            />
          <source
            srcset="/static/2be958fb5687e7e5eee58a87bf7d710d/8ff5a/image-51.png 240w,
/static/2be958fb5687e7e5eee58a87bf7d710d/e85cb/image-51.png 480w,
/static/2be958fb5687e7e5eee58a87bf7d710d/90712/image-51.png 882w"
            sizes="(max-width: 882px) 100vw, 882px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/2be958fb5687e7e5eee58a87bf7d710d/90712/image-51.png"
            alt="2021/12/image-51.png"
            title="2021/12/image-51.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>ちなみにレジスタの値は、<code class="language-text">p</code>コマンドを使って取得することもできます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ p <span class="token variable">$rax</span>
<span class="token variable">$2</span> <span class="token operator">=</span> 0x3039</code></pre></div>
<p>特に今回の場合、XORの暗号化を行った後のバイト列はchar型になるので、XOR暗号化に使用するキーもRAXレジスタの値の下位8bitのみになります。</p>
<p>特定のレジスタの下位8bitの値のみを取り出したい場合は、<code class="language-text">$al</code>レジスタの値を<code class="language-text">p</code>コマンドで出力します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ p <span class="token variable">$al</span>
<span class="token variable">$3</span> <span class="token operator">=</span> 0x39</code></pre></div>
<p>つまり、1文字目の暗号化を行うキーは<code class="language-text">0x39</code>であるということがわかります。</p>
<p>このキーは1文字を暗号化するたびに生成されるので、<code class="language-text">c</code>コマンドを使って実行を再開すると次は2文字目の暗号化を行うタイミングにブレークポイントが設定されます。</p>
<p>この方法で、要領で4文字目までのキーを特定してみました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">1</span>文字目：0x39
<span class="token number">2</span>文字目：0x7f
<span class="token number">3</span>文字目：0xe1
<span class="token number">4</span>文字目：0x2f</code></pre></div>
<p>このキーと、先ほどGhidraから特定した以下のバイト列を利用してFlagの4文字目まで復号できるかを試してみます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span> 0x74, 0x1a, 0x95, 0x4e, 0xba, 0xdb, 0x47, 0x64, 0x09, 0x2d, 0xd1, 0xbf, 0x8a, 0x9d, 0xde, 0x5a, 0xd7, 0x5c, 0x93, 0x16, 0x09, 0x3b, 0x30, 0x6f, 0x97, 0x40, 0xd0, 0x7c, 0x57, 0xdb, 0xde, 0x0c, 0x09, 0xa0, 0x84, 0x9b, 0x8a, 0x76, 0x2f, 0xb1, 0x57, 0xa2, 0xe1, 0x4f, 0xb9, 0x6f, 0x81, 0xbf, 0xb9, 0xbf, 0xe1, 0xef, 0x79, 0xcf, 0x01, 0xdf, 0xf9, 0x9f, 0xe1, 0x8f, 0x39, 0x2f, 0x81, 0xff, 0x00 <span class="token punctuation">]</span></code></pre></div>
<p>実際に4文字目まで復号してみると、出力が<code class="language-text">Meta</code>となり、MetaCTFのフラグフォーマットに一致していることがわかりました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">enc <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x1a</span><span class="token punctuation">,</span> <span class="token number">0x95</span><span class="token punctuation">,</span> <span class="token number">0x4e</span> <span class="token punctuation">]</span>
key <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">0x39</span><span class="token punctuation">,</span> <span class="token number">0x7f</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0x2f</span> <span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>enc<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> Meta</code></pre></div>
<p>これであとは、0x40文字分のキーを特定することができればFlagを特定できそうです。</p>
<p>しかし、この手順を56回もやるのはかなり面倒くさいです。</p>
<p>そこで、ここからはgdbの処理を自動化してFlagを一気に取得します。</p>
<h2 id="gdbを自動化する" style="position:relative;"><a href="#gdb%E3%82%92%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%99%E3%82%8B" aria-label="gdbを自動化する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>gdbを自動化する</h2>
<p>gdbは、<code class="language-text">.gdbinit</code>や<code class="language-text">gdb-python</code>を使って処理を自動化することができます。</p>
<p>参考：<a href="https://stackoverflow.com/questions/10748501/what-are-the-best-ways-to-automate-a-gdb-debugging-session" target="_blank" rel="nofollow noopener noreferrer">scripting - What are the best ways to automate a GDB debugging session? - Stack Overflow</a></p>
<p>参考：<a href="https://sourceware.org/gdb/onlinedocs/gdb/Python.html#Python" target="_blank" rel="nofollow noopener noreferrer">Python (Debugging with GDB)</a></p>
<p><code class="language-text">.gdbinit</code>の方が簡単にgdbのコマンド操作を自動化できますが、今回は取得した値を元に計算を行いたいので、より柔軟な処理を簡単に定義できる<code class="language-text">gdb-python</code>を使用してきます。</p>
<h3 id="gdb-pythonを使う" style="position:relative;"><a href="#gdb-python%E3%82%92%E4%BD%BF%E3%81%86" aria-label="gdb pythonを使う permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>gdb-pythonを使う</h3>
<p><code class="language-text">gdb-python</code>を利用してデバッグを行う場合、以下のPythonスクリプトが基本形になります。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> gdb

BINDIR <span class="token operator">=</span> <span class="token string">"~/Downloads"</span>
BIN <span class="token operator">=</span> <span class="token string">"revvy_chevy"</span>
INPUT <span class="token operator">=</span> <span class="token string">"./in.txt"</span>
BREAK <span class="token operator">=</span> <span class="token string">"0x5555555552ba"</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>INPUT<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token operator">*</span><span class="token number">0x40</span><span class="token punctuation">)</span>

gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'file {}/{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>BINDIR<span class="token punctuation">,</span> BIN<span class="token punctuation">)</span><span class="token punctuation">)</span>
gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'b *{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>BREAK<span class="token punctuation">)</span><span class="token punctuation">)</span>
gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'run &lt; {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>INPUT<span class="token punctuation">)</span><span class="token punctuation">)</span>

gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'quit'</span><span class="token punctuation">)</span></code></pre></div>
<p><code class="language-text">gdb.execute()</code>が、Pythonスクリプトからgdbのコマンドを実行する関数です。</p>
<p>基本はgdbをコマンド操作するときと同じですが、少々ややこしい点として実行中の入力値はファイルに事前定義しておく必要がある点です。</p>
<p>今回のプログラムは標準入力からの入力を求められるため、実行前に<code class="language-text">./in.txt</code>というファイルを作成して、0x40バイト分の文字列を予め書き込んでいます。</p>
<p>これを実行すると、gdbでプログラムを実行して0x40バイト分の文字列を入力し、<code class="language-text">0x5555555552ba</code>のブレークポイントで処理を停止して、その後デバッグを終了するという処理を自動化することができます。</p>
<p>呼び出しはPythonからではなく、以下のように<code class="language-text">gdb -x</code>コマンドを使います。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">gdb -x solver.py</code></pre></div>
<p>最後に、キーを取得する処理を追加してFlagを取得していきます。</p>
<h3 id="flag取得" style="position:relative;"><a href="#flag%E5%8F%96%E5%BE%97" aria-label="flag取得 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flag取得</h3>
<p>ここまでくればあとは簡単です。</p>
<p>先ほど手動で実行していたcontinueコマンドを利用して1文字ずつキーを取得する作業を自動化しました。</p>
<p>これがSolverスクリプトです。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># gdb -x solver.py</span>
<span class="token keyword">import</span> gdb

BINDIR <span class="token operator">=</span> <span class="token string">"~/Downloads"</span>
BIN <span class="token operator">=</span> <span class="token string">"revvy_chevy"</span>
INPUT <span class="token operator">=</span> <span class="token string">"./in.txt"</span>
BREAK <span class="token operator">=</span> <span class="token string">"0x5555555552ba"</span>

<span class="token comment"># Ghidraから取得したバイト列</span>
data <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x1a</span><span class="token punctuation">,</span> <span class="token number">0x95</span><span class="token punctuation">,</span> <span class="token number">0x4e</span><span class="token punctuation">,</span> <span class="token number">0xba</span><span class="token punctuation">,</span> <span class="token number">0xdb</span><span class="token punctuation">,</span> <span class="token number">0x47</span><span class="token punctuation">,</span> <span class="token number">0x64</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0x2d</span><span class="token punctuation">,</span> <span class="token number">0xd1</span><span class="token punctuation">,</span> <span class="token number">0xbf</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0x9d</span><span class="token punctuation">,</span> <span class="token number">0xde</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0xd7</span><span class="token punctuation">,</span> <span class="token number">0x5c</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0x16</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0x3b</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x6f</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0xd0</span><span class="token punctuation">,</span> <span class="token number">0x7c</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0xdb</span><span class="token punctuation">,</span> <span class="token number">0xde</span><span class="token punctuation">,</span> <span class="token number">0x0c</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0xa0</span><span class="token punctuation">,</span> <span class="token number">0x84</span><span class="token punctuation">,</span> <span class="token number">0x9b</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x2f</span><span class="token punctuation">,</span> <span class="token number">0xb1</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0xa2</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0x4f</span><span class="token punctuation">,</span> <span class="token number">0xb9</span><span class="token punctuation">,</span> <span class="token number">0x6f</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0xbf</span><span class="token punctuation">,</span> <span class="token number">0xb9</span><span class="token punctuation">,</span> <span class="token number">0xbf</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0xef</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0xcf</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdf</span><span class="token punctuation">,</span> <span class="token number">0xf9</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0x8f</span><span class="token punctuation">,</span> <span class="token number">0x39</span><span class="token punctuation">,</span> <span class="token number">0x2f</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token number">0x00</span> <span class="token punctuation">]</span>
key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>INPUT<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token operator">*</span><span class="token number">0x40</span><span class="token punctuation">)</span>

gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'file {}/{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>BINDIR<span class="token punctuation">,</span> BIN<span class="token punctuation">)</span><span class="token punctuation">)</span>
gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'b *{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>BREAK<span class="token punctuation">)</span><span class="token punctuation">)</span>
gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'run &lt; {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>INPUT<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 0x40文字分のキーを取得して key に格納する</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># gdb.execute('p $al')</span>
    r <span class="token operator">=</span> gdb<span class="token punctuation">.</span>parse_and_eval<span class="token punctuation">(</span><span class="token string">"$al"</span><span class="token punctuation">)</span>
    key<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>format_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'continue'</span><span class="token punctuation">)</span>

<span class="token comment"># 取得したキーを元にFlagを復号する</span>
flag <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"}"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'quit'</span><span class="token punctuation">)</span></code></pre></div>
<p>これを実行すると、最終的にFlagの文字列が取得できます。</p>
<h2 id="おまけよく使うgdbのテクニック" style="position:relative;"><a href="#%E3%81%8A%E3%81%BE%E3%81%91%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%86gdb%E3%81%AE%E3%83%86%E3%82%AF%E3%83%8B%E3%83%83%E3%82%AF" aria-label="おまけよく使うgdbのテクニック permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>おまけ：よく使うgdbのテクニック</h2>
<p>最後に、今回の問題では使用しなかったテクニックについても補足しておきます。</p>
<p>解析のために、以下のソースコードをコンパイルしたプログラムを使用します。</p>
<p><code class="language-text">is_vulun</code>が1の場合にのみ、keyを作成するループが実行されるプログラムです。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEXT</span> <span class="token string">"Enjoy debug!\n"</span></span>

<span class="token keyword">char</span> key<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span>TEXT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> is_vulun <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is_vulun <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    	<span class="token punctuation">{</span>
        	key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0x41</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Key %s\n"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Finish!!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>まずはこのソースコードを<code class="language-text">easy.c</code>として保存して、<code class="language-text">gcc easy.c -o easy</code>で実行ファイルを作成します。</p>
<p>しかし、コンパイルしたプログラムを実行してみたものの、<code class="language-text">is_vulun = 0</code>となっているためにキー生成のループは実行されませんでした。</p>
<h3 id="efragsを書き換えて条件分岐をバイパスする" style="position:relative;"><a href="#efrags%E3%82%92%E6%9B%B8%E3%81%8D%E6%8F%9B%E3%81%88%E3%81%A6%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90%E3%82%92%E3%83%90%E3%82%A4%E3%83%91%E3%82%B9%E3%81%99%E3%82%8B" aria-label="efragsを書き換えて条件分岐をバイパスする permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>EFRAGSを書き換えて条件分岐をバイパスする</h3>
<p>まずは<code class="language-text">is_vuln</code>の結果をもとに条件分岐を行っている行を見てみます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/eb435fcc24e3245f59f2812000ec8048/0b533/image-52.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 65.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAARlAAAEZQAGA43XUAAACb0lEQVQ4y02T63aTQBRG+ypqE+bOZRgGCEkgiZdq1br0l77/c2wPTa35MQtYHPbsM+fjzhvHMRccTu847jYsRvOjDfxeIue95VQpvvYjT4cDX4eBvd7x0O55HxxnrWUZjHM4a3FyvUtl4mev+Li84fN4z6NW/GkNfzrDl1JgTvEzB37tS350nkdV8eRKvsvGT0rxTZa+Bbqmp2wtedjSp4JOCs8xcWojndcMzhJTIPaeqi0JrqYONZUPVC8Qews05R4jNm7e4AclLwzzkDlPLaWx1FI4DA22HWm6ljq1aN9hQ/sMsvYFJsteDWfUruD+4Z5iX6AFeJxnDodMobTs6lnmkXJcSNNE3a6giA+NvLtC9I2lAI+oacvmyz1qBRrD6VDz4XKgbjyuspwvn6iydNKM+G4Su4T1V+Dadqct/r/hC/DxHWrZPhuelx1P3z7LucpHlTzPA6elp5/2uHyhyWLa1DJdTy3H0t8CbVoI0ZCzDCUqWilYmoaPfWQSi35raGKg7SpibChML7BMVZrn81sjU9y2rMMkhobNw1vUvBpq9ruay2mgTZW0ZwhjRk89bkiYUlJR1QR/BZYCWSVeDYOvUNlTLFqGY1G2ZOwrPkmwD0stLcqU8xqtTGh7Qn/C1VnOMAjw2u77QtMINKyG3kc2ueXtsWIroMJ1xOFIs3h8L1MOnjR0MoyMbyU+tYCacM2fvULWwZQv93dJjGKjxGIjFkrUJcxdx27siRLyNYtusJhR1k6j5ffU/fY1yCtoHUz6Z1iWEtboGdOWLOAosZklKg/ZcRkqcu1ITSJUCS+1vh7wEp9/hlFAkzKvln8BnLGaRLPV0XEAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/eb435fcc24e3245f59f2812000ec8048/8ac56/image-52.webp 240w,
/static/eb435fcc24e3245f59f2812000ec8048/d3be9/image-52.webp 480w,
/static/eb435fcc24e3245f59f2812000ec8048/b0a15/image-52.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/eb435fcc24e3245f59f2812000ec8048/8ff5a/image-52.png 240w,
/static/eb435fcc24e3245f59f2812000ec8048/e85cb/image-52.png 480w,
/static/eb435fcc24e3245f59f2812000ec8048/0b533/image-52.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/eb435fcc24e3245f59f2812000ec8048/0b533/image-52.png"
            alt="2021/12/image-52.png"
            title="2021/12/image-52.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>ここで、<code class="language-text">var_8h</code>というのは<code class="language-text">is_vulun</code>が格納されたローカル変数です。</p>
<p><code class="language-text">cmp</code>命令によって、32bit符号なし整数(<code class="language-text">dword</code>)として１との比較を行っています。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">0x00001160      837df801       <span class="token function">cmp</span> dword <span class="token punctuation">[</span>var_8h<span class="token punctuation">]</span>, <span class="token number">1</span>
0x00001164      <span class="token number">7542</span>           jne 0x11a8</code></pre></div>
<p><code class="language-text">cmp</code>命令は、条件分岐の際に2つの値を比較する場合によく登場しますが、その実態はただの減算です。</p>
<p>ただし、減算を行う<code class="language-text">sub</code>命令とは異なり、演算結果をレジスタに格納することはありません。</p>
<p>参考：<a href="https://stackoverflow.com/questions/45898438/understanding-cmp-instruction" target="_blank" rel="nofollow noopener noreferrer">assembly - Understanding cmp instruction - Stack Overflow</a></p>
<p>ではなぜ単なる減算を行うだけの<code class="language-text">cmp</code>命令を条件分岐に使用しているのかといえば、演算によってフラグレジスタが更新されるためです。</p>
<p>フラグレジスタは、CPUが演算を行った際に演算結果や状態を示すために使用されるレジスタです。</p>
<p>x86_64アーキテクチャではRFLAGSレジスタの下位32bitが使用されています。</p>
<p>参考：<a href="https://ja.wikibooks.org/wiki/X86%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%A9/x86%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3" target="_blank" rel="nofollow noopener noreferrer">X86アセンブラ/x86アーキテクチャ - Wikibooks</a></p>
<p>フラグレジスタは、32bitのうちの各bitの値にそれぞれ意味があり、演算結果に基づいて値が変更されます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 699px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f296a5af214f2dff11cda42feb2ca683/3fe45/image-53.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABs0lEQVQoz4VTiY6iUBD0/39sTEREjes46CiHyC2K4AFY09WG2clusktSvKPfq66uhsH1ekVd19+43W643+8Kxi6XC6qq+g1Z1zL253mmB88O8OO5lCXiOMHxeFTEcQzP8xS+7yuiKER4OMgYYR8ECGQehiG6rlNSJXw+n0qY5zkMw1CMRiPMZnPYto35fK5Yva8QCIn98SGwJT6DZVkao3olJFnbNlpiluWaLUkSFEWhCbgmCRVx/3Q64SxI0hTn81nPcY8KacGAnuz3e1UyHA5hmhNMp1M4joNCDrJ0EvdeNk2jl0ux58+H8UFdV6rA2e1gTYRMylgsFtjJmt4xlmWZqiEpKyEp171dvWVKyEy8tN1+Yjweqy80n8pYIsn6JhH/JWRW3/ew2WykVEtVLpdLufzyhqBPJCAej8e/CdmZXDLTM9M0sV6v4bou0jRDKcnOUkEPVkMiJqnr618ealP4IoHnuYiko6+snRjfyqTF88fYydfQijpwD6JMmtO2rYKN+lZI0uZxhxsXMOwQ6yDHLzeFsY5gbl5YOCmsbYyJzN9WB7y9H1CUFR7iKf8ugnZ8AdENQZIJLbYoAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/f296a5af214f2dff11cda42feb2ca683/8ac56/image-53.webp 240w,
/static/f296a5af214f2dff11cda42feb2ca683/d3be9/image-53.webp 480w,
/static/f296a5af214f2dff11cda42feb2ca683/32d5d/image-53.webp 699w"
              sizes="(max-width: 699px) 100vw, 699px"
              type="image/webp"
            />
          <source
            srcset="/static/f296a5af214f2dff11cda42feb2ca683/8ff5a/image-53.png 240w,
/static/f296a5af214f2dff11cda42feb2ca683/e85cb/image-53.png 480w,
/static/f296a5af214f2dff11cda42feb2ca683/3fe45/image-53.png 699w"
            sizes="(max-width: 699px) 100vw, 699px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/f296a5af214f2dff11cda42feb2ca683/3fe45/image-53.png"
            alt="2021/12/image-53.png"
            title="2021/12/image-53.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>※ 画像は<a href="https://www.intel.com/content/dam/www/public/us/en/documents/manuals/64-ia-32-architectures-software-developer-vol-3a-part-1-manual.pdf" target="_blank" rel="nofollow noopener noreferrer">Intel Developper Manual</a>より</p>
<p>フラグレジスタの値の内、特に条件分岐に使用することの多いレジスタは以下の通りです。</p>
<table>
<thead>
<tr>
<th align="center">FLAG</th>
<th align="center">用途</th>
<th align="center">bit番号</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">CF（キャリーフラグ）</td>
<td align="center">加算においてレジスタの大きさを越える値を使用する場合に、桁上がりが発生した場合にセットされる</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">ZF（ゼロフラグ）</td>
<td align="center">操作の結果がゼロ (0) になった場合にセットされる</td>
<td align="center">6</td>
</tr>
<tr>
<td align="center">SF（符号フラグ）</td>
<td align="center">操作の結果が負となった場合にセットされる</td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">OF（オーバーフローフラグ）</td>
<td align="center">符号付き算術演算の結果がレジスタに格納できないほど大きい値になった場合にセットされる</td>
<td align="center">11</td>
</tr>
</tbody>
</table>
<p><code class="language-text">cmp</code>命令によって条件分岐する場合には、減算結果が0であるか、もしくは正の値や負の値であるかによって分岐を決定します。</p>
<p>実際にフラグレジスタの値に基づいて分岐を決定するのはいくつかのジャンプ命令です。</p>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">ジャンプ条件</th>
<th align="center">Opcode</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">JE</td>
<td align="center">等しい(ZF = 1)</td>
<td align="center">74</td>
</tr>
<tr>
<td align="center">JNE</td>
<td align="center">等しくない(ZF = 0）</td>
<td align="center">75</td>
</tr>
<tr>
<td align="center">JG</td>
<td align="center">より大きい（ZF = 0 &#x26; SF = OF）</td>
<td align="center">7F</td>
</tr>
<tr>
<td align="center">JGE</td>
<td align="center">より大きいか等しい（SD = OF）</td>
<td align="center">７D</td>
</tr>
<tr>
<td align="center">JNG</td>
<td align="center">より大きくない（ZF = 1 | SF ! OF）</td>
<td align="center">７E</td>
</tr>
<tr>
<td align="center">JL</td>
<td align="center">より小さい（SF ! OF）</td>
<td align="center">７C</td>
</tr>
</tbody>
</table>
<p>参考：<a href="https://codezine.jp/article/detail/485" target="_blank" rel="nofollow noopener noreferrer">インラインアセンブラで学ぶアセンブリ言語 第3回 (1/3)：CodeZine（コードジン）</a></p>
<p>右列のオペコード(opcode)は、すぐに探せるようにしておくとパッチを当てて強制的に条件分岐を改ざんするときなどに便利です。</p>
<p>オペランドによってオペコードが変わる場合もありますが、基本的には以下のIDMを探すとよいと思います。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/321e7818549221e66d148ffce09673e7/0b533/image-54.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 60.83333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAARlAAAEZQAGA43XUAAAB/ElEQVQoz02TiW7iUAxF8//fhaZCpWwBAlnYIWtD2Hc8Pm4ZTSTLz+/Z1/a148ySUoJVKbP8IP66ktEiVynk/njK8/mU6/Uql8tF7ve7aezj8WhnvtfrZYIv4kTRWNK8kJsGVNut+H4gcZzI7XaT0+kkYRhIvV6XNE3l4+OPuG5PoiiU5XIph8NB9vu97HY7OZ/P5u/MZjPZbDZmfH8X0uv1/tlVVVngYDCQPM9Nr9dr6ff7MlBxXVf66o9dlhtL4EwmEymKwowsy8RVB2wyA7xarSQIAnsLw1CSJDFgfzSSkcp4PLY7OijLUhwuqASOKgXodDr2QMtwlcSxBQPueZ4Bf301rLJOu22gvIFB647v+1YRwTg3m02tJDIbx/l8bkF5nhlgrAlICmBXdbfb/YlXirY6A2c6nVpFAMDTT1BiFJAVzmgVQPimNU9bjvRuqL68AQRFBjiOIgt8PB6myc4DFFjLyg9JSPp/y/ihh8OhyVorZ5UcVoDKqAjN5LIMe28gi8XCgKwy1VSMD9vwnjC0MDwbylzb4GBro1x4nq7IL6dUGitApF3AE/oNzJnpI1PdFLYFzp1QLwCkRXStVrMqmDK8cO79rhI6SzNpNBrS1gk3Pj+l1WoZl9xThENG2gWAiiCZTO9frChyW27eaAtamCxn6ECYPDj4/AWnPnaKK/hvZgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/321e7818549221e66d148ffce09673e7/8ac56/image-54.webp 240w,
/static/321e7818549221e66d148ffce09673e7/d3be9/image-54.webp 480w,
/static/321e7818549221e66d148ffce09673e7/b0a15/image-54.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/321e7818549221e66d148ffce09673e7/8ff5a/image-54.png 240w,
/static/321e7818549221e66d148ffce09673e7/e85cb/image-54.png 480w,
/static/321e7818549221e66d148ffce09673e7/0b533/image-54.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/321e7818549221e66d148ffce09673e7/0b533/image-54.png"
            alt="2021/12/image-54.png"
            title="2021/12/image-54.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>参考：<a href="http://sparksandflames.com/files/x86InstructionChart.html" target="_blank" rel="nofollow noopener noreferrer">Intel x86 Assembler Instruction Set Opcode Table</a></p>
<p><code class="language-text">Jcc—Jump if Condition Is Met</code>のテーブルを参照してください。</p>
<p>ここまでフラグレジスタとジャンプ命令について整理したところで、本題に戻ります。</p>
<p><code class="language-text">is_vulun</code>の値が1であるかを特定する以下の条件分岐をバイパスしていきましょう。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">0x00001160      837df801       <span class="token function">cmp</span> dword <span class="token punctuation">[</span>var_8h<span class="token punctuation">]</span>, <span class="token number">1</span>
0x00001164      <span class="token number">7542</span>           jne 0x11a8</code></pre></div>
<p><code class="language-text">var_8h</code>には必ず0が格納されるので、<code class="language-text">0x00001160</code>の<code class="language-text">cmp</code>命令が実行された結果、フラグレジスタは<code class="language-text">[ CF PF AF SF IF ]</code>のフラグが立っている状態になります。</p>
<p>ここでは各フラグの詳細についてはいったん気にしなくてよいので、<code class="language-text">jne</code>で処理をスキップされないために必要な<code class="language-text">ZF</code>が立っていない点に着目してください。</p>
<p>gdbで実行してみた結果は以下のようになります。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ b *0x555555555164
$ p <span class="token variable">$eflags</span>
<span class="token variable">$5</span> <span class="token operator">=</span> <span class="token punctuation">[</span> CF PF AF SF IF <span class="token punctuation">]</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e84b8d431db46c8aa3cd53e1cc2abce6/0b533/image-55.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 63.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAARlAAAEZQAGA43XUAAACLklEQVQ4y2WTWXbrIBBEvZ1nWxNikhCaB8uOk/2vpl6BE8dJPjgg1Fyqq5vD7XbB+/sNl8uKaRqwbTOkLCFUiVJLtHOPqneohwZ1W8NxTrIUp9MJ5/P5Ob6+D9frhvv9in3fMM8DlmVCWRJmJIQU6BYCR0+QR901cFyf0+Qb+AIOe4eg8OPjDVfOAXi5LFQoUTsDbRRu9w37bcZ+nbGsA9cLsk+Fv0dUuO8r7m87Viobhi7OpRBwtYVi6muwgRdZJeEqg6ayT0BCQJokcTwVaqVwpX83ghceHrsW6zxCEZAwsHFVXA99i76lj9bAGI2K4JxKM8YUaRrhEShEEX1blhHD2KHnwVCcshTRH+8blFQaAIJ7KSF5nqMsCmQEpUn6M2VtK1azgjQ1pLaQSkNZxypbGNdBcS8U6d8xHKL5IT2OLM2QElgQ/APYjzOaYUU77XDdiMoyHa1jGrIQsYVq+qnZQpb/8jyL6qNKXhRAafriYdP1bIcpQpt+RvC0cR5t27EwTfTP9wM849p+5L5H13laYGhPR0tctMi5+qGwHSb22ENhO20wBI4MDAUK63DQWhvT04atpBW/DYL3QWVR5LF4yWelD7Z2UKaCqT1U5VAwnWC4YHBOnwwPWxYkQIOKMKtgCVsr/Avr1148NAwqeYu2NbRrIB2fmW9jcEG/Qo8dWZDHOD7m06NAx+PpzxM8eAI9U5z2CzzTL4RElgu+htAaWXwVrwee49eT+5r/A22gqEdyTBJ9AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/e84b8d431db46c8aa3cd53e1cc2abce6/8ac56/image-55.webp 240w,
/static/e84b8d431db46c8aa3cd53e1cc2abce6/d3be9/image-55.webp 480w,
/static/e84b8d431db46c8aa3cd53e1cc2abce6/b0a15/image-55.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/e84b8d431db46c8aa3cd53e1cc2abce6/8ff5a/image-55.png 240w,
/static/e84b8d431db46c8aa3cd53e1cc2abce6/e85cb/image-55.png 480w,
/static/e84b8d431db46c8aa3cd53e1cc2abce6/0b533/image-55.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/e84b8d431db46c8aa3cd53e1cc2abce6/0b533/image-55.png"
            alt="2021/12/image-55.png"
            title="2021/12/image-55.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>実際にZFが立っていないことが確認できました。</p>
<p>ここで条件分岐をバイパスするためには、ZFを立てる必要があります。</p>
<p>gdbでは、メモリのデータは<code class="language-text">set</code>コマンドで改ざんすることができます。</p>
<p>先ほど確認した通り、ZFはフラグレジスタの6bit目の値が対応しています。</p>
<p>つまり、フラグレジスタの6bit目の値を強制的に1に書き換えることでZFを立てることができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># OR演算で$eflagsの6bit目の値を0に設定する</span>
$ <span class="token builtin class-name">set</span> <span class="token variable">$eflags</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span>
$ p <span class="token variable">$eflags</span>
<span class="token variable">$7</span> <span class="token operator">=</span> <span class="token punctuation">[</span> CF PF AF ZF SF IF <span class="token punctuation">]</span></code></pre></div>
<p>上記のように、<code class="language-text">set $eflags |= (1 &lt;&lt; 6)</code>を実行することでZFを立てることができました。</p>
<p>この状態で<code class="language-text">n</code>コマンドで処理を進めると、本来実行されるはずのない<code class="language-text">0x555555555166</code>に処理を進めることができました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e96edda2a2e25f369363488ec7a6b81e/0b533/image-56.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 69.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAARlAAAEZQAGA43XUAAACVklEQVQ4y3VU2W7bMBD050S27oMUJeqWjxx2m6LpQ/vQAilQtP//Pp2lLTsN0IcFSXE5nJ1ZaqWVhsoLZHmOMIoRhNElQkRxgqwoEaeZW1/3gvC85ugz5Jzv+y5W1dSiqSskSYwwCJgUIGSyRBzHyLIMURS5WL6laeryk4QXZimBAmw2G/iMlSGgrWvkZJlnOYoih9YKxmiUJdmr4gIkoKEDk30BklzJEWYOUBiauUczHjAcTi5KU2Hoz5dopRARTNgIoLCTQ57nuXnoyg6uYDKuyrGFKWtUlWU0MJVB23aoa0uWNWxjcThsua5gbXVlnaaJYyxSLIBnhr1F3w+wBFFl5UpSpYHmBYqAYpaALDoKMxnX67UDesvOMTRDg2noyVIjpasxkwUkpbNJQvEJIIyW0t6CvI2bhoNFwzLFoUBCDKBmvgAwQdZ5njnAO2rnkZnkbtZLrN9pKG3TWgdSsNySbZKTaUmWmnPDMSHrIA5haZJ89zkPU5rCM1GW8NKbMSslYncNxmlE37YYug5d06CijrUxmMcZ0zhSzxLzMLj9gvOQl0dsnZjsI8pyBRzbBi/PR3z5dMLT/Q73uwm7sUfCWwu2ilE59mODrtJojULL0fJb4F1MeV/yN7bF74c9/jwe8HM74nUe8Z19eEoivOgcn02OX08zXrcdfmxbF1+txnTnnUGcKTejVi0dPn58wofnE6bdjP3DAfN+RkqtLLXVLPt4emTDl0ipqeIriVmu9z+XlS75hAo+J+3erczlCcY0ZulJxT33Q5CfgR+4MQyjf2IB/AuN6cOdwAKN3AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/e96edda2a2e25f369363488ec7a6b81e/8ac56/image-56.webp 240w,
/static/e96edda2a2e25f369363488ec7a6b81e/d3be9/image-56.webp 480w,
/static/e96edda2a2e25f369363488ec7a6b81e/b0a15/image-56.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/e96edda2a2e25f369363488ec7a6b81e/8ff5a/image-56.png 240w,
/static/e96edda2a2e25f369363488ec7a6b81e/e85cb/image-56.png 480w,
/static/e96edda2a2e25f369363488ec7a6b81e/0b533/image-56.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/e96edda2a2e25f369363488ec7a6b81e/0b533/image-56.png"
            alt="2021/12/image-56.png"
            title="2021/12/image-56.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>次は、フラグレジスタではなく変数の値をメモリから参照した後に改ざんすることで条件分岐をバイパスさせてみたいと思います。</p>
<h3 id="メモリの中から情報を抜き出す" style="position:relative;"><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E4%B8%AD%E3%81%8B%E3%82%89%E6%83%85%E5%A0%B1%E3%82%92%E6%8A%9C%E3%81%8D%E5%87%BA%E3%81%99" aria-label="メモリの中から情報を抜き出す permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>メモリの中から情報を抜き出す</h3>
<p>先ほど同様以下の処理を見ていきます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">0x00001160      837df801       <span class="token function">cmp</span> dword <span class="token punctuation">[</span>var_8h<span class="token punctuation">]</span>, <span class="token number">1</span>
0x00001164      <span class="token number">7542</span>           jne 0x11a8</code></pre></div>
<p>今度は<code class="language-text">0x00001160</code>にブレークポイントを設定しましょう。</p>
<p>そこで<code class="language-text">run</code>コマンドを実行すると、<code class="language-text">cmp</code>命令の呼び出し地点で処理が停止します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ b *0x555555555160
$ run
   0x555555555159 <span class="token operator">&lt;</span>main+2<span class="token operator"><span class="token file-descriptor important">0</span>></span>:    mov    DWORD PTR <span class="token punctuation">[</span>rbp-0x8<span class="token punctuation">]</span>,0x0
<span class="token operator">=</span><span class="token operator">></span> 0x555555555160 <span class="token operator">&lt;</span>main+2<span class="token operator"><span class="token file-descriptor important">7</span>></span>:    <span class="token function">cmp</span>    DWORD PTR <span class="token punctuation">[</span>rbp-0x8<span class="token punctuation">]</span>,0x1
   0x555555555164 <span class="token operator">&lt;</span>main+3<span class="token operator"><span class="token file-descriptor important">1</span>></span>:    jne    0x5555555551a8 <span class="token operator">&lt;</span>main+9<span class="token operator"><span class="token file-descriptor important">9</span>></span>
   0x555555555166 <span class="token operator">&lt;</span>main+3<span class="token operator"><span class="token file-descriptor important">3</span>></span>:    mov    DWORD PTR <span class="token punctuation">[</span>rbp-0x4<span class="token punctuation">]</span>,0x0</code></pre></div>
<p>このとき、<code class="language-text">DWORD PTR [rbp-0x8]</code>はローカル変数の<code class="language-text">is_vulun</code>の値を参照しています。</p>
<p><code class="language-text">DWORD PTR [メモリアドレス]</code>の構文は、<code class="language-text">[]</code>の中に定義されたメモリアドレスをDWORD（32bit符号なし整数）として取得する命令です。</p>
<p><code class="language-text">$rbp-0x8</code>は、ローカル変数の格納されたスタックのアドレスですが、確認してみるとスタックの中には実際の変数の値が格納されているメモリアドレスを関節参照しているようです。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">p <span class="token variable">$rbp</span>-0x8
<span class="token variable">$16</span> <span class="token operator">=</span> <span class="token punctuation">(</span>void *<span class="token punctuation">)</span> 0x7fffffffdce8</code></pre></div>
<p>つまり、実際の<code class="language-text">is_vulun</code>の値は<code class="language-text">0x7fffffffdce8</code>の中に格納されています。</p>
<p>gdbでは、<code class="language-text">x/[format] &lt;address></code>コマンドでメモリの中の情報を参照できます。</p>
<p>参考：<a href="https://visualgdb.com/gdbreference/commands/x" target="_blank" rel="nofollow noopener noreferrer">GDB Command Reference - x command</a></p>
<p>上記のドキュメントを見ると、<code class="language-text">x/w &lt;address></code>としてフォーマットを指定すると、32bit符号なし整数としてメモリ内の情報を取得できることがわかります。</p>
<p>そのため、以下のコマンドを実行すると、メモリアドレス<code class="language-text">0x7fffffffdce8</code>（変数<code class="language-text">is_vulun</code>）の値が0になっていることがわかります。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ x/w 0x7fffffffdce8
0x7fffffffdce8: <span class="token number">0</span></code></pre></div>
<p>話を条件分岐の処理に戻します。</p>
<p>ここで、<code class="language-text">dword [var_8h]</code>の値が0であり、<code class="language-text">cmp</code>命令によって1と比較した結果が等しいかどうかを確認していることがわかります。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">0x00001160      837df801       <span class="token function">cmp</span> dword <span class="token punctuation">[</span>var_8h<span class="token punctuation">]</span>, <span class="token number">1</span>
0x00001164      <span class="token number">7542</span>           jne 0x11a8</code></pre></div>
<p>そのため、<code class="language-text">dword [var_8h]</code>の値を1に改ざんすることで、条件分岐のバイパスができそうです。</p>
<p>ここで、特定のメモリ内の値を改ざんする場合にも<code class="language-text">set</code>コマンドを使用できます。</p>
<p>特定のアドレスの値を変更する際は、以下のリンク先のように<code class="language-text">{データ型}</code>を付与します。</p>
<p>参考：<a href="https://sourceware.org/gdb/current/onlinedocs/gdb/Assignment.html#Assignment" target="_blank" rel="nofollow noopener noreferrer">Assignment (Debugging with GDB)</a></p>
<p>実際に、以下のようにしてメモリのデータを改ざんできました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ x/w 0x7fffffffdce8
0x7fffffffdce8: 0x00000000

<span class="token comment"># 値の改ざん</span>
$ <span class="token builtin class-name">set</span> <span class="token punctuation">{</span>int<span class="token punctuation">}</span>0x7fffffffdce8 <span class="token operator">=</span> <span class="token number">1</span>

$ x/w 0x7fffffffdce8
0x7fffffffdce8: 0x00000001</code></pre></div>
<p>この状態で処理を進めることで、<code class="language-text">cmp</code>命令で値を比較した結果<code class="language-text">is_vuln == 1</code>となるため、条件分岐のバイパスに成功します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3dcd34a87afb4e114a4b55b19d5dc490/0b533/image-57.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAARlAAAEZQAGA43XUAAAB+0lEQVQoz02S65KqMBCEfR1F5GIISSCESwCxvOzWvv+z9Hai7jk/umak8KNnpnfnRqE2Cr1zKGuJpjGYbIdcVbH34wTZtRCqxjaOWKmzkihkhVwKlOzzskSSJDgej9jVUuJ223C/X7GuM8ZpwDD2yE8ZyjyHrAR8Z6EJUFSjaUAIJAcCCImVoKAkIbBtDZ7PG35+vnC9rvB+xLJ4ZEWOSglII7E8PPzi0M8dBtbG6T9H6Sn966NDxVG+v+8EPrFtCy6XOdaCwM4aKI7+9bxi8QNsqzGNHYyWOBwOOJ1OMFzXBxjqThvDMUf4eYbtOrjeUT1ExX1yl6bt6NojzwtCOOIx5Z9TpOlHJ4Kzfw7D7ho3oh1WaoEylsdoUFU1hJAE16i4OyHOhGZUHkGhBlBKl+FDwXF0eLtdYAcPO17g/AZjHXRdUwqtNqjpNEwx8LrjNEX3ztmYgKDQhzv0fRfXRIfbG7iiX25ougGN0ViXhZrpTBCo4wryokSteGXGS/PaARCcn88ldUaWZdiFmNS6YRYtVON4WfN6kTurKMGMWdtGQJBzHYE1JKFFUUDxWZbl2O/3r5EHP6PlmIpQYwln0LXV0VXGPYVsHULe3kuPPZ/F32n6is67xqO0hDStw7RsmHjNx+OKK6MTY8BFf148Hl9Bjn3yDvX/9R2bX1c8ajyUzL/UAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/3dcd34a87afb4e114a4b55b19d5dc490/8ac56/image-57.webp 240w,
/static/3dcd34a87afb4e114a4b55b19d5dc490/d3be9/image-57.webp 480w,
/static/3dcd34a87afb4e114a4b55b19d5dc490/b0a15/image-57.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/3dcd34a87afb4e114a4b55b19d5dc490/8ff5a/image-57.png 240w,
/static/3dcd34a87afb4e114a4b55b19d5dc490/e85cb/image-57.png 480w,
/static/3dcd34a87afb4e114a4b55b19d5dc490/0b533/image-57.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/3dcd34a87afb4e114a4b55b19d5dc490/0b533/image-57.png"
            alt="2021/12/image-57.png"
            title="2021/12/image-57.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>これでgdbを使ってメモリ情報の参照や改ざんを行うことができました。</p>
<h2 id="まとめ" style="position:relative;"><a href="#%E3%81%BE%E3%81%A8%E3%82%81" aria-label="まとめ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>まとめ</h2>
<p>今回はCTFの初心者向けにELFバイナリの基本的な解析手法をまとめてみました。</p>
<p>この記事は、私が個人的に開催する勉強会のために作成したものですので、もし勉強会などで再利用いただける場合は特に許諾などは不要です。</p>
<p>参照元としてURLだけ記載いただければ、あとはご自由にご利用ください。</p>
<p>なお、本記事やその他の内容について質問、指摘事項がある場合は、<a href="https://twitter.com/yuki_kashiwaba" target="_blank" rel="nofollow noopener noreferrer">Twitter:yuki_kashiwaba</a> のDMまでお願いします。</p>
<p>この記事のコメントでも受け付けてますが、Twitter経由の方がレスポンスが早いです。</p>
<p>この記事が少しでもこれからCTFを始める方の役に立てば幸いです。</p>
<h2 id="おすすめの書籍--webサイト" style="position:relative;"><a href="#%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E3%81%AE%E6%9B%B8%E7%B1%8D--web%E3%82%B5%E3%82%A4%E3%83%88" aria-label="おすすめの書籍  webサイト permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>おすすめの書籍 / WEBサイト</h2>
<p>この記事ではELF解析の入門的な内容にしか触れていないので、より詳細に学びたい方には以下の書籍やWebサイトが役に立つと思いますので、参考までに記載しておきます。</p>
<h3 id="書籍" style="position:relative;"><a href="#%E6%9B%B8%E7%B1%8D" aria-label="書籍 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>書籍</h3>
<ul>
<li><a href="https://amzn.to/3lkunSs" target="_blank" rel="nofollow noopener noreferrer">Debug Hacks -デバッグを極めるテクニック&#x26;ツール</a>
開発者向けのデバッグ本ですが、前半100ページくらいにgdbの基本的な使い方などがまとまっていて非常に参考になります。</li>
<li><a href="https://amzn.to/3o7g5Gj" target="_blank" rel="nofollow noopener noreferrer">詳解セキュリティコンテスト</a>
今からCTFに入門するならとりあえず読んでおくと良い1冊。
解析手法やアセンブリの読み方などかなりわかりやすくまとまってます。
Reversingの項目は何か所か誤植あるようなので、正誤表要確認。</li>
<li><a href="https://amzn.to/3robIsL" target="_blank" rel="nofollow noopener noreferrer">リバースエンジニアリングツールGhidra実践ガイド ~セキュリティコンテスト入門からマルウェア解析まで~ </a>
たぶん日本語で書かれた唯一のGhidra本です。
PEバイナリの解析の内容が多めですが、Ghidraの使い方だけでなく解析手法についてもとても勉強になります。
Ghidra10.0以前の本なのでデバッガについては記載がない点に注意。</li>
<li><a href="https://amzn.to/3robIsL" target="_blank" rel="nofollow noopener noreferrer">リバースエンジニアリング ―Pythonによるバイナリ解析技法</a>
完全にPEバイナリの解析のみについての本ですが、解析手法はELFと共通する部分が多いです。</li>
<li><a href="https://booth.pm/ja/items/1058583" target="_blank" rel="nofollow noopener noreferrer">冴えないIDAの育てかた</a>
IDAの概要や使い方がまとまってます。
なぜかIDA本なのに1/3くらいのページでradare2の解説がされてます。
日本語でこんなにradare2の情報が充実してる本は出会ったことがないのでとても参考になります。</li>
<li><a href="https://amzn.to/3oMmsPY" target="_blank" rel="nofollow noopener noreferrer">動かしながらゼロから学ぶ Linuxカーネルの教科書</a>
ELFバイナリの解析のためには、ある程度Linuxの仕組みを知っておく必要があります。
個人的には一番入門的な書籍化と思います。</li>
<li><a href="https://amzn.to/3yhiyBA" target="_blank" rel="nofollow noopener noreferrer">ptrace入門: ptraceの使い方</a>
今回は使いませんでしたが、ptraceとltraceの解説書です。
筑波大教授の先生が講義で使った資料を書籍化したもののようですが、たったの100円で販売されていて買わない理由がないです。</li>
</ul>
<h3 id="webサイト" style="position:relative;"><a href="#web%E3%82%B5%E3%82%A4%E3%83%88" aria-label="webサイト permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WEBサイト</h3>
<ul>
<li><a href="https://cs.lmu.edu/~ray/notes/nasmtutorial/" target="_blank" rel="nofollow noopener noreferrer">NASM Tutorial</a>
英語ですが、インテル記法のアセンブリを読めるようになるための最初の一歩として結構いい情報が多いです。</li>
<li>
<p><a href="http://asmdebugger.com/" target="_blank" rel="nofollow noopener noreferrer">Assembly Debugger Online</a>
わざわざローカルでgdbを動かさなくても簡単にWebからインテル記法のアセンブリの動作確認ができます。</p>
<p>ちょっとした挙動が自分の認識とあっているか検証する際などに便利です。</p>
</li>
<li><a href="https://linuxjm.osdn.jp/index.html" target="_blank" rel="nofollow noopener noreferrer">JM Project (Japanese)</a>
ELF解析をするなら頻繁にライブラリ関数などのmanを確認すると思いますが、manページなどが日本語に翻訳されたページです。</li>
<li><a href="https://book.rada.re/first_steps/intro.html" target="_blank" rel="nofollow noopener noreferrer">The Official Radare2 Book</a>
radare2って機能が豊富ですよね。
全然使いこなせてない。。</li>
</ul>
<p>※参考情報についてはそのうち気が向いたら追記していきます。沢山ありすぎて書ききれませんでした。</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Dec 12, 2021</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/ctf/">CTF</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/elf/">ELF</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/reversing/">Reversing</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/training/">Training</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたいCTF Player(Team: 0nePadding)。WinDbgとYARAが好き。OSCP / CISSP / AtCoder 緑 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/kash1064" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ctf-elf-training";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-6aedca512ffc346655cd.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-76f2006942127b3c7274.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-70ba56c0f46525baa629.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-d19905e5c8fc953958f1.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-6ba68ef37e264f701345.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-0faa242d92f89b71e668.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-6aedca512ffc346655cd.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-ccbc7c7848e640d6928d.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-a3c0f166cb4b802ff58f.js" async=""></script></body></html>