<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e71379dda153709d1a9a.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.625rem;margin:.3125rem 0;border:1px solid #999;border-radius:.3125rem}.Sidebar-module--search-container--17C6F{position:relative}.Sidebar-module--search-container-input--27Tw4{width:100%}.Sidebar-module--search-container-submit--WwtLg{position:absolute;width:2.375rem;height:2.375rem;top:calc(50% - 19px);right:0;border:3px solid #999;border-radius:0 .25rem .25rem 0;background:#999}.Sidebar-module--search-container-submit--WwtLg:before{position:absolute;content:"";width:.9375rem;height:.9375rem;top:calc(50% - 9px);left:calc(50% - 9px);border-radius:50%;box-shadow:0 0 0 2px #fff}.Sidebar-module--search-container-submit--WwtLg:after{position:absolute;content:"";width:.5rem;height:.375rem;top:calc(50% + 6px);left:calc(50% + 2px);border-top:2px solid #fff;transform:rotate(45deg)}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">Iris CTF 2024 Writeup - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content="Iris CTF 2024 Writeup"/><meta data-react-helmet="true" property="og:site_name" content="Iris CTF 2024 Writeup - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/8ae0ca03b5f4fd3a39dcc2afedc5a17e/ctf-irisctf-2024.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="Iris CTF 2024 Writeup - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content="Iris CTF 2024 Writeup"/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/8ae0ca03b5f4fd3a39dcc2afedc5a17e/ctf-irisctf-2024.png"/><link as="script" rel="preload" href="/webpack-runtime-a3c0f166cb4b802ff58f.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-dc4461458952c198375d.js"/><link as="script" rel="preload" href="/app-e02f8e389a3ee69c0504.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/ctf-irisctf-2024/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Iris CTF 2024 Writeup</h1><div class="Content-module--content__body--2TrQ-"><p>新年初めての CTF は、昨年同様 IrisCTF でした。</p>
<p>簡単に Writeup を書いていきます。</p>
<!-- omit in toc -->
<h2 id="もくじ" style="position:relative;"><a href="#%E3%82%82%E3%81%8F%E3%81%98" aria-label="もくじ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>もくじ</h2>
<ul>
<li><a href="#the-johnsonsrev">The Johnson’s(Rev)</a></li>
<li><a href="#rune-whats-thatrev">Rune? What’s that?(Rev)</a></li>
<li><a href="#secure-computingrev">Secure Computing(Rev)</a></li>
<li><a href="#not-just-mediaforensic">Not Just Media(Forensic)</a></li>
<li><a href="#wheres-skatnetwork">Where’s skat?(Network)</a></li>
<li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li>
</ul>
<h2 id="the-johnsonsrev" style="position:relative;"><a href="#the-johnsonsrev" aria-label="the johnsonsrev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Johnson’s(Rev)</h2>
<blockquote>
<p>Please socialize with the Johnson’s and get off your phone. You might be quizzed on it!</p>
</blockquote>
<p>問題バイナリとして与えられた ELF ファイルを解析すると、 Color と Food に対応する文字列を順番に入力として受け取るプログラムでした。</p>
<p>check 関数を調査したところ、以下のように入力値として受け取った Color と Food の値と対応する ID がどの変数に格納されるかチェックを行っていることがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 658px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7a78180574087d539f960f6dee9cf594/889a4/image-20240106113116528.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 82.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAABhklEQVQ4y61Ua4/bIBDk///C+35Sr8klxgbDAgueDiSXq1q5anyHNFr5td55gHG+wVpgtopSGvratg1Hl9HamxSiPpr9D/Z+bE4XhXNvSDI/NckeC5NE4SXiSsyEiCCy5lIQcoFNCS5nxCiQGMez2valMdKbJA8rDot4qCo/qGj8SInSUSsymzfe78/+SXmaOI2syCpsoF+nLJKQisBn0tGMymk+oH2yOwonb+Oejul3J4zUZQ4zLiEidN3uOiXqJrxeWD3r+puG/Ue7Da0V6iNDm29xuZuiJZDi3/ptT+TyAyYExYVUfoaAK6u1M9bVwwf/0OqpndK7vi4zXtjodXE4n864Tle8T+/MpA690t2Ynr8Rq2Far93EMqrqLU6GucXZBvwIF5zcxF3jGOpMXRPWUBHkFmzXDePL3cQe+sxU5OwftaelMzJuaZxqg40Td4rFnObR8PDhME2NUSmkxVhoGnRwwIxPU9YGvyoz6InIAJdh74bt0DFmlqWSf/sjLtstMwfWL/SAPWwcbvv9AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/7a78180574087d539f960f6dee9cf594/8ac56/image-20240106113116528.webp 240w,
/static/7a78180574087d539f960f6dee9cf594/d3be9/image-20240106113116528.webp 480w,
/static/7a78180574087d539f960f6dee9cf594/6ad61/image-20240106113116528.webp 658w"
              sizes="(max-width: 658px) 100vw, 658px"
              type="image/webp"
            />
          <source
            srcset="/static/7a78180574087d539f960f6dee9cf594/8ff5a/image-20240106113116528.png 240w,
/static/7a78180574087d539f960f6dee9cf594/e85cb/image-20240106113116528.png 480w,
/static/7a78180574087d539f960f6dee9cf594/889a4/image-20240106113116528.png 658w"
            sizes="(max-width: 658px) 100vw, 658px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/7a78180574087d539f960f6dee9cf594/889a4/image-20240106113116528.png"
            alt="image-20240106113116528"
            title="image-20240106113116528"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>このチェック部分を整理したとこと、以下のような条件式とイコールとなる比較を行っていることがわかりました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">food<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> chicken
food<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">!=</span> pasta
food<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!=</span> pasta
food<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!=</span> steak

color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> green
color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> red
color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> green
color<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">!=</span> yellow
color<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> blue</code></pre></div>
<p>ここから、Flag を取得するために必要な文字列の入力順序は以下であることを特定できました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> red
color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> yellow
color<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> green
color<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> blue

food<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> chicken
food<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> pasta
food<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> steak
food<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> pizza</code></pre></div>
<p>以上の順に文字列を入力することで正しい Flag を取得できました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/50bb5ff9861267e94166508a29b4226a/0b6f4/image-20240106113008800.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBUlEQVQY04WRW0+DQBCF961qfPD+ZGKltVrKpW0oFLClQkEEirSiabz8/59x3BmNUWPjw5czO8meObMrVsMUj3bO1FaGtVuyhk0H9kEP7rEB78SE81mPDzVW90jnvr2vMtQf7akQZPAyWeLJKaRpgWqQ8Hntlaj6CZaDW6SdCeaKh6TtI5Yat3wkF9cITi040ogMaQANFXRpoUe4N2M8WHfIujM2KXoh16Uxh7ndgt44h9FQWL9jbCk/EM9+BeJ1usLbrEY9ylip95E6l6t02bS/0/4XQWkoXaGFvGJ6OcVCi2S6ALl6g+wqwHC3s9Hwd1+QEa0cNcdf0IeEZw7X9H5/XdzEO2zJu/KF8/9cAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/50bb5ff9861267e94166508a29b4226a/8ac56/image-20240106113008800.webp 240w,
/static/50bb5ff9861267e94166508a29b4226a/d3be9/image-20240106113008800.webp 480w,
/static/50bb5ff9861267e94166508a29b4226a/e46b2/image-20240106113008800.webp 960w,
/static/50bb5ff9861267e94166508a29b4226a/d4a71/image-20240106113008800.webp 984w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/50bb5ff9861267e94166508a29b4226a/8ff5a/image-20240106113008800.png 240w,
/static/50bb5ff9861267e94166508a29b4226a/e85cb/image-20240106113008800.png 480w,
/static/50bb5ff9861267e94166508a29b4226a/d9199/image-20240106113008800.png 960w,
/static/50bb5ff9861267e94166508a29b4226a/0b6f4/image-20240106113008800.png 984w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/50bb5ff9861267e94166508a29b4226a/d9199/image-20240106113008800.png"
            alt="image-20240106113008800"
            title="image-20240106113008800"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2 id="rune-whats-thatrev" style="position:relative;"><a href="#rune-whats-thatrev" aria-label="rune whats thatrev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rune? What’s that?(Rev)</h2>
<blockquote>
<p>Rune? Like the ancient alphabet?</p>
</blockquote>
<p>問題バイナリとして与えられたものは以下の go スクリプトと、<code class="language-text">iÛÛÜÖ×ÚáäÈÑ¥gebªØÔÍãâ£i¥§²ËÅÒÍÈä</code> という謎の文字列でした。</p>
<div class="gatsby-highlight" data-language="go"><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
	<span class="token string">"strings"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token string">"irisctf{this_is_not_the_real_flag}"</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	runed <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	z <span class="token operator">:=</span> <span class="token function">rune</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> flag <span class="token punctuation">{</span>
		runed <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>runed<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>v<span class="token operator">+</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span>
		z <span class="token operator">=</span> v
	<span class="token punctuation">}</span>

	flag <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>runed<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"the"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token operator">|</span>os<span class="token punctuation">.</span>O_CREATE<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> file<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>スクリプトを読んでみると、flag 変数で定義した Flag 文字列を加工した結果が、問題バイナリとして与えられた意味不明な文字列として出力されることがわかります。</p>
<p>詳しい変換の実装を読んでみると、単純に前の文字に次の文字を足した値を Unicode 文字として表示しているだけであることがわかりました。</p>
<p>そこで、以下の Script を使用して、正しい Flag が <code class="language-text">irisctf{i_r3411y_1ik3_num63r5}</code> であることを特定しました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">decode_string</span><span class="token punctuation">(</span>encoded_string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    decoded_chars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    previous_char_unicode <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">for</span> char <span class="token keyword">in</span> encoded_string<span class="token punctuation">:</span>
        original_char_unicode <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token operator">-</span> previous_char_unicode
        original_char <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>original_char_unicode<span class="token punctuation">)</span>
        decoded_chars<span class="token punctuation">.</span>append<span class="token punctuation">(</span>original_char<span class="token punctuation">)</span>
        previous_char_unicode <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>original_char<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>decoded_chars<span class="token punctuation">)</span>

encoded_string <span class="token operator">=</span> <span class="token string">r'iÛÛÜÖ×ÚáäÈÑ¥gebªØÔÍãâ£i¥§²ËÅÒÍÈä'</span>
original_string <span class="token operator">=</span> decode_string<span class="token punctuation">(</span>encoded_string<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>original_string<span class="token punctuation">)</span></code></pre></div>
<h2 id="secure-computingrev" style="position:relative;"><a href="#secure-computingrev" aria-label="secure computingrev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Secure Computing(Rev)</h2>
<blockquote>
<p>Your own secure computer can check the flag! Might have forgotten to add the logic to the program, but I think if you guess enough, you can figure it out. Not sure</p>
</blockquote>
<p>問題バイナリとして、chal という ELF バイナリと、以下の C コード、そして Dockerfile が与えられます。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Here's a snippet of the source code for you</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Guess: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> flag<span class="token punctuation">[</span><span class="token number">49</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%57s"</span><span class="token punctuation">,</span> flag<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token function">strlen</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">57</span> <span class="token operator">||</span> <span class="token function">strncmp</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> <span class="token string">"irisctf{"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token function">strncmp</span><span class="token punctuation">(</span>flag <span class="token operator">+</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token string">"}"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Guess harder\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">flg</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__uint64_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>flag<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>n<span class="token punctuation">)</span></span></span>
    <span class="token function">syscall</span><span class="token punctuation">(</span><span class="token number">0x1337</span><span class="token punctuation">,</span> <span class="token function">flg</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">flg</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">flg</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">flg</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">flg</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">flg</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Maybe? idk bro\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="dockerfile"><pre class="language-dockerfile"><code class="language-dockerfile"><span class="token instruction"><span class="token keyword">FROM</span> ubuntu:latest</span>

<span class="token instruction"><span class="token keyword">RUN</span> apt update &amp;&amp; apt install -y gdbserver</span>

<span class="token instruction"><span class="token keyword">COPY</span> chal /</span>
<span class="token instruction"><span class="token keyword">CMD</span> /chal</span></code></pre></div>
<p>与えられた問題バイナリを Ghidra で解析してみると、問題バイナリとして与えられた C のコードと一致していそうなことがわかります。</p>
<p>ここでは、<code class="language-text">irisctf{</code> から始まり <code class="language-text">}</code> で終わる 57 文字を入力として受け取ります。</p>
<p>続けて、<code class="language-text">#define flg(n) *((__uint64_t*)((flag+8))+n)</code> で定義された flg(n) によって、flag の 8 文字目から 56 文字目までが 8 文字ずつ syscall 関数の引数として与えられます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 743px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d185f859eca5826bae59564fff586d6a/f2793/image-20240110120644240.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 116.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAAsTAAALEwEAmpwYAAACDElEQVQ4y52UO2/bMBSF9f/HAl0SpAXaKVOmdsqUpQlQBwWah10jjq0XZVmWSPGSl2+VdtCiS2KrBwQpXPCDLg4PmZye3rx/d31ycvPxw+Ts7Punz5Pz8x8XFz+/fL2/vJxeXc2/XT9Nbpd3d+mvebFcknXVPJNnUld5SZKm3ngYPA6DtkG5IIegBi93w4l9/XUlaUZ68JwPjBVK1btaiIrzn/EGXJaVsd5aFd7c9wpM6qaTHEgYTydZRrbUcJ4itmP5JE3LqlEd3WhNUYF1bgy8ylLiSI2IVcvWAnf+hiEc2XaREluuBeclIhvVeJLlBQiD2Dun/sOwaFUHILkwIKVWTOsejUSjjoDTjDHeNJwJCaY3NjLeBx91GF6tUqUqEJuWaQ6DQMEVjGhbYgVAl7le5aZqm4LWxjvvtTt0bBHOhegYa9tOA/dCGWmdNMZaYa05AOd5qbAXsjOGB6/HuZ3nuVZBCCqx46CE8GPgrPBBcV7FkABsJXqj0XsTc3ow6klRFFLadrsFqCm0PWC8nj4454+A86Kw1jNa1RuotjSaR4FRbAB7bUwI/u/j8KJ/PnbxzONCO9f2LYU167esZ1J0iJQDVwjGCCmj/VzreGvQWIhFrc2LYUVcutbXdF13FVd8hGGTye1sNnu4nz0+PE6ns/l8vnh6WiwWz3ut9kr3ymIk4q/2KsuSEPIbb/Uz8Mjdi9kAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d185f859eca5826bae59564fff586d6a/8ac56/image-20240110120644240.webp 240w,
/static/d185f859eca5826bae59564fff586d6a/d3be9/image-20240110120644240.webp 480w,
/static/d185f859eca5826bae59564fff586d6a/53666/image-20240110120644240.webp 743w"
              sizes="(max-width: 743px) 100vw, 743px"
              type="image/webp"
            />
          <source
            srcset="/static/d185f859eca5826bae59564fff586d6a/8ff5a/image-20240110120644240.png 240w,
/static/d185f859eca5826bae59564fff586d6a/e85cb/image-20240110120644240.png 480w,
/static/d185f859eca5826bae59564fff586d6a/f2793/image-20240110120644240.png 743w"
            sizes="(max-width: 743px) 100vw, 743px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d185f859eca5826bae59564fff586d6a/f2793/image-20240110120644240.png"
            alt="image-20240110120644240"
            title="image-20240110120644240"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>実際に Flag 文字列に対して何らかの処理を行うのはこの 0x1337 で呼び出されている syscall 関数のようですが、実際にこの syscall が何を行うのかこのままではわかりません。</p>
<p>0x1337 は一般的な Linux の syscall ではなさそうなので、どこかで独自に定義されている可能性が高そうです。</p>
<p>しかし、問題バイナリの Dockerfile を見る限り、実行に使用しているイメージは ubuntu 公式のものであり、特にカーネルモジュールなどを追加している様子はありません。</p>
<p>そこで少々悩みましたが、どうやら実際に syscall 0x1337 で呼び出される処理を実行しているわけではなさそうなことがわかりました。</p>
<p>システムコール呼び出し時の処理をプログラム側から操作するアプローチとしては seccomp があるようです。</p>
<p>Linux カーネルには、バージョン 2.6.12 から seccomp という仕組みが導入されています。</p>
<p>seccomp はアプリケーションが実行できるシステムコールを制限することによりセキュリティを高める機能です。</p>
<p>seccomp では、プロセスが実行可能なシステムコールをホワイトリスト形式で制御します。</p>
<p>この仕組みにより、プロセスでシステムコールが発行されると、seccomp のフィルタを通して実行可否の決定などのアクションが実行されるようです。</p>
<p>詳しくは以下の記事が参考になりました。</p>
<p>参考：<a href="https://zenn.dev/yurayake/articles/432d6b1b02727c" target="_blank" rel="nofollow noopener noreferrer">seccompを利用し、自プロセスから発行されるシステムコールを制限する</a></p>
<p>上記の記事の通り、seccomp フィルタは prctl で追加できます。</p>
<p>この記事で使用しているプログラムでは、seccomp-tools dump ツールを使うことで seccomp フィルタを一覧できたようですが、今回の問題バイナリではこの方法は使用できませんでした。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> gcc ruby-dev -y
<span class="token function">sudo</span> gem <span class="token function">install</span> seccomp-tool
seccomp-tools dump ./a.out</code></pre></div>
<p>参考：<a href="https://github.com/david942j/seccomp-tools" target="_blank" rel="nofollow noopener noreferrer">david942j/seccomp-tools: Provide powerful tools for seccomp analysis</a></p>
<p>どのような seccomp フィルタが登録されているかを調べるため、バイナリを解析していきます。</p>
<p>Ghidra でデコンパイルした entry 関数のコードから _<em>libc</em>start_main の呼び出しを見てみると、init と fini に当たる第 4 引数と第 5 引数に何かが定義されていることがわかります。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">FUN_555555400a20</span><span class="token punctuation">(</span>undefined8 param_1<span class="token punctuation">,</span>undefined8 param_2<span class="token punctuation">,</span>undefined8 param_3<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  undefined8 unaff_retaddr<span class="token punctuation">;</span>
  undefined auStack_8 <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">__libc_start_main</span><span class="token punctuation">(</span>main<span class="token punctuation">,</span>unaff_retaddr<span class="token punctuation">,</span><span class="token operator">&amp;</span>stack0x00000008<span class="token punctuation">,</span>FUN_555555400b30<span class="token punctuation">,</span>FUN_555555400ba0<span class="token punctuation">,</span>param_3<span class="token punctuation">,</span>
                    auStack_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">do</span> <span class="token punctuation">{</span>
                    <span class="token comment">/* WARNING: Do nothing block with infinite loop */</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span> true <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p> _<em>libc</em>start_main における init は初期化関数を指し、init が定義されている場合には main 関数の実行前に何らかの処理が呼び出されます。一般には、グローバル変数の初期化などがここで実行されるようです。</p>
<p>参考：<a href="https://refspecs.linuxbase.org/LSB_3.1.1/LSB-Core-generic/LSB-Core-generic/baselib---libc-start-main-.html" target="_blank" rel="nofollow noopener noreferrer">_<em>libc</em>start_main</a></p>
<p>Ghidra 上では、init に指定されている関数は _<em>DT</em>INIT_ARRAY として参照できました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1e1e387037a05df63afe072d596abb8e/1f038/image-20240113221338303.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 32.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABK0lEQVQoz12RiW7DIBBE/f/fV7VqpTSqEt82NtiYY4HpQpSkzUrD+IDHsFRCEZYtYpYOqybIIxQpk8XfVeL3BO2Buumg1AFrAcPyNsK6yB74WwSxVy0vuM6Ez9OG76vBuba4TIRGRlZCp4CWvWVv+hly3UDBgZFIKYAHpJiK56o6BjZLwM/gUa+hgDKgXgnnecdbO+C9G/HVS9TthGlS2PaBE5/hSZdUZAiBAjKyahZCx5BOBoxLwsQbjDtry1CDj77HaRS4CIOmm7ApfQtzC/SvEv+orCWY3C9pQdzLaBIiH8EHKnLBw5Ll5wghFnjvHotfVY6cB/IBS79DM/RQDHY5/nPSPY4Qgi/hCfzr9yrAwLub3IcYHxMoEvdJ86X0EHrB4Y6S0L0AX+sXm+Qget0kRo4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/1e1e387037a05df63afe072d596abb8e/8ac56/image-20240113221338303.webp 240w,
/static/1e1e387037a05df63afe072d596abb8e/d3be9/image-20240113221338303.webp 480w,
/static/1e1e387037a05df63afe072d596abb8e/e46b2/image-20240113221338303.webp 960w,
/static/1e1e387037a05df63afe072d596abb8e/f992d/image-20240113221338303.webp 1440w,
/static/1e1e387037a05df63afe072d596abb8e/42d7d/image-20240113221338303.webp 1481w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/1e1e387037a05df63afe072d596abb8e/8ff5a/image-20240113221338303.png 240w,
/static/1e1e387037a05df63afe072d596abb8e/e85cb/image-20240113221338303.png 480w,
/static/1e1e387037a05df63afe072d596abb8e/d9199/image-20240113221338303.png 960w,
/static/1e1e387037a05df63afe072d596abb8e/07a9c/image-20240113221338303.png 1440w,
/static/1e1e387037a05df63afe072d596abb8e/1f038/image-20240113221338303.png 1481w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/1e1e387037a05df63afe072d596abb8e/d9199/image-20240113221338303.png"
            alt="image-20240113221338303"
            title="image-20240113221338303"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>ここから、以下の prctl を使用するコードがプログラムの起動時に呼び出されることがわかります。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">init_unkown</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">long</span> lVar1<span class="token punctuation">;</span>
  <span class="token keyword">long</span> in_FS_OFFSET<span class="token punctuation">;</span>
  undefined2 local_48 <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  undefined8 local_40<span class="token punctuation">;</span>
  <span class="token keyword">long</span> local_30<span class="token punctuation">;</span>
  
  local_30 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>in_FS_OFFSET <span class="token operator">+</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  lVar1 <span class="token operator">=</span> <span class="token function">ptrace</span><span class="token punctuation">(</span>PTRACE_TRACEME<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;</span> lVar1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lVar1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">prctl</span><span class="token punctuation">(</span><span class="token number">0x26</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      local_48<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>undefined2<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>undefined8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>DAT_555555602020 <span class="token operator">+</span> lVar1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      local_40 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>undefined8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>PTR_DAT_55555563d560 <span class="token operator">+</span> lVar1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      lVar1 <span class="token operator">=</span> lVar1 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>
      <span class="token function">syscall</span><span class="token punctuation">(</span><span class="token number">0x13d</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>local_48<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>lVar1 <span class="token operator">!=</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>local_30 <span class="token operator">==</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>in_FS_OFFSET <span class="token operator">+</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
                    <span class="token comment">/* WARNING: Subroutine does not return */</span>
  <span class="token function">__stack_chk_fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ここで seccomp のフィルタを登録しているようです。</p>
<p>まず、このプログラムの seccomp フィルタについては実際のコードから判断する限り、while ループ内の <code class="language-text">syscall(0x13d,1,0,local_48);</code> の行で seccomp フィルタを登録していそうなことがわかります。</p>
<p>この 0x13d という ID は調べても何も情報が見つかりませんでしたが、第 4 引数に seccomp フィルタを与えていることから、<code class="language-text">syscall(SYS_seccomp, SECCOMP_SET_MODE_FILTER, 0, &amp;prog)</code> の呼び出しに該当していると推測できます。</p>
<p>参考：<a href="https://man7.org/linux/man-pages/man2/seccomp.2.html" target="_blank" rel="nofollow noopener noreferrer">seccomp(2) - Linux manual page</a></p>
<p>このコードは、while ループの中で 0x40 / 8 回、つまり 8 回呼び出されます。</p>
<p>実際に <code class="language-text">&amp;PTR_DAT_55555563d560</code> のセクションを調べてみると、<code class="language-text">20 00 00 00 ...</code> つまり <code class="language-text">A = sys_number</code> から始まる 8 つのメモリ領域のアドレスがリストされていることを確認できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 433px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1a0b3c36b5a03f0391c3a4a5fb4cf051/55fc0/image-20240114174453793.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 43.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmUlEQVQoz1WRiZKkIBBE/f+fmz0idrZH8aTF9sCrVTwgt4CeiVkiyhKtemQWwY1VePtb4OeHwI8bR8QVboXBe6rBhIaYDHh34u19QEG5WYCQr/gdTfgVTtQzUO+IP8kTYtQI1m3Hczu+Yt01VmWwUGy7cftFXRif/t/22g8z1a8Xlu3ymb6p0yC4rhPnceC6Lth3ozWMAfRFD1pDv+LORxdVNUOICbwY3P44qOfU0NqHXUFVVYjjBGlWIE0StM2GtgXqh8E4eqjaTrCogyIVdnXtQrU98nxAQjnLejpoJigpFKVAFDGCpsjSlIoVGgI+CCilgT14Vyc+bu1/wCSRSNMejHXU1+N+nzzw8VKYkcI8ywjigXVtMM8v4H4iiSVlD5RycaqsQgu1I3AKaVZBWZYIw5BOzAjMnOWmASrhgXaeFhh/syy7xY0gpkMYkw7Mi5FqrWUh6CP7Ajb15i1XBhPN0E5RkeXwm2WnkJR5yx545y/LDcnJ8wKclyjy3FmWkubU+Uv5tGwv4dOyvXkHobkVlEvKdb044D8RJ6sLMyywGQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/1a0b3c36b5a03f0391c3a4a5fb4cf051/8ac56/image-20240114174453793.webp 240w,
/static/1a0b3c36b5a03f0391c3a4a5fb4cf051/aff3a/image-20240114174453793.webp 433w"
              sizes="(max-width: 433px) 100vw, 433px"
              type="image/webp"
            />
          <source
            srcset="/static/1a0b3c36b5a03f0391c3a4a5fb4cf051/8ff5a/image-20240114174453793.png 240w,
/static/1a0b3c36b5a03f0391c3a4a5fb4cf051/55fc0/image-20240114174453793.png 433w"
            sizes="(max-width: 433px) 100vw, 433px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/1a0b3c36b5a03f0391c3a4a5fb4cf051/55fc0/image-20240114174453793.png"
            alt="image-20240114174453793"
            title="image-20240114174453793"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>つまり、このプログラムでは 8 つの seccomp フィルタを起動時に登録していると考えられます。</p>
<p>8 つのフィルタをそれぞれ抜き出して <code class="language-text">seccomp-tools disasm --no-bpf</code> を使用すれば各フィルタを抽出できそうでしたが、終端を特定できず断念しました。</p>
<p>そこで、再度 <code class="language-text">seccomp-tools dump</code> による出力を得るため、このコードを解析していきます。</p>
<p><code class="language-text">seccomp-tools dump</code> では、プログラムを実行し ptrace でアタッチすることで seccomp フィルタを抽出するようです。</p>
<p>前述のコードを見ると、<code class="language-text">ptrace(PTRACE_TRACEME,0);</code> の行でアンチデバッグの機能が追加されています。</p>
<p>つまり、seccomp-tools が ptrace を使用する場合にはこのフィルタ登録の処理がスキップされるために、先ほどの <code class="language-text">seccomp-tools dump</code> によるフィルタの出力が失敗していたと考えられます。</p>
<p>そこで、Ghidra でパッチを当ててこのアンチデバッグ処理部分をすべて無効化しました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 769px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/63e2e7ca423ab1330419bbf01690ff7a/227ba/image-20240113222332408.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+UlEQVQY042Oy06DYBBGef8X6EpN3BjTWutlYaISDKBx0YW3qIUWErUUqG0VChR+OP6lxsvCxEzOfJOZ5GSUS8dEtTQunq+5nbv0GdAN77mbWzwWD9zEV/QKC0vY9HJ7NZd97D9QNobrNAYN1rwtdkSHPdpsvjbZTlp02KXeVO1/oxwEh7TcJvv+MWpmco7O0VTlNDlDrzS04gQTQ+6NOo1Kl/0nv0sJ/ADXcRmN3phOoCohes9YLEqyNOXlKcQbRkzGCUUujxXfLENmKcovFL8WOlI4YxwiRTCbJqSpQIgE3w/lLcbzIsIwJs/Fp2hlFEKQZcsHFvX8ASataxdeHXvNAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/63e2e7ca423ab1330419bbf01690ff7a/8ac56/image-20240113222332408.webp 240w,
/static/63e2e7ca423ab1330419bbf01690ff7a/d3be9/image-20240113222332408.webp 480w,
/static/63e2e7ca423ab1330419bbf01690ff7a/85eee/image-20240113222332408.webp 769w"
              sizes="(max-width: 769px) 100vw, 769px"
              type="image/webp"
            />
          <source
            srcset="/static/63e2e7ca423ab1330419bbf01690ff7a/8ff5a/image-20240113222332408.png 240w,
/static/63e2e7ca423ab1330419bbf01690ff7a/e85cb/image-20240113222332408.png 480w,
/static/63e2e7ca423ab1330419bbf01690ff7a/227ba/image-20240113222332408.png 769w"
            sizes="(max-width: 769px) 100vw, 769px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/63e2e7ca423ab1330419bbf01690ff7a/227ba/image-20240113222332408.png"
            alt="image-20240113222332408"
            title="image-20240113222332408"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>これで、<code class="language-text">seccomp-tools dump</code> コマンドでフィルタをダンプできるようになりました。</p>
<p>フィルタの出力は膨大な量になりましたので、一部のみ記載しています。</p>
<p>概ね以下のような形で、まずシステムコールの ID が 0x1337 であるかをチェックし、その後、特定の値に対して演算を繰り返し、最後に特定の値との比較が行われます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ seccomp-tools dump ./chal_patched

line  CODE  JT   JF      K
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
 0000: 0x20 0x00 0x00 0x00000000  A <span class="token operator">=</span> sys_number
 0001: 0x15 0x01 0x00 0x00001337  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> 0x1337<span class="token punctuation">)</span> goto 0003
 0002: 0x06 0x00 0x00 0x7fff0000  <span class="token builtin class-name">return</span> ALLOW
 0003: 0x03 0x00 0x00 0x0000000b  mem<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> X
 0004: 0x04 0x00 0x00 0x9a0b31d4  A <span class="token operator">+=</span> 0x9a0b31d4
 0005: 0x04 0x00 0x00 0x5245d02a  A <span class="token operator">+=</span> 0x5245d02a
 0006: 0x1c 0x00 0x00 0x00000000  A -<span class="token operator">=</span> X
 0007: 0x04 0x00 0x00 0x7d5a280a  A <span class="token operator">+=</span> 0x7d5a280a
 0008: 0x1c 0x00 0x00 0x00000000  A -<span class="token operator">=</span> X
 0009: 0x24 0x00 0x00 0x000081af  A *<span class="token operator">=</span> 0x81af
 0010: 0x03 0x00 0x00 0x00000003  mem<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> X
**
 <span class="token number">2692</span>: 0x04 0x00 0x00 0xb06bedbc  A <span class="token operator">+=</span> 0xb06bedbc
 <span class="token number">2693</span>: 0x20 0x00 0x00 0x0000001c  A <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">32</span>
 <span class="token number">2694</span>: 0x44 0x00 0x00 0xc7fdf7c2  A <span class="token operator">|</span><span class="token operator">=</span> 0xc7fdf7c2
 <span class="token number">2695</span>: 0x04 0x00 0x00 0x88410078  A <span class="token operator">+=</span> 0x88410078
**
 <span class="token number">3791</span>: 0x60 0x00 0x00 0x0000000f  A <span class="token operator">=</span> mem<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span>
 <span class="token number">3792</span>: 0x15 0x00 0x01 0xd101957e  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">!=</span> <span class="token number">3506541950</span><span class="token punctuation">)</span> goto <span class="token number">3794</span>
 <span class="token number">3793</span>: 0x06 0x00 0x00 0x00050000  <span class="token builtin class-name">return</span> ERRNO<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">3794</span>: 0x06 0x00 0x00 0x00000000  <span class="token builtin class-name">return</span> KILL</code></pre></div>
<p>このチェックに失敗した場合には seccomp にてスレッドが KILL され、成功した場合には True を返しているようです。</p>
<p>いくつかの変数を見ていきます。</p>
<p>まず <code class="language-text">arg[]</code> については、0 から 5 までの添え字を持つ配列変数として扱われていそうです。</p>
<p>これは、<code class="language-text">syscall(0x1337, flg(0), flg(1), flg(2), flg(3), flg(4), flg(5));</code> にて呼び出される Flag 文字を 8 文字ずつ分割した値に該当していると考えられます。</p>
<p>次に A と X ですが、こちらは恐らくレジスタ的に使用される一時変数の可能性が高そうです。</p>
<p>最後に <code class="language-text">mem[]</code> ですが、これは 0 から 15 までの添え字を持つ配列変数です。</p>
<p>最終的にハードコードされた値との比較は、この mem の各要素に対して実行されます。</p>
<p>そのため、何らかの形で入力として受け取った Flag 文字を変換して mem に格納していると予想されます。</p>
<p>実際に行われている処理から判断する限り、この演算自体は Z3 で解読できそうです。</p>
<p>ただし、4000 行近い処理をすべて手動で Z3 に落とし込むのは断念しました。</p>
<p>そこで、Discord で共有されていた Solver を参考にし、この出力から Z3 の制約を自動作成して Flag を取得するプログラムを作成していきます。</p>
<p>まずは以下のコマンドで <code class="language-text">seccomp-tools dump</code> の出力結果から不要な部分を削除します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">seccomp-tools dump ./chal_patched -l <span class="token number">8</span> <span class="token operator">|</span> <span class="token function">grep</span> -Pv <span class="token string">"=======|CODE"</span> <span class="token operator">></span> seccomp_filter.txt</code></pre></div>
<p>次に、各種初期値を与えていきます。</p>
<p>変数 arch については、AUDIT<em>ARCH</em>X86_64 の値を設定します。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>

s <span class="token operator">=</span> Solver<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add_cons</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>And<span class="token punctuation">(</span>v <span class="token operator">></span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v <span class="token operator">&lt;=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'~'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

mem <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">16</span>
X <span class="token operator">=</span> <span class="token number">0</span>
A <span class="token operator">=</span> <span class="token number">0</span>
sys_number <span class="token operator">=</span> <span class="token number">0x1337</span>
arch <span class="token operator">=</span> <span class="token number">0xc000003e</span> <span class="token comment"># AUDIT_ARCH_X86_64</span>

<span class="token comment"># bpf is 32 bits</span>
args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>       <span class="token comment"># low DWORD</span>
args2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token comment"># hight DWORDs</span></code></pre></div>
<p>次の箇所では、arg と arg_2 を 0 から 5 までの 6 つ定義します。</p>
<p>さらに、それぞれを 4 バイトに分割し、1 バイトごとに Printable ASCII の制約を付与します。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># args is lower DWORD</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v <span class="token operator">=</span> BitVec<span class="token punctuation">(</span><span class="token string">"arg%d"</span><span class="token operator">%</span>x<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
    args<span class="token punctuation">.</span>append<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># args2 is upper DWORD</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v <span class="token operator">=</span> BitVec<span class="token punctuation">(</span><span class="token string">"arg_2%d"</span><span class="token operator">%</span>x<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
    args2<span class="token punctuation">.</span>append<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>これによって、各引数(= Flag が 8 文字ごとに格納されている)の変数を定義することができます。</p>
<p>ここから、取得した seccomp_filter.txt の処理を一行ずつ追っていきます。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"seccomp_filter.txt"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> fp<span class="token punctuation">:</span>
        i <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token comment"># 命令の抽出</span>
        ins <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># print(line)</span>
        <span class="token comment"># print(ins)</span>

        <span class="token comment"># Return 文を無視する</span>
        <span class="token keyword">if</span> ins<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"return "</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>

        <span class="token comment"># args[0] >> 32 のような演算を特定する</span>
        <span class="token comment"># これによって、上位 32 bit 文の文字を取得し、変数名をベクタ名に合わせる</span>
        <span class="token keyword">elif</span> <span class="token string">" >> "</span> <span class="token keyword">in</span> ins<span class="token punctuation">:</span>
            ins <span class="token operator">=</span> ins<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token comment"># A = args[x]</span>
            ins <span class="token operator">=</span> ins<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"args"</span><span class="token punctuation">,</span> <span class="token string">"args2"</span><span class="token punctuation">)</span>

        <span class="token comment"># if (A == 0x1337) goto 0003 のような if 文の処理を制約に追加する</span>
        <span class="token keyword">if</span> ins<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"if ("</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            val <span class="token operator">=</span> ins<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># if (A == val)</span>
            <span class="token keyword">if</span> val<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>val<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>

            s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>A <span class="token operator">==</span> val<span class="token punctuation">)</span>
            <span class="token keyword">continue</span>

        <span class="token comment"># A ^= X など、そのまま Python コードとして実行可能な行を実行する</span>
        <span class="token keyword">exec</span><span class="token punctuation">(</span>ins<span class="token punctuation">)</span>

        <span class="token comment"># 32 bit int を維持</span>
        A <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token number">0xffffffff</span></code></pre></div>
<p>最後に、Z3 で制約を解くことで、正しい Flag 文字が <code class="language-text">1f_0nly_s3cc0mp_c0ulD_us3_4ll_eBPF_1nstruct10ns!</code> であることを特定できます。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">assert</span> s<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> sat
model <span class="token operator">=</span> s<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span>
out <span class="token operator">=</span> <span class="token string">b''</span>

<span class="token comment"># 各 arg と atg_2 の文字を連結して出力</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v <span class="token operator">=</span> model<span class="token punctuation">[</span>args<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>as_long<span class="token punctuation">(</span><span class="token punctuation">)</span>
    out <span class="token operator">+=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    v <span class="token operator">=</span> model<span class="token punctuation">[</span>args2<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>as_long<span class="token punctuation">(</span><span class="token punctuation">)</span>
    out <span class="token operator">+=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span></code></pre></div>
<p>Solver 全文は以下。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># seccomp-tools dump ./chal_patched -l 8 > seccomp_filter.txt &amp;&amp; sed -i '1,2d' seccomp_filter.txt</span>
<span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>

s <span class="token operator">=</span> Solver<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add_cons</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>And<span class="token punctuation">(</span>v <span class="token operator">></span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v <span class="token operator">&lt;=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'~'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

mem <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">16</span>
X <span class="token operator">=</span> <span class="token number">0</span>
A <span class="token operator">=</span> <span class="token number">0</span>
sys_number <span class="token operator">=</span> <span class="token number">0x1337</span>
arch <span class="token operator">=</span> <span class="token number">0xc000003e</span> <span class="token comment"># AUDIT_ARCH_X86_64</span>

<span class="token comment"># bpf is 32 bits</span>
args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>       <span class="token comment"># low DWORD</span>
args2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token comment"># hight DWORDs</span>


<span class="token comment"># args is lower DWORD</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v <span class="token operator">=</span> BitVec<span class="token punctuation">(</span><span class="token string">"arg%d"</span><span class="token operator">%</span>x<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
    args<span class="token punctuation">.</span>append<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># args2 is upper DWORD</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v <span class="token operator">=</span> BitVec<span class="token punctuation">(</span><span class="token string">"arg_2%d"</span><span class="token operator">%</span>x<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
    args2<span class="token punctuation">.</span>append<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add_cons<span class="token punctuation">(</span>Extract<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>


i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"seccomp_filter.txt"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> fp<span class="token punctuation">:</span>
        i <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token comment"># 命令の抽出</span>
        ins <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># print(line)</span>
        <span class="token comment"># print(ins)</span>

        <span class="token comment"># Return 文を無視する</span>
        <span class="token keyword">if</span> ins<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"return "</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>

        <span class="token comment"># args[0] >> 32 のような演算を特定する</span>
        <span class="token comment"># これによって、上位 32 bit 文の文字を取得し、変数名をベクタ名に合わせる</span>
        <span class="token keyword">elif</span> <span class="token string">" >> "</span> <span class="token keyword">in</span> ins<span class="token punctuation">:</span>
            ins <span class="token operator">=</span> ins<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token comment"># A = args[x]</span>
            ins <span class="token operator">=</span> ins<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"args"</span><span class="token punctuation">,</span> <span class="token string">"args2"</span><span class="token punctuation">)</span>

        <span class="token comment"># if (A == 0x1337) goto 0003 のような if 文の処理を制約に追加する</span>
        <span class="token keyword">if</span> ins<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"if ("</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            val <span class="token operator">=</span> ins<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># if (A == val)</span>
            <span class="token keyword">if</span> val<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>val<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>

            s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>A <span class="token operator">==</span> val<span class="token punctuation">)</span>
            <span class="token keyword">continue</span>

        <span class="token comment"># A ^= X など、そのまま Python コードとして実行可能な行を実行する</span>
        <span class="token keyword">exec</span><span class="token punctuation">(</span>ins<span class="token punctuation">)</span>

        <span class="token comment"># 32 bit int を維持</span>
        A <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token number">0xffffffff</span>       

<span class="token keyword">assert</span> s<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> sat
model <span class="token operator">=</span> s<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span>
out <span class="token operator">=</span> <span class="token string">b''</span>

<span class="token comment"># 各 arg と atg_2 の文字を連結して出力</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v <span class="token operator">=</span> model<span class="token punctuation">[</span>args<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>as_long<span class="token punctuation">(</span><span class="token punctuation">)</span>
    out <span class="token operator">+=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    v <span class="token operator">=</span> model<span class="token punctuation">[</span>args2<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>as_long<span class="token punctuation">(</span><span class="token punctuation">)</span>
    out <span class="token operator">+=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span></code></pre></div>
<h2 id="not-just-mediaforensic" style="position:relative;"><a href="#not-just-mediaforensic" aria-label="not just mediaforensic permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Not Just Media(Forensic)</h2>
<blockquote>
<p>I downloaded a video from the internet, but I think I got the wrong subtitles.</p>
<p>Note: The flag is all lowercase.</p>
</blockquote>
<p>問題バイナリとして受け取った mkv を mkvinfo で解析します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ mkvinfo chal.mkv
+ EBML <span class="token function">head</span>
<span class="token operator">|</span>+ EBML version: <span class="token number">1</span>
<span class="token operator">|</span>+ EBML <span class="token builtin class-name">read</span> version: <span class="token number">1</span>
<span class="token operator">|</span>+ Maximum EBML ID length: <span class="token number">4</span>
<span class="token operator">|</span>+ Maximum EBML size length: <span class="token number">8</span>
<span class="token operator">|</span>+ Document type: matroska
<span class="token operator">|</span>+ Document <span class="token builtin class-name">type</span> version: <span class="token number">4</span>
<span class="token operator">|</span>+ Document <span class="token builtin class-name">type</span> <span class="token builtin class-name">read</span> version: <span class="token number">2</span>
+ Segment: size <span class="token number">25689323</span>
<span class="token operator">|</span>+ Seek <span class="token function">head</span> <span class="token punctuation">(</span>subentries will be skipped<span class="token punctuation">)</span>
<span class="token operator">|</span>+ EBML void: size <span class="token number">4012</span>
<span class="token operator">|</span>+ Segment information
<span class="token operator">|</span> + Timestamp scale: <span class="token number">1000000</span>
<span class="token operator">|</span> + Multiplexing application: libebml v1.4.4 + libmatroska v1.7.1
<span class="token operator">|</span> + Writing application: mkvmerge v80.0 <span class="token punctuation">(</span><span class="token string">'Roundabout'</span><span class="token punctuation">)</span> <span class="token number">64</span>-bit
<span class="token operator">|</span> + Duration: 00:02:11.674000000
<span class="token operator">|</span> + Date: <span class="token number">2024</span>-01-05 00:28:38 UTC
<span class="token operator">|</span> + Segment <span class="token environment constant">UID</span><span class="token builtin class-name">:</span> 0x0b 0xea 0x43 0x59 0xc7 0xd0 0x77 0xd9 0x8a 0xaf 0x19 0x68 0x93 0x40 0xd7 0xe4
<span class="token operator">|</span>+ Tracks
<span class="token operator">|</span> + Track
<span class="token operator">|</span>  + Track number: <span class="token number">1</span> <span class="token punctuation">(</span>track ID <span class="token keyword">for</span> mkvmerge <span class="token operator">&amp;</span> mkvextract: <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token operator">|</span>  + Track <span class="token environment constant">UID</span><span class="token builtin class-name">:</span> <span class="token number">15645917742896964978</span>
<span class="token operator">|</span>  + Track type: video
<span class="token operator">|</span>  + <span class="token string">"Lacing"</span> flag: <span class="token number">0</span>
<span class="token operator">|</span>  + Language: und
<span class="token operator">|</span>  + Codec ID: V_MPEG4/ISO/AVC
<span class="token operator">|</span>  + Codec<span class="token string">'s private data: size 51 (H.264 profile: High @L3.2)
|  + Default duration: 00:00:00.016666666 (60.000 frames/fields per second for a video track)
|  + Language (IETF BCP 47): und
|  + Video track
|   + Pixel width: 1280
|   + Pixel height: 720
|   + Display width: 1280
|   + Display height: 720
| + Track
|  + Track number: 2 (track ID for mkvmerge &amp; mkvextract: 1)
|  + Track UID: 516687677308344442
|  + Track type: audio
|  + Language: und
|  + Codec ID: A_AAC
|  + Codec'</span>s private data: size <span class="token number">5</span>
<span class="token operator">|</span>  + Default duration: 00:00:00.023219954 <span class="token punctuation">(</span><span class="token number">43.066</span> frames/fields per second <span class="token keyword">for</span> a video track<span class="token punctuation">)</span>
<span class="token operator">|</span>  + Language <span class="token punctuation">(</span>IETF BCP <span class="token number">47</span><span class="token punctuation">)</span>: und
<span class="token operator">|</span>  + Audio track
<span class="token operator">|</span>   + Sampling frequency: <span class="token number">44100</span>
<span class="token operator">|</span>   + Channels: <span class="token number">2</span>
<span class="token operator">|</span> + Track
<span class="token operator">|</span>  + Track number: <span class="token number">3</span> <span class="token punctuation">(</span>track ID <span class="token keyword">for</span> mkvmerge <span class="token operator">&amp;</span> mkvextract: <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">|</span>  + Track <span class="token environment constant">UID</span><span class="token builtin class-name">:</span> <span class="token number">4321065271376252327</span>
<span class="token operator">|</span>  + Track type: subtitles
<span class="token operator">|</span>  + <span class="token string">"Forced display"</span> flag: <span class="token number">1</span>
<span class="token operator">|</span>  + <span class="token string">"Lacing"</span> flag: <span class="token number">0</span>
<span class="token operator">|</span>  + Language: und
<span class="token operator">|</span>  + Codec ID: S_TEXT/ASS
<span class="token operator">|</span>  + Codec's private data: size <span class="token number">965</span>
<span class="token operator">|</span>  + Language <span class="token punctuation">(</span>IETF BCP <span class="token number">47</span><span class="token punctuation">)</span>: und
<span class="token operator">|</span>+ EBML void: size <span class="token number">1172</span>
<span class="token operator">|</span>+ Attachments
<span class="token operator">|</span> + Attached
<span class="token operator">|</span>  + File name: NotoSansTC-Regular_0.ttf
<span class="token operator">|</span>  + MIME type: font/ttf
<span class="token operator">|</span>  + File data: size <span class="token number">7110560</span>
<span class="token operator">|</span>  + File <span class="token environment constant">UID</span><span class="token builtin class-name">:</span> <span class="token number">13897746459734659379</span>
<span class="token operator">|</span>  + File description: Imported font from Untitled.ass
<span class="token operator">|</span> + Attached
<span class="token operator">|</span>  + File name: FakeFont_0.ttf
<span class="token operator">|</span>  + MIME type: font/ttf
<span class="token operator">|</span>  + File data: size <span class="token number">64304</span>
<span class="token operator">|</span>  + File <span class="token environment constant">UID</span><span class="token builtin class-name">:</span> <span class="token number">13557627962983747543</span>
<span class="token operator">|</span>  + File description: Imported font from Untitled.ass
<span class="token operator">|</span> + Attached
<span class="token operator">|</span>  + File name: NotoSans-Regular_0.ttf
<span class="token operator">|</span>  + MIME type: font/ttf
<span class="token operator">|</span>  + File data: size <span class="token number">582748</span>
<span class="token operator">|</span>  + File <span class="token environment constant">UID</span><span class="token builtin class-name">:</span> <span class="token number">7918181187782517176</span>
<span class="token operator">|</span>  + File description: Imported font from Untitled.ass
<span class="token operator">|</span>+ Cluster</code></pre></div>
<p>すると、このファイルには動画と音楽の他に、<code class="language-text">我們歡迎您接受一生中最大的挑戰，即嘗試理解這段文字的含義</code> という文字を表示する字幕設定が埋め込まれていることがわかりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/0a8411d674f4d77fc1aee82973632062/19a6b/image-20240106154348057.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 52.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsklEQVQoz51T11ICUQzdN7AgoCPNSi8iLNvYBZYiSJMqzsj//8gxybr7qKMPmeTmJucmJ7nKoOnCLdowUxasjAUz08akNMBBm2FZHWJWcjEr9jAlWVYGmOQc9NItdBINdJNNsZ3rBty0BjNWg7J1lphUXLRTOpy0ASupw06o6Gc0uCTGRQXNkzz0izJaZ0URM1aFEa2QzxOOYZ92XoJytNf4MJY46HNMC12YFKieFvAcyqIRzgmYSDgf2OyXu28JznSnHDtbbBoTaqUDK14TJwP+V5SDvpDKWlSu/4r3ej44c6Bf3a+ACyKaAeflPkYPlnDCfAg31L4WKf2twn1rhndtjk/i8p145EH0Ut7kuilVJufz+aOEPK281Ybo3+jeGhCAHikH1fFkeYLMrRGtwrp8EjvQcU/zo/ZVXXKU1dNI9o01t71TpyJ72sNt81Wq35Fme/M8xro+liGuyeY8pszP5e6U0b2F8aMtVY6zDgV5y7uqv8hCr0kvKJgB+X54Z+I13xG+GWBwa5DflqEyNVIhJ3DrDMCAMiT6IWxzVXzvnYcE1hXQfkYnrlX5Lf4WsP4ClTBLs3jjmmAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/0a8411d674f4d77fc1aee82973632062/8ac56/image-20240106154348057.webp 240w,
/static/0a8411d674f4d77fc1aee82973632062/d3be9/image-20240106154348057.webp 480w,
/static/0a8411d674f4d77fc1aee82973632062/e46b2/image-20240106154348057.webp 960w,
/static/0a8411d674f4d77fc1aee82973632062/812c2/image-20240106154348057.webp 1191w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/0a8411d674f4d77fc1aee82973632062/8ff5a/image-20240106154348057.png 240w,
/static/0a8411d674f4d77fc1aee82973632062/e85cb/image-20240106154348057.png 480w,
/static/0a8411d674f4d77fc1aee82973632062/d9199/image-20240106154348057.png 960w,
/static/0a8411d674f4d77fc1aee82973632062/19a6b/image-20240106154348057.png 1191w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/0a8411d674f4d77fc1aee82973632062/d9199/image-20240106154348057.png"
            alt="image-20240106154348057"
            title="image-20240106154348057"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>しかし、この動画を再生しても字幕は正しく表示されません。</p>
<p>さらに mkvinfo の結果を解析すると、Attachments に FakeFont_0.ttf という怪しげなフォントデータが埋め込まれていることがわかります。</p>
<p>以下のコマンドでフォントデータのみを抜き出しました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">mkvextract attachments chal.mkv <span class="token number">2</span>:FakeFont_0.ttf</code></pre></div>
<p>試しに、<code class="language-text">我們歡迎您接受一生中最大的挑戰，即嘗試理解這段文字的含義</code> という文字列を抽出したフォントデータでレンダリングしてみたところ、正しい Flag が表示されました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/dae8c9c1f23d2c8322bb26e67d25debe/e088a/image-20240106161119964.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 5.416666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAOklEQVQI13XB0QnAMAhAwe4/W0AJgoqSv6zhKx2gd885BzNDVYkIMhMRobupKtydtRZ7b+69fGaGPy9ZpEoLMW18agAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/dae8c9c1f23d2c8322bb26e67d25debe/8ac56/image-20240106161119964.webp 240w,
/static/dae8c9c1f23d2c8322bb26e67d25debe/d3be9/image-20240106161119964.webp 480w,
/static/dae8c9c1f23d2c8322bb26e67d25debe/e46b2/image-20240106161119964.webp 960w,
/static/dae8c9c1f23d2c8322bb26e67d25debe/3a6ad/image-20240106161119964.webp 1015w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/dae8c9c1f23d2c8322bb26e67d25debe/8ff5a/image-20240106161119964.png 240w,
/static/dae8c9c1f23d2c8322bb26e67d25debe/e85cb/image-20240106161119964.png 480w,
/static/dae8c9c1f23d2c8322bb26e67d25debe/d9199/image-20240106161119964.png 960w,
/static/dae8c9c1f23d2c8322bb26e67d25debe/e088a/image-20240106161119964.png 1015w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/dae8c9c1f23d2c8322bb26e67d25debe/d9199/image-20240106161119964.png"
            alt="image-20240106161119964"
            title="image-20240106161119964"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>フォントのレンダリングには以下のスクリプトを使用しました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw<span class="token punctuation">,</span> ImageFont

font_file <span class="token operator">=</span> <span class="token string">'./FakeFont_0.ttf'</span>
font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span>font_file<span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>

image <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>image<span class="token punctuation">)</span>

text <span class="token operator">=</span> <span class="token string">"我們歡迎您接受一生中最大的挑戰，即嘗試理解這段文字的含義"</span>
draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> font<span class="token operator">=</span>font<span class="token punctuation">)</span>

image_path <span class="token operator">=</span> <span class="token string">'./flag.png'</span>
image<span class="token punctuation">.</span>save<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span></code></pre></div>
<h2 id="wheres-skatnetwork" style="position:relative;"><a href="#wheres-skatnetwork" aria-label="wheres skatnetwork permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Where’s skat?(Network)</h2>
<blockquote>
<p>While traveling over the holidays, I was doing some casual wardriving (as I often do). Can you use my capture to find where I went?</p>
<p>Note: the flag is irisctf{the<em>location}, where the</em>location is the full name of my destination location, not the street address. For example, irisctf{Washington_Monument}. Note that the flag is not case sensitive.</p>
</blockquote>
<p>問題バイナリとして与えられた pcap ファイルを解析すると、以下のような SSID を持つアクセスポイントと通信していることがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 885px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ce322894856d93b7ad54d06b94195bc7/efc66/image-20240106202322056.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 35.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABU0lEQVQoz22Py07DMBBF8yuABKh5IFLl6URJg5M4duy0aoVALKASLOD/95exgW7oYuSxx+f42ms/DO6fWkSPNS7me1zpNS51DHaUGL8OaN41+s892NsE9ioQ0r34uXX7+qioJJIXTmxM3BrexEfUaYlinSK8XuHuNkB042NoORYxw863ykDSqkeJOmPoqgaaZos0MEK5WUhMRKwnJnq5YsiLHH7gI4xCBGGAfhiwbBcIOWE2GuM0Qs0KrK7QtA0k9doYKo00S+ETExDrjeOIsiyRZRl8n4QhCQMS9j2MNrAPzvMMe09J6e5uNhsopU5VFIVjLOsJIcAYJczzf0JNwskJFa3CwVmegXMOQ+mkpJRaY6bzP+4kPJvQ/AgnSjYMPQkkqoq+3DSut8n3+wOsw/dXvwkJsJHPCXe7nQOt1H6z6zokSeIC2N6ecd7jgfo4jh33DVwe9BF5rWlVAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/ce322894856d93b7ad54d06b94195bc7/8ac56/image-20240106202322056.webp 240w,
/static/ce322894856d93b7ad54d06b94195bc7/d3be9/image-20240106202322056.webp 480w,
/static/ce322894856d93b7ad54d06b94195bc7/dad35/image-20240106202322056.webp 885w"
              sizes="(max-width: 885px) 100vw, 885px"
              type="image/webp"
            />
          <source
            srcset="/static/ce322894856d93b7ad54d06b94195bc7/8ff5a/image-20240106202322056.png 240w,
/static/ce322894856d93b7ad54d06b94195bc7/e85cb/image-20240106202322056.png 480w,
/static/ce322894856d93b7ad54d06b94195bc7/efc66/image-20240106202322056.png 885w"
            sizes="(max-width: 885px) 100vw, 885px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/ce322894856d93b7ad54d06b94195bc7/efc66/image-20240106202322056.png"
            alt="image-20240106202322056"
            title="image-20240106202322056"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>これらのアクセスポイントを Wigle で調べてみたところ、そのアクセスポイントが存在する座標を特定できました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/56e73c4cb9b2bee798772411b40b7580/6fcb6/image-20240106202338335.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 41.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUElEQVQoz21R226CUBA8//8xTWurXIwPaiq0FK9PGMGAoIIgeIk+Tp1tMI3xYTJn9szu2d2j0jTFdrtFkiQoyxJVVQl4/o+qKsUTxzF2ux2Ox6MwQT+ZPsVip9MJ1+sVWZbhfD7jcrmgKArs9/s7aI7CEIvFQooyj2ChPM/BxtI0g+KBASaw4OFweNohwQ6Xy6UwwVzG6wfJii/8VU+lK3bHC45UF+cEZMbpKYpcuG6kXhOhPM/DfO4hCAL4vi/jPOvuMbHWjx6l6QZe3j7w2nhHs9lEo9GAYRhot9tom6ZoXdNFdzodtFotAbVu6jBvHk3TRJPVaDLD5/cIznCC2XSKwWCA4XAI13VhWRZ6vR7cHxfT251t26IdxxHdtbqwv2yJj8dj9Pt9qDjZIAhjRHGCzWZzXzpHD2+/ylXUvxpFkejVaiXaD32J0bderyX3F1MgQ9jiLPBnAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/56e73c4cb9b2bee798772411b40b7580/8ac56/image-20240106202338335.webp 240w,
/static/56e73c4cb9b2bee798772411b40b7580/d3be9/image-20240106202338335.webp 480w,
/static/56e73c4cb9b2bee798772411b40b7580/e46b2/image-20240106202338335.webp 960w,
/static/56e73c4cb9b2bee798772411b40b7580/f992d/image-20240106202338335.webp 1440w,
/static/56e73c4cb9b2bee798772411b40b7580/dff8d/image-20240106202338335.webp 1523w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/56e73c4cb9b2bee798772411b40b7580/8ff5a/image-20240106202338335.png 240w,
/static/56e73c4cb9b2bee798772411b40b7580/e85cb/image-20240106202338335.png 480w,
/static/56e73c4cb9b2bee798772411b40b7580/d9199/image-20240106202338335.png 960w,
/static/56e73c4cb9b2bee798772411b40b7580/07a9c/image-20240106202338335.png 1440w,
/static/56e73c4cb9b2bee798772411b40b7580/6fcb6/image-20240106202338335.png 1523w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/56e73c4cb9b2bee798772411b40b7580/d9199/image-20240106202338335.png"
            alt="image-20240106202338335"
            title="image-20240106202338335"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>この座標を Google Map で調べた結果、<code class="language-text">irisctf{Los_Angeles_Union_Station}</code> が正解の Flag になることがわかりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/dd46e58aa58a6630c939be1dcfd184f0/58fee/image-20240106202348174.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACkklEQVQoz02TOW8TURSF/WuoEBIFAkUUCNHQABWIFokOiZ4KCYmCAhAVJSUlAgQkoGASEhYntpPYcRbHW5wZJ559X/1xZ9LwpKOZufPmvHvPOVOZKIcoioKmTTEMnTzPKFbbG/LFqNPU+nyqNlnvjAjDEM/z+FnfRZ0aMHMYjIYsr+8QyzvLcqjsqTFxkhEmlAjiXJ5nNI57LEwbbKgDFn912B7qpElcElZrHTzfI48N0tCUmo/tuCUqQy0nzQqiGbaf44QzkhRq3S7vfq/xvdbmQ7XO+vaAnd6Yrb0hq8198jRgFuskoU0YBNi2g+f6VJI4LAtRFJYjBXI/yzLWugdUxy2Wmh3eL9bpjhVWt9vMrzb5s3VAEvlEfkHoyndRSXikHlPRDAvTNKVglyjaL9ZAPWGx3uZ9dZ2FlS10y8KVbmpbXRrbPQzZu69MhdAQOELq4vgysuOF2NapDnmelyhNCQbU7QOWRK/Fv21WGrv83ezy8UeD0VglSQx62pEcNIHMIjUOifttKqY4Y8npWXZKlM/kOoNNvcdyv8W31Ra98TFRHKGc6DKydGs6YohADCk0TCKPxJkSTkdUYnHA933SNOH/teON+N3fZX5ps4zIVPeYTC2+/moRiMNpZBLJmEEQiQeheBDhuDYVVTmSohBKV0UUJsoI37Fo6H0Wmi2+in6OyOGKNHsDlW9/OoS+TR5pEhld8mcJ3BKeI4Q3r17i9cunPH/xjCePH/Hg/m3evnnFxt4hH35s8Hm5KR0FhRgSmRG1Vk8088hCjTg4JStMSWV0t8jh3NkzXL98kWtz53l47y5XLpzjzq0bOBKDhZUNltY6nGgmw0NV/pAdOgdj4XaFQCvJfD8sJTMtm8mxzj+nZiFyzNOp0AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/dd46e58aa58a6630c939be1dcfd184f0/8ac56/image-20240106202348174.webp 240w,
/static/dd46e58aa58a6630c939be1dcfd184f0/d3be9/image-20240106202348174.webp 480w,
/static/dd46e58aa58a6630c939be1dcfd184f0/e46b2/image-20240106202348174.webp 960w,
/static/dd46e58aa58a6630c939be1dcfd184f0/42749/image-20240106202348174.webp 1051w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/dd46e58aa58a6630c939be1dcfd184f0/8ff5a/image-20240106202348174.png 240w,
/static/dd46e58aa58a6630c939be1dcfd184f0/e85cb/image-20240106202348174.png 480w,
/static/dd46e58aa58a6630c939be1dcfd184f0/d9199/image-20240106202348174.png 960w,
/static/dd46e58aa58a6630c939be1dcfd184f0/58fee/image-20240106202348174.png 1051w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/dd46e58aa58a6630c939be1dcfd184f0/d9199/image-20240106202348174.png"
            alt="image-20240106202348174"
            title="image-20240106202348174"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2 id="まとめ" style="position:relative;"><a href="#%E3%81%BE%E3%81%A8%E3%82%81" aria-label="まとめ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>まとめ</h2>
<p>新年初の CTF でしたが、新しい学びがありとても楽しかったです。</p>
<p>最近は何かと eBPF に触れる機会が多い気がするので、Linux の低レイヤ周りももっと勉強していかないとなという感じです。</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Jan 13, 2024</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/rev/">Rev</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/forensic/">Forensic</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたいCTF Player(Team: 0nePadding)。WinDbgとYARAが好き。OSCP / CISSP / AtCoder 緑 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/kash1064" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ctf-irisctf-2024";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-e02f8e389a3ee69c0504.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-76f2006942127b3c7274.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-70ba56c0f46525baa629.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-d19905e5c8fc953958f1.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-6ba68ef37e264f701345.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-0faa242d92f89b71e668.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-e02f8e389a3ee69c0504.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-dc4461458952c198375d.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-a3c0f166cb4b802ff58f.js" async=""></script></body></html>