<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e71379dda153709d1a9a.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.625rem;margin:.3125rem 0;border:1px solid #999;border-radius:.3125rem}.Sidebar-module--search-container--17C6F{position:relative}.Sidebar-module--search-container-input--27Tw4{width:100%}.Sidebar-module--search-container-submit--WwtLg{position:absolute;width:2.375rem;height:2.375rem;top:calc(50% - 19px);right:0;border:3px solid #999;border-radius:0 .25rem .25rem 0;background:#999}.Sidebar-module--search-container-submit--WwtLg:before{position:absolute;content:"";width:.9375rem;height:.9375rem;top:calc(50% - 9px);left:calc(50% - 9px);border-radius:50%;box-shadow:0 0 0 2px #fff}.Sidebar-module--search-container-submit--WwtLg:after{position:absolute;content:"";width:.5rem;height:.375rem;top:calc(50% + 6px);left:calc(50% + 2px);border-top:2px solid #fff;transform:rotate(45deg)}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">UIUCTF 2023 Writeup - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content="UIUCTF 2023 の Writeup です。"/><meta data-react-helmet="true" property="og:site_name" content="UIUCTF 2023 Writeup - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/cb5ed04abfdd2e10f676bb43deb53b87/ctf-uiuctf-2023.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="UIUCTF 2023 Writeup - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content="UIUCTF 2023 の Writeup です。"/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/cb5ed04abfdd2e10f676bb43deb53b87/ctf-uiuctf-2023.png"/><link as="script" rel="preload" href="/webpack-runtime-a3c0f166cb4b802ff58f.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-c234cda2451411e871dc.js"/><link as="script" rel="preload" href="/app-2508de546c0ea9cf9a63.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/ctf-uiuctf-2023/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">UIUCTF 2023 Writeup</h1><div class="Content-module--content__body--2TrQ-"><p>7/1 から開催されていた UIUCTF 2023 に 0nePadding で参加して 124位 / 818 チームでした。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/251fa82515e6b3a2a23649c5a4a9f548/cad6c/image-20230705210351400.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeklEQVQY06WRSQoDMQwE/f/HJrFWb9AjxUwgt8zk0NgIuSjJhYjwrARVg5lBbZ+/5OwVESRnjIGSl0dlcABba7dyQuecKMwchoIXK/o/QNUN3CNzFLahu19Kvsl18bchg+Q+MA2T8wHWGNe9xVI7er+W/Ah/WyrWWjgAWpvSlwxeQdkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/251fa82515e6b3a2a23649c5a4a9f548/8ac56/image-20230705210351400.webp 240w,
/static/251fa82515e6b3a2a23649c5a4a9f548/d3be9/image-20230705210351400.webp 480w,
/static/251fa82515e6b3a2a23649c5a4a9f548/e46b2/image-20230705210351400.webp 960w,
/static/251fa82515e6b3a2a23649c5a4a9f548/44ab2/image-20230705210351400.webp 1339w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/251fa82515e6b3a2a23649c5a4a9f548/8ff5a/image-20230705210351400.png 240w,
/static/251fa82515e6b3a2a23649c5a4a9f548/e85cb/image-20230705210351400.png 480w,
/static/251fa82515e6b3a2a23649c5a4a9f548/d9199/image-20230705210351400.png 960w,
/static/251fa82515e6b3a2a23649c5a4a9f548/cad6c/image-20230705210351400.png 1339w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/251fa82515e6b3a2a23649c5a4a9f548/d9199/image-20230705210351400.png"
            alt="image-20230705210351400"
            title="image-20230705210351400"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>今回は Rev と OSINT を解きましたが、課題感の残るコンテストでした。</p>
<p>とりあえず Rev の問題の Writeup を 2 問分書きます。</p>
<h2 id="vmwhere1rev" style="position:relative;"><a href="#vmwhere1rev" aria-label="vmwhere1rev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vmwhere1(Rev)</h2>
<p>問題バイナリとして vm という ELF ファイルと、 program というバイナリファイルが与えられます。</p>
<p>Ghidra で解析すると vm は program のバイトデータを読み取り、そのバイト値に応じた処理を行っていることがわかります。</p>
<p>実際のデコンパイル結果は以下のようになっていました。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">undefined8 <span class="token function">check</span><span class="token punctuation">(</span>byte <span class="token operator">*</span>param_1<span class="token punctuation">,</span><span class="token keyword">int</span> param_2<span class="token punctuation">)</span>

<span class="token punctuation">{</span>
  byte <span class="token operator">*</span>pbVar1<span class="token punctuation">;</span>
  byte bVar2<span class="token punctuation">;</span>
  byte bVar3<span class="token punctuation">;</span>
  <span class="token keyword">int</span> iVar4<span class="token punctuation">;</span>
  byte <span class="token operator">*</span>pbVar5<span class="token punctuation">;</span>
  uint local_24<span class="token punctuation">;</span>
  byte <span class="token operator">*</span>local_20<span class="token punctuation">;</span>
  byte <span class="token operator">*</span>local_18<span class="token punctuation">;</span>
  
  pbVar5 <span class="token operator">=</span> <span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  local_20 <span class="token operator">=</span> param_1<span class="token punctuation">;</span>
  local_18 <span class="token operator">=</span> pbVar5<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span> true <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>local_20 <span class="token operator">&lt;</span> param_1<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>param_1 <span class="token operator">+</span> param_2 <span class="token operator">&lt;=</span> local_20<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Program terminated unexpectedly. Last instruction: 0x%04lx\n"</span><span class="token punctuation">,</span>
             <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_20 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>param_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    pbVar1 <span class="token operator">=</span> local_20 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token operator">*</span>local_20<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
      local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
      local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
      local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
      local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
      local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
      local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span>
      local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>byte<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span>local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token punctuation">(</span>local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>
      iVar4 <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">*</span>local_18 <span class="token operator">=</span> <span class="token punctuation">(</span>byte<span class="token punctuation">)</span>iVar4<span class="token punctuation">;</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token operator">*</span>local_18<span class="token punctuation">)</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">10</span><span class="token operator">:</span>
      <span class="token operator">*</span>local_18 <span class="token operator">=</span> <span class="token operator">*</span>pbVar1<span class="token punctuation">;</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> local_20 <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xb</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token char">'\0'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pbVar1 <span class="token operator">=</span> pbVar1 <span class="token operator">+</span> <span class="token function">CONCAT11</span><span class="token punctuation">(</span><span class="token operator">*</span>pbVar1<span class="token punctuation">,</span>local_20<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> local_20 <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xc</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pbVar1 <span class="token operator">=</span> pbVar1 <span class="token operator">+</span> <span class="token function">CONCAT11</span><span class="token punctuation">(</span><span class="token operator">*</span>pbVar1<span class="token punctuation">,</span>local_20<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> local_20 <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xd</span><span class="token operator">:</span>
      local_20 <span class="token operator">=</span> pbVar1 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token function">CONCAT11</span><span class="token punctuation">(</span><span class="token operator">*</span>pbVar1<span class="token punctuation">,</span>local_20<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xe</span><span class="token operator">:</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xf</span><span class="token operator">:</span>
      <span class="token operator">*</span>local_18 <span class="token operator">=</span> local_18<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      local_18 <span class="token operator">=</span> local_18 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0x10</span><span class="token operator">:</span>
      local_20 <span class="token operator">=</span> local_20 <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
      bVar2 <span class="token operator">=</span> <span class="token operator">*</span>pbVar1<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_18 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>pbVar5 <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ulong<span class="token punctuation">)</span>bVar2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stack underflow in reverse at 0x%04lx\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_20 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>param_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>local_24 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>local_24 <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token punctuation">(</span>bVar2 <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> local_24 <span class="token operator">=</span> local_24 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bVar3 <span class="token operator">=</span> local_18<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>local_24 <span class="token operator">-</span> bVar2<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        local_18<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>local_24 <span class="token operator">-</span> bVar2<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_18<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">~</span>local_24<span class="token punctuation">]</span><span class="token punctuation">;</span>
        local_18<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">~</span>local_24<span class="token punctuation">]</span> <span class="token operator">=</span> bVar3<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Unknown opcode: 0x%02x at 0x%04lx\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>ulong<span class="token punctuation">)</span><span class="token operator">*</span>local_20<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_20 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>param_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0x28</span><span class="token operator">:</span>
      <span class="token function">FUN_00101370</span><span class="token punctuation">(</span>param_1<span class="token punctuation">,</span>pbVar5<span class="token punctuation">,</span>local_18<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>pbVar1 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>param_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      local_20 <span class="token operator">=</span> pbVar1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>local_18 <span class="token operator">&lt;</span> pbVar5<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pbVar5 <span class="token operator">+</span> <span class="token number">0x1000</span> <span class="token operator">&lt;</span> local_18<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stack overflow at 0x%04lx\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_20 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>param_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stack underflow at 0x%04lx\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_20 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>param_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>このコードを見ると、Hex が 0x08 のときに getchar 関数が呼び出され、入力値を 1 文字ずつ取得していることがわかります。</p>
<p>そこで、program から 0x08 の命令を抽出したところ、以下のように周期性があることがわかりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 786px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4c543d47656591ce6256b99635328d4e/321ea/image-20230703183714428.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 45.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB50lEQVQoz12RyW/aYBDFOVTqlq5K27RS1VYpWSDgLThAjBNjMMYsNjZeCciAlEiV+v8fX2dMwqGHp2+R5jdv3pTcmwk8zYGldOGoFgYVE7Y0xuDEgHmswxFHsGo2hvIYdt2GXjYgH4q4/d6A+bOJ4amOzle5uHe+ySj98Tb4a98hVcdY6gHWZoTcCLHtJ1i2JthoLlLJQq552PZiRKoD5aCMq49VKG9OC4mvfqP67Adqz3+htLZTPExy+KKFWB1hQdC4NUWmzRC3XayMCIEyRCQPEIt9TCu3UN6eEfACl+/OSOeQqAFDWaXcSvAwWsG76CIghfUe4oZDQK8Ar8htSI1SapBde/CEflHIIHbJ4rfw8ngH3FgpNv0Ucy6igrQ5QUhFodBDSK5XNwEi+lt0fNIMU2oovS6j9amOxvsKmoc1Os8hvHgErnsJ8m6EmWwjuhoX0IRGjQkyJ2B2OYRPzuPHhi79qR8qaH+uQzsS0aA757h3uLWywmFAGSUE4dGS9i5DBudmjFCxEdNiWC7BOUN2eP1FJLDw38i0TR7bpbD9qoGEip/AnOEdjTx/ypDeHo2sUm48KouBHMEeeO8scT9c7nKiopSKw7qJlMEUwXaQIWEwbX+h+5hJg2K7DGVpRxLkg5M98B/MjjO6q5xaIAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/4c543d47656591ce6256b99635328d4e/8ac56/image-20230703183714428.webp 240w,
/static/4c543d47656591ce6256b99635328d4e/d3be9/image-20230703183714428.webp 480w,
/static/4c543d47656591ce6256b99635328d4e/4cb1e/image-20230703183714428.webp 786w"
              sizes="(max-width: 786px) 100vw, 786px"
              type="image/webp"
            />
          <source
            srcset="/static/4c543d47656591ce6256b99635328d4e/8ff5a/image-20230703183714428.png 240w,
/static/4c543d47656591ce6256b99635328d4e/e85cb/image-20230703183714428.png 480w,
/static/4c543d47656591ce6256b99635328d4e/321ea/image-20230703183714428.png 786w"
            sizes="(max-width: 786px) 100vw, 786px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/4c543d47656591ce6256b99635328d4e/321ea/image-20230703183714428.png"
            alt="image-20230703183714428"
            title="image-20230703183714428"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>以降のバイト列を追ってみると、0xf の処理で入力値を保存した後、0x7 と 0x5 の処理で変換を行い、ハードコードされているバイト値と XOR した後 0xc の処理で 1 文字ずつ検証していることがわかります。</p>
<p>ここまで特定できれば、あとは動的解析で総当たりを試すことができます。</p>
<p>以下のスクリプトで 0xc の条件式を満たすような文字を先頭から 1 文字ずつ特定していくことで Flag を取得できました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># gdb -x solver.py</span>
<span class="token keyword">import</span> gdb
<span class="token keyword">from</span> pprint <span class="token keyword">import</span> pprint

<span class="token comment"># pprint(dir(gdb))</span>
BINDIR <span class="token operator">=</span> <span class="token string">"/home/ubuntu/Hacking/CTF/2023/UIUCTF/Rev/vmwhere1/"</span>
BIN <span class="token operator">=</span> <span class="token string">"chal"</span>

gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'file {}/{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>BINDIR<span class="token punctuation">,</span> BIN<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># gdb.execute('b *{}'.format(0x555555555587))</span>
gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'b *{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">0x55555555569f</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

flag <span class="token operator">=</span> <span class="token string">"uiuctf{"</span> <span class="token operator">+</span> <span class="token string">"A"</span><span class="token operator">*</span><span class="token number">150</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">,</span><span class="token number">0x126</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        flag <span class="token operator">=</span> flag<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"A"</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token operator">-</span>i<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"in.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
        
        gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"run program &lt; in.txt"</span><span class="token punctuation">)</span>
        gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"continue {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">51</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        res <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>gdb<span class="token punctuation">.</span>parse_and_eval<span class="token punctuation">(</span><span class="token string">"$al"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> res <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>flag<span class="token punctuation">)</span>            
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'quit'</span><span class="token punctuation">)</span></code></pre></div>
<h3 id="静的解析でちゃんと解くパターン" style="position:relative;"><a href="#%E9%9D%99%E7%9A%84%E8%A7%A3%E6%9E%90%E3%81%A7%E3%81%A1%E3%82%83%E3%82%93%E3%81%A8%E8%A7%A3%E3%81%8F%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3" aria-label="静的解析でちゃんと解くパターン permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>静的解析でちゃんと解くパターン</h3>
<p>vmwhere1 については最低限 0xc で 1 文字ずつ検証しているという点さえ特定できれば Flag 取得まで行けましたが、そのまま進んでしまうと vmwhere2 で詰みます。</p>
<p>そのため、vmwhere1 の時点でもう少しバイナリの動作を理解するために深掘りしていきます。</p>
<p>vm の動作を理解するには、0x28 の処理で呼び出される以下の関数がヒントになっています。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">FUN_00101370</span><span class="token punctuation">(</span>undefined8 param_1<span class="token punctuation">,</span><span class="token keyword">long</span> param_2<span class="token punctuation">,</span><span class="token keyword">long</span> param_3<span class="token punctuation">,</span>undefined8 param_4<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">int</span> local_c<span class="token punctuation">;</span>
  
  param_3 <span class="token operator">=</span> param_3 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Program counter: 0x%04lx\n"</span><span class="token punctuation">,</span>param_4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stack pointer: 0x%04lx\n"</span><span class="token punctuation">,</span>param_3 <span class="token operator">-</span> param_2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Stack:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>local_c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> local_c <span class="token operator">&lt;</span> <span class="token number">0x10</span><span class="token punctuation">;</span> local_c <span class="token operator">=</span> local_c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span>param_3 <span class="token operator">-</span> param_2<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"0x%04lx: 0x%04x\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>param_3 <span class="token operator">-</span> param_2<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_c<span class="token punctuation">,</span>
             <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>param_3 <span class="token operator">-</span> local_c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>実際に適当に Stack に値を積んだ後に 0x28 の処理を呼び出すバイナリを作成して実行してみると、以下のような出力を得ることができます。</p>
<p>ここでわかるのは、param_3 として与えている変数がスタックポインタになっているという点です。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">echo</span> -n -e <span class="token string">"<span class="token entity" title="\x0a">\x0a</span><span class="token entity" title="\x21">\x21</span><span class="token entity" title="\x0a">\x0a</span><span class="token entity" title="\x22">\x22</span><span class="token entity" title="\x0a">\x0a</span><span class="token entity" title="\x23">\x23</span><span class="token entity" title="\x0a">\x0a</span><span class="token entity" title="\x24">\x24</span><span class="token entity" title="\x28">\x28</span>"</span> <span class="token operator">></span> <span class="token builtin class-name">test</span>
./chal <span class="token builtin class-name">test</span>
<span class="token operator">></span>
Program counter: 0x0009
Stack pointer: 0x0003
Stack:
0x0003: 0x0024
0x0002: 0x0023
0x0001: 0x0022
0x0000: 0x0021
Program terminated unexpectedly. Last instruction: 0x0009</code></pre></div>
<p>スタックポインタとプログラムカウンタを特定できたので、あとは必要な処理を読み解いていきます。</p>
<p>0x8 で Flag の 1 文字を読み込んだ後の処理は以下のようになっていました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">08 0f 0a 04 07 05 05 0f 0a <span class="token number">72</span> 05 0c 00 03 0d 04 0d 0e</code></pre></div>
<p>とりあえず 0xc までの処理を Python に落とし込んでみると以下のようになりました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">op <span class="token operator">=</span> prog<span class="token punctuation">[</span>pic<span class="token punctuation">]</span>

<span class="token keyword">if</span> op <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    b <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span>
    pic <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">if</span> op <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    b <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> a <span class="token operator">^</span> b
    stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    pic <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">if</span> op <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    b <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> b <span class="token operator">>></span> <span class="token punctuation">(</span>a <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span>
    stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    pic <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">if</span> op <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">:</span>
    c <span class="token operator">=</span> flag<span class="token punctuation">[</span>seek<span class="token punctuation">]</span>
    seek <span class="token operator">+=</span> <span class="token number">1</span>
    stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    pic <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">if</span> op <span class="token operator">==</span> <span class="token number">0xa</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> prog<span class="token punctuation">[</span>pic<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
    stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    pic <span class="token operator">+=</span> <span class="token number">2</span>

<span class="token keyword">if</span> op <span class="token operator">==</span> <span class="token number">0xf</span><span class="token punctuation">:</span>
    stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span>stack<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    pic <span class="token operator">+=</span> <span class="token number">1</span></code></pre></div>
<p>順番を置き換えると以下のようになります。</p>
<ul>
<li>入力値を 1 文字取得し、その値を Stack に追加</li>
<li>同じ値をもう 1 つ Stack に追加</li>
<li>0x4 を Stack に追加</li>
<li>0x4 &#x26; 0x1f した値で入力値を右シフトして Stack に格納(入力文字の上位ビットのみを取得)</li>
<li>上記の値と入力値を XOR して Stack に格納(上位ビットはそのまま、下位ビットのみ XOR される)</li>
<li>入力値の取得前に Stack に積んであった値(初期値は 0x00 ) と上記の値を XOR</li>
<li>上記の結果と同じ値をもう 1 つ Stack に追加</li>
<li>0x72 を Stack に追加(この値は毎回変わり、次の検証にも使用される)</li>
<li>0x72 と先ほどの演算結果を XOR して Stack に追加</li>
<li>1 つ前の演算結果(入力値の取得前に Stack に積んであった値(0x00) と上記の値を XOR) が 0 かどうかを判定し、0 なら正解とする</li>
</ul>
<p>実際にこの処理を演算してみると、以下のように 1 文字目が u の場合は正解の 0 が返却されることがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 296px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/27edc374106c84ff753747d17d51b920/b1a44/image-20230703220020748.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 67.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACTUlEQVQ4y3VTaVcaQRDcHCYmmjsxKiIQYVlgkWuR5VouheW+D4nxwvcSE/P/P1amW+SBhA/9ZqZhq7u6qqWKN4uhXkfyaxCjeAO39Ut8T7cxKY3xu3nNuUGsjl60IvIdJLYCOFz/htCGC8HXzlkEXh3wKRl7Gs6zPYwSDVzkByg4dGhvFaR3Qoh/9kN7pyC8KTOA/knlj/wvHfC/cExP+wyMTim5HcSZ0UXDX+AuDEtEgIX5D9H3HoTfyPxObB2Kt5eLxT6qoO90UTAlClOxWYdFVwrdSJkpnxkd/Kpd4KowxLEjjq5WRsai4U/rGnftG/S0Co+nHSrhb+cG42SL2RGLwPoUsBk8QUxQ8T23QV2zQ3myx+F9ti/CynnPUysH3akTmuF8LFAuOpMw5bSg4UPeFuPOSuJd9eZQVjKoUHiyMN0Gar7cfTdTgMeCcIemYrCSBEai/KyeYyjek+KY8zTX02STf6MRkFDU1TzggsrxL34xhz5bohMxWT23ZIFL2uGTqMrSrnhvwyvu6lTVh3gMLJ0cJHjQWWsU/aMqOmGTRaIClKf3KNHkrk/FSW4Ibbr+C8aAJTnF1GiWg1gN41QLdTXPVKtidlSQZkjKlsV4ymKWwQ3nakDyEs2HtsLYDWNf+sAKy4KyIiiTeYkyhbpmWzLyEqDpTnN1UpmokSg/hLfu2hP2JN1vG5fsxYonw6DzRl4CpFWjTelHq2yN3P4RMmIdKU8nbUferrML9BUKL1IWKpPjr45HvClscEHr3ug2BqC7b3pfRfUh/gGh7bG7XixEtAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/27edc374106c84ff753747d17d51b920/8ac56/image-20230703220020748.webp 240w,
/static/27edc374106c84ff753747d17d51b920/f6dfe/image-20230703220020748.webp 296w"
              sizes="(max-width: 296px) 100vw, 296px"
              type="image/webp"
            />
          <source
            srcset="/static/27edc374106c84ff753747d17d51b920/8ff5a/image-20230703220020748.png 240w,
/static/27edc374106c84ff753747d17d51b920/b1a44/image-20230703220020748.png 296w"
            sizes="(max-width: 296px) 100vw, 296px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/27edc374106c84ff753747d17d51b920/b1a44/image-20230703220020748.png"
            alt="image-20230703220020748"
            title="image-20230703220020748"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>以上の処理は、<code class="language-text">0a 72</code> で Stack に積む値以外は共通で実行されます。</p>
<p>つまり、各文字ごとにハードコードされた検証用の値を抽出することでただしい Flag を逆算することができそうです。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 696px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/6320f6da07c48e23aaa38c5f175e2775/82158/image-20230703220312435.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 144.16666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFdklEQVRIxz1WZ3sTZxDU1ySQEEoAU2wDrnJRt5p7VS+nK9KpugSDQx4SQv7+ZGYl58M9J8PdvrM7ZS8yPvbxxblBLXoEb30f9Q95uKkSensOBgcuglwdvUITvd02/Ngpmq+T6Kwf4OBtBsmfV5H5dZ33Few8jtoV6fLhm1IflTUWW95FdS6O8rMNVPlie/sUbrYGn8900hW4O1V0eHWLLezNJZF+tI78b1ssGrXCiQfLiPxeHuDf/p/opMoYnwQYHXnoE1WwcQiHRZ2FDJEfYHToYsRuxic+rs9DnLzLIfFwGcUXcRbdRv7ZFpIPVxARum+9O7QTFxiyWGitdjA+7WLA3yHb77zPsXgC7nIRXT53ddbDIVuO/7SE1C+rduVY0BB2Cw1MiEwtt/hCY3UPTrIEhy16bNfuuQacxDlqizuoPN9CfamA/dcpQ5R+tIadJxvI6nq6icjlWRd3zUs0t07gbR6hxTabROOQnB4LCrGQC7VI6u22cHkaGMIUSdl7lUTh+TaO5ncMaeRTbYy/g89wMxVM2MqED4+KTXSjh3DnU/CX8gg2jzHh/CYcgwB8rAxx9qHAGa5YMRGju0iK9Io6sYvK+qEx6JAcXV6ebabLaEUPUH2VQOVpFLWFHTR5UMD/O17MEtGaFRWy3bnElJQhW7kh03WicNlym3efLLvZOkJqTy9LJp3YGVrvsqi92IJD1jVDyUVkSDKF5zE7IHLXuMS37p0NPYyfwedLAVn1V3cx3mtbmzpQ47iiXCaUzS1bPl7MmZA1SxXM8LdkRISuCbtGZD0W8InIpTSa1FmNjDbeptCmAqSGgAKXEfr7Dg7epLH9w3tjVwWFLv5gCZGQrF1fhKiKBM5Q7XZIkNzhJFl4he55GbMZ1om8Rff0OSaxK+sJpVovvIhNdXhbG01b5svDTBkhiRgfexhRm1c8SC3rGlBCAcfgEvGQB4oUodt9mUCO+lNBsW06/NK+sZNl+tabpF0ORd7L1YwU6U+o1Kpalj3VsnQo22l+ErecE+nyhSsWVcse2zWpbByh+iaFi8drKDMsamxbklJQaCxKoHunCKX0Z+EgUkTIV++WaVLGkOIVmuEsCPokokuyHLbpELXPg3rZqpF4RE1abM0sZwcQMdNmiL/8TxYO/XQJAWfZJ9sDFtXspgkT2Gz9laKFRMhnJBsJWgVV2Nie5mHD7FQSmzy1/GwTZcqlyqE7Shq1OstBd2caFkG+bs5Qm0WScR8SxrIS+3NjgiadEO530OV8PBLUmk+jQbm0leAzqUinCgelkwStQsYwXWLxJeup2D/hH4ZGrelSQFyXBhjx5XD7BC5jy1/MoMff+rdbBsr5UtGKCWWOXYl187L8ak7hwDskoM2XFPcmbipAzOveps/rZL7C9dBiZhZfxi2lpT85JDubZWRAbYmYKjXYfD+1W52Dl0OkQd/CoWmSCThvjweF/FusihAh0/ysoBB+qo/xPfwCj0NXAIwVpHSMz9l5C2n0GF99FrFgIHnqRu46fZc33Wl2ykIV/58UhayELQTKR6ESQR7n6hBpfS6G5qs4OvL7bNaHRBb78YO5xRBynqZDWcmcwoB1ybRDPaqgQ1RTZ0zd0WLiaMVqhs3ZDEWIWlXSiGnbKbfVEb5rjXIx+XypQ1d4bDfYmsb+eJaH12xVu2RIlm8IQE5RGNzn4f9O0Y796n40HSphQmUeg7b1No02F5bPrwmP4TtdVK4Fw/VFH8cLWcvDe5Ri25aUwsF2yhqThoXk6TbnpJ3SpFRq8xmUnkRtfTbYgfZNl1JTfEl/KqJW9+gcCwfZTgi1i+2rQYuehOh7RqgUWX3tFo6gzYCoc4Zh8tzWZoHRNf0kWTMLapb/AXd27gbalT2UAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/6320f6da07c48e23aaa38c5f175e2775/8ac56/image-20230703220312435.webp 240w,
/static/6320f6da07c48e23aaa38c5f175e2775/d3be9/image-20230703220312435.webp 480w,
/static/6320f6da07c48e23aaa38c5f175e2775/038cb/image-20230703220312435.webp 696w"
              sizes="(max-width: 696px) 100vw, 696px"
              type="image/webp"
            />
          <source
            srcset="/static/6320f6da07c48e23aaa38c5f175e2775/8ff5a/image-20230703220312435.png 240w,
/static/6320f6da07c48e23aaa38c5f175e2775/e85cb/image-20230703220312435.png 480w,
/static/6320f6da07c48e23aaa38c5f175e2775/82158/image-20230703220312435.png 696w"
            sizes="(max-width: 696px) 100vw, 696px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/6320f6da07c48e23aaa38c5f175e2775/82158/image-20230703220312435.png"
            alt="image-20230703220312435"
            title="image-20230703220312435"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>以下のようなスクリプトでこれらの Key を取得できます。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"program"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    prog <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

pattern <span class="token operator">=</span> <span class="token string">b"\x05\x0f\x0a"</span>
key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>prog<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> prog<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> pattern<span class="token punctuation">:</span>
        key<span class="token punctuation">.</span>append<span class="token punctuation">(</span>prog<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></code></pre></div>
<p>そして、解析した結果を元に以下の Solver を実行することで正しい結果を取得できました。</p>
<p><code class="language-text">chr((a>>4)^a)</code> で Flag を復号できているのは、正しい入力値の上位ビットはそのままにして、下位ビットを上位ビットで XOR した値を使用しているためです。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"program"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    prog <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

pattern <span class="token operator">=</span> <span class="token string">b"\x05\x0f\x0a"</span>
key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>prog<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> prog<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> pattern<span class="token punctuation">:</span>
        key<span class="token punctuation">.</span>append<span class="token punctuation">(</span>prog<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># print([hex(i) for i in key])</span>

flag <span class="token operator">=</span> <span class="token string">""</span>
key <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    k <span class="token operator">=</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    a <span class="token operator">=</span> k <span class="token operator">^</span> key<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">>></span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">^</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"c"</span> <span class="token operator">+</span> flag<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># ciuctf{ar3_y0u_4_r3al_vm_wh3r3_(gpt_g3n3r4t3d_th1s_f14g)}</span></code></pre></div>
<h2 id="vmwhere2rev" style="position:relative;"><a href="#vmwhere2rev" aria-label="vmwhere2rev permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vmwhere2(Rev)</h2>
<p>問題バイナリとして vmwhere1 とほぼ同じバイナリと新しい program ファイルが与えられます。</p>
<p>vmwhere1 とは異なり、ELF ファイルには以下の 2 つの処理が追加されていました。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">case</span> <span class="token number">0x11</span><span class="token operator">:</span>
  local_30 <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> local_30 <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
    local_30 <span class="token operator">=</span> local_30 <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">;</span>
  current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
  <span class="token keyword">break</span><span class="token punctuation">;</span>

<span class="token keyword">case</span> <span class="token number">0x12</span><span class="token operator">:</span>
  local_2f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;</span> k<span class="token punctuation">;</span> k <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    local_2f <span class="token operator">=</span> local_2f <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token punctuation">(</span>sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_2f<span class="token punctuation">;</span>
  sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">;</span>
  current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
  <span class="token keyword">break</span><span class="token punctuation">;</span></code></pre></div>
<p>0x11 の処理の方は、入力された文字を 1 bit ずつ Stack に積んでいく処理であることがわかります。</p>
<p>また、0x12 の方は 0x11 で格納した bit 列を逆順に並べ替えて再格納しているようです。</p>
<p>その他の処理は見た感じ vmwhere1 と同じのようなので、次に program の方を見ていきます。</p>
<p>vmwhere2 の program では、vmwhere1 とは異なりすべての文字入力を受け取ってから Flag の検証を行っているようです。</p>
<p>まずは、先ほど同様 0x08 で文字入力を受けとったあとの処理を見てみます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 812px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f73677230ecc79b1a5c0f5976e1ca50c/63ec5/image-20230703233629823.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 54.58333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4ElEQVQoz52SS0/bQBhFs2mrlraBVkhIgESLE/JwiLFdJ34ksZO4xg1xYjv4ATagqoUN/397+82EVuqiKOpiNNaMfObeM1Px+1/h6i5saYhxewC7PobdcGHuyjD2+7AEh9Y9WptiQrO814N5oME9NjBr2Xy2D7/Aq1kYHaioPC6+494rkKgzFFaEchAi789R6HOkooO4biLrOEhkDz/Or+AcqpC3alDfN6C8O8HZ2xrEl0cQXxyh8+oTKj/9AjfOJcLuFLkRoKDvpB8gM5fIrBCX2gzpmYfgs46IUugfRajbTWg7bfQ+tKFWm5DeCJC2BD5X7v0Spb1CUDMRCgZWrREiyUUxivm4HlBqOiQ1Fsh7F7D2JCiUTttp8aFWG+i+Pl5DOfBbibtJikj1kVLVTD7HgryEdEDcmSAhyC3t55T4bpphuK8Q8GQDoOLzn3JrSZUJTKCYpC+oatwckRKXA5l45u5Z4O04QXi6dsjr6cETPOQJM4WlJnDdgsEcVpvPAMkhO/mPQ0oTdX87XP3l8IqSDzZySAm5Q0rG0xA4FExE4hiJ9h8OS0oT0TvL2U2ymgxMVVdte121MeRKNnL4MLuhS0kQ06Vc06NmcOYtf3qHSW/OUy8pdURwnUG2/+3wF64KcElFKdJhAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/f73677230ecc79b1a5c0f5976e1ca50c/8ac56/image-20230703233629823.webp 240w,
/static/f73677230ecc79b1a5c0f5976e1ca50c/d3be9/image-20230703233629823.webp 480w,
/static/f73677230ecc79b1a5c0f5976e1ca50c/77913/image-20230703233629823.webp 812w"
              sizes="(max-width: 812px) 100vw, 812px"
              type="image/webp"
            />
          <source
            srcset="/static/f73677230ecc79b1a5c0f5976e1ca50c/8ff5a/image-20230703233629823.png 240w,
/static/f73677230ecc79b1a5c0f5976e1ca50c/e85cb/image-20230703233629823.png 480w,
/static/f73677230ecc79b1a5c0f5976e1ca50c/63ec5/image-20230703233629823.png 812w"
            sizes="(max-width: 812px) 100vw, 812px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/f73677230ecc79b1a5c0f5976e1ca50c/63ec5/image-20230703233629823.png"
            alt="image-20230703233629823"
            title="image-20230703233629823"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>1 文字目の入力を受け取る処理は以下のようになっていました。</p>
<p>先ほどと比べるとかなり多いですね。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">08 <span class="token number">11</span> 0a ff <span class="token number">10</span> 09 <span class="token number">10</span> 08 0a 00 <span class="token number">10</span> 02 0f 0a ff 05 0c 00 04 0e 0d 00 04 0e 0d 00 <span class="token number">16</span> <span class="token number">10</span> 02 <span class="token number">10</span> 02 0c 00 07 0e 0a 01 01 0d 00 01 0e 0f 0f 01 01 0d ff d9 0e</code></pre></div>
<p>各処理について整理するために、オペコードとオペランドで整列してみました。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">08
<span class="token number">11</span>
0a ff
<span class="token number">10</span> 09
<span class="token number">10</span> 08
0a 00
<span class="token number">10</span> 02
0f
0a ff
05
0c 00 04 
0e 
0d 00 04
0e 0d 00 <span class="token number">16</span> 
<span class="token number">10</span> 02 
<span class="token number">10</span> 02 
0c 00 07 0e 0a 01 01 0d 00 01 
0e 
0f 
0f 
01 
01 
0d ff d9
0e</code></pre></div>
<ul>
<li>受け取った入力値は、0x11 の処理で bit 列として Stack に格納される</li>
<li>Stack に 0xff が積まれる</li>
<li>0x10 の処理で 0x9 を引数として Stack の操作を行う</li>
<li>連続して 0x10 の処理で 0x8 を引数として Stack の操作を行う</li>
<li>0x0 を Stack に積む</li>
<li>0x10 の処理を 0x2 を引数として呼び出す</li>
<li>Stack の最上位の値をもう一つ Stack に積む</li>
<li>0xff を Stack に積む</li>
<li>Stack の上 2 つを XOR する</li>
<li>2 つ分処理を進めて 0xd の処理に進む</li>
<li>0x10 の処理を 0x2 を引数をして 2 回行う</li>
<li>0xe の処理まで進める</li>
<li>Stack にいくつかの値おを積んだ後、0xd の処理で -0x25 の位置までプログラムカウンタを戻す(<code class="language-text">(0x55555555a535+0xffffffffffffffd9) &amp; 0xffffffffffffffff</code> の演算を行う)</li>
</ul>
<p>ここまで読んだものの、以降の処理量が膨大過ぎて処理を追うのを諦めました。</p>
<p>仕方がないので、バイナリのコードを再実装して Print デバッグをしながら挙動を確認することにしました。</p>
<p>実装力が足りず、自分が書いた Python スクリプトでは動作を完全には再現することができなかったので C 言語で書くことにしました。</p>
<p>作成したコードは以下の通りです。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> bVar1<span class="token punctuation">;</span>
    <span class="token keyword">char</span> bVar2<span class="token punctuation">;</span>
    <span class="token keyword">int</span> iVar3<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>stack<span class="token punctuation">;</span>
    <span class="token keyword">char</span> local_30<span class="token punctuation">;</span>
    <span class="token keyword">char</span> local_2f<span class="token punctuation">;</span>
    uint i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> j<span class="token punctuation">;</span>
    <span class="token keyword">int</span> k<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>current_pic<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>sp<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>next_pic<span class="token punctuation">;</span>

    FILE <span class="token operator">*</span>f<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>prog<span class="token punctuation">;</span>
    <span class="token keyword">long</span> f_size<span class="token punctuation">;</span>

    <span class="token comment">// Read file</span>
    f <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"program"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token punctuation">(</span>FILE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        prog <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">fseek</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f_size <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">rewind</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        prog <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>f_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>prog <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            prog <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">fread</span><span class="token punctuation">(</span>prog<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>f_size<span class="token punctuation">,</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fclose</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Run program</span>
    stack <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    current_pic <span class="token operator">=</span> prog<span class="token punctuation">;</span>
    <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>current_pic<span class="token punctuation">;</span>
    sp <span class="token operator">=</span> stack<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>current_pic <span class="token operator">&lt;</span> prog<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>prog <span class="token operator">+</span> f_size <span class="token operator">&lt;=</span> current_pic<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Program terminated unexpectedly. Last instruction: 0x%04lx\n"</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>current_pic <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>prog<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[0x%x] OP:0x%x  "</span><span class="token punctuation">,</span> current_pic <span class="token operator">-</span> start<span class="token punctuation">,</span> <span class="token operator">*</span>current_pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
    next_pic <span class="token operator">=</span> current_pic <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token operator">*</span>current_pic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ADD %x, %x = %x\n"</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SUB %x, %x = %x\n"</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"AND %x, %x = %x\n"</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"OR %x, %x = %x\n"</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"XOR %x, %x = %x\n"</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"LSH %x, %x = %x\n"</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token punctuation">(</span>sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"RSH %x, %x = %x\n"</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span>sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token punctuation">(</span>sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>
        iVar3 <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span>sp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>iVar3<span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"READ %c\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>sp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PUTCHAR %c\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>sp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// putchar((uint)*sp);</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">10</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PUSH %x\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>next_pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span>sp <span class="token operator">=</span> <span class="token operator">*</span>next_pic<span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> current_pic <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xb</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token char">'\0'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            next_pic <span class="token operator">=</span> next_pic <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span>next_pic <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> current_pic<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> current_pic <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"JPM %x\n"</span><span class="token punctuation">,</span> current_pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xc</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            next_pic <span class="token operator">=</span> next_pic <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span>next_pic <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> current_pic<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> current_pic <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"JPM %x\n"</span><span class="token punctuation">,</span> current_pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xd</span><span class="token operator">:</span>
        current_pic <span class="token operator">=</span> next_pic <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span>next_pic <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> current_pic<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"JPM %x\n"</span><span class="token punctuation">,</span> current_pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xe</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"POP\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0xf</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"DUP %x\n"</span><span class="token punctuation">,</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span>sp <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0x10</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"REVERSE TOP %x\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>next_pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> current_pic <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        bVar1 <span class="token operator">=</span> <span class="token operator">*</span>next_pic<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>sp <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>stack <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ulong<span class="token punctuation">)</span>bVar1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stack underflow in reverse at 0x%04lx\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>current_pic <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>prog<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token punctuation">(</span>bVar1 <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bVar2 <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">-</span> bVar1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            sp<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">-</span> bVar1<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">~</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            sp<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">~</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> bVar2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0x11</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SPLIT BYTE TO BITS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        local_30 <span class="token operator">=</span> sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span>sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> local_30 <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        local_30 <span class="token operator">=</span> local_30 <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">0x12</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"POP 8 VALUES, NEW VALUE = LSB OF LAST 8\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        local_2f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;</span> k<span class="token punctuation">;</span> k <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        local_2f <span class="token operator">=</span> local_2f <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token punctuation">(</span>sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        sp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_2f<span class="token punctuation">;</span>
        sp <span class="token operator">=</span> sp <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">;</span>
        current_pic <span class="token operator">=</span> next_pic<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Unknown opcode: 0x%02x at 0x%04lx\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>ulong<span class="token punctuation">)</span><span class="token operator">*</span>current_pic<span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>current_pic <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>prog<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sp <span class="token operator">&lt;</span> stack<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stack <span class="token operator">+</span> <span class="token number">0x1000</span> <span class="token operator">&lt;</span> sp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stack overflow at 0x%04lx\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>current_pic <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>prog<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stack underflow at 0x%04lx\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>current_pic <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>prog<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>これをコンパイルして実行すると、最終的にオフセット 0xbed の命令まで実行し、<code class="language-text">Incorrect password!</code> という文字列を出力してくれました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 325px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/794c70b537698bd483d43304b9f93042/ff46a/image-20230705184531728.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 399.58333333333326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAABQCAYAAAAZQFV3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKmklEQVRYw3WYZ1sbyRKF2Xzv7tqbbexdZ5skUCSDJBBJgEgKCKFABtt4vc/9/x/61ls9NZrB3g88EqOZ7qpzTlWdnoHGbMUdze26o/k911rYd+XhgqvlNt322LL+v/pizk3/knDN2R3XLdZc6dmMXp/+ZcyNffXEjX/z3KX++8qlv3+tnwPd5bo7Wz1yJ6VDd7Lc0IUu1o9dNVt2V5tdt/pyzs3+Nu5uKifuZrun/3Pf1uiSK/yZc2uvFlzu/ohL/eelLjpQn9nWxS42jt3xoo+ona+6vdSaXiMibrza7Lja5KZeJ9K3ssFlue3O11pucTDtJr597hfslRrudKXpI5S/nYkV/axmN/SBrdGiyz/KShZNheZaov5wcOkj/33cjX75RKKLpNyYqbjeUsN1l+oawdqref2+m1zV3TdHCi7zwxuNEByBpL144M7XW/pcp1Bzc39MuInvXvgI24WqPni50XZnEunWSFFSqrtqrqyLrL9e0Bvf7py6pkS4nVjWjN7vnbvrra77u3blCo9zSk64YE8iIk1u3JQF+QQrNik9n5HUJhSzQ8nmWKKDnNbCnjvIbLid8ZKb+TXhkt8FpDSEFCKD6cb0tqYMKfvpdSWFlHmgIxs3piuaIhsROZsZuyGGRgpRcrORciCksCDyyPw45G73L0Sru64iKfP7raR8FRC0+Cjjxo1lZAMJREhksAeGRkr+cdal5EZ0WJ/cUkiQ1/u9M8XwnWCbjy7YKXpSiIZIiYgNEPb1Vk9YXXLzD5K6ISwj+g8HF7rw8tNprZjsvaGwWgaO8wch/YAeJeV87chtvFnU0kOTlOeh4Mh1ooUQsPSVEix4KLXM7uiqLYtzAwQcZNZ1ESJkd9KzDTtSKe92fcrIB1jGo5VysuwlQ+oV2ZXvSAIYlp5MucmfRkJSuH4p14HjdOVQtRorvbpIhZT58ZjuoqTUlBQW3BjKu4WHKY0KsV9IJmgS/Lg+PPA43m06SzW9iagAHVkgIR4mZf7P/PhG00PUYItswBHygAnhh6XXEgkgE1oSN5YlolP59KS0NBJqGWbrU1teBRIt+qNiPtav46V3OLejpFyVO8p0n5QNxcf6HXKBFP7YiMj4zsb0y6RFqKRIREQJTjtRUmSR8nBeQWcRZMPne2EYOS0OZhS3GIb16a0w3cbUtpJCpHtUimBrsiFaL5uCkke6YE9dLzyE5SBCRsC5pEw0KhslpRGSsvJ8Vkmh1GiwyApCboP29VHbV7aP4ZG0ISUlmCmkwndkw+6rL+el9FL6HVIgjN64O7GqnYnoYpXSFLES2RnlJA+gO0jREbDRVlYRdk82Q9hICxLBWMeDRJe9N9yvZVImMjTFZyVhpKwrDGyQlfb1d/VSMdwO2hf/31R67p/GTbz0IIXdIYC2tPJi1pPC1JMFizIqbepBms4UkQz4gSX3xEqvK4uRgv9rKuhsoO1LGigsIw9rXzpHqleqT65bZKFswJBSQ/01aUlKiiyIbMCVyskJRggflm0u01AoRVyGzhQb9LBsU4/IykpKzTsHWWRTrAk3ojs/Rpd0McQNDJRgIYohpKA7gCYtMIIUG1LalSUCdMgYhRgWojsRMT5n7o9kvzlopQQjlAh8pfStCOaJB5g3dGnuA0f65IzU8MgXf4XphlNPzZKkS0ntjK/od1IGBmRCt6FDt/T3kgbAcKKSgCJWenQbKoWdARv2wNKmHq2JG1nQph6ysdKjrcV02Mrve1KEAMAmRRa2qccCpMY9hwIJeBMVVQXepD7102ifZTo2EcEs7SlKCosgoznpyODZkt/BElJ2xRBQy9Q5zSMsPQb9aWBFYI1mACn7ASlsEGtfkgEpmz+kUcScg1kRHaUSkYHuSfFTD2Hf7p9rBobtB5mCYAiW+MdwQTx2N3BfpE0avcAfEuH660Vlkd+pChZjcaR0t1t751A40AI390VL6gYj0w/6ZbUa1jwwUZQkGZANWE+JHQlJaRe9P+SP5kn/C0mRRfDc1r7YkA249x+Zdu92T/UzNvXwh6elpooYq2uVwoJEiGmHRX7HH3IdVbAp9yP2+WjphaY9GFRRf8iC6BC7ZirwDeFC5QRhY189jU89IkSsvahpL0ZNezFssNZtWuHUO1ZCY82hXYyYdoki9Ic5374oxfQPr7V2depJbXMf3YdNPt417bDcjZp2EW7UtDNGqRQiQtjga72RauF+/GPIciPwhyobmRlRf+hNe1H7oRlSSg/2yYToISymQyWl1AzHQEhKxkx7UWUDEZYyv/M/kTJfYpVSV1LMtB+o7swfhqZddrcOY6YdDYIhNR037dJtzLQz9Uy4vn11A9OeCqceuKppF+yW/ppU10AGYcr4QzPtVIKSEvpDb9qnfh4LTbvakRV/kEQJ9E+cRUiK+UM0BRlRf+hPo3HTbmdBS5lG8RnT3ghM+1HEivRNOx1Z2xdRBbOGxXiOQGIzRUkJFuRAaP7Q2hdzGgx1VtO+RDIQxHhFn0N3Tbv6w7XAtKssSp+adpl6LIJTYCNmD7+BNfjHSi/qD4kUt3USMe2kzIKcU5h66LKjpt3rMDSchiHexkw7+qNDkx4YYpb4f1IwNNMOjmAI43RwMoidl9UfqmmvKbufmHY9+PRNO5u/3TnRhdjMnNcd0+5fYKDD0LST8udM+3Bg2sVsMsS4vjB4x7Tb4dGb9sAfBqTQsakEDolY4h017a3gAN7Rdw75uxjGSLlj2nWYy5mO9M0s0RtJ2V4S5aIeW/3het+0R/2hVcqk1Cub4BxIm4z4nU3RY+7+v5l2eaiSiPhDTLtE7KfelTftYxHTvu1Ne+GuabcS6pv2at+0S0cJTbuQBsbmbyhVoo2VnvlDWheRqRUJ/CEPqWl/9KlptwNR4utn8dKj2/RN+6Z2m94d045z0KknomaOkAGWmOkHDDN6Gn3Z74c29fS8LDrrBP6QRVgwHbxmCU17yUx7V7GMnfXUHwaEeNPetyJsAouUFguwoKYtCwEL3YkIYy/TeOdwGoxQfjR/GDPt0qbUtE95g0/do0FGLKY9hqGRAm60J516UdM+5tsXg52IKmbad09Dw7kQPZqpPwxMe98fNmJTT027POhNe0E3pp2hw09GAG+WvGn3pPBAaNrlAWbIbMS0++jO9PhBytgQhlQq5g/NtPPCMUKKmfbZiGlHKrBPSUIYL3ZjYzRq2nlA3x8W+u8PP2/aq4rhZ9/OWS3bota+aLA0jaIO8+FQNip4uY+02RDnEDsFgKGNRRZFyNxIP2QRUqNWEbEZzv8136qYcQ3ghwrClBcepRULXn8SOgQwxcDNTqJghBb5Y2jxl/jmmb5pT3z9NH54zP+Z1SKnGmZ+Hdd30yzENSLjhSM3Yt14XcALCxouZHGNKalvRaLHCvSEQDVlAR2MqAraPHrkxlsZm5C1l/ZtDf1db3c9hoMZNxGtZYTdDY4WHGf5Dsu8PUYWtPh3Wyeunim7/QlxFCtH7qbcded8CrZKiqStKbcW93RHTqM2U9AfLDOY9pJrLnlPxmRq2k0MZ1w2MeXSuVmXKkgXepFyKbmeTE661KuUm3yQhpSMgsx04xNSwM9IgYikmPbkoGD5UE5Mv4/o9+RjGe6/yfcHo/qZvj+kWP4fesUMstM+4zMAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/794c70b537698bd483d43304b9f93042/8ac56/image-20230705184531728.webp 240w,
/static/794c70b537698bd483d43304b9f93042/647a8/image-20230705184531728.webp 325w"
              sizes="(max-width: 325px) 100vw, 325px"
              type="image/webp"
            />
          <source
            srcset="/static/794c70b537698bd483d43304b9f93042/8ff5a/image-20230705184531728.png 240w,
/static/794c70b537698bd483d43304b9f93042/ff46a/image-20230705184531728.png 325w"
            sizes="(max-width: 325px) 100vw, 325px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/794c70b537698bd483d43304b9f93042/ff46a/image-20230705184531728.png"
            alt="image-20230705184531728"
            title="image-20230705184531728"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>これで、実際に実行される問題プログラムの挙動を追うことができそうです。</p>
<p>この Print デバッグ結果から、先ほどまで追っていた 1 文字取得後の処理を抜き出すと以下のようになります。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span>0x74<span class="token punctuation">]</span> OP:0xa  PUSH <span class="token number">0</span>
<span class="token punctuation">[</span>0x76<span class="token punctuation">]</span> OP:0x8  READ u
<span class="token punctuation">[</span>0x77<span class="token punctuation">]</span> OP:0x11  SPLIT BYTE TO BITS
<span class="token punctuation">[</span>0x78<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x7a<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">9</span>
<span class="token punctuation">[</span>0x7c<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">8</span>
<span class="token punctuation">[</span>0x7e<span class="token punctuation">]</span> OP:0xa  PUSH <span class="token number">0</span>
<span class="token punctuation">[</span>0x80<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x82<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">0</span>
<span class="token punctuation">[</span>0x83<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x85<span class="token punctuation">]</span> OP:0x5  XOR <span class="token number">0</span>, ffffffff <span class="token operator">=</span> ffffffff
<span class="token punctuation">[</span>0x86<span class="token punctuation">]</span> OP:0xc  JPM f117f519
<span class="token punctuation">[</span>0x89<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x8a<span class="token punctuation">]</span> OP:0xd  JPM f117f521
<span class="token punctuation">[</span>0x91<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x93<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x95<span class="token punctuation">]</span> OP:0xc  JPM f117f52f
<span class="token punctuation">[</span>0x9f<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0xa0<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">0</span>
<span class="token punctuation">[</span>0xa1<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">0</span>
<span class="token punctuation">[</span>0xa2<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">0</span>, <span class="token number">0</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">[</span>0xa3<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">0</span>, <span class="token number">0</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">[</span>0xa4<span class="token punctuation">]</span> OP:0xd  JPM f117f510
<span class="token punctuation">[</span>0x80<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x82<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">1</span>
<span class="token punctuation">[</span>0x83<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x85<span class="token punctuation">]</span> OP:0x5  XOR <span class="token number">1</span>, ffffffff <span class="token operator">=</span> fffffffe
<span class="token punctuation">[</span>0x86<span class="token punctuation">]</span> OP:0xc  JPM f117f519
<span class="token punctuation">[</span>0x89<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x8a<span class="token punctuation">]</span> OP:0xd  JPM f117f521
<span class="token punctuation">[</span>0x91<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x93<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x95<span class="token punctuation">]</span> OP:0xc  JPM f117f528
<span class="token punctuation">[</span>0x98<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x99<span class="token punctuation">]</span> OP:0xa  PUSH <span class="token number">1</span>
<span class="token punctuation">[</span>0x9b<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">0</span>, <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">[</span>0x9c<span class="token punctuation">]</span> OP:0xd  JPM f117f530
<span class="token punctuation">[</span>0xa0<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">1</span>
<span class="token punctuation">[</span>0xa1<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">1</span>
<span class="token punctuation">[</span>0xa2<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">1</span>, <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">[</span>0xa3<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">1</span>, <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token punctuation">[</span>0xa4<span class="token punctuation">]</span> OP:0xd  JPM f117f510
<span class="token punctuation">[</span>0x80<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x82<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">1</span>
<span class="token punctuation">[</span>0x83<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x85<span class="token punctuation">]</span> OP:0x5  XOR <span class="token number">1</span>, ffffffff <span class="token operator">=</span> fffffffe
<span class="token punctuation">[</span>0x86<span class="token punctuation">]</span> OP:0xc  JPM f117f519
<span class="token punctuation">[</span>0x89<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x8a<span class="token punctuation">]</span> OP:0xd  JPM f117f521
<span class="token punctuation">[</span>0x91<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x93<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x95<span class="token punctuation">]</span> OP:0xc  JPM f117f528
<span class="token punctuation">[</span>0x98<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x99<span class="token punctuation">]</span> OP:0xa  PUSH <span class="token number">1</span>
<span class="token punctuation">[</span>0x9b<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">3</span>, <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">4</span>
<span class="token punctuation">[</span>0x9c<span class="token punctuation">]</span> OP:0xd  JPM f117f530
<span class="token punctuation">[</span>0xa0<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">4</span>
<span class="token punctuation">[</span>0xa1<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">4</span>
<span class="token punctuation">[</span>0xa2<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">4</span>, <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">8</span>
<span class="token punctuation">[</span>0xa3<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">4</span>, <span class="token number">8</span> <span class="token operator">=</span> c
<span class="token punctuation">[</span>0xa4<span class="token punctuation">]</span> OP:0xd  JPM f117f510
<span class="token punctuation">[</span>0x80<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x82<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">1</span>
<span class="token punctuation">[</span>0x83<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x85<span class="token punctuation">]</span> OP:0x5  XOR <span class="token number">1</span>, ffffffff <span class="token operator">=</span> fffffffe
<span class="token punctuation">[</span>0x86<span class="token punctuation">]</span> OP:0xc  JPM f117f519
<span class="token punctuation">[</span>0x89<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x8a<span class="token punctuation">]</span> OP:0xd  JPM f117f521
<span class="token punctuation">[</span>0x91<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x93<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x95<span class="token punctuation">]</span> OP:0xc  JPM f117f528
<span class="token punctuation">[</span>0x98<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x99<span class="token punctuation">]</span> OP:0xa  PUSH <span class="token number">1</span>
<span class="token punctuation">[</span>0x9b<span class="token punctuation">]</span> OP:0x1  ADD c, <span class="token number">1</span> <span class="token operator">=</span> d
<span class="token punctuation">[</span>0x9c<span class="token punctuation">]</span> OP:0xd  JPM f117f530
<span class="token punctuation">[</span>0xa0<span class="token punctuation">]</span> OP:0xf  DUP d
<span class="token punctuation">[</span>0xa1<span class="token punctuation">]</span> OP:0xf  DUP d
<span class="token punctuation">[</span>0xa2<span class="token punctuation">]</span> OP:0x1  ADD d, d <span class="token operator">=</span> 1a
<span class="token punctuation">[</span>0xa3<span class="token punctuation">]</span> OP:0x1  ADD d, 1a <span class="token operator">=</span> <span class="token number">27</span>
<span class="token punctuation">[</span>0xa4<span class="token punctuation">]</span> OP:0xd  JPM f117f510
<span class="token punctuation">[</span>0x80<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x82<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">0</span>
<span class="token punctuation">[</span>0x83<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x85<span class="token punctuation">]</span> OP:0x5  XOR <span class="token number">0</span>, ffffffff <span class="token operator">=</span> ffffffff
<span class="token punctuation">[</span>0x86<span class="token punctuation">]</span> OP:0xc  JPM f117f519
<span class="token punctuation">[</span>0x89<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x8a<span class="token punctuation">]</span> OP:0xd  JPM f117f521
<span class="token punctuation">[</span>0x91<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x93<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x95<span class="token punctuation">]</span> OP:0xc  JPM f117f52f
<span class="token punctuation">[</span>0x9f<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0xa0<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">27</span>
<span class="token punctuation">[</span>0xa1<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">27</span>
<span class="token punctuation">[</span>0xa2<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">27</span>, <span class="token number">27</span> <span class="token operator">=</span> 4e
<span class="token punctuation">[</span>0xa3<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">27</span>, 4e <span class="token operator">=</span> <span class="token number">75</span>
<span class="token punctuation">[</span>0xa4<span class="token punctuation">]</span> OP:0xd  JPM f117f510
<span class="token punctuation">[</span>0x80<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x82<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">1</span>
<span class="token punctuation">[</span>0x83<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x85<span class="token punctuation">]</span> OP:0x5  XOR <span class="token number">1</span>, ffffffff <span class="token operator">=</span> fffffffe
<span class="token punctuation">[</span>0x86<span class="token punctuation">]</span> OP:0xc  JPM f117f519
<span class="token punctuation">[</span>0x89<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x8a<span class="token punctuation">]</span> OP:0xd  JPM f117f521
<span class="token punctuation">[</span>0x91<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x93<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x95<span class="token punctuation">]</span> OP:0xc  JPM f117f528
<span class="token punctuation">[</span>0x98<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x99<span class="token punctuation">]</span> OP:0xa  PUSH <span class="token number">1</span>
<span class="token punctuation">[</span>0x9b<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">75</span>, <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">76</span>
<span class="token punctuation">[</span>0x9c<span class="token punctuation">]</span> OP:0xd  JPM f117f530
<span class="token punctuation">[</span>0xa0<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">76</span>
<span class="token punctuation">[</span>0xa1<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">76</span>
<span class="token punctuation">[</span>0xa2<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">76</span>, <span class="token number">76</span> <span class="token operator">=</span> ec
<span class="token punctuation">[</span>0xa3<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">76</span>, ffffffec <span class="token operator">=</span> <span class="token number">62</span>
<span class="token punctuation">[</span>0xa4<span class="token punctuation">]</span> OP:0xd  JPM f117f510
<span class="token punctuation">[</span>0x80<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x82<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">0</span>
<span class="token punctuation">[</span>0x83<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x85<span class="token punctuation">]</span> OP:0x5  XOR <span class="token number">0</span>, ffffffff <span class="token operator">=</span> ffffffff
<span class="token punctuation">[</span>0x86<span class="token punctuation">]</span> OP:0xc  JPM f117f519
<span class="token punctuation">[</span>0x89<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x8a<span class="token punctuation">]</span> OP:0xd  JPM f117f521
<span class="token punctuation">[</span>0x91<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x93<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x95<span class="token punctuation">]</span> OP:0xc  JPM f117f52f
<span class="token punctuation">[</span>0x9f<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0xa0<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">62</span>
<span class="token punctuation">[</span>0xa1<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">62</span>
<span class="token punctuation">[</span>0xa2<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">62</span>, <span class="token number">62</span> <span class="token operator">=</span> c4
<span class="token punctuation">[</span>0xa3<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">62</span>, ffffffc4 <span class="token operator">=</span> <span class="token number">26</span>
<span class="token punctuation">[</span>0xa4<span class="token punctuation">]</span> OP:0xd  JPM f117f510
<span class="token punctuation">[</span>0x80<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x82<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">1</span>
<span class="token punctuation">[</span>0x83<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x85<span class="token punctuation">]</span> OP:0x5  XOR <span class="token number">1</span>, ffffffff <span class="token operator">=</span> fffffffe
<span class="token punctuation">[</span>0x86<span class="token punctuation">]</span> OP:0xc  JPM f117f519
<span class="token punctuation">[</span>0x89<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x8a<span class="token punctuation">]</span> OP:0xd  JPM f117f521
<span class="token punctuation">[</span>0x91<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x93<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x95<span class="token punctuation">]</span> OP:0xc  JPM f117f528
<span class="token punctuation">[</span>0x98<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x99<span class="token punctuation">]</span> OP:0xa  PUSH <span class="token number">1</span>
<span class="token punctuation">[</span>0x9b<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">26</span>, <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">27</span>
<span class="token punctuation">[</span>0x9c<span class="token punctuation">]</span> OP:0xd  JPM f117f530
<span class="token punctuation">[</span>0xa0<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">27</span>
<span class="token punctuation">[</span>0xa1<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">27</span>
<span class="token punctuation">[</span>0xa2<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">27</span>, <span class="token number">27</span> <span class="token operator">=</span> 4e
<span class="token punctuation">[</span>0xa3<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">27</span>, 4e <span class="token operator">=</span> <span class="token number">75</span>
<span class="token punctuation">[</span>0xa4<span class="token punctuation">]</span> OP:0xd  JPM f117f510
<span class="token punctuation">[</span>0x80<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x82<span class="token punctuation">]</span> OP:0xf  DUP ffffffff
<span class="token punctuation">[</span>0x83<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x85<span class="token punctuation">]</span> OP:0x5  XOR ffffffff, ffffffff <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">[</span>0x86<span class="token punctuation">]</span> OP:0xc  JPM f117f51d
<span class="token punctuation">[</span>0x8d<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x8e<span class="token punctuation">]</span> OP:0xd  JPM f117f537
<span class="token punctuation">[</span>0xa7<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0xa8<span class="token punctuation">]</span> OP:0x8  READ i</code></pre></div>
<p>かなり長いです。</p>
<p>僕はここで完全に詰んだのですが、<a href="https://github.com/D13David/ctf-writeups/blob/main/uiuctf23/rev/vmwhere2/README.md" target="_blank" rel="nofollow noopener noreferrer">ctf-writeups/uiuctf23/rev/vmwhere2</a> を参考にしたところ、以下のような Base3 エンコーディングを行う Python スクリプトに書き起こすことができるようです。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">result <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
		result <span class="token operator">=</span> <span class="token punctuation">(</span>result <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		result <span class="token operator">=</span> result <span class="token operator">*</span> <span class="token number">3</span>
	result <span class="token operator">=</span> result <span class="token operator">%</span> <span class="token number">256</span>
<span class="token keyword">return</span> result</code></pre></div>
<p>なるほどたしかに、0xa0 から 0x9c までのループ構造を見抜けば、そんな処理に見えなくもないような気がする・・・？（しない）</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span>0xa0<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">1</span>
<span class="token punctuation">[</span>0xa1<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">1</span>
<span class="token punctuation">[</span>0xa2<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">1</span>, <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">[</span>0xa3<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">1</span>, <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token punctuation">[</span>0xa4<span class="token punctuation">]</span> OP:0xd  JPM f117f510

<span class="token punctuation">[</span>0x80<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x82<span class="token punctuation">]</span> OP:0xf  DUP <span class="token number">1</span>
<span class="token punctuation">[</span>0x83<span class="token punctuation">]</span> OP:0xa  PUSH ffffffff
<span class="token punctuation">[</span>0x85<span class="token punctuation">]</span> OP:0x5  XOR <span class="token number">1</span>, ffffffff <span class="token operator">=</span> fffffffe
<span class="token punctuation">[</span>0x86<span class="token punctuation">]</span> OP:0xc  JPM f117f519
<span class="token punctuation">[</span>0x89<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x8a<span class="token punctuation">]</span> OP:0xd  JPM f117f521

<span class="token punctuation">[</span>0x91<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x93<span class="token punctuation">]</span> OP:0x10  REVERSE TOP <span class="token number">2</span>
<span class="token punctuation">[</span>0x95<span class="token punctuation">]</span> OP:0xc  JPM f117f528

<span class="token punctuation">[</span>0x98<span class="token punctuation">]</span> OP:0xe  POP
<span class="token punctuation">[</span>0x99<span class="token punctuation">]</span> OP:0xa  PUSH <span class="token number">1</span>
<span class="token punctuation">[</span>0x9b<span class="token punctuation">]</span> OP:0x1  ADD <span class="token number">3</span>, <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">4</span>
<span class="token punctuation">[</span>0x9c<span class="token punctuation">]</span> OP:0xd  JPM f117f530</code></pre></div>
<p>しばらく出力結果とにらめっこしたものの、残念ながら処理をすっきり理解することはできませんでした。</p>
<p>ただし、こうして変換した入力値は最終的にどこかの値と比較することになるだろうという予測が立ちます。</p>
<p>実際に 1 文字目に “u” を入力した場合の演算結果である 0x75 と比較を行っている箇所を見つけました。</p>
<p>以下のように入力値を変更してみると XOR の結果が変わることから、最終的にこのあたりで Flag の検証を行っているだろうということがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 919px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7956a882f04292acb11b20e2a45579b6/6295b/image-20230705203219584.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 13.750000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvElEQVQI1yWO226CQBRF+YBGiUZrLPYGTSMDMiAwwOhArbb9/x9aPZ0+7Kych732CYakwtUjNm6xz446sjRbQ7GqScMCFWoyYSosV0eurz3TrsEsM8/Lk/H8eXfcYktwjis+mwsu6RiTD8zO0kUdx02LmuVk84MkRwn1Uvuy21a0C8VZOEY17uFvaPDyYHop+TZfTG89t/1VvjxhH3svVXcp+SyTKDJhuTh4ob3XNOGeYV1w2mi5i/8hEf8CbHhbuAobE+cAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/7956a882f04292acb11b20e2a45579b6/8ac56/image-20230705203219584.webp 240w,
/static/7956a882f04292acb11b20e2a45579b6/d3be9/image-20230705203219584.webp 480w,
/static/7956a882f04292acb11b20e2a45579b6/5041b/image-20230705203219584.webp 919w"
              sizes="(max-width: 919px) 100vw, 919px"
              type="image/webp"
            />
          <source
            srcset="/static/7956a882f04292acb11b20e2a45579b6/8ff5a/image-20230705203219584.png 240w,
/static/7956a882f04292acb11b20e2a45579b6/e85cb/image-20230705203219584.png 480w,
/static/7956a882f04292acb11b20e2a45579b6/6295b/image-20230705203219584.png 919w"
            sizes="(max-width: 919px) 100vw, 919px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/7956a882f04292acb11b20e2a45579b6/6295b/image-20230705203219584.png"
            alt="image-20230705203219584"
            title="image-20230705203219584"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>そこで、バイナリの 0xb90 あたりからハードコードされた Key を探してみます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 696px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b0966b7f74539817fdde71c0d2ffe209/82158/image-20230705204000304.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABTElEQVQoz1VQy07CUBDtt7lRf8CYqHGjJq6MCeqOGBCQgqClPPqilEKhUFoqiomGhV92vDOtFRfnzpmZmzNnRlLydcz0MdqFJrRyC/qjCqPaZugVFb2SwtyUO6LX5n6/3kP9rgw5V4R8U0Q1V0Dt9gGlqzwkr+Pge71BYE0QuwFeRyHjzYtSvsBqHDEoX4n6ehpjrNpiSBf2k5bBqnUh0fPOHwbslOBro4zPDQ9+yqdpfW567JLca5VWEstJlGiVX0FfH/HnbTFCYE44zoyktuhPWdCsdvgUBDLGgsMXC5v4k12F9gyRM0c8DLAUkXg0SGrLLcTuglfs0c3Fnem2tD65lZymga/ogwVpckgCKWhAaPv/cxFJ1FX6sIRLu6FjIDScZ5NdS+p9g9c0hH1qJE0j43+5nuWuYuH68BKnOwe42D/B2e4RzveOOf4A76mI9p3dT7MAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/b0966b7f74539817fdde71c0d2ffe209/8ac56/image-20230705204000304.webp 240w,
/static/b0966b7f74539817fdde71c0d2ffe209/d3be9/image-20230705204000304.webp 480w,
/static/b0966b7f74539817fdde71c0d2ffe209/038cb/image-20230705204000304.webp 696w"
              sizes="(max-width: 696px) 100vw, 696px"
              type="image/webp"
            />
          <source
            srcset="/static/b0966b7f74539817fdde71c0d2ffe209/8ff5a/image-20230705204000304.png 240w,
/static/b0966b7f74539817fdde71c0d2ffe209/e85cb/image-20230705204000304.png 480w,
/static/b0966b7f74539817fdde71c0d2ffe209/82158/image-20230705204000304.png 696w"
            sizes="(max-width: 696px) 100vw, 696px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/b0966b7f74539817fdde71c0d2ffe209/82158/image-20230705204000304.png"
            alt="image-20230705204000304"
            title="image-20230705204000304"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>コードを見てわかった通り Flag 文字は逆順に埋め込まれているので、一番下の 0x75 が 1 文字目との比較を行う Key になっています。</p>
<p>ここまでわかったので、以下のように適当な文字列を突っ込んだところ、すべての Key と思われる箇所を特定することができました。(0x67 と比較を行っている値がすべて Key になります。)</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b3dad32f6a0985f871dae4d48c20123a/9de76/image-20230705204415010.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 67.08333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBklEQVQ4y62SS0/CQBSFu4MQEoJAcSsSgcLMEJRHJYG2UF4qBKFiogH5/z/icG9JURZuGBZ3MY98+eacMb77KyyVj1Fe4sVy0cnUIGMF1BPFi8b4GWwQPE4xuVWYy6E+8K/ha9VD+4aAcQ3g1g3IcHIytHOSDO8uB3713o+GJhu6IVDoAHfex6+hoAyz4koZsmHN038yZ7i+qmEvalnRP3So5apey5zhukGGBFwQ+NnULCXKcExAbrmd0fyH+8EnAjKcUobLug87zJAN76EIzHDOlPfOpxC+hM+je7w2Vt03zIQLx1TwSw6aWQWReIBMltFIWWGmdk78MxKttIWnVAUtusdxHQD2u3hpAoko1AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/b3dad32f6a0985f871dae4d48c20123a/8ac56/image-20230705204415010.webp 240w,
/static/b3dad32f6a0985f871dae4d48c20123a/d3be9/image-20230705204415010.webp 480w,
/static/b3dad32f6a0985f871dae4d48c20123a/e46b2/image-20230705204415010.webp 960w,
/static/b3dad32f6a0985f871dae4d48c20123a/fb6f1/image-20230705204415010.webp 1423w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/b3dad32f6a0985f871dae4d48c20123a/8ff5a/image-20230705204415010.png 240w,
/static/b3dad32f6a0985f871dae4d48c20123a/e85cb/image-20230705204415010.png 480w,
/static/b3dad32f6a0985f871dae4d48c20123a/d9199/image-20230705204415010.png 960w,
/static/b3dad32f6a0985f871dae4d48c20123a/9de76/image-20230705204415010.png 1423w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/b3dad32f6a0985f871dae4d48c20123a/d9199/image-20230705204415010.png"
            alt="image-20230705204415010"
            title="image-20230705204415010"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span> </p>
<p>ここから Key を抽出できたので、Python で各文字と変換後の値のテーブルを作って Flag を取得できるようにします。</p>
<p>以下の Solver を作成しました。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> subprocess

key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0xc6</span><span class="token punctuation">,</span><span class="token number">0x8b</span><span class="token punctuation">,</span><span class="token number">0xd9</span><span class="token punctuation">,</span><span class="token number">0xcf</span><span class="token punctuation">,</span><span class="token number">0x63</span><span class="token punctuation">,</span><span class="token number">0x60</span><span class="token punctuation">,</span><span class="token number">0xd8</span><span class="token punctuation">,</span><span class="token number">0x7b</span><span class="token punctuation">,</span><span class="token number">0xd8</span><span class="token punctuation">,</span><span class="token number">0x60</span><span class="token punctuation">,</span><span class="token number">0xf6</span><span class="token punctuation">,</span><span class="token number">0xd3</span><span class="token punctuation">,</span><span class="token number">0x7b</span><span class="token punctuation">,</span><span class="token number">0xf6</span><span class="token punctuation">,</span><span class="token number">0xd8</span><span class="token punctuation">,</span><span class="token number">0xc1</span><span class="token punctuation">,</span><span class="token number">0xcf</span><span class="token punctuation">,</span><span class="token number">0xd0</span><span class="token punctuation">,</span><span class="token number">0xf6</span><span class="token punctuation">,</span><span class="token number">0x72</span><span class="token punctuation">,</span><span class="token number">0x63</span><span class="token punctuation">,</span><span class="token number">0x75</span><span class="token punctuation">,</span><span class="token number">0xbe</span><span class="token punctuation">,</span><span class="token number">0xf6</span><span class="token punctuation">,</span><span class="token number">0x7f</span><span class="token punctuation">,</span><span class="token number">0xd8</span><span class="token punctuation">,</span><span class="token number">0x63</span><span class="token punctuation">,</span><span class="token number">0xe7</span><span class="token punctuation">,</span><span class="token number">0x6d</span><span class="token punctuation">,</span><span class="token number">0xf6</span><span class="token punctuation">,</span><span class="token number">0x63</span><span class="token punctuation">,</span><span class="token number">0xcf</span><span class="token punctuation">,</span><span class="token number">0xf6</span><span class="token punctuation">,</span><span class="token number">0xd8</span><span class="token punctuation">,</span><span class="token number">0xf6</span><span class="token punctuation">,</span><span class="token number">0xd8</span><span class="token punctuation">,</span><span class="token number">0x63</span><span class="token punctuation">,</span><span class="token number">0xe7</span><span class="token punctuation">,</span><span class="token number">0x6d</span><span class="token punctuation">,</span><span class="token number">0xb4</span><span class="token punctuation">,</span><span class="token number">0x88</span><span class="token punctuation">,</span><span class="token number">0x72</span><span class="token punctuation">,</span><span class="token number">0x70</span><span class="token punctuation">,</span><span class="token number">0x75</span><span class="token punctuation">,</span><span class="token number">0xb8</span><span class="token punctuation">,</span><span class="token number">0x75</span><span class="token punctuation">]</span>
key <span class="token operator">=</span> key<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
table <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0xfd</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cmd <span class="token operator">=</span> <span class="token string">'echo "{}" | ./a.out | grep 0xb90 | cut -d " " -f 5'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> capture_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    table<span class="token punctuation">[</span>result<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">",\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token keyword">for</span> k <span class="token keyword">in</span> key<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">[</span><span class="token builtin">hex</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span></code></pre></div>
<p>これを実行すると Flag を取得できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 746px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b15e5ac4dee2f49415d826a2f51e0903/62de4/image-20230705210305482.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 24.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVQY05XMQXOCMBQEYG5YPNSx1Y6dUUEEFCQJQQ0TEiitl/7/H7R9YGs99NLDN7v7MhPn00/xtj7hEhu0/hnN8gg1L6AXe7yXJbRqYCsLyY5IowxFWqDIJMqDpM4oBWTWJx+2oyOFhlm0wkKFJaxfwW47qKWG9mtUa4NqVQ83HTbIXiX2qxNEcMaFtfjYdTCBQZd0sBtDH84Y9HOOes4pqdO2C3Hds/zGvHAYuvNJDPGUgE/JY4zci3AY75ARNk7gsNEGvdwNhmTud3ev/f69J0YhOBE/PPLwyxHeFv/B7/x1+wJxBZIwu13iqgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/b15e5ac4dee2f49415d826a2f51e0903/8ac56/image-20230705210305482.webp 240w,
/static/b15e5ac4dee2f49415d826a2f51e0903/d3be9/image-20230705210305482.webp 480w,
/static/b15e5ac4dee2f49415d826a2f51e0903/f7ebd/image-20230705210305482.webp 746w"
              sizes="(max-width: 746px) 100vw, 746px"
              type="image/webp"
            />
          <source
            srcset="/static/b15e5ac4dee2f49415d826a2f51e0903/8ff5a/image-20230705210305482.png 240w,
/static/b15e5ac4dee2f49415d826a2f51e0903/e85cb/image-20230705210305482.png 480w,
/static/b15e5ac4dee2f49415d826a2f51e0903/62de4/image-20230705210305482.png 746w"
            sizes="(max-width: 746px) 100vw, 746px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/b15e5ac4dee2f49415d826a2f51e0903/62de4/image-20230705210305482.png"
            alt="image-20230705210305482"
            title="image-20230705210305482"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2 id="まとめ" style="position:relative;"><a href="#%E3%81%BE%E3%81%A8%E3%82%81" aria-label="まとめ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>まとめ</h2>
<p>今回はかなり純粋な Rev 力の不足を痛感しました。</p>
<p>先日の Google CTF もそうでしたが、Writeup を読みこんでも解けないような問題に最近頻繁にぶつかります。</p>
<p>今解けないような問題を解いて上位を目指すためには、ツールの使い方などではなく、純粋にバイナリを読んで挙動を理解できる力をきたえていかないといけないなと痛感しています。</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Jul 5, 2023</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/ctf/">CTF</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/rev/">Rev</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたいCTF Player(Team: 0nePadding)。WinDbgとYARAが好き。OSCP / CISSP / AtCoder 緑 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/kash1064" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ctf-uiuctf-2023";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-2508de546c0ea9cf9a63.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-76f2006942127b3c7274.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-70ba56c0f46525baa629.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-d19905e5c8fc953958f1.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-6ba68ef37e264f701345.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-0faa242d92f89b71e668.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-2508de546c0ea9cf9a63.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-c234cda2451411e871dc.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-a3c0f166cb4b802ff58f.js" async=""></script></body></html>