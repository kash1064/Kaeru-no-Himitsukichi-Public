<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e71379dda153709d1a9a.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.625rem;margin:.3125rem 0;border:1px solid #999;border-radius:.3125rem}.Sidebar-module--search-container--17C6F{position:relative}.Sidebar-module--search-container-input--27Tw4{width:100%}.Sidebar-module--search-container-submit--WwtLg{position:absolute;width:2.375rem;height:2.375rem;top:calc(50% - 19px);right:0;border:3px solid #999;border-radius:0 .25rem .25rem 0;background:#999}.Sidebar-module--search-container-submit--WwtLg:before{position:absolute;content:"";width:.9375rem;height:.9375rem;top:calc(50% - 9px);left:calc(50% - 9px);border-radius:50%;box-shadow:0 0 0 2px #fff}.Sidebar-module--search-container-submit--WwtLg:after{position:absolute;content:"";width:.5rem;height:.375rem;top:calc(50% + 6px);left:calc(50% + 2px);border-top:2px solid #fff;transform:rotate(45deg)}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">Magical WinDbg VOL.1【4 章 アプリケーションのクラッシュダンプを解析する】 - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content="技術書典 15 で頒布した Magical WinDbg -雰囲気で楽しむ Windows ダンプ解析とトラブルシューティング- VOL.1 の WEB 版です。"/><meta data-react-helmet="true" property="og:site_name" content="Magical WinDbg VOL.1【4 章 アプリケーションのクラッシュダンプを解析する】 - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/2dbf3e09d59db889dc9dc41adcc8e827/magical-windbg-vol1.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="Magical WinDbg VOL.1【4 章 アプリケーションのクラッシュダンプを解析する】 - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content="技術書典 15 で頒布した Magical WinDbg -雰囲気で楽しむ Windows ダンプ解析とトラブルシューティング- VOL.1 の WEB 版です。"/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/2dbf3e09d59db889dc9dc41adcc8e827/magical-windbg-vol1.png"/><link as="script" rel="preload" href="/webpack-runtime-a3c0f166cb4b802ff58f.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-ccbc7c7848e640d6928d.js"/><link as="script" rel="preload" href="/app-6aedca512ffc346655cd.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/magical-windbg-vol1-04/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Magical WinDbg VOL.1【4 章 アプリケーションのクラッシュダンプを解析する】</h1><div class="Content-module--content__body--2TrQ-"><p>本章では、シンプルなアプリケーションクラッシュダンプを WinDbg で解析していきます。</p>
<!-- omit in toc -->
<h2 id="もくじ" style="position:relative;"><a href="#%E3%82%82%E3%81%8F%E3%81%98" aria-label="もくじ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>もくじ</h2>
<ul>
<li><a href="#%E8%A7%A3%E6%9E%90%E7%94%A8%E3%81%AE%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%83%80%E3%83%B3%E3%83%97%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B">解析用のアプリケーションクラッシュダンプを作成する</a></li>
<li><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%83%80%E3%83%B3%E3%83%97%E3%82%92-windbg-%E3%81%A7%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B">アプリケーションクラッシュダンプを WinDbg でロードする</a></li>
<li><a href="#analyze-%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%81%A7%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%83%80%E3%83%B3%E3%83%97%E3%82%92%E5%88%86%E6%9E%90%E3%81%99%E3%82%8B">!analyze 拡張機能でクラッシュダンプを分析する</a></li>
<li><a href="#%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%97%E3%81%9F%E5%89%8D%E5%BE%8C%E3%81%AE%E5%91%BD%E4%BB%A4%E3%82%92%E8%AA%AD%E3%82%80">クラッシュが発生した前後の命令を読む</a></li>
<li><a href="#appendixghidra-%E3%81%A7%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E8%A7%A3%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%86">Appendix：Ghidra でバイナリ解析を行う</a></li>
<li><a href="#4-%E7%AB%A0%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81">4 章のまとめ</a></li>
<li><a href="#%E5%90%84%E7%AB%A0%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF">各章へのリンク</a></li>
</ul>
<h2 id="解析用のアプリケーションクラッシュダンプを作成する" style="position:relative;"><a href="#%E8%A7%A3%E6%9E%90%E7%94%A8%E3%81%AE%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%83%80%E3%83%B3%E3%83%97%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B" aria-label="解析用のアプリケーションクラッシュダンプを作成する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解析用のアプリケーションクラッシュダンプを作成する</h2>
<p>まずは、解析用のアプリケーションクラッシュダンプを作成します。</p>
<p>1 章でダウンロードした D4C.exe を起動して、1 番のメニューを指定 Enter キーを押下すると、D4C.exe がクラッシュしてユーザモードクラッシュダンプが生成されます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c58f6d77ace8f688147832a7dc606615/0b533/app-crash-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 52.083333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABE0lEQVQoz52Sy07DMBBFraKWxOPEJMSOSolInMcCpBZWbPgFXmtEoXueaz7+4rhFBCnQ0sWRvfCcuWObNSdTNKVBVZaoq9KtJs9hihyTgzFUkkCpv0nTFFHIcTt/BpsUtS0uUBTGUdcNjDHIsgxCCPi+vxZOAgPGcHn3BKYPj1wKbbtoraGVQhzHkFI64SaEocRoh+H6/gWM7+2Dt104WbiDiBxfBd19H0EQYjhguJq/gok4gSD+6+F1MicMV8LHNzCKrLBN1SneRNIrXLz/FIot+Ra2CWNlR7Z3JoJlyn+yFMpOQhlBeCMI39sO7iEQhKH9NjcL+yh0fA6qpqD6tJ+qywxUdjCWYgZhzrA7bnDx8IFPSXv1Y15jct8AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/c58f6d77ace8f688147832a7dc606615/8ac56/app-crash-001.webp 240w,
/static/c58f6d77ace8f688147832a7dc606615/d3be9/app-crash-001.webp 480w,
/static/c58f6d77ace8f688147832a7dc606615/b0a15/app-crash-001.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/c58f6d77ace8f688147832a7dc606615/8ff5a/app-crash-001.png 240w,
/static/c58f6d77ace8f688147832a7dc606615/e85cb/app-crash-001.png 480w,
/static/c58f6d77ace8f688147832a7dc606615/0b533/app-crash-001.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/c58f6d77ace8f688147832a7dc606615/0b533/app-crash-001.png"
            alt="D4C.exe でアプリケーションクラッシュを作成する"
            title="D4C.exe でアプリケーションクラッシュを作成する"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Windows 10 などの最新の OS では、ユーザーモードアプリケーションがクラッシュすると、WER サービスが起動されてクラッシュレポートの作成が行われますが、この過程でアプリケーションのユーザモードクラッシュダンプが生成されます。<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup></p>
<p>生成されたユーザモードクラッシュダンプは、既定では <code class="language-text">C:\Users\&lt;ユーザ名>\AppData\Local\CrashDumps</code> に保存されます。</p>
<p>また、既定値ではアプリケーションのクラッシュ時に生成されるダンプファイルの種類はミニダンプです。</p>
<p>ミニダンプとは、アプリケーションのクラッシュが発生した時点のスレッドのレジスタとスタックの情報を、レジスタが参照しているメモリのページとともにキャプチャしたものです。<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup></p>
<p>クラッシュ事象の調査に必要な最小限の情報はミニダンプからも確認が可能ですが、より詳細なトラブルシューティングを行う場合には、ターゲットプロセスのユーザーモードのメモリ領域をすべてキャプチャしたフルダンプを取得することが望ましいです。
(ただし、1 章に記載した通り、指定するオプションによってはプロセスのミニダンプにはフルダンプよりも多くの情報が含まれる場合があります)</p>
<p>アプリケーションクラッシュが発生した場合に生成されるダンプの種類を変更する場合、 レジストリキー <code class="language-text">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting\LocalDumps</code> 内の DWORD 値 DumpType を 2 に変更します。</p>
<p>なお、D4C.exe によるフルメモリダンプの取得設定を実施している環境の場合、生成されるアプリケーションのクラッシュダンプの種類はすでにフルダンプに変更されているため、D4C.exe のクラッシュ時にもフルダンプが生成されます。</p>
<br>
<p>ユーザーモードダンプの収集:</p>
<p><a href="https://learn.microsoft.com/ja-jp/windows/win32/wer/collecting-user-mode-dumps" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows/win32/wer/collecting-user-mode-dumps</a></p>
<br>
<h2 id="アプリケーションクラッシュダンプを-windbg-でロードする" style="position:relative;"><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%83%80%E3%83%B3%E3%83%97%E3%82%92-windbg-%E3%81%A7%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B" aria-label="アプリケーションクラッシュダンプを windbg でロードする permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>アプリケーションクラッシュダンプを WinDbg でロードする</h2>
<p>D4C.exe のクラッシュ時に生成されたアプリケーションクラッシュダンプは既定では <code class="language-text">C:\Users\&lt;ユーザ名>\AppData\Local\CrashDumps</code> に保存されます。</p>
<p>解析を行うために、管理者権限で起動した 64 bit 用の WinDbg でショートカットキー [Ctrl + D] を使用して、このフォルダの中から取得したダンプファイルをロードします。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/32016a8a77a453089befebfe67715d64/0b533/app-crash-002.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABq0lEQVQoz41Ti26jMBDk/3+p9wNVKy6EkEDC8QwQsHmERyEEMrd2RdSLempGGhnj2dldvChvqoZ3dQ11ZUDfWtA2JnZ7F7uDi8MfD3uiYR6w3tnQTUdyY7lyNUi3cLP3sKZY5U39DWNnITgmcLwAfhDBC460jxFGCU4po31ESRzYboCD41MSn55DnFiJvGrBqwZl/UHxIZSNrsPcGuAsQ845OGdomwZD3+N6vUKgH0a4joMi56RhSNOT1DVNjes4Ypo+dee6hvLrVcfLqwHVThGfMlRViZoO2raVFKjbDpqmwbZteJ6HjDEZPM8zbrcbJloF8qKEstJ0bE0LPC+QZRnKsqTMDbqukxTo+kGa+b6PKKbqikomu1wusgthKlBIw5UGy7JQFgUYZRbV9dTuMAySooq26yl4xCOE0cK7oe1FcMMEfpwhSBiCmCFMOPFzjenDO0FyN3w0Wd7dDadpxk+QFY7/Gv63wkfhIxfD8Qnd04ZN9/Ftywvnr7c8TdOPLYtbfkZXVhWUoqzQ0AjUNCrfUYxHxnL5x1TnmoLOdzKe0xlHmjFZXRAe8Rdh8ZUTX5wcugAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/32016a8a77a453089befebfe67715d64/8ac56/app-crash-002.webp 240w,
/static/32016a8a77a453089befebfe67715d64/d3be9/app-crash-002.webp 480w,
/static/32016a8a77a453089befebfe67715d64/b0a15/app-crash-002.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/32016a8a77a453089befebfe67715d64/8ff5a/app-crash-002.png 240w,
/static/32016a8a77a453089befebfe67715d64/e85cb/app-crash-002.png 480w,
/static/32016a8a77a453089befebfe67715d64/0b533/app-crash-002.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/32016a8a77a453089befebfe67715d64/0b533/app-crash-002.png"
            alt="WinDbg でユーザーモードフルダンプをロード"
            title="WinDbg でユーザーモードフルダンプをロード"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>WinDbg の起動直後の Command ウインドウには、<code class="language-text">Path validation summary</code> の情報が表示されています。</p>
<p><code class="language-text">Path validation summary</code> には解析に有用な情報が記載されているので、いくつか内容を確認してみましょう。</p>
<p>まずは以下の前半部分ですが、こちらには現在設定している .sympath の情報や OS バージョンなどが記載されています。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Response                         Time (ms)     Location
Deferred                                       srv*https://msdl.microsoft.com/download/symbols
Symbol search path is: srv*https://msdl.microsoft.com/download/symbols
Executable search path is: 
Windows 10 Version 19045 MP (8 procs) Free x64
Product: WinNt, suite: SingleUserTS
Edition build lab: 19041.1.amd64fre.vb_release.191206-1406</code></pre></div>
<p>続いて以下の行ですが、<code class="language-text">Debug session time</code> にはプロセスクラッシュが発生した時刻が、また、<code class="language-text">System Uptime</code> と <code class="language-text">Process Uptime</code> には、アプリケーションがクラッシュするまでのシステムの稼働時間とプロセスの稼働時間がそれぞれ記載されています。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Debug session time: Wed Sep 13 20:36:00.000 2023 (UTC + 9:00)
System Uptime: 1 days 20:35:58.000
Process Uptime: 0 days 0:00:56.000</code></pre></div>
<p>また、以下の行には、アプリケーションのクラッシュを直接的に引き起こした例外コードが表示されています。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">This dump file has an exception of interest stored in it.
The stored exception information can be accessed via .ecxr.
(2f10.598): Access violation - code c0000005 (first/second chance not available)
For analysis of this file, run !analyze -v
ntdll!NtWaitForMultipleObjects+0x14:
00007fff`35fcd9a4 c3              ret</code></pre></div>
<p>ここに記載されている <code class="language-text">Access violation - code c0000005 (first/second chance not available)</code> という情報から、アプリケーションクラッシュの直接の原因がメモリアクセス違反 (Access violation) であるということを容易に特定できました。</p>
<br>
<p>アクセス違反 C0000005:</p>
<p><a href="https://learn.microsoft.com/ja-jp/shows/inside/c0000005" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/shows/inside/c0000005</a></p>
<br>
<p>ここから、さらに具体的に問題が発生した処理を特定していきます。</p>
<h2 id="analyze-拡張機能でクラッシュダンプを分析する" style="position:relative;"><a href="#analyze-%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%81%A7%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%83%80%E3%83%B3%E3%83%97%E3%82%92%E5%88%86%E6%9E%90%E3%81%99%E3%82%8B" aria-label="analyze 拡張機能でクラッシュダンプを分析する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>!analyze 拡張機能でクラッシュダンプを分析する</h2>
<p>WinDbg でクラッシュダンプを解析する上で最もよく使うコマンドの一つは <code class="language-text">!analyze -v</code> かと思います。</p>
<p>このコマンドでは、<code class="language-text">!analyze</code> 拡張機能を使用してクラッシュダンプで収集した例外に関する詳細情報を表示できます。</p>
<br>
<p>!analyze (WinDbg):</p>
<p><a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-analyze" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-analyze</a></p>
<br>
<p>なお、エクスクラメーション(<code class="language-text">!</code>) から始まるコマンドは通常、デバッガの拡張機能を呼び出すコマンドを意味します。</p>
<p>デバッガの拡張機能は、デバッガとは別のモジュールとして用意した DLL を WinDbg にロードすることで使用できます。</p>
<p>WinDbg には、既定でロードされている拡張機能がいくつか存在しますが、ユーザが独自に拡張機能を作成してデバッガにロードすることもできます。</p>
<p>WinDbg に現在ロードされている拡張機能の一覧は、<code class="language-text">.chain</code> コマンドで取得できます。</p>
<p>私の手元の環境で実際に<code class="language-text">.chain</code> コマンドを実行すると、以下の結果を取得することができました。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Extension DLL chain:

ext: image 10.0.22621.1778, API 1.0.0, 
  [path: C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\winext\ext.dll]

ELFBinComposition: image 10.0.22621.1778, API 0.0.0, 
  [path: C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\winext\ELFBinComposition.dll]

dbghelp: image 10.0.22621.1778, API 10.0.6, 
  [path: C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\dbghelp.dll]

exts: image 10.0.22621.1778, API 1.0.0, 
  [path: C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\WINXP\exts.dll]

uext: image 10.0.22621.1778, API 1.0.0, 
  [path: C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\winext\uext.dll]

ntsdexts: image 10.0.22621.1778, API 1.0.0, 
  [path: C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\WINXP\ntsdexts.dll]</code></pre></div>
<p>しかし、この一覧を見ると、analyze という拡張機能は一覧に存在していないことがわかります。</p>
<p>これは、<code class="language-text">!analyze</code> 拡張機能は、厳密には WinDbg に既定でロードされている ext 拡張機能に含まれる機能の一つであるからです。</p>
<p>WinDbg では、拡張機能のモジュールについては <code class="language-text">!&lt;拡張モジュールのエイリアス名></code> または <code class="language-text">!&lt;拡張機能名>.&lt;拡張モジュールのモジュール名></code> コマンドのどちらかを実行することで呼び出すことが可能です。</p>
<p>つまり、<code class="language-text">!ext.analyze</code> コマンドを実行することでも、<code class="language-text">!analyze</code> コマンドを実行した場合と同等の出力を得ることができます。</p>
<p>なお、余談ですが、ext 拡張機能に含まれるモジュールの一覧は <code class="language-text">!help</code> もしくは <code class="language-text">!ext.help</code> コマンドで一覧参照できます。</p>
<p>以下のように、analyze 以外にも使用頻度の多い address などが含まれていることを確認できます。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0:000> !ext.help
analyze [-v][level]        - Analyzes current exception or bugcheck (levels are 0..9)
owner [symbol!module]      - Displays the Owner for current exception or bugcheck
comment                    - Displays the Dump's Comment(s)

error [errorcode]          - Displays Win32 or NTSTATUS error string
gle [-all]                 - Displays the Last Error &amp; Last Status of the current thread

address [address]          - Displays the address space layout
        [-UsageType]       - Displays the address space regions of the given type

cpuid [processor]          - Displays the CPU information for a specific or all CPUs

exchain                    - Displays exception chain for the current thread

for_each_process &lt;cmd>     - Executes command for each process
for_each_thread &lt;cmd>      - Executes command for each thread
for_each_frame &lt;cmd>       - Executes command for each frame in the current thread
for_each_local &lt;cmd> $$&lt;n> - Executes command for each local variable in the current frame,
                             substituting the fixed-name alias $u&lt;n> for each occurrence of $$&lt;n>

imggp &lt;imagebase>          - Displays GP directory entry for 64-bit image
imgreloc &lt;imagebase>       - Relocates modules for an image

str &lt;address>              - Displays ANSI_STRING or OEM_STRING
ustr &lt;address>             - Displays UNICODE_STRING

list [-? | parameters]     - Displays lists

cppexr &lt;exraddress>        - Displays a C++ EXCEPTION_RECORD
obja &lt;address>             - Displays OBJECT_ATTRIBUTES[32|64]
rtlavl &lt;address>           - Displays RTL_AVL_TABLE
std_map &lt;address>          - Displays a std::map&lt;></code></pre></div>
<p>拡張機能について確認できたところで、実際に <code class="language-text">!analyze -v</code> コマンドを実行してダンプファイルの解析を行ってみましょう。</p>
<p><code class="language-text">!analyze -v</code> コマンドの出力は少々多いので、分割して確認していきます。</p>
<p>最初のセクションは、環境情報やダンプファイルに関する情報が表示されています。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">KEY_VALUES_STRING: 1

  Key  : AV.Dereference
  Value: NullPtr

  Key  : AV.Fault
  Value: Write

  Key  : Analysis.CPU.mSec
  Value: 561

  Key  : Analysis.DebugAnalysisManager
  Value: Create

  Key  : Analysis.Elapsed.mSec
  Value: 577

  Key  : Analysis.Init.CPU.mSec
  Value: 12827

  Key  : Analysis.Init.Elapsed.mSec
  Value: 85744066

  Key  : Analysis.Memory.CommitPeak.Mb
  Value: 84

  Key  : Timeline.OS.Boot.DeltaSec
  Value: 44

  Key  : Timeline.Process.Start.DeltaSec
  Value: 7

  Key  : WER.OS.Branch
  Value: vb_release

  Key  : WER.OS.Timestamp
  Value: 2019-12-06T14:06:00Z

  Key  : WER.OS.Version
  Value: 10.0.19041.1

FILE_IN_CAB:  D4C.exe.9608.dmp

NTGLOBALFLAG:  0

PROCESS_BAM_CURRENT_THROTTLED: 0

PROCESS_BAM_PREVIOUS_THROTTLED: 0

APPLICATION_VERIFIER_FLAGS:  0</code></pre></div>
<p>次のセクションでは、発生した例外と紐づく Register Context<sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup> を表示する <code class="language-text">.ecxr</code> コマンドの出力結果が表示されます。</p>
<p>この情報は、メモリリーク事象などの調査のために手動で取得したダンプファイルの場合は参照する必要はありませんが、今回のようなクラッシュダンプの調査を行う場合には非常に重要になります。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">CONTEXT:  (.ecxr)
rax=0000000000000017 rbx=0000021b6cad2460 rcx=00007ff6abb95300
rdx=000000bfc50ff948 rsi=00007ff6abb953f8 rdi=0000021b6cad7490
rip=00007ff6abb91412 rsp=000000bfc50ff910 rbp=0000000000000000
 r8=000000bfc50fdd28  r9=0000021b6cad9477 r10=0000000000000000
r11=000000bfc50ff810 r12=0000000000000000 r13=0000000000000000
r14=0000000000000000 r15=0000000000000000
iopl=0         nv up ei pl nz na po nc
cs=0033  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010206
D4C+0x1412:
00007ff6`abb91412 41c706e8030000  mov     dword ptr [r14],3E8h ds:00000000`00000000=????????
Resetting default scope</code></pre></div>
<p>実際に上記の <code class="language-text">.ecxr</code> コマンドの出力結果を見てみると、アプリケーションのクラッシュがオフセット 0x1412 の命令で発生していることがわかります。</p>
<p>また、クラッシュを引き起こした命令は <code class="language-text">mov   dword ptr [r14],3E8h</code> であることがわかります。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">D4C+0x1412:
00007ff6`abb91412 41c706e8030000  mov     dword ptr [r14],3E8h ds:00000000`00000000=????????</code></pre></div>
<p>この命令は、r14 レジスタが保持するポインタアドレスが指す DWORD(32bit) の領域に 0x3E8(1000) という値を保存する命令です。</p>
<p>しかし、<code class="language-text">r14=0000000000000000</code> と表示されている通り、r14 レジスタには有効なポインタアドレスが格納されていません。</p>
<p>つまり、存在しないメモリアドレスに対して値を格納しようとした結果、メモリアクセス違反 (Access violation) によりアプリケーションがクラッシュしたと判断できます。</p>
<p>ここまでの情報ですでにアプリケーションがクラッシュした詳細な原因は特定できましたが、今回はこのままダンプファイルの解析を継続します。</p>
<p>次のセクションには <code class="language-text">.exr -1</code> コマンドの実行結果と同等の出力が表示されています。</p>
<p>このコマンドは、システムで発生した例外に関連する情報を出力します。</p>
<p>引数に <code class="language-text">-1</code> を指定した場合には最新の例外の情報が表示されます。<sup id="fnref-4"><a href="#fn-4" class="footnote-ref">4</a></sup></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">EXCEPTION_RECORD:  (.exr -1)
ExceptionAddress: 00007ff7f7481412 (D4C+0x0000000000001412)
   ExceptionCode: c0000005 (Access violation)
  ExceptionFlags: 00000000
NumberParameters: 2
   Parameter[0]: 0000000000000001
   Parameter[1]: 0000000000000000
Attempt to write to address 0000000000000000</code></pre></div>
<p>上記の結果の ExceptionAddress から、発生した例外が <code class="language-text">c0000005 (Access violation)</code> であり、例外の発生箇所が D4C.exe のオフセット 0x1412 であることがわかります。</p>
<p>また、例外が <code class="language-text">c0000005 (Access violation)</code> の場合、<code class="language-text">.exr -1</code> コマンドで表示される 2 つのパラメータは、それぞれ以下の意味を持ちます。<sup id="fnref-5"><a href="#fn-5" class="footnote-ref">5</a></sup></p>
<ul>
<li><code class="language-text">Parameter[0]</code>: メモリアクセスの種類(読み取り:0 / 書き込み:1 / 実行: 8)</li>
<li><code class="language-text">Parameter[1]</code>: 対象のメモリアドレス</li>
</ul>
<p>つまり、上記の結果から、発生したメモリアクセス違反は、アドレス 0x0 に対する書き込みアクセスに起因していることがわかります。</p>
<p>さらに次のセクションを見ていきます。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">PROCESS_NAME:  D4C.exe

WRITE_ADDRESS:  0000000000000000 

ERROR_CODE: (NTSTATUS) 0xc0000005 - 0x%p ???? 0x%p ???????????????? %s ???????????????

EXCEPTION_CODE_STR:  c0000005

EXCEPTION_PARAMETER1:  0000000000000001

EXCEPTION_PARAMETER2:  0000000000000000

STACK_TEXT:  
00000065`1e9cf580 00007ff7`f7481a40 : {省略} : D4C+0x1412
00000065`1e9cf840 00007fff`35e17344 : {省略} : D4C+0x1a40
00000065`1e9cf880 00007fff`35f826b1 : {省略} : kernel32!BaseThreadInitThunk+0x14
00000065`1e9cf8b0 00000000`00000000 : {省略} : ntdll!RtlUserThreadStart+0x21

STACK_COMMAND:  ~0s; .ecxr ; kb</code></pre></div>
<p>前半の情報は、<code class="language-text">.exr -1</code> の出力結果と同じく、直前の例外の種類と例外発生時のパラメータを示しています。</p>
<p>また、後半の STACK_TEXT には、例外が発生するまでのスタックバックトレースが表示されています。</p>
<p>このスタックバックトレースの情報は、<code class="language-text">~0s; .ecxr ; kb</code> コマンドによって取得できる情報と同等です。</p>
<p>このコマンドを分解すると、<code class="language-text">~0s</code> と <code class="language-text">.ecxr</code> コマンドによって 1 番目のスレッドの Register Context を取得した後に <code class="language-text">kb</code> コマンドで引数付きのスタックバックトレースの情報を出力しています。</p>
<p>つまり、今回のクラッシュダンプの場合、この出力は <code class="language-text">kb</code> コマンドによって出力される引数付きのスタックバックトレースの情報から、例外ディスパッチャ(<code class="language-text">KiUserExceptionDispatch</code>)<sup id="fnref-6"><a href="#fn-6" class="footnote-ref">6</a></sup>が呼び出される前までの情報を抜き出したものと同等であると言えます。</p>
<p>実際に WinDbg で <code class="language-text">kb</code> コマンドを実行すると以下の情報を得ることができます。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0:000> kb
# RetAddr               : Args to Child  : Call Site
00 00007fff`33701be0    : {省略} : ntdll!NtWaitForMultipleObjects+0x14
01 00007fff`33701ade    : {省略} : KERNELBASE!WaitForMultipleObjectsEx+0xf0
02 00007fff`35e6f93a    : {省略} : KERNELBASE!WaitForMultipleObjects+0xe
03 00007fff`35e6f376    : {省略} : kernel32!WerpReportFaultInternal+0x58a
04 00007fff`337de099    : {省略} : kernel32!WerpReportFault+0xbe
05 00007fff`35fd5330    : {省略} : KERNELBASE!UnhandledExceptionFilter+0x3d9
06 00007fff`35fbc876    : {省略} : ntdll!RtlUserThreadStart$filt$0+0xa2
07 00007fff`35fd221f    : {省略} : ntdll!_C_specific_handler+0x96
08 00007fff`35f814b4    : {省略} : ntdll!RtlpExecuteHandlerForException+0xf
09 00007fff`35fd0d2e    : {省略} : ntdll!RtlDispatchException+0x244
0a 00007ff7`f7481412    : {省略} : ntdll!KiUserExceptionDispatcher+0x2e
0b 00007ff7`f7481a40    : {省略} : D4C+0x1412
0c 00007fff`35e17344    : {省略} : D4C+0x1a40
0d 00007fff`35f826b1    : {省略} : kernel32!BaseThreadInitThunk+0x14
0e 00000000`00000000    : {省略} : ntdll!RtlUserThreadStart+0x21</code></pre></div>
<p>上記のスタックバックトレースを順を追って読んでいくと、Windows においてユーザモードスレッドを開始する RtlUserThreadStart 関数の実行から始まり、オフセット 0x1412 をスタックにプッシュした後、例外ディスパッチャと WER サービスに接続する WerpReportFault 関数の呼び出しという、クラッシュダンプを作成するまでの一連の流れを追うことができます。<sup id="fnref-7"><a href="#fn-7" class="footnote-ref">7</a></sup></p>
<p>続いて、<code class="language-text">!analyze -v</code> の最後のセクションを確認します。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">SYMBOL_NAME:  D4C+1412

MODULE_NAME: D4C

IMAGE_NAME:  D4C.exe

FAILURE_BUCKET_ID:  NULL_POINTER_WRITE_c0000005_D4C.exe!Unknown

OS_VERSION:  10.0.19041.1

BUILDLAB_STR:  vb_release

OSPLATFORM_TYPE:  x64

OSNAME:  Windows 10

FAILURE_ID_HASH:  {3a8ea6b5-fbef-8da5-2baa-142fae4fc055}

Followup:     MachineOwner</code></pre></div>
<p><code class="language-text">FAILURE_BUCKET_ID</code> は、ダンプファイルの解析において非常に重要な情報の 1 つです。</p>
<p>クラッシュダンプファイルをデバッガにロードすると、BUCKET ID というクラッシュの種類を識別するシグネチャが生成されます。<sup id="fnref-8"><a href="#fn-8" class="footnote-ref">8</a></sup> <sup id="fnref-9"><a href="#fn-9" class="footnote-ref">9</a></sup></p>
<p>今回のダンプファイルでは、<code class="language-text">FAILURE_BUCKET_ID</code> に <code class="language-text">NULL_POINTER_WRITE_c0000005_D4C.exe!Unknown</code> と表示されています。 </p>
<p>この点からも、アプリケーションのクラッシュが発生した原因が NULL ポインタに対する書き込み時のメモリアクセス違反であると判断できます。</p>
<p>以上で、<code class="language-text">!analyze -v</code> コマンドのすべての出力結果を確認できました。</p>
<p>今回のようにシンプルなクラッシュダンプであれば、<code class="language-text">!analyze -v</code> コマンドの出力結果を参照するだけで、アプリケーションクラッシュが発生した原因を容易に特定できます。</p>
<h2 id="クラッシュが発生した前後の命令を読む" style="position:relative;"><a href="#%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%97%E3%81%9F%E5%89%8D%E5%BE%8C%E3%81%AE%E5%91%BD%E4%BB%A4%E3%82%92%E8%AA%AD%E3%82%80" aria-label="クラッシュが発生した前後の命令を読む permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>クラッシュが発生した前後の命令を読む</h2>
<p>すでに <code class="language-text">!analyze -v</code> コマンドの出力結果からアプリケーションクラッシュの原因は特定できましたが、より詳細な情報を得るために、さらにダンプファイルの解析を進めていきます。</p>
<p><code class="language-text">!analyze -v</code> コマンドの出力結果から、アプリケーションのクラッシュが発生した命令はオフセット 0x1412 の <code class="language-text">mov   dword ptr [r14],3E8h</code> であることを確認しました。</p>
<p>このセクションでは、クラッシュが発生する直前の処理を追跡します。</p>
<p>まずは、ext 拡張機能に含まれる threads を呼び出してアプリケーションのスレッドを一覧参照しましょう。</p>
<p>以下の出力結果から、このアプリケーションではメインスレッド 1 つのみが実行されていることがわかります。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0:000> !threads
Index	TID	TEB	StackBase	StackLimit DeAlloc StackSize ThreadProc
0	0000000000000000 0x000000651eac0000 0x000000651e9d0000 0x000000651e9cc000	0x000000651e8d0000 0x0000000000004000	0x0
Total VM consumed by thread stacks 0x00004000</code></pre></div>
<p>上記の結果から解析対象はメインスレッドで問題ないことがわかるので、<code class="language-text">~0s; .ecxr ; k</code> コマンドで例外が発生した Register Context を指定した状態でスタックバックトレースを表示します。</p>
<p>なお、<code class="language-text">kb</code> コマンドで取得できる Args to Child の情報は、x64 バイナリの場合は呼び出し規約の関係でほとんど参考にならないので、以下の例では <code class="language-text">k</code> コマンドだけで情報を表示しています。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0:000> ~0s; .ecxr ; k
{省略}
D4C+0x1412:
00007ff7`f7481412 41c706e8030000  mov     dword ptr [r14],3E8h ds:00000000`00000000=????????
  *** Stack trace for last set context - .thread/.cxr resets it
 # Child-SP          RetAddr               Call Site
00 00000065`1e9cf580 00007ff7`f7481a40     D4C+0x1412
01 00000065`1e9cf840 00007fff`35e17344     D4C+0x1a40
02 00000065`1e9cf880 00007fff`35f826b1     kernel32!BaseThreadInitThunk+0x14
03 00000065`1e9cf8b0 00000000`00000000     ntdll!RtlUserThreadStart+0x21</code></pre></div>
<p>今回のようなアプリケーションクラッシュダンプの場合、最上位の Call Site は通常、例外を発生させた命令のオフセットになります。</p>
<p>今回のダンプファイルの出力結果においては、例外ディスパッチャが呼び出される直前の呼び出しが <code class="language-text">D4C+0x1412</code> ですので、クラッシュが発生した命令は D4C.exe のオフセット 0x1412 であることがわかります。</p>
<p>すでに <code class="language-text">.ecxr</code> コマンドの出力結果にてこのアプリケーションクラッシュはオフセット 0x1412 の命令でアクセス違反が発生したことを原因として発生したことは確認済みですが、このオフセットの前後の命令も念のため参照してみましょう。</p>
<p>[Alt + 7] キーで起動した Disassembly ウインドウを使用することでも特定のオフセットの前後の命令を参照することが可能です。</p>
<p>Disassembly ウインドウを使用する場合、ウインドウ上部の Offset 欄に <code class="language-text">!&lt;モジュール名>+オフセット</code> を入力します。</p>
<p>つまり、D4C.exe のオフセット 0x1412 に存在する命令を参照したい場合は、ウインドウ上部の Offset 欄に <code class="language-text">!D4C+0x1412</code> と入力してみてください。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d296f3f1bb0cd2b669738deebdd69213/0b533/app-crash-004.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 72.91666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACgUlEQVQ4y3WU6W7aQBSFef+3aFW1/dFWatoqapqKplmAGK9jG7A9eIFgG9s4VGGJFDidOw2ISMXS0eBZPt/lDI1PFwxf2wG+tHycG2P8srO9LpwMTZYKTcTvXL7v9bznTI1wcuXi27mC0w9f0WCOA1U30b5VYDIbk2yKvCilfB7CsBh4GKGc1ajqudTsnsZ7LNePWCxX+DOv8bhewQ8TNFwBZIxB13VomoZ0MkFZlqiEPM8DsywkcYzpdIqqqqRms0ru2Ww2OHzi0Z0Auv+AhmHANE0URSFUohQHCTgchnJuPB4jTVOpPM8xER9+enrCVoB24CgZo9Hr9WDbtoyOxt0BisT3fRm5I7Igua4rP1LXNVarFbbbrQTtxigREdq2A0tE2FVVqKqGMIowvrvDVETpCWC7cwtV0wXYkFlYogT0sd1DsBdA3nfQdyz0mIHOzSWCgYv7MsdyPsMoDOCYGlymwxf7OA8Qi3rugDvYC+D73328a9p485Ph9ZmOkw7HqZHis5bi4w3Hqx8m3jZdfNciEXUhGjLDcrk8DuwYPVyrDFeKhRsxelEKL87gj6ZQbR/NlorLWxMtsUY1ppo/PDwcBw56DmzLlGpdX8HruyjyDHVVIBQpal0FzNRhM0vWj5pDUR6tIfnQMExoopvtdltGEceJrFMQBFAURTaLLEVrZLHRaHQcSClYzz4k4GAwkNYh43LO0e12990lEZB8eTRlR0ZoSB8SkA4Nh0N5KBIWIqAqLEVz1GGaIx8eAjeHQDIqGZbSIRilQ8amCMnYFFEYhkiSRK7RjVmv1/jfI68ebaa0OR8iyzIpgs3ncznSO93jQ1H0i8ViL+r6mv4ceIS/yNlFv1/mEDYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d296f3f1bb0cd2b669738deebdd69213/8ac56/app-crash-004.webp 240w,
/static/d296f3f1bb0cd2b669738deebdd69213/d3be9/app-crash-004.webp 480w,
/static/d296f3f1bb0cd2b669738deebdd69213/b0a15/app-crash-004.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/d296f3f1bb0cd2b669738deebdd69213/8ff5a/app-crash-004.png 240w,
/static/d296f3f1bb0cd2b669738deebdd69213/e85cb/app-crash-004.png 480w,
/static/d296f3f1bb0cd2b669738deebdd69213/0b533/app-crash-004.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d296f3f1bb0cd2b669738deebdd69213/0b533/app-crash-004.png"
            alt="Disassembly ウインドウで命令コードを参照する"
            title="Disassembly ウインドウで命令コードを参照する"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>また、WinDbg で特定のオフセットの命令を参照するために、<code class="language-text">u / ub / uu</code> コマンド<sup id="fnref-10"><a href="#fn-10" class="footnote-ref">10</a></sup>を使用することも可能です。</p>
<p>コマンドを使用する場合も、Disassembly ウインドウと同じフォーマットでオフセットを指定できます。</p>
<p>オフセット 0x1412 の命令を取得する場合は、<code class="language-text">u !D4C+0x1412</code> コマンドを実行します。</p>
<p><code class="language-text">u</code> コマンドのオプションを指定しない場合は、指定したオフセット以降の 8 つの命令が表示されます。(指定したオフセットの命令を含みます)</p>
<p>一方で、指定オフセットの直前の命令を参照したい場合には <code class="language-text">ub</code> コマンドを利用できます。</p>
<p><code class="language-text">ub !D4C+0x1412</code> コマンドを実行すると、指定のオフセットより前の 8 つもしくは 9 つの命令が表示されます。(指定したオフセットの命令は含まれません)</p>
<p>実際に各コマンドの出力結果を確認してみると、以下の通り指定のオフセットの前後の命令を正しく取得できていることがわかります。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># u コマンドで指定のオフセット以降の 8 つの命令を取得(一部省略)
0:000> u !D4C+0x1412
D4C+0x1412:
mov     dword ptr [r14],3E8h
call    D4C+0x14e0 (00007ff7`f74814e0)
jmp     D4C+0x1431 (00007ff7`f7481431)
lea     rcx,[D4C+0x3538 (00007ff7`f7483538)]
call    D4C+0x1010 (00007ff7`f7481010)
call    D4C+0x1740 (00007ff7`f7481740)
lea     rcx,[D4C+0x3310 (00007ff7`f7483310)]
call    D4C+0x1010 (00007ff7`f7481010)


# ub コマンドで指定のオフセットより前の 8 つ(または 9 つ)の命令を取得(一部省略)
0:000> ub !D4C+0x1412
D4C+0x13e7:
jmp     D4C+0x1431 (00007ff7`f7481431)
lea     rcx,[D4C+0x3560 (00007ff7`f7483560)]
call    D4C+0x1010 (00007ff7`f7481010)
lea     rcx,[D4C+0x52e8 (00007ff7`f74852e8)]
call    D4C+0x14e0 (00007ff7`f74814e0)
mov     qword ptr [rsp+38h],r14
lea     rdx,[rsp+38h]
lea     rcx,[D4C+0x5300 (00007ff7`f7485300)]


# ub コマンドで特定したオフセットから 16 (0x10) 個の命令を取得(一部省略)
0:000> u !D4C+0x13e7 L10
D4C+0x13e7:
jmp     D4C+0x1431 (00007ff7`f7481431)
lea     rcx,[D4C+0x3560 (00007ff7`f7483560)]
call    D4C+0x1010 (00007ff7`f7481010)
lea     rcx,[D4C+0x52e8 (00007ff7`f74852e8)]
call    D4C+0x14e0 (00007ff7`f74814e0)
mov     qword ptr [rsp+38h],r14
lea     rdx,[rsp+38h]
lea     rcx,[D4C+0x5300 (00007ff7`f7485300)]
mov     dword ptr [r14],3E8h
call    D4C+0x14e0 (00007ff7`f74814e0)
jmp     D4C+0x1431 (00007ff7`f7481431)
lea     rcx,[D4C+0x3538 (00007ff7`f7483538)]
call    D4C+0x1010 (00007ff7`f7481010)
call    D4C+0x1740 (00007ff7`f7481740)
lea     rcx,[D4C+0x3310 (00007ff7`f7483310)]
call    D4C+0x1010 (00007ff7`f7481010)</code></pre></div>
<p>これで、アプリケーションクラッシュが発生した前後の命令を WinDbg で参照することができました。</p>
<h2 id="appendixghidra-でバイナリ解析を行う" style="position:relative;"><a href="#appendixghidra-%E3%81%A7%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E8%A7%A3%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%86" aria-label="appendixghidra でバイナリ解析を行う permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Appendix：Ghidra でバイナリ解析を行う</h2>
<p>一般的に、クラッシュダンプの解析はトラブルシューティングのために行う一連の活動の中の一部です。</p>
<p>今回のように、ダンプファイルの解析結果からアプリケーションクラッシュの具体的な原因とエラーが発生したコードのオフセットが特定できている場合、より詳細な原因や回避方法を特定するためには、ソースコードの確認やライブデバッグ、問題の再現環境での設定変更などによる切り分けなどのアプローチの方がダンプファイルの解析より効果的な可能性があります。</p>
<p>しかし、ダンプファイルの解析者が解析対象のプログラムのソースコードやシンボルを入手できず、上記のアプローチによるトラブルシューティングが困難である場面はしばしば発生します。</p>
<p>そのような場合の選択肢の一つとして、デコンパイラと呼ばれるツールを用いて、アプリケーションをアセンブリや疑似コードに復元するテクニックを覚えておくとよいと思います。</p>
<p>本書では、オープンソースの高機能なデコンパイラである Ghidra のバージョン 2.3 を使用してアプリケーションのデコンパイルを行います。</p>
<p>Ghidra はアメリカ国家安全保障局 (NSA) によって開発されたツールで、アプリケーションの実行ファイルのディスアセンブルやデコンパイルを手軽に行うことができます。</p>
<p>ただし、解析対象のプログラムが .Net や Java などのプログラム言語で作成されている場合には、ILSpy<sup id="fnref-11"><a href="#fn-11" class="footnote-ref">11</a></sup> や jadx<sup id="fnref-12"><a href="#fn-12" class="footnote-ref">12</a></sup> などの専用のデコンパイラを使用する方が効率的です。</p>
<p>解析を行う場合には、対象のプログラムの種類や開発に使用しているプログラム言語、フレームワークなどに合わせて最適なツールや複数のツールを組み合わせて使用するとよいと思います。</p>
<p>なお、D4C.exe のような C 言語で作成されたコマンドラインアプリケーションを Ghidra でデコンパイルして解析を行うことは非常に簡単です。</p>
<p>まずは、1 章でセットアップした Ghidra を起動して、プロジェクト画面に実行ファイル D4C.exe をドラッグ &#x26; ドロップします。</p>
<p>この時、ファイルの種類が Ghidra によって自動的に分析されて x64 プラットフォーム用の PE バイナリ(Windows 用の実行プログラム)であることが表示されたら、[OK] をクリックしてファイルをロードします。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/dc9858e47b2615914c18e09e1ab5f24d/0b533/ghidra-appcrash-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB90lEQVQ4y51U2W7bQAzU/39VCxRFX9r0wal1xLo3so7VLceyak9J2us6aQIDFTDgao/Z4ZCSlaUK/bTDsHvB/vAbL/Micb9ccLiHhc4cMO1n7PYHWGGYYOO5CAIfSZKgKAqM44hhGD7EeMHtWDAOsL48fMaPRxsqy1GWBaFEVVX/hbKsYH39+Qnfvj/AcTdCZsBK8zx/Fx+tbbdbWJH/BN9e0Uv+ioxva9sOXXeLXqKua8zz/ArLssgaeRijyrbIiUQpJT7GcYyUijWQJ9M0XcHe6qYlNQXee3iPFcYJ+r6HSlMqTAjHcWHbjoDT0FqLP1rXyLIM7iZEQVmcTkfC6Qp++EIhTEmVbdtw3Sesf9mkkOdSUWLM1pVGRh7FUSS2GJJ/CCM6yJ5FtJFTfn7OZIHlv22Xtm1Rk398kSExpH8VEqExnQ8wOkbXihUMmaN13/cR+IFYcTyeU+bIEA+Z8HFty61nnzSapoavKjhJBT+MJMWmaWQPRybnwtV1g4bGzUWEpvdIFbBsKsJ6vcZqtRIFnLq3Cch8guvB8zyZC8NQEAQBdcA5K7bhmh2hpMJZQRRLAYwCji0ruagxvt2C55iUC8mRvVcqJf8VrIqksl9MZlrkHngffxUJdQO3Eo85cvXJQ4dSc6X/MqrwuU3KuzDEtxfx/+APWQpp3BDajdoAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/dc9858e47b2615914c18e09e1ab5f24d/8ac56/ghidra-appcrash-001.webp 240w,
/static/dc9858e47b2615914c18e09e1ab5f24d/d3be9/ghidra-appcrash-001.webp 480w,
/static/dc9858e47b2615914c18e09e1ab5f24d/b0a15/ghidra-appcrash-001.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/dc9858e47b2615914c18e09e1ab5f24d/8ff5a/ghidra-appcrash-001.png 240w,
/static/dc9858e47b2615914c18e09e1ab5f24d/e85cb/ghidra-appcrash-001.png 480w,
/static/dc9858e47b2615914c18e09e1ab5f24d/0b533/ghidra-appcrash-001.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/dc9858e47b2615914c18e09e1ab5f24d/0b533/ghidra-appcrash-001.png"
            alt="プロジェクトに実行ファイルをロードする"
            title="プロジェクトに実行ファイルをロードする"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>次に、ロードしたファイルをダブルクリックして解析ウインドウを起動します。</p>
<p>以下のような確認プロンプトがいくつか表示されたら [Yes] を選択します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/49a236e4cd663e17b5c9d1d25a531c5a/0b533/ghidra-appcrash-002.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 34.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABFElEQVQoz6VPyU7DMBT0R/Id/BsSBw69IS5USJQsTpqmpYkJibN5ydLbYLuNQBUSByyNZt549OwhL7snFKxEWZb4zzmdTpjnGUSqAm3ToDGwhsU0nXle+Fq7zHTRZ9ZaYxgGkMc1w/69QN+1qKoKFa/ADazmnP/wuGvhZoO6Xu6sb+caQgiQm9t73D284nhMEYQBojhCksTwfN9oiiDw4Ae+8zabN9CIulyy28LzPIQ0RhhSZHkOpTRIemCmbgcppXtBCOmgzDxqhXHQ0Eq6ShY2t2SluLD8ZjKOJmSGvhfOtKykQF622GwzeLscB8aRZRkY+0DXdZeHfwe5NuzCwfwoYQ1Wa4rVs6m4/0RMqamZ/rnwC9JHDWh8fLt9AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/49a236e4cd663e17b5c9d1d25a531c5a/8ac56/ghidra-appcrash-002.webp 240w,
/static/49a236e4cd663e17b5c9d1d25a531c5a/d3be9/ghidra-appcrash-002.webp 480w,
/static/49a236e4cd663e17b5c9d1d25a531c5a/b0a15/ghidra-appcrash-002.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/49a236e4cd663e17b5c9d1d25a531c5a/8ff5a/ghidra-appcrash-002.png 240w,
/static/49a236e4cd663e17b5c9d1d25a531c5a/e85cb/ghidra-appcrash-002.png 480w,
/static/49a236e4cd663e17b5c9d1d25a531c5a/0b533/ghidra-appcrash-002.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/49a236e4cd663e17b5c9d1d25a531c5a/0b533/ghidra-appcrash-002.png"
            alt="Ghidra の確認プロンプト"
            title="Ghidra の確認プロンプト"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>続けて表示される解析オプションの選択はデフォルト設定のままで問題ないので、[Analyze] をクリックしてプログラムの解析を開始します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/450a41547d6576d133592305b8e7af07/0b533/ghidra-appcrash-003.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 59.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABiklEQVQoz5WS626CUBCEff9na6rVagRB5FyAw/2Opup09yRNbKO2/TExgvvtzDqzfeghjmPUbYuu79F0HVoWfWdVVWU/u64ndQ81DIPlzBzXg+vssHdcqEOIKJSIhKKXhpRAa408zy24LMuHqusaSinMdJxCKoP164pACcZmwlCP6KcrPddIksQOFEXxVLxQSslAQ0M59ssNIi/EVHYYjxcMpysEOeWt7PA38VIhBGYROVRRhvn8Hdutj4rcjQTrpwuEVKjoh03T2EjPxHfm81iHQhu8UOQ1AUuKPB4JOJ4RComCtvMAR3omXmpvGBFQ6hQLirzzBZr+RA4vNrZJMxvnC3jP2R1gCh3nWKy2cH1JblNyOeL4ARRlhTzL/ge0kVWMNwKmRUOwAe1wwjCdkWb5N4d/iqzokOv1BsvlCo67QxAc4FAnfX+PjGBciVvgI5f8p1ggDxiT2A4ZY5BRxDiKbOtvS3s7zM9u3X0rNkdiuz+r0bYUIcmw9LStDy8MgsAuvHcCnufafAK0aIWCX2T6hAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/450a41547d6576d133592305b8e7af07/8ac56/ghidra-appcrash-003.webp 240w,
/static/450a41547d6576d133592305b8e7af07/d3be9/ghidra-appcrash-003.webp 480w,
/static/450a41547d6576d133592305b8e7af07/b0a15/ghidra-appcrash-003.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/450a41547d6576d133592305b8e7af07/8ff5a/ghidra-appcrash-003.png 240w,
/static/450a41547d6576d133592305b8e7af07/e85cb/ghidra-appcrash-003.png 480w,
/static/450a41547d6576d133592305b8e7af07/0b533/ghidra-appcrash-003.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/450a41547d6576d133592305b8e7af07/0b533/ghidra-appcrash-003.png"
            alt="Ghidra の解析オプションの選択"
            title="Ghidra の解析オプションの選択"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>自動解析を開始して数十秒から数分程度経過すると、Ghidra を使用してアプリケーションのデコンパイル結果を参照できるようになります。</p>
<p>Ghidra の解析ウインドウは、既定では以下のような配置になっています。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/8a5e11d6e2ddff736051e860c0fe7ab8/0b533/ghidra-appcrash-004.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 60.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABwklEQVQoz41S2W7bMBDU//9aixZBEcdwIkWHZR08dFESL3m6lOHmqYEEDJYUd2fJnYku7xdkWYbiWiBOUuTXEpxzMCbAJEPDGfq+R5FzxB8MOcWylKjrjnIGdN2IcVSEkdYdovPbad9wKsyKGy6FQEwF75lAUvZImwnxleH1T4rPpCNCidutR9uOkDIQzViWlbBAqRlR0zTw3sM7B209bv0Dn/WCnFu0CsjZhKYpceSLrLXYtg0rdZgWjbhakNSOyAxKaVGNQFYPqMpiLwi59/v9v4heXn6hqmpUdQVjHc1sQCs01OoxaYfZbKgajobOwxeKvr1hll2oK7CuK5yzEFxAEqFzHsbT7b1DS2NhJNQhwuciPD1Aio5goI2H3TwRO3SksprnY4RFUYAzjpYxaG0wDKQ4M6SYx3bfdkJOtx7G6dgMf//8gTxNScV2LzDGou9ANvjqOk0KXIhjKiv16DwTw0cc43Q64/yWII4TMvuVDFyT93LaxxBEGkwfopRyN3IwfXjVNE0Yevk1wyCKlB0dDvS8B0JSgFJqN+48z3sMRg75AVrrHcbQ3PWKSFCnUMSE3H+GmVn7hP2HcGae8Rv8BVCynP5UjzP5AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/8a5e11d6e2ddff736051e860c0fe7ab8/8ac56/ghidra-appcrash-004.webp 240w,
/static/8a5e11d6e2ddff736051e860c0fe7ab8/d3be9/ghidra-appcrash-004.webp 480w,
/static/8a5e11d6e2ddff736051e860c0fe7ab8/b0a15/ghidra-appcrash-004.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/8a5e11d6e2ddff736051e860c0fe7ab8/8ff5a/ghidra-appcrash-004.png 240w,
/static/8a5e11d6e2ddff736051e860c0fe7ab8/e85cb/ghidra-appcrash-004.png 480w,
/static/8a5e11d6e2ddff736051e860c0fe7ab8/0b533/ghidra-appcrash-004.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/8a5e11d6e2ddff736051e860c0fe7ab8/0b533/ghidra-appcrash-004.png"
            alt="Ghidra の解析ウインドウ"
            title="Ghidra の解析ウインドウ"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>まず、右側の Decompiler ウインドウには、アプリケーションの関数を C 言語に近い疑似コードでデコンパイルした結果が表示されます。</p>
<p>中央の Listing ウインドウにはアプリケーションのディスアセンブル結果が表示されます。</p>
<p>Listing ウインドウに表示されるコードは、WinDbg の Disassembly ウインドウで参照できるディスアセンブル結果と基本的には同じですが、Ghidra は IAT などの情報を自動的に解析した結果を表示してくれるので、WinDbg で参照するディスアセンブル結果よりも比較的読みやすいコードが表示されることが多いです。</p>
<p>ウインドウの左側には、プログラムのセクション、シンボルツリー、データタイプを参照できるウインドウが並べられています。</p>
<p>プログラムの解析を行うために、まずはプログラムで最初に実行される main 関数を特定しましょう。</p>
<p>Windows が PE ファイル(exe)<sup id="fnref-13"><a href="#fn-13" class="footnote-ref">13</a></sup>を実行する場合、PE ファイルのファイルヘッダに埋め込まれた AddressOfEntryPoint の値が実行の開始位置になります。</p>
<p>Windows は AddressOfEntryPoint で指定されたアドレスからプログラムの実行を開始し、いくつかの初期化処理を経た後で main 関数が実行されます。</p>
<p>この AddressOfEntryPoint で指定されたエントリポイントは、Ghidra の解析ウインドウ左側の Symbol Tree ウインドウから [Functions] のツリーを展開して entry 関数を見つけることで特定できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/0c3068d38813d99d5fd798f9e697379c/0b533/ghidra-appcrash-005.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADj0lEQVQ4y21U2XLaWBTU///EzHv+YGqWTDJx2SQG24AJGIMBSaB9RdLV1tPnyltSUdUp3bXv6T6LYZ4s2PYJtmXDPJjwgwBJkiJNMyRiSYY0y9HUDZSqUPN/PpcoqjPnNbIyR1mWaJoWNefGxdUYt9MplsvvmN/fY3L3DdPZHJ8+f8E/n/7D1bcxxrdTzLi2WCxg7k2eXWOxmmL9sML1YoLpfIGHzRr7/Q7G1Zc/8e3rCL4fIMtzehNg/bjGfD7nhQccDgd4rgvP9xCGIVwvQBil9DxBlkbI84zziHseTPMAI0lirJZLtG2Hl88lgNCQr+t6JHGCKOxARqjyFkXSoqwapElN+tDW8bowMOSyeCIa9H2vQY7HE+I45lqjNWubGsW50I+0dQlV5FxvUZUN17hXKD0fjb7CEDrz2Yyun98ATydNqeOzVVXBYrBcJyKLmvOSQAXSioHqmmdOw71rSmfUda09ef+dTo4GbAkokYuikJQjjhlZRrdiZM/8y75gvThye/kRxvmc6VclJYqi0BRN03oFrCoFhxK4bsC9khRz0k+RK6ZK2w7+PQNejy5g/Pb7v/jwYYS//r7DdMp0YPqMJ2NkWfYD5cA/60sSPHHsrApSbn9g9rCcwRhd/IHZ3ZTeDQGQ12zbZmRj1E0HL1GwvAzHUCEuegRZQ2vhpgpBXuu5n9VIyg63k2sYWehgt42pCVOiHFz3PE9HuWLkzLCGk0GbHXfYeSWtwM4tsPdqrK0YTxyfkg6XEmXfPeDz5RLWSQR/y0PJTwG0owZHHt76pb603jPxLRerg4PZU4CNHfKhBm7eY8X0M2b3H/G0WaDTAg8eOgSMmf1V3WkPTdLd+Yp/yuG22tNj2uIQKZzSXj/oZD327AmGCN8/h/4lWgIoZSZRTqmFZZ2wPxRwPCCidhF1zWTdPSNMgJhgqhWpfBjvS+4FUCiLhp3OQwKEAeu5ZAfiGXoNWskq8QNFmfpnZvT0eBTAt1z6GVAek5Ic0kWsZxqxfvNKr8tdKQoxGZum+WtA3/dfS0/Rw0A6UTZELMsUm4LScvTPmotmMlpb1qDhz5QFUDcHPiZNVJJbqSFHVTVUVM4WI38xxfIVnJubGxhyQSbi6ZDYgGUfdaX88uO+qtRg9P69Q+PJBMaE2b1+fMR2+6Sb6ZGN4e5+xchacBwHm83m1bbbLbv1Uo/lrLb9Abvdnt16j3t2/P8Bv/XzAvJ19Z4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/0c3068d38813d99d5fd798f9e697379c/8ac56/ghidra-appcrash-005.webp 240w,
/static/0c3068d38813d99d5fd798f9e697379c/d3be9/ghidra-appcrash-005.webp 480w,
/static/0c3068d38813d99d5fd798f9e697379c/b0a15/ghidra-appcrash-005.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/0c3068d38813d99d5fd798f9e697379c/8ff5a/ghidra-appcrash-005.png 240w,
/static/0c3068d38813d99d5fd798f9e697379c/e85cb/ghidra-appcrash-005.png 480w,
/static/0c3068d38813d99d5fd798f9e697379c/0b533/ghidra-appcrash-005.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/0c3068d38813d99d5fd798f9e697379c/0b533/ghidra-appcrash-005.png"
            alt="entry 関数の特定"
            title="entry 関数の特定"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>続けて、Listing ウインドウや Decompiler ウインドウに表示されている <code class="language-text">FUN_140001934()</code> という関数をクリックして、その関数のオフセットにジャンプします。(関数オフセットはバイナリによって変わります)</p>
<p>この関数 <code class="language-text">FUN_140001934()</code> のデコンパイル結果は以下のようになっています。(一部省略)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">uint <span class="token function">FUN_140001934</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">{</span><span class="token punctuation">{</span> 省略 <span class="token punctuation">}</span><span class="token punctuation">}</span>
  uVar4 <span class="token operator">=</span> <span class="token function">__scrt_initialize_crt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>uVar4 <span class="token operator">==</span> <span class="token char">'\0'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">FUN_140001fa8</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token punctuation">{</span><span class="token punctuation">{</span> 省略 <span class="token punctuation">}</span><span class="token punctuation">}</span>

      puVar7 <span class="token operator">=</span> <span class="token punctuation">(</span>undefined <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">_get_initial_narrow_environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      puVar8 <span class="token operator">=</span> <span class="token punctuation">(</span>undefined8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">__p___argv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      uVar1 <span class="token operator">=</span> <span class="token operator">*</span>puVar8<span class="token punctuation">;</span>
      puVar9 <span class="token operator">=</span> <span class="token punctuation">(</span>uint <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">__p___argc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      uVar10 <span class="token operator">=</span> <span class="token punctuation">(</span>ulonglong<span class="token punctuation">)</span><span class="token operator">*</span>puVar9<span class="token punctuation">;</span>
      unaff_EBX <span class="token operator">=</span> <span class="token function">FUN_140001070</span><span class="token punctuation">(</span>uVar10<span class="token punctuation">,</span>uVar1<span class="token punctuation">,</span>puVar7<span class="token punctuation">,</span>in_R9<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">{</span><span class="token punctuation">{</span> 省略 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">FUN_140001fa8</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  LAB_140001aa0<span class="token operator">:</span>

  <span class="token function">exit</span><span class="token punctuation">(</span>unaff_EBX<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>コードの詳細については本書の範囲外となるので詳しく解説はしませんが、関数 <code class="language-text">FUN_140001934()</code> はアプリケーションを実行する際の初期化処理にあたります。<sup id="fnref-14"><a href="#fn-14" class="footnote-ref">14</a></sup></p>
<p>特に、Ghidra 2.3 のデフォルト設定で特定されているシンボル名である <code class="language-text">_get_initial_narrow_environment</code>、<code class="language-text">__p___argv</code>、<code class="language-text">__p___argc</code> を引数としている <code class="language-text">unaff_EBX = FUN_140001070(uVar10,uVar1,puVar7,in_R9);</code> の行に着目します。</p>
<p>公式のドキュメント上では情報が見つかりませんでしたが、Stack Overflow などのインターネット上の Web サイトでこれらの 3 つの値を引数について検索を行うと、Windows で CRT が main 関数を実行するための以下の処理に該当する可能性が高いことを特定できます。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> __cdecl <span class="token function">invoke_main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">main</span><span class="token punctuation">(</span>__argc<span class="token punctuation">,</span> __argv<span class="token punctuation">,</span> <span class="token function">_get_initial_narrow_environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>つまり、関数 <code class="language-text">FUN_140001934()</code> 内の <code class="language-text">unaff_EBX = FUN_140001070(uVar10,uVar1,puVar7,in_R9);</code> 行で呼び出される 関数 <code class="language-text">FUN_140001070()</code> が、このプログラムに置ける main 関数に該当すると判断できます。</p>
<p>実際に Ghidra で関数 <code class="language-text">FUN_140001070()</code> にジャンプして Decompiler ウインドウを確認すると、プログラムの起動時にコンソールに表示される <code class="language-text">Welcome.</code> などの文字列を含むコードが呼び出されており、この関数 <code class="language-text">FUN_140001070()</code> が D4C.exe の main 関数であることを確認できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d45bec063e98219cdf4a7c63e47b7cd8/0b533/ghidra-appcrash-006.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACO0lEQVQ4y42TC2+bQBCE/f//V5tH0yZq3FqqHWMb8zIY7gEHZ+6YDsRymiZKe2hhJbiPudnd2dNqhSCMsUkqPK0zbOMKy/UBQRDj/v4Xbj/t8XCX4Pu3dIr5Q4rF/IDVKsdmUyAMS8Tck2UCRaEwa41BfQIiMSCMOiSVR5x7bEKNx8dbACc4vu9PUwp/jqEHnOPz5GGZe+sxrpmSAqLpEVUOYdIiLpnnPbb7Cjc3X3AoaxgjMQzcxNsl/DmYD3/ETCsJaZ6B+8xSoUN89FRb4u76M3aJRl3n09+Hvza/F6+AcemQCM8YCFf4enuNfWpRVgkG7y7Qj9YLUDhEF4VUm0jM54+I0nYCdp2C8/6f0JkiUBAY0rt4PHbpEWQDq65xffWssDoD/cQZPgZKIWBYoeggsd4bpCWQiR6FNPjxc4E0r6FUCtPV/+ehlJLV8jBNjSLvYC1bpHfomGx2u0mhkAUsFb5Zw3sKCRy90UrhkBmqAdq25xE77Ag8Hg1yoVG2kt90UIJtpAV/2sOP1+BZMLZP7ydhF4UjMCOQDlDdCLRYrwMET2ALGez1Dptig22xQ1AECHWIPC8gtyxqIGFK8wJ0bHljGo5OB63HI9MCKlxwLLNUIYrHhk+R1SnyJsexJkgoNMcGbdGio3LvzpMiKGnseEtAkVsqHYEDmsbgilWu64pto6HFCR2tcOzHcdy8fWvgVJS6rie/kjhGmlK+dITRK6WxXC6ZD7TBoLUtTs4yONvePod1ryo8rt8oNjVaoOCDrwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d45bec063e98219cdf4a7c63e47b7cd8/8ac56/ghidra-appcrash-006.webp 240w,
/static/d45bec063e98219cdf4a7c63e47b7cd8/d3be9/ghidra-appcrash-006.webp 480w,
/static/d45bec063e98219cdf4a7c63e47b7cd8/b0a15/ghidra-appcrash-006.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/d45bec063e98219cdf4a7c63e47b7cd8/8ff5a/ghidra-appcrash-006.png 240w,
/static/d45bec063e98219cdf4a7c63e47b7cd8/e85cb/ghidra-appcrash-006.png 480w,
/static/d45bec063e98219cdf4a7c63e47b7cd8/0b533/ghidra-appcrash-006.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d45bec063e98219cdf4a7c63e47b7cd8/0b533/ghidra-appcrash-006.png"
            alt="FUN_140001070() が main 関数であることを確認"
            title="FUN_140001070() が main 関数であることを確認"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Ghidra では、関数名を右クリックして [Rename Function] を選択することで関数名を任意に変更できます。</p>
<p>解析をスムーズに進めるためにも、<code class="language-text">FUN_140001070()</code> を main にリネームしておきます。</p>
<p>また、<code class="language-text">FUN_1400014e0("Welcome.\n",param_2,param_3,param_4);</code> と <code class="language-text">FUN_140001010(L"\n0. Setting: Full memory dump(You need reboot OS.)\n",param_2,param_3,param_4);</code> についても、それぞれ ASCII 文字列とワイド文字列をコンソールに出力する関数であると推測できます。</p>
<p>そのため、<code class="language-text">FUN_1400014e0()</code> を printf に、<code class="language-text">FUN_140001010()</code> を wprintf にそれぞれリネームします。</p>
<p>これでかなりデコンパイル結果を読みやすくなりました。</p>
<p>最後に、アプリケーションクラッシュが発生したより詳細な原因を Ghidra を使用して特定します。</p>
<p>すでに確認している通り、このアプリケーションクラッシュは最初のメニューで 1 を選択した後に、不正なアドレスに対して書き込みアクセスが行われようとしたことで発生しました。</p>
<p>そこで、main 関数のデコンパイル結果からアプリケーションクラッシュが発生した箇所のコードを調査してみます。</p>
<p>Decompiler ウインドウの情報を参照すると、アプリケーションクラッシュが発生したのは以下の箇所であることがわかります。</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>local_38 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">wprintf</span><span class="token punctuation">(</span>L<span class="token string">"User Mode Trouble: Simple process crash.\n"</span><span class="token punctuation">,</span>pwVar9<span class="token punctuation">,</span>NewState<span class="token punctuation">,</span>param_4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"OK, Start application.\n"</span><span class="token punctuation">,</span>pwVar9<span class="token punctuation">,</span>NewState<span class="token punctuation">,</span>param_4<span class="token punctuation">)</span><span class="token punctuation">;</span>

  local_280 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  pwVar9 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">wchar_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>local_280<span class="token punctuation">;</span>
  uRam0000000000000000 <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>DAT_140005300<span class="token punctuation">,</span>pwVar9<span class="token punctuation">,</span>NewState<span class="token punctuation">,</span>param_4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>実際に書き込みアクセスを行っている <code class="language-text">uRam0000000000000000 = 1000;</code> を選択してみると、Listing ウインドウの表示から対応するコードのオフセットが 0x1412 であることを確認できます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/cc2d3ea0111aea638d089baade569af0/0b533/ghidra-appcrash-007.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 52.083333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB2ElEQVQoz32S2Y7UMBRE+/+/ineEeAA0QjD0dIYkncXuOO3dcQ43zEhsEpGsSI5TrlN1TzlnjhVjQM0rNw0pFUrZmeeJrh8YdSWEgR3P/5+dk/ce7wMpJqz1Igb2nnA2M04TbXtlvTsme8PI2+jIMlu8XShbpu47e/21TiEEoqikKAcXJ66QCwq5gJ46zl8HmrbwvF5odEOjGs7zmcvS0JkO1WqWp4XlvBBMeBFMghzE6YEslIJ3IIO6isj5wjgHLtNIa1r6e8fgBrRVGGWwvcUNjmgi21ZfBcXhkeHt5tA3yVDsyTemoaP93kgUE+MYBTdgfSJviRrlUrexle2PFE9BhPJRQkiSzZERbHGHV8G+71lNlfwEKQXJrVDrJtnll7fcvB85vq5TlEJU0nyyD7xXD7y9Nny8P/I5f+M8npnHEefgKljGGVz2kq/gFU+JmS3XvxwKsk3Sop941gPXVbDTgi4rnZRyCPo79MOCEnTtpIBoWIP6uawxEtlKFmNFYnhpOUT2Uslhk01p+V5IfpfcFE/TM334zJfhDY/mHY/rB9ao5FyiSJl12wS1/oYs41JkU2v5+amXuUPGR0ZIWlNKicsrvghumFiLuMo3QXZsknst9Z/R/gGcSQKNk/ir4wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/cc2d3ea0111aea638d089baade569af0/8ac56/ghidra-appcrash-007.webp 240w,
/static/cc2d3ea0111aea638d089baade569af0/d3be9/ghidra-appcrash-007.webp 480w,
/static/cc2d3ea0111aea638d089baade569af0/b0a15/ghidra-appcrash-007.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/cc2d3ea0111aea638d089baade569af0/8ff5a/ghidra-appcrash-007.png 240w,
/static/cc2d3ea0111aea638d089baade569af0/e85cb/ghidra-appcrash-007.png 480w,
/static/cc2d3ea0111aea638d089baade569af0/0b533/ghidra-appcrash-007.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/cc2d3ea0111aea638d089baade569af0/0b533/ghidra-appcrash-007.png"
            alt="オフセット 0x1412 のデコンパイル結果を確認"
            title="オフセット 0x1412 のデコンパイル結果を確認"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>このオフセット 0x1412 は、WinDbg でダンプファイルの解析を行った際に特定したオフセットと一致しています。</p>
<p>さらに、Ghidra のデコンパイル結果を参照してみると、書き込み先のアドレスはハードコードされた 0 という値を参照していることがわかりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3127ae6baa387734d092b851f3e3d315/0b533/ghidra-appcrash-008.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABC0lEQVQY0x2PyU7CAAAF+/+f4MmDFy4aTYxRECilLBaRLtC0CBjQUrAUutgFqGNjXibvNskIoidR2yg0diq9/BUpVOjnA5pem3Yg04v69PYKrUjGykzssYaTbVhup1hfXfRQK9ExYgMtUhGqUZUHX+Qx6NIqJJ4TEal8MW5Rj8R/Gkmdp2MdPVexTJ1a1uQuvORmd8GVf08lvOY2qqAcuwj6Xme4tRm4S6x0jplMmRczJocxesmbP2aS2CyY454dZtN3giTA/ylwwwQvC9ilEUl+oMhThI7fof09RPZMRrnBSzxkdNKRfRXtVOYUGsZvmVNucV5gWzZpUopc+HR81sEHK3+FE65Zxxv+ANuAHlhVLwnlAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/3127ae6baa387734d092b851f3e3d315/8ac56/ghidra-appcrash-008.webp 240w,
/static/3127ae6baa387734d092b851f3e3d315/d3be9/ghidra-appcrash-008.webp 480w,
/static/3127ae6baa387734d092b851f3e3d315/b0a15/ghidra-appcrash-008.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/3127ae6baa387734d092b851f3e3d315/8ff5a/ghidra-appcrash-008.png 240w,
/static/3127ae6baa387734d092b851f3e3d315/e85cb/ghidra-appcrash-008.png 480w,
/static/3127ae6baa387734d092b851f3e3d315/0b533/ghidra-appcrash-008.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/3127ae6baa387734d092b851f3e3d315/0b533/ghidra-appcrash-008.png"
            alt="NULL ポインタ参照の発生箇所"
            title="NULL ポインタ参照の発生箇所"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>これで、今回調査したアプリケーションクラッシュの発生原因はメモリアクセス違反であり、開発者が 1000 という値を書き込む先を 0 に固定してしまったことで発生したということを特定できました。</p>
<h2 id="4-章のまとめ" style="position:relative;"><a href="#4-%E7%AB%A0%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81" aria-label="4 章のまとめ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4 章のまとめ</h2>
<p>以上で、シンプルなアプリケーションクラッシュダンプの解析は終了です。</p>
<p>現実のトラブルシューティングでここまで単純なクラッシュ事象の調査を行うことはまずありませんが、基本的な解析のステップは大きくは変わりません。</p>
<p>アプリケーションクラッシュダンプが正常に出力されている状況であれば、根本的な原因が何であれ、クラッシュを直接的に引き起こした例外の種類と、クラッシュが発生した命令コードのオフセットについてはダンプファイルから調査することが可能です。</p>
<p>本章を通して、一見複雑そうに見えるダンプファイルの解析も、最低限の確認ポイントを押さえるだけで実は簡単に原因特定ができる場合があるということを感じてもらえたら良いと思っています。</p>
<h2 id="各章へのリンク" style="position:relative;"><a href="#%E5%90%84%E7%AB%A0%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF" aria-label="各章へのリンク permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>各章へのリンク</h2>
<ul>
<li><a href="/magical-windbg-vol1-00">まえがき</a></li>
<li><a href="/magical-windbg-vol1-01">1 章 環境構築</a></li>
<li><a href="/magical-windbg-vol1-02">2 章 WinDbg の基本操作</a></li>
<li><a href="/magical-windbg-vol1-03">3 章 解析に必要な前提知識</a></li>
<li><a href="/magical-windbg-vol1-04">4 章 アプリケーションのクラッシュダンプを解析する</a></li>
<li><a href="/magical-windbg-vol1-05">5 章 システムクラッシュ時のフルメモリダンプを解析する</a></li>
<li><a href="/magical-windbg-vol1-06">6 章 プロセスダンプからユーザモードアプリケーションのメモリリーク事象を調査する</a></li>
<li><a href="/magical-windbg-vol1-07">7 章 フルメモリダンプからユーザモードメモリリーク事象を調査する</a></li>
<li><a href="/magical-windbg-vol1-50">付録 A WinDbg の Tips</a></li>
<li><a href="/magical-windbg-vol1-51">付録 B Volatility 3 でクラッシュダンプを解析する</a></li>
</ul>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>インサイド Windows 第 7 版 下 P.564 (Andrea Allievi, Mark E.Russinovich, Alex Ionescu, David A.Solomon 著 / 山内和朗 訳 / 日系 BP 社 / 2022 年) </p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
<li id="fn-2">
<p>インサイド Windows 第 7 版 上 P.534 (Pavel Yosifovich, Alex Ionescu, Mark E. Russinovich, David A. Solomon 著 / 山内 和朗 訳 / 日系 BP 社 / 2018 年) </p>
<a href="#fnref-2" class="footnote-backref">↩</a>
</li>
<li id="fn-3">
<p>Register Context <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/changing-contexts#register-context" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/changing-contexts#register-context</a></p>
<a href="#fnref-3" class="footnote-backref">↩</a>
</li>
<li id="fn-4">
<p>.exr 例外レコードの表示 <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-exr--display-exception-record-" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-exr—display-exception-record-</a></p>
<a href="#fnref-4" class="footnote-backref">↩</a>
</li>
<li id="fn-5">
<p>アクセス違反 C0000005 <a href="https://learn.microsoft.com/ja-jp/shows/inside/c0000005" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/shows/inside/c0000005</a></p>
<a href="#fnref-5" class="footnote-backref">↩</a>
</li>
<li id="fn-6">
<p>インサイド Windows 第 7 版 下 P.91 (Andrea Allievi, Mark E.Russinovich, Alex Ionescu, David A.Solomon 著 / 山内和朗 訳 / 日系 BP 社 / 2022 年) </p>
<a href="#fnref-6" class="footnote-backref">↩</a>
</li>
<li id="fn-7">
<p>インサイド Windows 第 7 版 下 P.565 (Andrea Allievi, Mark E.Russinovich, Alex Ionescu, David A.Solomon 著 / 山内和朗 訳 / 日系 BP 社 / 2022 年) </p>
<a href="#fnref-7" class="footnote-backref">↩</a>
</li>
<li id="fn-8">
<p>インサイド Windows 第 6 版 下 P.624 (Mark E. Russinovich・David A. Solomon・Alex Ionescu 著 / 株式会社クイープ 訳 / 日系 BP 社 / 2013 年)</p>
<a href="#fnref-8" class="footnote-backref">↩</a>
</li>
<li id="fn-9">
<p>!analyze 拡張機能の使用 <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/using-the--analyze-extension" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/using-the—analyze-extension</a></p>
<a href="#fnref-9" class="footnote-backref">↩</a>
</li>
<li id="fn-10">
<p>u、ub、uu Unassemble <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/u--unassemble-" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/u—unassemble-</a></p>
<a href="#fnref-10" class="footnote-backref">↩</a>
</li>
<li id="fn-11">
<p>ILSpy <a href="https://github.com/icsharpcode/ILSpy" target="_blank" rel="nofollow noopener noreferrer">https://github.com/icsharpcode/ILSpy</a></p>
<a href="#fnref-11" class="footnote-backref">↩</a>
</li>
<li id="fn-12">
<p>jadx <a href="https://github.com/skylot/jadx" target="_blank" rel="nofollow noopener noreferrer">https://github.com/skylot/jadx</a></p>
<a href="#fnref-12" class="footnote-backref">↩</a>
</li>
<li id="fn-13">
<p>PE format <a href="https://learn.microsoft.com/ja-jp/windows/win32/debug/pe-format" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows/win32/debug/pe-format</a></p>
<a href="#fnref-13" class="footnote-backref">↩</a>
</li>
<li id="fn-14">
<p>CRT の初期化 <a href="https://learn.microsoft.com/ja-jp/cpp/c-runtime-library/crt-initialization?view=msvc-170" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/cpp/c-runtime-library/crt-initialization?view=msvc-170</a></p>
<a href="#fnref-14" class="footnote-backref">↩</a>
</li>
</ol>
</div></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Nov 15, 2023</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/magical-win-dbg/">Magical WinDbg</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/windows/">Windows</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/win-dbg/">WinDbg</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたいCTF Player(Team: 0nePadding)。WinDbgとYARAが好き。OSCP / CISSP / AtCoder 緑 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/kash1064" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/magical-windbg-vol1-04";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-6aedca512ffc346655cd.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-76f2006942127b3c7274.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-70ba56c0f46525baa629.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-d19905e5c8fc953958f1.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-6ba68ef37e264f701345.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-0faa242d92f89b71e668.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-6aedca512ffc346655cd.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-ccbc7c7848e640d6928d.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-a3c0f166cb4b802ff58f.js" async=""></script></body></html>