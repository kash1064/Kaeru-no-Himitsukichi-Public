<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e71379dda153709d1a9a.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.625rem;margin:.3125rem 0;border:1px solid #999;border-radius:.3125rem}.Sidebar-module--search-container--17C6F{position:relative}.Sidebar-module--search-container-input--27Tw4{width:100%}.Sidebar-module--search-container-submit--WwtLg{position:absolute;width:2.375rem;height:2.375rem;top:calc(50% - 19px);right:0;border:3px solid #999;border-radius:0 .25rem .25rem 0;background:#999}.Sidebar-module--search-container-submit--WwtLg:before{position:absolute;content:"";width:.9375rem;height:.9375rem;top:calc(50% - 9px);left:calc(50% - 9px);border-radius:50%;box-shadow:0 0 0 2px #fff}.Sidebar-module--search-container-submit--WwtLg:after{position:absolute;content:"";width:.5rem;height:.375rem;top:calc(50% + 6px);left:calc(50% + 2px);border-top:2px solid #fff;transform:rotate(45deg)}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">Magical WinDbg VOL.1【付録 A WinDbg の Tips】 - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content="技術書典 15 で頒布した Magical WinDbg -雰囲気で楽しむ Windows ダンプ解析とトラブルシューティング- VOL.1 の WEB 版です。"/><meta data-react-helmet="true" property="og:site_name" content="Magical WinDbg VOL.1【付録 A WinDbg の Tips】 - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/2dbf3e09d59db889dc9dc41adcc8e827/magical-windbg-vol1.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="Magical WinDbg VOL.1【付録 A WinDbg の Tips】 - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content="技術書典 15 で頒布した Magical WinDbg -雰囲気で楽しむ Windows ダンプ解析とトラブルシューティング- VOL.1 の WEB 版です。"/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/2dbf3e09d59db889dc9dc41adcc8e827/magical-windbg-vol1.png"/><link as="script" rel="preload" href="/webpack-runtime-a3c0f166cb4b802ff58f.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-8cce2329c7028a61e8db.js"/><link as="script" rel="preload" href="/app-df6adebb6794fedcb8af.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/magical-windbg-vol1-50/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Magical WinDbg VOL.1【付録 A WinDbg の Tips】</h1><div class="Content-module--content__body--2TrQ-"><p>この章では、本書の内容に含めることができなかったデバッガ操作のテクニックをいくつか紹介します。</p>
<!-- omit in toc -->
<h2 id="もくじ" style="position:relative;"><a href="#%E3%82%82%E3%81%8F%E3%81%98" aria-label="もくじ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>もくじ</h2>
<ul>
<li><a href="#command-%E3%82%A6%E3%82%A3%E3%83%B3%E3%83%89%E3%82%A6%E3%81%AE%E7%B5%90%E6%9E%9C%E3%82%92%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B">Command ウィンドウの結果をファイルに出力する</a></li>
<li><a href="#windbg-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%8C%96%E3%81%97%E3%81%A6%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B">WinDbg コマンドをスクリプト化して実行する</a></li>
<li><a href="#mex-%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">MEX 拡張機能を使用する</a></li>
<li><a href="#%E3%83%95%E3%83%AB%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%80%E3%83%B3%E3%83%97%E3%81%8B%E3%82%89%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%B8%AD%E8%BA%AB%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B">フルメモリダンプからファイルの中身を参照する</a></li>
<li><a href="#%E3%83%80%E3%83%B3%E3%83%97%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8B%E3%82%89-windbg-%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B">ダンプファイルから WinDbg で実行ファイルを抽出する</a></li>
<li><a href="#%E5%90%84%E7%AB%A0%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF">各章へのリンク</a></li>
</ul>
<h2 id="command-ウィンドウの結果をファイルに出力する" style="position:relative;"><a href="#command-%E3%82%A6%E3%82%A3%E3%83%B3%E3%83%89%E3%82%A6%E3%81%AE%E7%B5%90%E6%9E%9C%E3%82%92%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B" aria-label="command ウィンドウの結果をファイルに出力する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Command ウィンドウの結果をファイルに出力する</h2>
<p>WinDbg の Command ウインドウは、任意のファイルに実行結果を出力するように設定することが可能です。</p>
<p>これは、WinDbg を使用した解析の履歴を保存したい場合や、出力が膨大な量になるコマンドの実行結果を WinDbg 以外の方法で解析したい場合などに便利です。</p>
<p>WinDbg のコマンド出力結果を指定のファイルに保存したい場合、Command ウインドウにて <code class="language-text">.logopen &lt;保存先のファイルのフルパス></code> コマンドを実行します。</p>
<p>このコマンドによって、以降のコマンド実行結果が ASCII テキスト形式で指定したパスのファイルに書き込まれるようになります。</p>
<p>書き込みを終了してファイルを閉じるには、<code class="language-text">.logclose</code> コマンド実行します。</p>
<p>上記のコマンドを実行することで、以下の画像のように出力結果がログに保存されます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b7fd878508bf57c5eaaa84bfbe78ce7c/0b533/appendix-logfile-01.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 63.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACH0lEQVQ4y6VT53LiQAzm/V+KACHH0AI4BGPcwQ3b2FRj2neSAgy5v7czmi32fkXSVrLNBofDAceiwH63w/l8xv+Mynq9RpZliOMYq9UKeZ7TnAmJEJUlCiLjOJ1OuN1uEtfr9RmPM47KcDiCZVoEmGC73WJDisMoQpLEiGheEZnvefAokiTB5XKRi4/xCiaAruPgeDxKlBQpXcpIJTOzopIU8o8MyGQZudhstgLM8QoslrvdLhzbgTIa4e3tDZ12B++NdywWC4yGQ1SrVQRBCFVVYVoW3PkcFs3adIoh3WE3ZXl6glYURYFNgLOZhl6vh/HXGP1+XxTpMx2fnwOxOtNmGBCB5/lI00RAHXIXBIG4ewIOBgPM3TkBKWg2m+B9u91GSKpYdaNel4JZpokuEXq+j3gZyTeVVPq057Q8AVmVoZv4IqV/Pj4EsNVqSRom39/odDqIlkuEYQDDMHCmvM1dF1MCM4jkFUxyOB6PqYo+1MkEnE+2zKBLAtGmmpwlSUppsaHrhrQP53eqTmmvY78//Kp2pUsKDMMUC7VaDbxvNBqicED5q9fqpC4kQAsKke2o+Vkh517TNCH4pXBCysJ7FX8KZFOBdORZDpcu8vmWQBiUi8OD7XPRbMemdfTomx+FbJEvsnXOSUxW83yNVZpKMRiI19zk0uj0irg/uQf5mb42ugCW96fFjfxY8/xo9qI43KMQu/yaXl/Kv439F/JazWlRGWzVAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/b7fd878508bf57c5eaaa84bfbe78ce7c/8ac56/appendix-logfile-01.webp 240w,
/static/b7fd878508bf57c5eaaa84bfbe78ce7c/d3be9/appendix-logfile-01.webp 480w,
/static/b7fd878508bf57c5eaaa84bfbe78ce7c/b0a15/appendix-logfile-01.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/b7fd878508bf57c5eaaa84bfbe78ce7c/8ff5a/appendix-logfile-01.png 240w,
/static/b7fd878508bf57c5eaaa84bfbe78ce7c/e85cb/appendix-logfile-01.png 480w,
/static/b7fd878508bf57c5eaaa84bfbe78ce7c/0b533/appendix-logfile-01.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/b7fd878508bf57c5eaaa84bfbe78ce7c/0b533/appendix-logfile-01.png"
            alt="ログファイルに出力されたコマンド実行結果"
            title="ログファイルに出力されたコマンド実行結果"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>なお、<code class="language-text">.logopen</code> コマンドでログの出力先を指定した場合、そのパスにすでにファイルが存在している場合は、既存のファイルのデータが削除され、新しいコマンド出力結果が上書きされるため注意してください。</p>
<p>もし、既存のファイルに追記する形でコマンド出力結果を保存したい場合は、<code class="language-text">.logopen</code> コマンドではなく <code class="language-text">.logappend &lt;保存先のファイルのフルパス></code> コマンドを使用します。</p>
<p>また、うっかり過去の解析結果を保存したファイルを上書きしてしまうことを避けたい場合には、<code class="language-text">.logopen</code> コマンドの <code class="language-text">/t</code> オプションを使用することもできます。</p>
<p><code class="language-text">/t</code> オプションを使用すると、以下の例のように、指定のファイルパスに自動的に記録の開始日時に関するタイムスタンプ情報が追加されるため、既存のファイルの上書きを防ぐことが可能になります。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0:000> .logopen /t C:\Users\Public\windbg.log
Closing open log file C:\Users\Public\windbg.log
Opened log file 'C:\Users\Public\windbg_1058_2023-09-24_08-36-13-088.log'</code></pre></div>
<p>どのコマンドを使用する場合も、書き込みを終了してファイルを閉じるには、<code class="language-text">.logclose</code> コマンド使用します。</p>
<p>WinDbg の出力結果の保存に関するより詳しい情報は、以下の公式ドキュメントを参照してください。</p>
<br>
<p>WinDbg でのログファイルの保持:</p>
<p><a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/keeping-a-log-file-in-windbg" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/keeping-a-log-file-in-windbg</a></p>
<br>
<h2 id="windbg-コマンドをスクリプト化して実行する" style="position:relative;"><a href="#windbg-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%8C%96%E3%81%97%E3%81%A6%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B" aria-label="windbg コマンドをスクリプト化して実行する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WinDbg コマンドをスクリプト化して実行する</h2>
<p>WinDbg ではスクリプト化した複雑な処理を実行することが可能です。</p>
<p>本書でダンプファイルの解析にコマンドを使用した際には、WinDbg の Command ウインドウに単一のコマンド、もしくは セミコロン(<code class="language-text">;</code>) で区切った複数のコマンドを入力して実行していました。</p>
<p>しかし、より効率的に解析を行う場合には、複雑なコマンドを一括で実行したり、条件分岐を設定して実行するコマンドを制御したりする必要がある場合があります。</p>
<p>例えば、以下のスクリプトはカーネルメモリ空間内の EPROCESS 構造体を列挙し、If 文を使用して D4C.exe のプロセスが見つかったときにそのアドレスのみを出力する事ができるスクリプトです。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$$  Get process list LIST_ENTRY in $t0.
r $t0 = nt!PsActiveProcessHead

$$  Iterate over all processes in list.
.for (r $t1 = poi(@$t0);
      (@$t1 != 0) &amp; (@$t1 != @$t0);
      r $t1 = poi(@$t1))
{
    r? $t2 = #CONTAINING_RECORD(@$t1, nt!_EPROCESS, ActiveProcessLinks);
    as /x Procc @$t2

    $$  Get image name into $ImageName.
    as /ma $ImageName @@c++(&amp;@$t2->ImageFileName[0])

    .block
    {
	   .if ($scmp("D4C.exe","${$ImageName}")) { } .else {.echo ${$ImageName} at ${Procc}}
    }

    ad $ImageName
    ad Procc
}</code></pre></div>
<p>このスクリプトを <code class="language-text">C:\Users\Win10\Downloads\windbg_script.txt</code> として保存し、WinDbg で以下のように呼び出すことで実行できます。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">6: kd> $$>a&lt;C:\Users\Win10\Downloads\windbg_script.txt
D4C.exe at 0xffffc18f45284080</code></pre></div>
<p>なお、スクリプトの呼び出しコマンド<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>や、このスクリプト内で使用している条件分岐<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>とループ<sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup>の構文、またエイリアス<sup id="fnref-4"><a href="#fn-4" class="footnote-ref">4</a></sup>や疑似レジスタ<sup id="fnref-5"><a href="#fn-5" class="footnote-ref">5</a></sup>の使用方法については、本書では詳しく解説しません。</p>
<p>各コマンドの詳細については公開ドキュメントの情報を参照してください。</p>
<h2 id="mex-拡張機能を使用する" style="position:relative;"><a href="#mex-%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B" aria-label="mex 拡張機能を使用する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MEX 拡張機能を使用する</h2>
<p>MEX 拡張機能は、Microsoft が公式に提供している WinDbg 用の拡張機能です。</p>
<p>MEX 拡張機能のいくつかのコマンドについては 7 章で使用しました。</p>
<p>本書で実施した程度の解析であれば MEX 拡張機能を使用する必要はありませんが、覚えておくと便利かと思います。</p>
<p>MEX 拡張機能を利用するにはまず、以下の URL からダウンロード可能な Mex.exe を Windows システムで実行します。</p>
<br>
<p>Download MEX Debugging Extension from Official Microsoft Download Center:</p>
<p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=53304" target="_blank" rel="nofollow noopener noreferrer">https://www.microsoft.com/en-us/download/details.aspx?id=53304</a></p>
<br>
<p>次に、利用規約に同意した後に表示されるウィンドウで任意のフォルダパスを指定し、MEX 拡張機能のモジュールを配置します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c75e8c47f84c63428c00b284e2b7ec7a/0b533/MEX-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 33.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABbklEQVQoz22R7WriQBiFc9NegJewa//4xwtoC34gmGDW0n8ioqDRNB8qJnFjKiaxpuJHu89OBrIg7MDDOcMMw5nzKr1eD1XtoHU1uoJOR0XVNHovL4xGozvG4zHD4ZDBYCB9of1+X56Xy2WUNE15370TbHx2u0iwI4oi4iTh9vXF7Xbjer1KLXyxP51OXITPNV+1Wg1ltVrhui6O4+B5HsvlUvpCTdNkPp9jWdY/tW0H17GxLVPwxtJ14M83lUoFJU8ThiG+77PZbAiCQCbcbrfs93uyLLvjeMz4zI54UcJ8FWI4HobrE8QnKg8PKLZtM51OJYZhMJlMmM1mUtfrNYfDgTiOJYmoIUlS0mQvH3sdL+j2DX4NTGbBBz9+ioT53y+Xy103hT+fz7KfPFmeeLFYSPKe0zThd7jlTXzfEuT3q9Uqiq7rYrIdMWn1v2hi4rk2m03q9bqk1WrRbrdpNBo8Pz/x9PiIrncplUr8BSyS7eMrbQRfAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/c75e8c47f84c63428c00b284e2b7ec7a/8ac56/MEX-001.webp 240w,
/static/c75e8c47f84c63428c00b284e2b7ec7a/d3be9/MEX-001.webp 480w,
/static/c75e8c47f84c63428c00b284e2b7ec7a/b0a15/MEX-001.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/c75e8c47f84c63428c00b284e2b7ec7a/8ff5a/MEX-001.png 240w,
/static/c75e8c47f84c63428c00b284e2b7ec7a/e85cb/MEX-001.png 480w,
/static/c75e8c47f84c63428c00b284e2b7ec7a/0b533/MEX-001.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/c75e8c47f84c63428c00b284e2b7ec7a/0b533/MEX-001.png"
            alt="MEX モジュールの展開"
            title="MEX モジュールの展開"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>上記で指定したパスをエクスプローラで参照すると <code class="language-text">Mex.zip</code> というファイルが配置されていることを確認できるので、この ZIP ファイルを解凍してください。</p>
<p>解凍したフォルダ内に含まれる <code class="language-text">mex.dll</code> というファイルを <code class="language-text">.load &lt;mex.dll のフルパス></code> コマンドで WinDbg にロードすることで、MEX 拡張機能を利用できるようになります。</p>
<p>本書では MEX 拡張機能について詳細な解説は行いませんが、<code class="language-text">!mex.help -all</code> コマンドを実行することで使用可能な各機能に関するヘルプを出力できます。</p>
<h2 id="フルメモリダンプからファイルの中身を参照する" style="position:relative;"><a href="#%E3%83%95%E3%83%AB%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%80%E3%83%B3%E3%83%97%E3%81%8B%E3%82%89%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%B8%AD%E8%BA%AB%E3%82%92%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B" aria-label="フルメモリダンプからファイルの中身を参照する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>フルメモリダンプからファイルの中身を参照する</h2>
<p>この項ではフルメモリダンプで取得したメモリデータからファイルのデータを取得するテクニックを紹介します。</p>
<p>Windows システムでは、キャッシュマネージャという仕組みによってファイルのコンテンツやファイルシステムのメタデータなどをキャッシュします。<sup id="fnref-6"><a href="#fn-6" class="footnote-ref">6</a></sup></p>
<p>このキャッシュマネージャは「仮想ブロックキャッシュ(Virtual Block Caching)」という仕組みによってどのファイルのどの部分がキャッシュ内に存在するかを追跡します。</p>
<p>本書では、メモリにマップされたファイルオブジェクトからキャッシュマネージャの管理する「仮想アドレス制御ブロック(VACB)」と呼ばれる構造体のアドレスを特定することで、メモリ内にキャッシュされた情報からからシステム内のファイルコンテンツを抽出することを試みます。</p>
<p>なお、この方法はフルメモリダンプで取得したメモリ内のページにキャッシュデータが存在していることを前提とするため、取得したフルメモリダンプから必ずしもファイルのコンテンツを取得できるとは限らない点に注意が必要です。</p>
<p>フルメモリダンプからファイルコンテンツを抽出するため、まずは取得したフルメモリダンプを WinDbg にロードして <code class="language-text">!memusage</code> コマンドを実行します。</p>
<p><code class="language-text">!memusage</code> コマンドの出力結果は膨大になるため、事前に <code class="language-text">.logopen</code> コマンドで実行結果をファイルに出力する設定を有効化しておくことをおすすめします。</p>
<p><code class="language-text">!memusage</code> コマンドを実行して PFN データベースの情報を解析した結果、mapped_file として no-cached-file.txt と Microsoft-Windows-Windows Defender%4Operational.evtx(Microsoft Defender ウイルス対策のイベントログファイル) の存在を確認できました。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0: kd> !memusage
loading PFN database
{{ 省略 }}
Usage Summary (in Kb):
Control       Valid Standby Dirty Shared Locked PageTables  name
・・・
ffffc40861b53750     0      4     0     0     0     0  mapped_file( no-cached-file.txt )
・・・
ffffc40861b5c350    68      0     0     0    68     0  mapped_file( Microsoft-Windows-Windows Defender%4Operational.evtx )
・・・</code></pre></div>
<p>ここで特定した Control の情報を参照するには <code class="language-text">!ca</code> 拡張機能<sup id="fnref-7"><a href="#fn-7" class="footnote-ref">7</a></sup>を使用します。</p>
<p><code class="language-text">mapped_file( no-cached-file.txt )</code> に対応するコントロール領域のアドレスである 0xffffc40861b53750 を使用して <code class="language-text">!ca ffffc40861b53750</code> コマンドを実行したところ、以下の結果を得ることができました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ff05f77f98d57df8289c61e0929e0b30/0b533/windbg-read-file-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 43.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABRklEQVQoz3WSa8uCQBCF/f//y/wiEaZUlJVdtAuVUtndE8+AYry8C8NeZvfMOWfWWa1W2u/3ms1miqJIw+FQm81G7/db9Xi9Xno+nxbt83bu8Xjo8/nI8TxP2+1W5/NZSZJouVxqsVhYAH69XpXnuXa7nQ6HgxULgsDuQqQoip+c47quer2eTqeTxfF4tOR4PFan05Hv+7rdbg0jAMhNp1OlafrDluJOlmXNBapiAfLZMxPI+m9UVdUEw0Haer02+oDN53NjiEwqYgUMAeWMQMX9fv8BrNfmYRiGdglj60eXy8W8wVOK0QzOCGS3bajBjCFyYYhcmjAajcwCwGHFTBfbLIg6R2f/MKTLsAKIr9Ptds27wWBg+ziO7QGsJpOJ+v2+eUwTy7I0axpAvgBy8ASJsEUma74BfnJG89gTFGZmwBCmNeAXZluo2l5c/fcAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/ff05f77f98d57df8289c61e0929e0b30/8ac56/windbg-read-file-001.webp 240w,
/static/ff05f77f98d57df8289c61e0929e0b30/d3be9/windbg-read-file-001.webp 480w,
/static/ff05f77f98d57df8289c61e0929e0b30/b0a15/windbg-read-file-001.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/ff05f77f98d57df8289c61e0929e0b30/8ff5a/windbg-read-file-001.png 240w,
/static/ff05f77f98d57df8289c61e0929e0b30/e85cb/windbg-read-file-001.png 480w,
/static/ff05f77f98d57df8289c61e0929e0b30/0b533/windbg-read-file-001.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/ff05f77f98d57df8289c61e0929e0b30/0b533/windbg-read-file-001.png"
            alt="!ca で no-cached-file.txt のコントロール領域の情報を取得する"
            title="!ca で no-cached-file.txt のコントロール領域の情報を取得する"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>同じく、<code class="language-text">mapped_file( Microsoft-Windows-Windows Defender%4Operational.evtx )</code> に対応するコントロール領域のアドレスである 0xffffc40861b5c350 を使用して <code class="language-text">!ca ffffc40861b5c350</code> コマンドを実行したところ、結果は以下のようになりました。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9d4e16a72f9099898ae7d0f08c992c63/0b533/windbg-read-file-002.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 43.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABT0lEQVQoz22S646CUAyEef/nMjH4DyVGRBEv4BVEAe8ym68Jxt1sk5PTnKHTmRZntVrpcDhoOp1qOBxqNBpps9no/X6rjcfjofv9buf1euk7/mKO67rKskzn81nL5VI0iKJIi8XCGtR1rePxqP1+b43TNJXneZrNZtrtdjqdTobBwe10Oh0NBgMjzPPcigAp6PV6hqGijaqqDJvP51qv17/UotKh42QyMUWcOI6VJImKojBlNCGnEWrIy7K0HKzF+bZpGjlYZGbIJ4fwm4hCCC6Xi5Fy+BZHt9vNVOGAY4Tdble+71shRdiFjCWhnrlCwJKwy4Hser3qv3AoxCJzCcPQthwEgXVnayh4Pp/WnWhvMFSBtZs3hQweBViBaDwef2YKOeppRqAMjDeE4IQ3RvMh7Pf7ZoffA+Ltdmvr52aL5NhmzuTcNGUc3/9iS/gDMqynVyJaYIAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/9d4e16a72f9099898ae7d0f08c992c63/8ac56/windbg-read-file-002.webp 240w,
/static/9d4e16a72f9099898ae7d0f08c992c63/d3be9/windbg-read-file-002.webp 480w,
/static/9d4e16a72f9099898ae7d0f08c992c63/b0a15/windbg-read-file-002.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/9d4e16a72f9099898ae7d0f08c992c63/8ff5a/windbg-read-file-002.png 240w,
/static/9d4e16a72f9099898ae7d0f08c992c63/e85cb/windbg-read-file-002.png 480w,
/static/9d4e16a72f9099898ae7d0f08c992c63/0b533/windbg-read-file-002.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/9d4e16a72f9099898ae7d0f08c992c63/0b533/windbg-read-file-002.png"
            alt="!ca でイベントログファイルのコントロール領域の情報を取得する"
            title="!ca でイベントログファイルのコントロール領域の情報を取得する"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>この出力結果から、各ファイルのパスとファイルオブジェクトのアドレスを確認できます。</p>
<p>例えば、no-cached-file.txt の出力結果では <code class="language-text">File Object  ffffc40861f5f720</code> と表示されているため、このファイルのファイルオブジェクトが 0xffffc40861f5f720 に存在していることを特定できます。</p>
<p>また、イベントログファイルの出力結果は <code class="language-text">File Object  ffffc40861920440</code> となっていることを確認できます。</p>
<p>確認のためにこれらのアドレスを使用して <code class="language-text">!fileobj</code> 拡張機能を実行することで、ファイルオブジェクトの詳細情報を参照できることを確認しておきます。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># no-cached-file.txt のファイルオブジェクトを調査
0: kd> !fileobj ffffc40861f5f720

\Users\Vuln\Desktop\no-cached-file.txt

Device Object: 0xffffc4085b32ec00   \Driver\volmgr
Vpb: 0xffffc4085b3c69c0
Access: Read SharedRead SharedWrite 

Flags:  0x44042
	Synchronous IO
	Cache Supported
	Cleanup Complete
	Handle Created

Final Status: 80000005
FsContext: 0xffff83807b62d700	FsContext2: 0xffff83807ceb2580
CurrentByteOffset: 0
Cache Data:
  Section Object Pointers: ffffc40861f22a98
  Shared Cache Map: 00000000


# イベントログファイルのファイルオブジェクトを調査
0: kd> !fileobj ffffc40861920440

\Windows\System32\winevt\Logs\Microsoft-Windows-Windows Defender%4Operational.evtx

Device Object: 0xffffc4085b32ec00   \Driver\volmgr
Vpb: 0xffffc4085b3c69c0
Event signalled
Access: Read Write SharedRead 

Flags:  0x41042
	Synchronous IO
	Cache Supported
	Modified
	Handle Created

FsContext: 0xffff83807a55f700	FsContext2: 0xffff83807a55f970
Private Cache Map: 0xffffc40861582b98
CurrentByteOffset: 36a0
Cache Data:
  Section Object Pointers: ffffc40861981b38
  Shared Cache Map: ffffc40861582a20         File Offset: 36a0 in VACB number 0
  Vacb: ffffc4085abd5ea0
  Your data is at: ffff9688ea9436a0</code></pre></div>
<p>各ファイルオブジェクトのアドレスを特定できたので、次に <code class="language-text">nt!_FILE_OBJECT</code> 構造体内の情報から <code class="language-text">nt!_SECTION_OBJECT_POINTERS</code> 構造体のアドレスを取得します。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># no-cached-file.txt のファイルオブジェクトを調査
0: kd> dt nt!_FILE_OBJECT ffffc40861f5f720 SectionObjectPointer
   +0x028 SectionObjectPointer : 0xffffc408`61f22a98 _SECTION_OBJECT_POINTERS

# イベントログファイルのファイルオブジェクトを調査
0: kd> dt nt!_FILE_OBJECT ffffc40861920440 SectionObjectPointer
   +0x028 SectionObjectPointer : 0xffffc408`61981b38 _SECTION_OBJECT_POINTERS</code></pre></div>
<p>さらにこのアドレスが指す <code class="language-text">nt!_SECTION_OBJECT_POINTERS</code> 構造体の情報をダンプします。</p>
<p>先に no-cached-file.txt の情報をダンプしてみると、以下のように SharedCacheMap が空であることがわかります。</p>
<p>この場合、no-cached-file.txt はキャッシュマネージャによってキャッシュされていないため、キャッシュからコンテンツを参照することができません。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0: kd> dt nt!_SECTION_OBJECT_POINTERS ffffc408`61f22a98 
   +0x000 DataSectionObject : 0xffffc408`61b53750 Void
   +0x008 SharedCacheMap   : (null) 
   +0x010 ImageSectionObject : (null)</code></pre></div>
<p>では次に、イベントログファイルの構造体情報をダンプしてみます。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0: kd> dt nt!_SECTION_OBJECT_POINTERS ffffc40861981b38
   +0x000 DataSectionObject : 0xffffc408`61b5c350 Void
   +0x008 SharedCacheMap   : 0xffffc408`61582a20 Void
   +0x010 ImageSectionObject : (null) </code></pre></div>
<p>こちらは SharedCacheMap に 0xffffc40861582a20 というアドレスが格納されていることがわかります。</p>
<p>SharedCacheMap 構造体の中には VACB のアドレスが含まれています。</p>
<p>そのため、特定した SharedCacheMap のアドレスを使用して <code class="language-text">t nt!_SHARED_CACHE_MAP ffffc40861582a20 Vacbs</code> コマンドを実行することで、対象ファイルのコンテンツが含まれるキャッシュを参照するための VACB のアドレスを特定できます。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0: kd> dt nt!_SHARED_CACHE_MAP ffffc40861582a20 Vacbs
   +0x058 Vacbs : 0xffffc408`61582a58  -> 0xffffc408`5abd5ea0 _VACB</code></pre></div>
<p>上記のコマンドで特定した VACB のアドレス 0xffffc4085abd5ea0 を使用して <code class="language-text">nt!_VACB</code> 構造体の情報をダンプすることで、以下の情報を取得できました。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0: kd> dt nt!_VACB ffffc4085abd5ea0
   +0x000 BaseAddress      : 0xffff9688`ea940000 Void
   +0x008 SharedCacheMap   : 0xffffc408`61582a20 _SHARED_CACHE_MAP
   +0x010 Overlay          : &lt;anonymous-tag>
   +0x020 ArrayHead        : 0xffffc408`5abce000 _VACB_ARRAY_HEADER</code></pre></div>
<p>VACB 構造体はシステムの VACB 配列によって管理されており、各 VACB エントリはシステムキャッシュ用に割り当てられている 256 KB のスロットのアドレスを記述しています。<sup id="fnref-8"><a href="#fn-8" class="footnote-ref">8</a></sup></p>
<p>つまり、Microsoft Defender ウイルス対策のイベントログファイルのコンテンツは、VACB の BaseAddress で確認したアドレス 0xffff9688ea940000 にキャッシュされていることがわかります。</p>
<p>実際に <code class="language-text">db 0xffff9688ea940000 L60</code> コマンドで、BaseAddress から 60 バイト分のメモリをダンプしてみると、Windows のイベントログファイル(EVTX) フォーマットのシグネチャにあたる <code class="language-text">ElfFile\x00</code> から始まるデータであることがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7eaa5672a14e677b12c278b63f52b5e2/0b533/windbg-read-file-003.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 14.166666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAmUlEQVQI1z2OSQqFMBBEc/9juRBRNMEhDmQhunEgbiVKKOmC/xePSjXhdaumaaC1Rp7nsNaiLEv2YRiwbRuO48C+78zzPDn7pfce13WR930RY4QqigJJkpB1XVHXNcVd15GqqmCM+c/l3bYtlzrnEELAfd9MkSr5kGUZ0jTFsiyQi/u+J+M4sotIJNJlyTRN7PM88yoRPc9DPgkq17+R/b8eAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/7eaa5672a14e677b12c278b63f52b5e2/8ac56/windbg-read-file-003.webp 240w,
/static/7eaa5672a14e677b12c278b63f52b5e2/d3be9/windbg-read-file-003.webp 480w,
/static/7eaa5672a14e677b12c278b63f52b5e2/b0a15/windbg-read-file-003.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/7eaa5672a14e677b12c278b63f52b5e2/8ff5a/windbg-read-file-003.png 240w,
/static/7eaa5672a14e677b12c278b63f52b5e2/e85cb/windbg-read-file-003.png 480w,
/static/7eaa5672a14e677b12c278b63f52b5e2/0b533/windbg-read-file-003.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/7eaa5672a14e677b12c278b63f52b5e2/0b533/windbg-read-file-003.png"
            alt="イベントログファイルのキャッシュされたメモリのダンプ"
            title="イベントログファイルのキャッシュされたメモリのダンプ"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>※ Windows のイベントログファイル(EVTX) フォーマットの詳細な仕様は公開されていませんが、Github で公開されている <a href="https://github.com/libyal/libevtx/blob/main/documentation/Windows%20XML%20Event%20Log%20(EVTX).asciidoc#windows-xml-event-log-evtx-format" target="_blank" rel="nofollow noopener noreferrer">libyal/libevtx</a> リポジトリの情報から、ファイルヘッダやチャンクヘッダに関する情報を得ることができます。</p>
<p>さらに、この BaseAddress から始まるメモリ領域にイベントログファイルのデータが書き込まれているかどうか確認するため、<code class="language-text">.writemem C:\windefend-event.txt ffff9688ea940000 L10000</code> コマンドで適当に 10000 バイト分のデータを windefend-event.txt にダンプします。</p>
<p>イベントログファイル内のテキストはワイド文字列として書き込まれているので、<code class="language-text">strings -e l windefend-event.txt</code> のようなコマンドを使用してファイルのテキストを抽出すると、以下のようなイベントログファイル内に記述されるデータを取得できていることがわかりました。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ strings -e l windefend-event.txt
・・・
Microsoft Defender Antivirus
4.18.23080.2006
1.397.865.0
1.1.23080.2005
Security intelligence update
C:\ProgramData\Microsoft\Windows Defender\Scans\RtSigs\data\884898236a1fb17353dac39aea1e06cfeadc24e4
0.0.0.0
10/20/2023 11:36:23 AM
Duration
2592000000
Microsoft-Windows-Windows Defender
Microsoft-Windows-Windows Defender/Operational</code></pre></div>
<p>ちなみに、今回は VACB のアドレスに到達するためにファイルオブジェクトのアドレスから構造体の情報を順に辿っていきましたが、<code class="language-text">!finddata</code> 拡張機能<sup id="fnref-9"><a href="#fn-9" class="footnote-ref">9</a></sup>を使用すると、もっと簡単にコンテンツがキャッシュされたアドレスを特定できます。</p>
<p>ここまでに調査した no-cached-file.txt とイベントログファイルのファイルオブジェクトのアドレスを使用して <code class="language-text">!finddata</code> コマンドを実行すると、以下のような結果が得られました。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># no-cached-file.txt のファイルオブジェクトを調査
0: kd> !finddata ffffc40861f5f720
・・・
FindData for FileObject ffffc40861f5f720   Section Object Pointers: ffffc40861f22a98
Shared Cache Map: 00000000Unable to read nt!_SHARED_CACHE_MAP at 0000000000000000


# イベントログファイルのファイルオブジェクトを調査
0: kd> !finddata ffffc40861920440
・・・
FindData for FileObject ffffc40861920440   Section Object Pointers: ffffc40861981b38
Shared Cache Map: ffffc40861582a20         File Offset: 0 in VACB number 0
Vacb: ffffc4085abd5ea0
Your data is at: ffff9688ea940000</code></pre></div>
<p>メモリ内にキャッシュが存在していなかった no-cached-file.txt の場合は <code class="language-text">nt!_SHARED_CACHE_MAP</code> 構造体のアドレスを参照できなかった旨のテキストが出力されています。</p>
<p>一方で、イベントログファイルの場合は、<code class="language-text">Your data is at: ffff9688ea940000</code> として、VACB 構造体の情報から特定したコンテンツのキャッシュされているアドレスが出力されました。</p>
<p>以上で、フルメモリダンプからシステムにキャッシュされたファイルのデータを抽出することができました。</p>
<p>この方法では狙ったファイルや元の完全なファイルを取得することは困難ですが、フルメモリダンプを解析する上で知っておくと面白いテクニックかと思います。</p>
<h2 id="ダンプファイルから-windbg-で実行ファイルを抽出する" style="position:relative;"><a href="#%E3%83%80%E3%83%B3%E3%83%97%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8B%E3%82%89-windbg-%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B" aria-label="ダンプファイルから windbg で実行ファイルを抽出する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ダンプファイルから WinDbg で実行ファイルを抽出する</h2>
<p>実際のトラブルシューティングの場面で使用する必要はありませんが、例えばマルウェアに感染した端末のダンプファイルを解析する場合などに、メモリダンプから元の実行ファイルを取得したい場合があります。</p>
<p>そのような場合は、プロセスのメモリ内に展開されたデータを WinDbg で抽出してファイルとしてエクスポートすることで、実行ファイル(PE ファイル)を取得できます。</p>
<p>しかし、この方法でプロセスのメモリから展開した実行ファイルは、元の実行ファイルと完全に同一のファイルではない点に注意する必要があります。<sup id="fnref-10"><a href="#fn-10" class="footnote-ref">10</a></sup></p>
<p>この理由は複数ありますが、1 つは PE ファイルの一部のセクションがプロセスメモリ内に展開されないことが挙げられます。</p>
<p>また、メモリに展開されたグローバル変数の値や実行コードなどがプログラムによってに書き換えられた場合にも、元の実行ファイルを抽出することができなくなります。</p>
<p>プロセスメモリから元の実行ファイルと完全に同一のファイルを抽出することが困難な理由は他にもありますが、本書では詳細な解説は割愛します。</p>
<p>プロセスメモリからの実行ファイルの抽出については参考文献に記載している「The Art of Memory Forensics」で詳しく解説されています。</p>
<p>本書では、WinDbg を使用してプロセスのフルメモリダンプから D4C.exe の実行ファイル復元を行います。</p>
<p>基本的には、PE ファイルのローダの逆の操作を行い、プロセスのメモリ内に展開された PE ヘッダや各セクションの情報を抜き出して 1 つのファイルとしてマージすることでファイルの復元が可能です。</p>
<p>5 章や 6 章で紹介したように <code class="language-text">!dh -f</code> コマンドと <code class="language-text">!dh -s</code> コマンドを使用して IAT やセクションヘッダの情報を取得し、<code class="language-text">.writemem</code> コマンドで各領域のメモリをファイルをとして出力していく方法でも実行ファイルの復元は技術的には可能です。</p>
<p>しかし、今回は Github 上で公開されているオープンソースの拡張機能(<a href="https://github.com/HongThatCong/dumpext" target="_blank" rel="nofollow noopener noreferrer">HongThatCong/dumpext</a>)を利用して実行ファイルの抽出を行います。</p>
<p>なお、本書ではあくまでプロセスダンプから実行ファイルを抽出可能であるということの紹介のみを行うため、拡張機能の詳細については解説しません。</p>
<p>実行ファイルの抽出のため、6 章で取得した D4C.exe のプロセスダンプを使用します。</p>
<p>D4C.exe のプロセスダンプを WinDbg にロードしたら、<a href="https://github.com/HongThatCong/dumpext" target="_blank" rel="nofollow noopener noreferrer">HongThatCong/dumpext</a> リポジトリからダウンロードした拡張機能を <code class="language-text">.load C:\Users\Public\Downloads\dumpext.dll</code> コマンドで読み込みます。</p>
<p>拡張機能をロードしたら、<code class="language-text">!dumpext.dump_pe !D4C</code> コマンドを実行してプロセスから実行ファイルをダンプします。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ef34154aad3352406c6345fc16287d37/0b533/windbg-recover-file-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 20.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAs0lEQVQY031PSQqEQBDr//9MEfetXUHFBUFFvQhqhsphbjMFoUJ1k0X5vo+iKOC6LoQnSYIoitB1Hfq+xziO5G3bYlkWHMeBf6M8z6OIbdsIggBZlsFxHN7iOEZVVUjTFGEY8q2ua27BMAxomgbTNNFs33coy7L42TAMJhRh4aZp8q61ppEYSOJ1XSmwbRvTyr6ui+ne94XK85yVyrL8QlIJpO48zzjPE/d943men1VFTOYDlwcm7ogkQKcAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/ef34154aad3352406c6345fc16287d37/8ac56/windbg-recover-file-001.webp 240w,
/static/ef34154aad3352406c6345fc16287d37/d3be9/windbg-recover-file-001.webp 480w,
/static/ef34154aad3352406c6345fc16287d37/b0a15/windbg-recover-file-001.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/ef34154aad3352406c6345fc16287d37/8ff5a/windbg-recover-file-001.png 240w,
/static/ef34154aad3352406c6345fc16287d37/e85cb/windbg-recover-file-001.png 480w,
/static/ef34154aad3352406c6345fc16287d37/0b533/windbg-recover-file-001.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/ef34154aad3352406c6345fc16287d37/0b533/windbg-recover-file-001.png"
            alt="!dumpext.dump_pe !D4C による実行ファイルのダンプ"
            title="!dumpext.dump_pe !D4C による実行ファイルのダンプ"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>拡張機能によって出力されたバイナリは WinDbg の実行フォルダ(<code class="language-text">C:\Program Files (x86)\Windows Kits\10\Debuggers\x64</code>) に dump.out として保存されるため、dump.exe などにリネームしておきます。</p>
<p>dump.exe を実行してみると、オリジナルの D4C.exe と同じように起動し、各種機能を利用できました。</p>
<p>しかし、ここで取得した dump.exe とオリジナルの D4C.exe のファイルハッシュを比較してみると、ダンプファイルから取得したファイルは元のファイルとは一致していないことがわかります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ee1759107617605fb2474109be3a1476/0b533/windbg-recover-file-003.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 35.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABPUlEQVQoz22R6U4CQRCER25EIaCCoAgKiCzxAAXF4xEMKIu7S0RBFtH3f4CyeoJ4ZH9UZiZdfX2j4scjxE9ekDx7xeb5BJmWi1RT3j1sNB+QbXcRq5tYqw8RM2wkTsU/QrIxRro11Tnpizd6x4jWhlA7VzOI1llYFfsMTCBN1L4JdTD4UWmh33cvSbHAoQVfxWKRvu5cvPtE9nKmlaPy13Nst6fI0bt3M0eoarOw6d1Egn4WDPIMHTmIcOxwzeHdRMQwEaUC1YFuGqTEI95vv0j88l4pP0ElhAf5pTiZrJtpk2FjRFZdTtvjZPdYNfqUQ0YW0TxrPJoh2W0t+Em+NFUFrrBkWHjUBgmqkgV/xYavzA0q1h8t1/RiLGxkVJ+My4B03u3wo6jC7Qe5uWTpan5y5jvvCHNNSZa8//oCAgPazg3wKOcAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/ee1759107617605fb2474109be3a1476/8ac56/windbg-recover-file-003.webp 240w,
/static/ee1759107617605fb2474109be3a1476/d3be9/windbg-recover-file-003.webp 480w,
/static/ee1759107617605fb2474109be3a1476/b0a15/windbg-recover-file-003.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/ee1759107617605fb2474109be3a1476/8ff5a/windbg-recover-file-003.png 240w,
/static/ee1759107617605fb2474109be3a1476/e85cb/windbg-recover-file-003.png 480w,
/static/ee1759107617605fb2474109be3a1476/0b533/windbg-recover-file-003.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/ee1759107617605fb2474109be3a1476/0b533/windbg-recover-file-003.png"
            alt="ファイルハッシュの比較"
            title="ファイルハッシュの比較"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>以上の通り、プロセスダンプから元のファイルと完全には一致しないものの、実行可能な EXE ファイルを抽出できることが確認できました。</p>
<h2 id="各章へのリンク" style="position:relative;"><a href="#%E5%90%84%E7%AB%A0%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF" aria-label="各章へのリンク permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>各章へのリンク</h2>
<ul>
<li><a href="/magical-windbg-vol1-00">まえがき</a></li>
<li><a href="/magical-windbg-vol1-01">1 章 環境構築</a></li>
<li><a href="/magical-windbg-vol1-02">2 章 WinDbg の基本操作</a></li>
<li><a href="/magical-windbg-vol1-03">3 章 解析に必要な前提知識</a></li>
<li><a href="/magical-windbg-vol1-04">4 章 アプリケーションのクラッシュダンプを解析する</a></li>
<li><a href="/magical-windbg-vol1-05">5 章 システムクラッシュ時のフルメモリダンプを解析する</a></li>
<li><a href="/magical-windbg-vol1-06">6 章 プロセスダンプからユーザモードアプリケーションのメモリリーク事象を調査する</a></li>
<li><a href="/magical-windbg-vol1-07">7 章 フルメモリダンプからユーザモードメモリリーク事象を調査する</a></li>
<li><a href="/magical-windbg-vol1-50">付録 A WinDbg の Tips</a></li>
<li><a href="/magical-windbg-vol1-51">付録 B Volatility 3 でクラッシュダンプを解析する</a></li>
</ul>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">&lt;,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.3em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span></span></span></span>>&#x3C;, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">&lt;,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.3em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span></span></span></span>>&#x3C;, $$ >a&#x3C; Run Script File: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-----------------------a---run-script-file-" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-----------------------a---run-script-file-</a></p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
<li id="fn-2">
<p>.if: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-if" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-if</a></p>
<a href="#fnref-2" class="footnote-backref">↩</a>
</li>
<li id="fn-3">
<p>.for: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-for" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-for</a></p>
<a href="#fnref-3" class="footnote-backref">↩</a>
</li>
<li id="fn-4">
<p>as, aS Set Alias: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/as--as--set-alias-" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/as—as—set-alias-</a></p>
<a href="#fnref-4" class="footnote-backref">↩</a>
</li>
<li id="fn-5">
<p>疑似レジスタの構文: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/pseudo-register-syntax" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/pseudo-register-syntax</a></p>
<a href="#fnref-5" class="footnote-backref">↩</a>
</li>
<li id="fn-6">
<p>インサイド Windows 第 7 版 下 P.595 (Andrea Allievi, Mark E.Russinovich, Alex Ionescu, David A.Solomon 著 / 山内和朗 訳 / 日系 BP 社 / 2022 年) </p>
<a href="#fnref-6" class="footnote-backref">↩</a>
</li>
<li id="fn-7">
<p>!ca 拡張機能 <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-ca" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-ca</a></p>
<a href="#fnref-7" class="footnote-backref">↩</a>
</li>
<li id="fn-8">
<p>インサイド Windows 第 7 版 下 P.606 (Andrea Allievi, Mark E.Russinovich, Alex Ionescu, David A.Solomon 著 / 山内和朗 訳 / 日系 BP 社 / 2022 年)</p>
<a href="#fnref-8" class="footnote-backref">↩</a>
</li>
<li id="fn-9">
<p>!finddata 拡張機能 <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-finddata" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/-finddata</a></p>
<a href="#fnref-9" class="footnote-backref">↩</a>
</li>
<li id="fn-10">
<p>The Art of Memory Forensics: Detecting Malware and Threats in Windows, Linux, and Mac Memory 1st Edition P.239 (Michael Hale Ligh, Andrew Case, Jamie Levy, AAron Walters 著 / Wiley / 2014 年 )</p>
<a href="#fnref-10" class="footnote-backref">↩</a>
</li>
</ol>
</div></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Nov 15, 2023</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/magical-win-dbg/">Magical WinDbg</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/windows/">Windows</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/win-dbg/">WinDbg</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたいCTF Player(Team: 0nePadding)。WinDbgとYARAが好き。OSCP / CISSP / AtCoder 緑 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/kash1064" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/magical-windbg-vol1-50";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-df6adebb6794fedcb8af.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-76f2006942127b3c7274.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-70ba56c0f46525baa629.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-d19905e5c8fc953958f1.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-6ba68ef37e264f701345.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-0faa242d92f89b71e668.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-df6adebb6794fedcb8af.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-8cce2329c7028a61e8db.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-a3c0f166cb4b802ff58f.js" async=""></script></body></html>