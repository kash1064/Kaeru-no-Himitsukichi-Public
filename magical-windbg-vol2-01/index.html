<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e71379dda153709d1a9a.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.625rem;margin:.3125rem 0;border:1px solid #999;border-radius:.3125rem}.Sidebar-module--search-container--17C6F{position:relative}.Sidebar-module--search-container-input--27Tw4{width:100%}.Sidebar-module--search-container-submit--WwtLg{position:absolute;width:2.375rem;height:2.375rem;top:calc(50% - 19px);right:0;border:3px solid #999;border-radius:0 .25rem .25rem 0;background:#999}.Sidebar-module--search-container-submit--WwtLg:before{position:absolute;content:"";width:.9375rem;height:.9375rem;top:calc(50% - 9px);left:calc(50% - 9px);border-radius:50%;box-shadow:0 0 0 2px #fff}.Sidebar-module--search-container-submit--WwtLg:after{position:absolute;content:"";width:.5rem;height:.375rem;top:calc(50% + 6px);left:calc(50% + 2px);border-top:2px solid #fff;transform:rotate(45deg)}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">Magical WinDbg VOL.2【1 章 環境構築】 - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content="技術書典 16 で頒布した Magical WinDbg 2 - CTF で学ぶユーザモード &amp; カーネルデバッギング - の WEB 版です。"/><meta data-react-helmet="true" property="og:site_name" content="Magical WinDbg VOL.2【1 章 環境構築】 - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/e9bfc3718fd53ab58623a496fc9a302e/magical-windbg-vol2.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="Magical WinDbg VOL.2【1 章 環境構築】 - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content="技術書典 16 で頒布した Magical WinDbg 2 - CTF で学ぶユーザモード &amp; カーネルデバッギング - の WEB 版です。"/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/e9bfc3718fd53ab58623a496fc9a302e/magical-windbg-vol2.png"/><link as="script" rel="preload" href="/webpack-runtime-a3c0f166cb4b802ff58f.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-8695bc0012d92a323104.js"/><link as="script" rel="preload" href="/app-4426ef62af9f9b25b2f3.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/magical-windbg-vol2-01/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Magical WinDbg VOL.2【1 章 環境構築】</h1><div class="Content-module--content__body--2TrQ-"><p>本章では、本書で使用する環境構築の手順について紹介します。</p>
<p>なお、本書で使用するバイナリの実行やデバッグには仮想マシンを使用することを前提としています。</p>
<p>私は、Windows 10/11 の Pro エディションに付属している Hyper-V を利用することをおすすめしています。</p>
<p>しかし、Windows 10 / 11 の Home エディションを利用する場合でも、VirtualBox や VMWare などのサードパーティ製の仮想化アプリケーションを使用することで仮想マシンを作成することが可能です。</p>
<!-- omit in toc -->
<h2 id="もくじ" style="position:relative;"><a href="#%E3%82%82%E3%81%8F%E3%81%98" aria-label="もくじ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>もくじ</h2>
<ul>
<li><a href="#%E6%9C%AC%E6%9B%B8%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">本書で使用する環境について</a></li>
<li><a href="#%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90">仮想マシンの作成</a></li>
<li><a href="#%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97">仮想マシンのセットアップ</a></li>
<li><a href="#windbg-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">WinDbg のインストール</a></li>
<li><a href="#debugging-tools-for-windows-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">Debugging Tools for Windows のインストール</a></li>
<li><a href="#sysinternals-%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">Sysinternals ユーティリティのインストール</a></li>
<li><a href="#windbg-%E3%81%A8-sysinternals-%E3%81%AB%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AB%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B">WinDbg と Sysinternals にシンボルサーバを登録する</a></li>
<li><a href="#ghidra-1102-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">Ghidra 11.0.2 のインストール</a></li>
<li><a href="#binary-ninja-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">Binary Ninja のインストール</a></li>
<li><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E8%A7%A3%E6%9E%90%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">その他解析ツールのインストール</a></li>
<li><a href="#windbg-%E3%81%AB%E3%82%88%E3%82%8B%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%AE%E6%BA%96%E5%82%99">WinDbg によるカーネルデバッグの準備</a></li>
<li><a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E7%B5%8C%E7%94%B1%E3%81%A7%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%82%92%E8%A1%8C%E3%81%86">ネットワーク経由でカーネルデバッグを行う</a></li>
<li><a href="#%E8%A7%A3%E6%9E%90%E5%AF%BE%E8%B1%A1%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">解析対象プログラムのダウンロード</a></li>
<li><a href="#%E5%90%84%E7%AB%A0%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF">各章へのリンク</a></li>
</ul>
<h2 id="本書で使用する環境について" style="position:relative;"><a href="#%E6%9C%AC%E6%9B%B8%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" aria-label="本書で使用する環境について permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>本書で使用する環境について</h2>
<p>本書の内容については、以下の環境で確認を行っています。</p>
<p>OS : Windows 10 Pro 22H2</p>
<p>なお、仮想マシンを用意することを前提としているため、ある程度快適に操作するためにも、CPU は Intel Core i3 以上、RAM は 8 GB 以上の端末を使用することを推奨します。</p>
<h2 id="仮想マシンの作成" style="position:relative;"><a href="#%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90" aria-label="仮想マシンの作成 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>仮想マシンの作成</h2>
<p>本書では仮想マシンのインストール方法については詳しい手順の解説は行いません。</p>
<p>Windows 10/11 Pro や Enterprise、または Education を利用している場合は、無料で利用できる Hyper-V の使用をおすすめします。</p>
<p>Hyper-V を有効化して仮想マシンを作成する手順については、以下の公式ドキュメントの手順を利用できます。</p>
<br>
<p>Install Hyper-V on Windows 10：</p>
<p><a href="https://learn.microsoft.com/ja-jp/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v</a></p>
<br>
<p>もし、みなさんの利用中の OS のエディションが Windows 10/11 Home の場合には Hyper-V を利用することはできません。</p>
<p>その場合は、無料でインストール可能な VirtualBox などの仮想マシンプラットフォームを利用することができます。(少なくとも本書執筆時点での最新バージョンである VirtualBox 7.0.14 を使用する場合には、Windows 10/11 の Home エディションにもインストールし、仮想マシンを作成できることを確認しております。ただし、当該バージョンには悪用が容易な既知の脆弱性の存在が報告されているため、可能な限り利用時点で最新のバージョンをインストールすることを推奨します。)</p>
<p>VirtualBox は以下のダウンロードページから取得したインストーラを使用することでインストールできます。</p>
<br>
<p>Download VirtualBox：</p>
<p><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="nofollow noopener noreferrer">https://www.virtualbox.org/wiki/Downloads</a></p>
<br>
<p>なお、VirtualBox 7.0.14 をインストールするためには以下の URL からダウンロードできる vc_redist.x64.exe を実行して、最新の再頒布可能パッケージをインストールする必要があります。</p>
<br>
<p>vc_redist.x64.exe:</p>
<p><a href="https://aka.ms/vs/17/release/vc_redist.x64.exe" target="_blank" rel="nofollow noopener noreferrer">https://aka.ms/vs/17/release/vc_redist.x64.exe</a></p>
<br>
<p>Hyper-V や VirtualBox などの仮想マシンプラットフォームの準備が完了したら、Windows 10 の仮想マシンを作成します。</p>
<p>一般に、どの仮想化プラットフォームを利用する場合でも、OS を始めにインストールする際には OS インストール用の ISO イメージファイルを利用します。</p>
<p>本書で解析に使用する Windows 仮想マシンをセットアップする際には、以下からダウンロード可能な評価版 OS の ISO を使用します。(ダウンロードにはメールアドレスなどの入力が必要です)</p>
<p>評価版 OS をインストールすると、インストール後から 90 日間、Windows 10 のフル機能を利用できます。</p>
<br>
<p>Windows 10 Enterprise(評価版)：</p>
<p><a href="https://www.microsoft.com/ja-jp/evalcenter/evaluate-windows-10-enterprise" target="_blank" rel="nofollow noopener noreferrer">https://www.microsoft.com/ja-jp/evalcenter/evaluate-windows-10-enterprise</a></p>
<br>
<h2 id="仮想マシンのセットアップ" style="position:relative;"><a href="#%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97" aria-label="仮想マシンのセットアップ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>仮想マシンのセットアップ</h2>
<p>解析対象のプログラムを実行するための仮想マシンのセットアップが完了したら、デバイスドライバをインストールしてカーネルデバッグを行うためのセットアップを行います。</p>
<p>まずは管理者権限で起動したコマンドプロンプトで以下の 3 つのコマンドを実行した後、OS を再起動します。</p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell">bcdedit <span class="token operator">/</span><span class="token function">set</span> testsigning on
bcdedit <span class="token operator">/</span>debug on
bcdedit <span class="token operator">/</span>dbgsettings serial debugport:1 baudrate:115200</code></pre></div>
<p>これらのコマンドを実行することで、対象の仮想マシンでテスト署名されたドライバのインストール <sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> と COM ポートを利用したカーネルデバッグ <sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup> を有効化できます。</p>
<p>Windows Vista 以降のシステムでは、システムにインストールするすべてのドライバに有効な署名が必要です。特に、Windows 10 バージョン 1607 以降のシステムでは、ドライバは Microsoft によって有効な署名が付与されている必要があります。<sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup> <sup id="fnref-4"><a href="#fn-4" class="footnote-ref">4</a></sup></p>
<p>しかし、Windows で <code class="language-text">bcdedit /set testsigning on</code> を実行してテスト署名されたドライバのインストールを有効化した場合には、テスト用の自己署名証明書などによって署名されたドライバのインストールが可能になります。</p>
<p>そのため、本書で使用するカーネルドライバをシステムにインストールして実行するために、テスト署名モードを有効化する必要があります。</p>
<p>システムでテスト署名モードが有効化されると、以下のようにデスクトップの右下に「テストモード」と表示されます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 656px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9ac4f2c13d5437ca339955668c281b3b/748f4/test-signing-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAD0ElEQVQ4y02SfUzUdRzHv9/fA5synWN0M+ThwBsuZbY2V241Q0FAQBFMCmHTaGW4mLaVth4otzQ3J3rj+e7gHro7QJzZCpJOSG9hJlLqrBVWC4I0ezB5vjvOd+/f5h/98dn39/vj9/q93p/3V8gPpyHd0xBtPO2cJk79DKR1FvJ4CEptBFptFDHHo4itj2JJyzzi6iLQq0JQn/0NWtE1aJu+grbxAvSsPgjhJ8AzBeGcgnTwuYXTyB/UcawziHeFkeyPIskXQdqpKCyf3EfqmXnEVIehlhrAqwReJPA8tA0GsJ02Xn7snoRonSSQZwNPK8/aCSx1h5DmvY/EtjDM7nmkGXDPPPTdE1C3D0PfcgVa3pfQsr8gMEBg5yyEbwbCsGwjxDYB2cCx3oM4dg8m2yySHWEkNM0hqZlQWwTL6uegV45C3ca4my8RGCSwD9r6zwk8OQfR8QDqom0rx8Zp5Hv9LBJ887B0ACmeCFK9USxvB5IcIei7bkIrod3mAQIvEHgOWqYBPB2B6AoTytMX5j4jkIwn7SHI5hAWtU7hIfskTC0TSLRPweygacM09J03oBV/Da2QcXMZN8sA9hL4EWFdtGxnq0bjTu7P9i/3+DfEiT8hjv4Bcfh3iIPjUN8eQ8yBUSyoHoZWNkQgyygM/g94lsBTjNbJ/fkmGJkgx12a/cW4dyBrb0MeGYd8bwTK/p+gvPI9ZOW3UHZcZsPc3VbaFTBuTj+vTOABsIsNd7AML0tw3YWw/0M7A3YL8oNRyHd/gXxjGHLfd1D2XIPywhDUisvQSmm3lXYFvC65LCSrF9rTPQaQsHbaeWjXypjNd3j/bjHqGOShXyFqbkIe+AHKvhtQqq5CqbwCtZx221lGEe3y+2kYgL7hLIHdxrUhyEsrF2PaCWsk7MQYgSOQ79PuHdrtZ9S916G8zLjPM2457Z4JQi/i7vLPQc/phbq+B8q6Twn0EeTm4ltvQ7Rw+XU0O0bYkZ8hD/4I+RZhr12HrP4GykuDUHZdhFoWhFLSD6UgACWPsOzPEJvTg9hsw/Akd+hnKR7GdtC0ic1a+YOj4xCHRhjZ2CFjv8rYVQRXDkGyFFPlINJ3D8K88xLM5QNIrxiA5bkghHr4PE36oNQEIGv6ob7Zi5jXu6Hv7Ya252NoL56BqOiELPVD2eaHWuyHvsmJhBIXVu3wwlLiRHqxE+Z8G1JyWyDiV67BwtQMLEp5BMqafCx9Yi0yHl+NtXlb8Oi6jXgssxBicRJE7MNYkP4UEjPLYErOgLbEjPjk1YhbtgqWjCex2LQCC+OW4z8vHLJ2Mm1Q5QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/9ac4f2c13d5437ca339955668c281b3b/8ac56/test-signing-001.webp 240w,
/static/9ac4f2c13d5437ca339955668c281b3b/d3be9/test-signing-001.webp 480w,
/static/9ac4f2c13d5437ca339955668c281b3b/31099/test-signing-001.webp 656w"
              sizes="(max-width: 656px) 100vw, 656px"
              type="image/webp"
            />
          <source
            srcset="/static/9ac4f2c13d5437ca339955668c281b3b/8ff5a/test-signing-001.png 240w,
/static/9ac4f2c13d5437ca339955668c281b3b/e85cb/test-signing-001.png 480w,
/static/9ac4f2c13d5437ca339955668c281b3b/748f4/test-signing-001.png 656w"
            sizes="(max-width: 656px) 100vw, 656px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/9ac4f2c13d5437ca339955668c281b3b/748f4/test-signing-001.png"
            alt="テスト署名モードの有効化後"
            title="テスト署名モードの有効化後"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>なお、テスト署名モードが有効化されている場合は Microsoft による署名が付与されていないドライバをシステムにインストールできるようになるため、不正なドライバがインストールされるリスクがあります。</p>
<p>そのため、テスト署名モードは必ず仮想マシンでのみ有効化するようにしてください。</p>
<h2 id="windbg-のインストール" style="position:relative;"><a href="#windbg-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" aria-label="windbg のインストール permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WinDbg のインストール</h2>
<p>プログラムの解析のため、コンピュータに最新の WinDbg をインストールします。</p>
<p>なお、カーネルデバッグを行うため、WinDbg は必ず仮想マシンを管理するホスト端末にインストールしてください。</p>
<p>もちろん、ユーザモードデバッグ用に仮想マシン側にもインストールすることは問題ありません。</p>
<p>最新の WinDbg は、WinGet パッケージマネージャを利用できる環境であれば、コマンドプロンプトや PowerShell で以下のコマンドを実行することで簡単にインストールできます。</p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell">winget install Microsoft<span class="token punctuation">.</span>WinDbg</code></pre></div>
<p>WinGet パッケージマネージャを利用できない場合は、以下の URL から WinDbg のインストーラファイルをダウンロードし、WinDbg のインストールを行います。</p>
<br>
<p>Install the Windows debugger：</p>
<p><a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/</a></p>
<br>
<h2 id="debugging-tools-for-windows-のインストール" style="position:relative;"><a href="#debugging-tools-for-windows-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" aria-label="debugging tools for windows のインストール permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Debugging Tools for Windows のインストール</h2>
<p>続けて解析を行うマシンに Debugging Tools for Windows をインストールします。</p>
<p>Debugging Tools for Windows には、WinDbg Classic <sup id="fnref-5"><a href="#fn-5" class="footnote-ref">5</a></sup> などのデバッガや、GFlags <sup id="fnref-6"><a href="#fn-6" class="footnote-ref">6</a></sup> のような Windows 環境のトラブルシューティングに役立つツールが含まれています。</p>
<p>Debugging Tools for Windows をインストールする方法はいくつかありますが、本書では Windows SDK (10.0.22621) を使用して Debugging Tools for Windows のインストールを行います。</p>
<p>まずは、以下の URL で Windows SDK のダウンロードページにアクセスし、[Download the installer] から winsdksetup.exe をダウンロードします。</p>
<br>
<p>Windows SDK：</p>
<p><a href="https://developer.microsoft.com/ja-jp/windows/downloads/windows-sdk/" target="_blank" rel="nofollow noopener noreferrer">https://developer.microsoft.com/ja-jp/windows/downloads/windows-sdk/</a></p>
<br>
<p>続いて、ダウンロードした winsdksetup.exe をダブルクリックして実行します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4243068539b87bc45f865df668fc4dde/0b533/winsdksetup-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 73.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABsUlEQVQ4y51U2W7CMBDk/78NwQMVEk8IEo6Q20lIyDXdWce0pQi1WFpsb5z1HBtm+8MBaZIiiRNEYSxzKvsEYRgijmOEUYgsy9C27dO43W6o6xp93+s7My6yNEUUxTDGaJFxHPHOKMsSs67rcLlcNFj0fD5jGIZ/FXIAiqKwCBmdRNt2SuN6vaKqGJXSqa+15GrN6762a+Z4uQNwL2hMjuPxKChDTRoJnSVPGsW0Lwqjs80ZeV78QKoFWZ2Qfd9DEAQweS46JmJEjlS07Xt5PtEiMzvbNQel2mw2aggZKULS5IY305jvwRwpUgJHWyVhlJVcmuEonZILEC1IhNxst1ttD0vVKG3OueRYwOSWLhmwENfsDl5SVaWCUpdZkBu6GwRnvZkch95K4UR30jwOx5DvaEEmeLBpGuviRMtJ4AwpixLuLIu77uAZ6kikd4S99CINIGUGJSDd4QHROMmjiJ6MyeVRDtzgeR58z8d+t1OXaYTrL0e1aWqcTid9Bnw5/qsPX30Bj/FqqMt4cxAVC7g2oob8H5jxh7pRw78Gz/PLWiwWWK0+sF6vMZ/PsVwu8QktAI2JUKzRxQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/4243068539b87bc45f865df668fc4dde/8ac56/winsdksetup-001.webp 240w,
/static/4243068539b87bc45f865df668fc4dde/d3be9/winsdksetup-001.webp 480w,
/static/4243068539b87bc45f865df668fc4dde/b0a15/winsdksetup-001.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/4243068539b87bc45f865df668fc4dde/8ff5a/winsdksetup-001.png 240w,
/static/4243068539b87bc45f865df668fc4dde/e85cb/winsdksetup-001.png 480w,
/static/4243068539b87bc45f865df668fc4dde/0b533/winsdksetup-001.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/4243068539b87bc45f865df668fc4dde/0b533/winsdksetup-001.png"
            alt="Debugging Tools for Windows のインストール"
            title="Debugging Tools for Windows のインストール"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>デフォルト設定のままインストーラの指示に従っていくと、最後にインストールするパッケージの選択画面が表示されます。</p>
<p>ここではどの項目をダウンロードしても問題ありませんが、必ず [Debugging Tools for Windows] にチェックが入っていることを確認してください。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/18062a9c40ea76c2449d9f48fc9ad448/0b533/winsdksetup-002.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 73.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABwElEQVQ4y41T13LDMAzz//9e+5TUo/Xe2/FGCTlO7euK7hDKCgWSIKUFSYauH9HeesEg+wG3YfvmnrYfJ0zLimGcMUxn8D9iENBfW5cFeZYhy3Nl0yRBWZZomgZlkaMqK8RRjKqqoNa64q+lTdME0zDwbr3DEui6IdaCLmemZSIvCviej7pufiVZJcgOjQd9f4PruvB9H2EYwiNBU58uxXECQ4IEweaT55n4eUiS9ESsCLuukwwt2LYNz/Vgf3ygkMx2p0VkSUQK13WQpqnypyS0XdviJrbv+61k/gzDAE+yY4ZBEKjI3GdZri6SNE1iCebCcRw4d8s7dV2jvZM/CMdxRBRFCls5Bajtrsuz61EyM2RmRVGq1JcDyU54FP43nEu+l0liYm/Srs1/RCfCR8nxVnYqnWMTeP5Tlj/vtxk9ZPjVlJBZsiky7M9mp3AsmZnFcfwAx4YNYnP+a8S3plAnakYdPW+znDeejeNGyAA8o+UzLKWBk7xlLn7vc6sI53lGKwNKdF2rhpVB+NymebsURSEcGfzr9apeTMb3L6C/49i4XC9qFrVn5uzoQ51NwxStQ7y8vkiAi5JGf9NVZZ/hlYjYXXFasgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/18062a9c40ea76c2449d9f48fc9ad448/8ac56/winsdksetup-002.webp 240w,
/static/18062a9c40ea76c2449d9f48fc9ad448/d3be9/winsdksetup-002.webp 480w,
/static/18062a9c40ea76c2449d9f48fc9ad448/b0a15/winsdksetup-002.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/18062a9c40ea76c2449d9f48fc9ad448/8ff5a/winsdksetup-002.png 240w,
/static/18062a9c40ea76c2449d9f48fc9ad448/e85cb/winsdksetup-002.png 480w,
/static/18062a9c40ea76c2449d9f48fc9ad448/0b533/winsdksetup-002.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/18062a9c40ea76c2449d9f48fc9ad448/0b533/winsdksetup-002.png"
            alt="Debugging Tools for Windows のチェック"
            title="Debugging Tools for Windows のチェック"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>[Debugging Tools for Windows] にチェックが入った状態でインストーラを実行します。</p>
<p>インストーラの実行が完了したら、<code class="language-text">C:\Program Files (x86)\Windows Kits\10\Debuggers\x64</code> 内に windbg.exe や gflags.exe が存在することを確認します。</p>
<p>Windows SDK でインストール可能な windbg.exe は、WinDbg Classic とも呼ばれる従来のデバッガです。</p>
<p>最新バージョンの WinDbg と WinDbg Classic のデバッガコマンドやウィンドウなどは同一ですが、最新バージョンの WinDbg では JavaScript によるデバッガスクリプトや Time Travel Debugging(TTD) などの強力なデバッガ機能を利用できます。</p>
<p>本書では、WinDbg Classic ではなく、[WinDbg のインストール] の項でインストールした最新バージョンの WinDbg を使用します。</p>
<h2 id="sysinternals-ユーティリティのインストール" style="position:relative;"><a href="#sysinternals-%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" aria-label="sysinternals ユーティリティのインストール permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sysinternals ユーティリティのインストール</h2>
<p>※ Sysinternals ユーティリティは本書では使用しないため、インストールは必須ではありません。</p>
<p>次に、Process Monitor <sup id="fnref-7"><a href="#fn-7" class="footnote-ref">7</a></sup> や Process Explorer <sup id="fnref-8"><a href="#fn-8" class="footnote-ref">8</a></sup> などの便利なツールを含む Sysinternals <sup id="fnref-9"><a href="#fn-9" class="footnote-ref">9</a></sup> を取得します。</p>
<p>これらのツールについて、本書では詳しい説明は割愛します。</p>
<p>詳しく知りたい方は公式ドキュメントや「Windows Sysinternals徹底解説」<sup id="fnref-10"><a href="#fn-10" class="footnote-ref">10</a></sup> などが参考になると思います。</p>
<p>これらのツールをまとめてインストールするため、以下の URL にアクセスして [Sysinternals Suite] をクリックします。</p>
<br>
<p>Sysinternals ユーティリティ：</p>
<p><a href="https://learn.microsoft.com/ja-jp/sysinternals/downloads/" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/sysinternals/downloads/</a></p>
<br>
<p>ここからダウンロードした ZIP ファイルを解凍することで、Process Monitor や Process Explorer などのツールを利用できるようになります。</p>
<h2 id="windbg-と-sysinternals-にシンボルサーバを登録する" style="position:relative;"><a href="#windbg-%E3%81%A8-sysinternals-%E3%81%AB%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AB%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B" aria-label="windbg と sysinternals にシンボルサーバを登録する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WinDbg と Sysinternals にシンボルサーバを登録する</h2>
<p>WinDbg や Process Monitor(Procmon) などを使用してトラブルシューティングを行う際に適切なシンボルを取得することは非常に重要です。</p>
<p>シンボル <sup id="fnref-11"><a href="#fn-11" class="footnote-ref">11</a></sup> とは、exe や dll などの実行ファイルには含まれない関数や変数の名称などを含む情報です。</p>
<p>WinDbg などのツールを使用する際には、適切なシンボルを取得し参照することで、よりスムーズな解析を行うことが可能です。</p>
<p>一般にダンプファイルの解析で使用するシンボル情報は Microsoft が公開しているシンボルサーバ <sup id="fnref-12"><a href="#fn-12" class="footnote-ref">12</a></sup> から取得できます。</p>
<p>ただし、一部の公開されていないモジュールのシンボル情報や、サードパーティが独自に開発したソフトウェアのシンボル情報は、Microsoft によって公開されているシンボルサーバからダウンロードすることはできません。</p>
<p>なお、解析対象のプログラムがユーザ自身によって開発されている場合は、プログラムのビルド時に生成できる pdb や dbg ファイルをシンボル情報としてデバッガにロードして利用できます。</p>
<p>この項では、Microsoft が公開しているシンボルサーバからシンボル情報を取得するため、WinDbg と Process Monitor の設定を行います。</p>
<p>本書では使用しませんが、必要に応じて Process Explorer でも同様の設定を実施しておくとよいでしょう。</p>
<p>シンボルサーバの設定を行うため、WinDbg を管理者権限で起動して、[ファイル]>[Settings]>[Debugging Settings] を開きます。</p>
<p>起動したウインドウの [Default Symbol Path] に以下を入力して、[OK] をクリックします。</p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell">srv*https:<span class="token operator">/</span><span class="token operator">/</span>msdl<span class="token punctuation">.</span>microsoft<span class="token punctuation">.</span>com/download/symbols</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 878px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/64f5510165051b2d259d74a7768ff263/94829/windbg-symbol-setting-01.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 78.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACiklEQVQ4y41UTW/TQBANd+5ISBTuRYh/Vz5uVOVCBTeu/BMQlyKRpqjigtQk/khsx3acxN92bOcxbzduC+WApZdde2fezryZyeD0s4mPZy4+fbMx9SLkaYK8KFCWJQpZ/wd5niNNU2RZhsH9N5d4cDzE158mPD9EHCdYrdZYrzfKIE33kH22B9+TJL0GfdbrtfIb3Hs9wuG7EQx7jixJkIgxb6RRGIZYLBaIokhFkMh5HMeKhBn0KAq9bjYxBoOX53j+4Qd+jU3MZzZ8P0DTNGJQwXVd2LYNb+EhCAKEAp7zIpLzEl5Asq7rVOSK8OnpBSa2g0Ci4Uc+VVVjuVwqZ0ZLAsrA1AhGzfNeGuI6QhIacw/RMkQoRlVVYbttUNe12nPV2ulU+Y3gntnsdhDs9hG+GuHZ+wtESaki4wFR11u0bavAdIJlBHfhS3GkqiJHXlTIqF21xbbpsG13ksWe8PB0hDDOFWF3i7CqKHiu2ijNSyHLUQhZoQhLZHmBSuzoI5yIFeGLczx5O8QyKe4Q9inz8YMQs7kjTqmQNGIHtPLTtBJd0wphH+HREI9OhpLyDWFfFLYMhWcbbTYb0VgXifuchdg3M89vinJ0joOTuxGyKL7vwzAMOM4cpmmpFlKwLHk3MZUzwzAxmUykmKEQFzrCg78i7An7cer7sq9uDy1JrRqbhctE42vCf2moJyZWoHMret2ufL8neJ6mtwjD+E8NaeB5HizLhCHpMX1qGkhxODXc8xs1jlar/Z9EqQkfC2Gc6T7supuUORF04riRnHpRQ0s0tGTVU6QzoE+WFbooD4+/48uliZnjy/xqOM5CwXVJFqi9LePZYzbz1Pe5TNh4PMF0auLqaozfNWqcrSUVJjQAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/64f5510165051b2d259d74a7768ff263/8ac56/windbg-symbol-setting-01.webp 240w,
/static/64f5510165051b2d259d74a7768ff263/d3be9/windbg-symbol-setting-01.webp 480w,
/static/64f5510165051b2d259d74a7768ff263/6749f/windbg-symbol-setting-01.webp 878w"
              sizes="(max-width: 878px) 100vw, 878px"
              type="image/webp"
            />
          <source
            srcset="/static/64f5510165051b2d259d74a7768ff263/8ff5a/windbg-symbol-setting-01.png 240w,
/static/64f5510165051b2d259d74a7768ff263/e85cb/windbg-symbol-setting-01.png 480w,
/static/64f5510165051b2d259d74a7768ff263/94829/windbg-symbol-setting-01.png 878w"
            sizes="(max-width: 878px) 100vw, 878px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/64f5510165051b2d259d74a7768ff263/94829/windbg-symbol-setting-01.png"
            alt="Default Symbol Path ウインドウの設定"
            title="Default Symbol Path ウインドウの設定"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>次に、[Sysinternals ユーティリティのインストール] で取得した SysinternalsSuite から Procmon64.exe を管理者権限で実行します。</p>
<p>起動した Procmon のウインドウ上部のメニューから [Options]>[Configure Symbols…] をクリックします。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e9eeba7b98afd8eed8b01bc6b167546c/0b533/procmon-symbol-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB40lEQVQoz5VT226bQBDl/6VIVfPQh771H6JWauRGSdTkoQ8pvgEmLra57bLscgkYDPh0IHHrtFWbjnQ4EuyemTMzaGaQQsYRokggTRJEQkAIBcNLYbsSSkq0XYd/xn4/kCa4QMwyiDjGauMhZwFmboiTTwne3UQIfQ8PRYGyLH+g2m7hshgOSxDyEG3bkN6euIVmLxywVQFntYJpLVGul9AJPPCwWTvYuD4YJwciBicXjKCUwujmDme3Or7MbilJgS0l6ciJVlUVtlU5HOozt5SpooqSyMdiqiPyVshiqqJM0BTqCdQKwbGlavuo6xp5nj9a/lM76qbFxVziw12ISzPBpZXifJbiI+F8nuL9WOFbIIez3VF/e9ta/zhGH0XV4O1nhVcjjtMRw5trhdOrHK+vMuIMJxcZJmvVS6Db49ld7aB8/LKj5uYyhO9YcJcmioSj7a0+yCfEyBKJx9M/7/1m+fChnxbnHKZhwTAXcL0AsUwgpCJWA0upcFzMXwV3TYO1F+L+fgnHcWDbNhjjtKvRkIgxRoLy5YL1roHtbDCZTKDrOibjMfSvOizLgkd7GQbhsBUvFuwnx8IAxtyAYRiYE0+nU/i+j5h+gL7K/xI8bH23754NrKFW7Ha7AYd1+VXwO/1tk6Gq5q4FAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/e9eeba7b98afd8eed8b01bc6b167546c/8ac56/procmon-symbol-001.webp 240w,
/static/e9eeba7b98afd8eed8b01bc6b167546c/d3be9/procmon-symbol-001.webp 480w,
/static/e9eeba7b98afd8eed8b01bc6b167546c/b0a15/procmon-symbol-001.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/e9eeba7b98afd8eed8b01bc6b167546c/8ff5a/procmon-symbol-001.png 240w,
/static/e9eeba7b98afd8eed8b01bc6b167546c/e85cb/procmon-symbol-001.png 480w,
/static/e9eeba7b98afd8eed8b01bc6b167546c/0b533/procmon-symbol-001.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/e9eeba7b98afd8eed8b01bc6b167546c/0b533/procmon-symbol-001.png"
            alt="Configure Symbols の設定"
            title="Configure Symbols の設定"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>既定では、[DbgHelp.dll path(version 6.0 or later)] に <code class="language-text">C:\WINDOWS\SYSTEM32\dbghelp.dll</code> が登録されています。</p>
<p>しかし、<code class="language-text">C:\WINDOWS\SYSTEM32\dbghelp.dll</code> は通常はバージョン 6.0 以上の要件を満たさないので、要件を満たす dbghelp.dll のパスを指定する必要があります。</p>
<p>この要件を満たす dbghelp.dll は、[Debugging Tools for Windows のインストール] でインストールした WinDbg x64 などと同じく <code class="language-text">C:\Program Files (x86)\Windows Kits\10\Debuggers\x64</code> の直下に配置されています。</p>
<p>そのため、[DbgHelp.dll path(version 6.0 or later)] には以下のパスを指定します。</p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell">C:\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\Windows Kits\10\Debuggers\x64\dbghelp<span class="token punctuation">.</span>dll</code></pre></div>
<p>また、[Symbol paths:] には WinDbg の時と同じく Microsoft のシンボルサーバのアドレスを指定します。</p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell">srv*https:<span class="token operator">/</span><span class="token operator">/</span>msdl<span class="token punctuation">.</span>microsoft<span class="token punctuation">.</span>com/download/symbols</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/6c17ed61bf717d4b603ba711b9911bc9/0b533/procmon-symbol-002.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 81.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACnUlEQVQ4y3VU2XLaQBDk/78pD3lIpVKxMWAQkpDQfcs60I0EdGYWbJzgbFXX7K52e6fn0EwLCzRtjbquMfQdqrZFT+i6HnXboe1anC8Q43LGl+N8PuN0Ogk7C4MI5duA8nCA7fhoogBOnsK1DVSBi7c0R5H5KIsc3bGElNRQwwg7N4LspLA8m8gmXOhRJp0pqoHYaWCYFtTdHr3vQKZD86dfqOw9HMeDbUjI6ZF+yPHdLvBsufi5lPHtaYOVNkdHipqmJdILZv0wkKsTsixHFIZIyIZegCwvyKMjWjpc1y3GcUTfD7iMdH6acOx7NNWBwnBBkiQoy1LIn03TSUyapkEcRYgIcZyIdUUXquoa3wOFRNiqEvPDoaJvV+R5Lr4Jwn6cxIQPbSUJm/UG69UrFosFVssVXmm+XCyxfFngZT6HvJVhGAZ0TYdpmvD9gByIxX1BOE5XQn7J2O8JhrB84X3uui5cx6F4XsFrx3YoYW9CCUt+JKQNVVEgrSXI0lZ4y97w3LZt+J5P3viCyCUUFGOWWRSFeOCDcPiQXEFVd1iTZNMigiAUCKhEPJJl0Z5LpLzmfU5aSXfY2vQAK/yLkD+qpg/F8KA5EXQ3xp7hJWLNMMMMWTsia0ak9UA4Ii5bWKTggZBd1nYathsJ0oYkbxkyhUEV0nfkvSIrYs7hkOjclsKhqqoIxQMhb3DWOBF7fQ+P4vIet7v14P2DgMLBpXaP4a0OecNzPVECTMD1xhmsm/pmG2F76m3uebZd19F/oBFJuXv4iZALVFym7FUfBXwFFzn3uxdn1L+UsCRHmqaijCzLeiTkDZYQUvsFQSDsZ3Bben6I35KJHy8KnmULuq5Bonjqun4nPN4I+U/R3GT9D+0Xknvqae53vs/jD/VFshBwppCnAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/6c17ed61bf717d4b603ba711b9911bc9/8ac56/procmon-symbol-002.webp 240w,
/static/6c17ed61bf717d4b603ba711b9911bc9/d3be9/procmon-symbol-002.webp 480w,
/static/6c17ed61bf717d4b603ba711b9911bc9/b0a15/procmon-symbol-002.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/6c17ed61bf717d4b603ba711b9911bc9/8ff5a/procmon-symbol-002.png 240w,
/static/6c17ed61bf717d4b603ba711b9911bc9/e85cb/procmon-symbol-002.png 480w,
/static/6c17ed61bf717d4b603ba711b9911bc9/0b533/procmon-symbol-002.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/6c17ed61bf717d4b603ba711b9911bc9/0b533/procmon-symbol-002.png"
            alt="Procmon にシンボルサーバを設定"
            title="Procmon にシンボルサーバを設定"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>これでシンボルサーバの設定は完了です。</p>
<h2 id="ghidra-1102-のインストール" style="position:relative;"><a href="#ghidra-1102-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" aria-label="ghidra 1102 のインストール permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ghidra 11.0.2 のインストール</h2>
<p>※ Ghidra 11.0.2 は本書では使用しないため、インストールは必須ではありません。</p>
<p>次に、リバースエンジニアリングツールの Ghidra 11.0.2 のセットアップを行います。</p>
<p>Ghidra の詳細や詳しい利用方法については本書では解説しませんが、Ghidra に同梱されている Help や、「リバースエンジニアリングツール Ghidra 実践ガイド」<sup id="fnref-13"><a href="#fn-13" class="footnote-ref">13</a></sup> や「マスタリング Ghidra」<sup id="fnref-14"><a href="#fn-14" class="footnote-ref">14</a></sup> などの書籍が参考になると思います。</p>
<p>Ghidra のセットアップのため、以下の Github の Release ページから Ghidra 11.0.2 のパッケージ (<code class="language-text">ghidra_11.0.2_PUBLIC_20240326.zip</code>) をダウンロードし、解凍しておきます。</p>
<br>
<p>Ghidra Release Page：</p>
<p><a href="https://github.com/NationalSecurityAgency/ghidra/releases" target="_blank" rel="nofollow noopener noreferrer">https://github.com/NationalSecurityAgency/ghidra/releases</a></p>
<br>
<p>続いて、Ghidra を実行するために必要な JDK 17 をインストールするため、以下のダウンロードページから Windows x64 用の MSI Installer をダウンロードします。</p>
<br>
<p>Java Downloads：</p>
<p><a href="https://www.oracle.com/jp/java/technologies/downloads/#jdk17-windows" target="_blank" rel="nofollow noopener noreferrer">https://www.oracle.com/jp/java/technologies/downloads/#jdk17-windows</a></p>
<br>
<p>ダウンロードした JDK 17 の MSI インストーラを実行し、JDK 17 のインストールを完了します。</p>
<p>インストールの完了後、展開した <code class="language-text">ghidra_11.0.2_PUBLIC_20240326.zip</code> 内の ghidraRun.bat をダブルクリックして Ghidra を起動します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f4181953724ed3e06043574694a36498/0b533/ghidra-setup-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABMElEQVQ4y52T646CMBBGef+H25hNjMqlC6VAkZugyx2+7dSA6x9vTU4CneF02g7G76XADCA/HhF4HqJIIggCFEWBvu/Rdd1TmqZBXdfI8xxGLrc4X1olCrHZfMM0TTDGtJQSsix7CSogDEMYRbxH109auNt+Ybfba4QIdGKapi9Bi7uuC+OU2KrkQU1kGIdal9+2rT6GeX4VygaklDAc28YPc1WFEa7Ty7h/ezTuhJz78FSptEUKfMoqXFahc5imaV3xY+EykSTJGvh0SBlfhTRIOI6jZhiGt6B+JQ/dwyrknMP3hbrtAqeyRFWdFdUTzmteWV1gMn4TRqopLcuCYzv6LKhRqbcecWvsVBfi8X9CCsRxfNeoz6At0h9F0DNznJuQZL7v66AQ4m3ou4Np4w8qFebNnCdcUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/f4181953724ed3e06043574694a36498/8ac56/ghidra-setup-001.webp 240w,
/static/f4181953724ed3e06043574694a36498/d3be9/ghidra-setup-001.webp 480w,
/static/f4181953724ed3e06043574694a36498/b0a15/ghidra-setup-001.webp 500w"
              sizes="(max-width: 500px) 100vw, 500px"
              type="image/webp"
            />
          <source
            srcset="/static/f4181953724ed3e06043574694a36498/8ff5a/ghidra-setup-001.png 240w,
/static/f4181953724ed3e06043574694a36498/e85cb/ghidra-setup-001.png 480w,
/static/f4181953724ed3e06043574694a36498/0b533/ghidra-setup-001.png 500w"
            sizes="(max-width: 500px) 100vw, 500px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/f4181953724ed3e06043574694a36498/0b533/ghidra-setup-001.png"
            alt="Ghidra のセットアップ"
            title="Ghidra のセットアップ"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Ghidra の起動が完了したら、[File]>[New Project] から任意の名称の Project を作成しておきましょう。</p>
<h2 id="binary-ninja-のインストール" style="position:relative;"><a href="#binary-ninja-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" aria-label="binary ninja のインストール permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Binary Ninja のインストール</h2>
<p>Windows 用のプログラムを解析するツールには、Ghidra 以外にも IDA や Binary Ninja などの有力な選択肢があります。</p>
<p>Binary Ninja は以下の URL の [Download For Windows] から無料版のインストーラをダウンロードしてインストールすることができます。</p>
<br>
<p>Binary Ninja 4.0 Free：</p>
<p><a href="https://binary.ninja/free/" target="_blank" rel="nofollow noopener noreferrer">https://binary.ninja/free/</a></p>
<br>
<p>Binary Ninja のインストール方法や基本的な操作については以下のリンク先の公式ページを参照してください。</p>
<br>
<p>Binary Ninja 4.0 Getting Started：</p>
<p><a href="https://docs.binary.ninja/getting-started.html" target="_blank" rel="nofollow noopener noreferrer">https://docs.binary.ninja/getting-started.html</a></p>
<br>
<p>ちなみに、Binary Ninja の使用方法を詳しく知りたい場合、私は Binary Ninja の提供元である VECTOR 35 の公式 YouTube チャンネルを参照することをおすすめしています。</p>
<br>
<p>Youtube VECTOR 35：</p>
<p><a href="https://www.youtube.com/@Vector35" target="_blank" rel="nofollow noopener noreferrer">https://www.youtube.com/@Vector35</a></p>
<br>
<h2 id="その他解析ツールのインストール" style="position:relative;"><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E8%A7%A3%E6%9E%90%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" aria-label="その他解析ツールのインストール permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>その他解析ツールのインストール</h2>
<p>本書ではここまで紹介したもの以外に、Windows プログラムの解析に利用できる PEStudio を使用します。</p>
<p>また、本書では使用しませんが、PEStudio と類似の用途で利用できるツールとして PE-bear や Explorer Suite に含まれる CFF Explorer も便利です。</p>
<p>詳しいセットアップ方法は割愛しますが、各ツールは以下のリンク先からダウンロードできます。</p>
<br>
<p>PEStudio：</p>
<p><a href="https://www.winitor.com/download" target="_blank" rel="nofollow noopener noreferrer">https://www.winitor.com/download</a></p>
<br>
<br>
<p>PE-bear：</p>
<p><a href="https://github.com/hasherezade/pe-bear" target="_blank" rel="nofollow noopener noreferrer">https://github.com/hasherezade/pe-bear</a></p>
<br>
<br>
<p>Explorer Suite：</p>
<p><a href="https://ntcore.com/explorer-suite/" target="_blank" rel="nofollow noopener noreferrer">https://ntcore.com/explorer-suite/</a></p>
<br>
<h2 id="windbg-によるカーネルデバッグの準備" style="position:relative;"><a href="#windbg-%E3%81%AB%E3%82%88%E3%82%8B%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%AE%E6%BA%96%E5%82%99" aria-label="windbg によるカーネルデバッグの準備 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WinDbg によるカーネルデバッグの準備</h2>
<p>[仮想マシンのセットアップ] で設定した仮想マシンに、ホストマシンにインストールされた WinDbg から COM ポートを利用したカーネルデバッグが可能となることを確認します。</p>
<p>Hyper-V を使用している場合は、対象の仮想マシンの設定画面を開き、[COM 1] のハードウェア設定から、アタッチメントを [名前付きパイプ] に変更してパイプ名を [com1] に設定します。</p>
<p>以下の画面の通り、[名前付きパイプのパス] に表示される値が <code class="language-text">\\\\.\\pipe\\com1</code> となっていれば OK です。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 702px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/8a46403f1264813cb589ae6d08bac88f/d6331/hyper-v-com-port-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 42.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABW0lEQVQoz4WSCYvCMBCF8///lKAIHqB4dT1737Zqa7d4oG/zZlHERTbwmGmSfnNFuZ6L47HC6XRCXddit9stFosF5l9zWJaFzWaD1WoFx3Fgmqb4tOv1WizPl8sloiiCshwLaZridrvhfr+Di+DhcIhms4nJZILpdIput4vBYIDxeIxGo4F+vy/+bGag3W6j1WpJIsq0XR3ZFvr1ehXg4XCQ6L1eD57noaoq2dvtdtjv909xj3r4tCpOUgSBjzhOdOlHnM9nuK6LNEmkNIrBGL0oCtE76PVbBWEM3/cli9+CIcBEA9mb0WgkvcvzXDLkGf1XcZ8B6SvPD+Vn0tlHLgJ4Icsy2LatKwikdAZOdEUEvOsBVoRFYSiARw8JJIyT7nQ6MAxDgK+lfZJyAw3U/ePFy+UiWTIrTp5BmBXtf6AncGJnSPIS9XeFUg+FveTbIqQsS1FR/B3AJ/0ASEyekBL68cYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/8a46403f1264813cb589ae6d08bac88f/8ac56/hyper-v-com-port-001.webp 240w,
/static/8a46403f1264813cb589ae6d08bac88f/d3be9/hyper-v-com-port-001.webp 480w,
/static/8a46403f1264813cb589ae6d08bac88f/de2ca/hyper-v-com-port-001.webp 702w"
              sizes="(max-width: 702px) 100vw, 702px"
              type="image/webp"
            />
          <source
            srcset="/static/8a46403f1264813cb589ae6d08bac88f/8ff5a/hyper-v-com-port-001.png 240w,
/static/8a46403f1264813cb589ae6d08bac88f/e85cb/hyper-v-com-port-001.png 480w,
/static/8a46403f1264813cb589ae6d08bac88f/d6331/hyper-v-com-port-001.png 702w"
            sizes="(max-width: 702px) 100vw, 702px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/8a46403f1264813cb589ae6d08bac88f/d6331/hyper-v-com-port-001.png"
            alt="Hyper-V マシンの COM ポートを構成する"
            title="Hyper-V マシンの COM ポートを構成する"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>VirtualBox を使用している場合は、同じく作成した仮想マシンの設定画面から [シリアルポート] の設定画面を開き、[ポート 1] のタブから [シリアルポートを有効化] のチェックボックスを有効にします。</p>
<p>[ポート番号] を [COM1]、[ポートモード] を [ホストにパイプ] とし、[パス/アドレス] に <code class="language-text">\\\\.\\pipe\\com1</code> を入力して設定を保存します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 723px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7270374eade660e856cdb508d50fbd15/c67d4/v-box-com-port-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 67.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABg0lEQVQ4y61T2U7DMBD0//8bD4hCUZUqodRtkiZxbjvn4N2S1g8FUcDSyNJmM57ZQ6SpQpIkqOsa0zRhnme+x3H8EYZhgNYaxhh0XQdxjFP7YUDf9yirCkEQQErJpJRM8eV2QTEXRN62LYSMM0yWkE5lCUnt6XRCHEV8K6WQZRk7oB8WNE3DMRdFUUAcLKHRLVut64YJIktGSne7d06kh8jWAiIje3ToPwIdiotYlejtx8kGKYlqEYYh9nuJ1eoZ2+2WFRrTXZU5hO5hy0mWY+oNvcXEVB8iJVWbzQa+7yPPc4THIyqr1lXlNodqTm7E45uCH1fYlzOKpsM4nJtDSuIotiXIWc3Sya9AOSRCPEnb2bRDkM/IaoO/HLYc2Tk8WwZbXuzci0tTZJIjV5ll12itLbdGvyIcx+nSCP0fhG4Nbo3C3TXsuv7cRauQXri1Ztd166Ftvqo1ytZ8DnrL7oisLEsIGtoFtCXfobDzKKMUD68BXvwDvK0Pz/N499frNS/EB9NhQZYHbjs9AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/7270374eade660e856cdb508d50fbd15/8ac56/v-box-com-port-001.webp 240w,
/static/7270374eade660e856cdb508d50fbd15/d3be9/v-box-com-port-001.webp 480w,
/static/7270374eade660e856cdb508d50fbd15/6c8c7/v-box-com-port-001.webp 723w"
              sizes="(max-width: 723px) 100vw, 723px"
              type="image/webp"
            />
          <source
            srcset="/static/7270374eade660e856cdb508d50fbd15/8ff5a/v-box-com-port-001.png 240w,
/static/7270374eade660e856cdb508d50fbd15/e85cb/v-box-com-port-001.png 480w,
/static/7270374eade660e856cdb508d50fbd15/c67d4/v-box-com-port-001.png 723w"
            sizes="(max-width: 723px) 100vw, 723px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/7270374eade660e856cdb508d50fbd15/c67d4/v-box-com-port-001.png"
            alt="VirtualBox マシンの COM ポートを構成する"
            title="VirtualBox マシンの COM ポートを構成する"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Hyper-V や VirtualBox で作成した仮想マシンの COM ポートを設定したら、WinDbg を起動してカーネルデバッガをアタッチします。</p>
<p>新しいバージョンの WinDbg を使用する場合は、[ファイル]>[Start Debugging] から [Attach to Kernel] を選択します。</p>
<p>[Attach to Kernel] の設定画面を開き、[COM] タブの [Baud Rate] を 115200 に設定し、Port を <code class="language-text">\\\\.\\pipe\\com1</code> とします。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 882px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2e0fbe3e61d94ea09b2e17aa2131a5d5/90712/attach-to-kerne-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 77.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACrklEQVQ4y4VUPW/TUBS1YECCBXYW+AHszBQQv4GRhRmQECAEgomPCSQW6MwCv4ClSKhAP2ibljhpEieOv57tfDiO49hJk8O9z0maVAUsHfnJfu/43HPPtfL2m4WXKyY+77hI+zH6/T6Gw6HEYDCY3ZMkQZqmx4LPMHiPcubpLyi3V3H53R7CpgfbEXAcB7Ztw3VduW40Guh0OgiC4L9QLr3Zw8XXOdz6VIZj6CiVK9A0DaVSCaqqIp/Po16vy83tdnvh8PQj/JzXDOXCqxzOv8jh5sd9OK0IltuAK4RUyMp6vR5tDEmpgKDnfIiVd7td6HoNel2Xe33fzwhPP9mE8mAdN5ZVdMMO6oaJalWTKiuVCq2rcrMQLgyjLonY19FohDiOkaSJ9JjB75Szz8jDhxu4+iGPOAxQ0aooFAooFouy7ExVOFPBxo/HYxx3RVEE5dzzLSj313HlPREGAqZlwzRNCS6t1WplJduOXPeJ8ODgQJLOY5Hw3hqWiDAJLVg2wbKI2ERAnoRhKL0REw8j8vQo2QLhqcfk4d2fsuReQ4dFMeGDnufNusqE3JSqSc3yA7SiBFE6Qm84lhiN50o+8WgDyp2MsOOTMvKKFTI4LrVaTXabP+JOPpTlMqYmJFQBBzqVNkjCkxPC68sFaL+3UdZIpeXAMC3ZcYe6GwSZQo88tcmSgDxtNlMJz0uJuC8nJop6h4TXSOFuTsWXTQtfdzysbAv8KIb4XgixqobQdAGMR/jXxZmdU6hirWxgq2RiX7Ohlk0Uq6RUBDDcDjVJ0LzGMm+sZpq9ecgcHipUYQobumnAtgyYNIa+J2TYGewhx+a4+eXmCWom53RGuMTBDppwPZ9eNLIu8wE5rx3y1V6Y2aOYJiIjpNhwDgdxF+3Jhmn+pj8ADvn8D+FvxH8AFth/IXJK19YAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/2e0fbe3e61d94ea09b2e17aa2131a5d5/8ac56/attach-to-kerne-001.webp 240w,
/static/2e0fbe3e61d94ea09b2e17aa2131a5d5/d3be9/attach-to-kerne-001.webp 480w,
/static/2e0fbe3e61d94ea09b2e17aa2131a5d5/9d646/attach-to-kerne-001.webp 882w"
              sizes="(max-width: 882px) 100vw, 882px"
              type="image/webp"
            />
          <source
            srcset="/static/2e0fbe3e61d94ea09b2e17aa2131a5d5/8ff5a/attach-to-kerne-001.png 240w,
/static/2e0fbe3e61d94ea09b2e17aa2131a5d5/e85cb/attach-to-kerne-001.png 480w,
/static/2e0fbe3e61d94ea09b2e17aa2131a5d5/90712/attach-to-kerne-001.png 882w"
            sizes="(max-width: 882px) 100vw, 882px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/2e0fbe3e61d94ea09b2e17aa2131a5d5/90712/attach-to-kerne-001.png"
            alt="WinDbg でカーネルデバッガをアタッチする"
            title="WinDbg でカーネルデバッガをアタッチする"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>なお、[Break on Connection] のチェックを入れておけば WinDbg をカーネルデバッガとしてマシンにアタッチした際に自動で Break が行われ、VM 側のシステムが停止します。</p>
<p>WinDbg がカーネルデバッガとしてシステムにアタッチされた場合には、以下の画面のように OS バージョンなどが表示され、WinDbg のコマンドウィンドウにコマンドを入力できるようになります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 782px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/445895c8b26fd4e0d0b6b5cbca207451/2e195/windbg-kernel-attach-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 76.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB10lEQVQ4y4VUibKCMAzs//+hB1JulPsQQdC8bmjeQ58zdiYTjrLZ3aSoIs+pKArquo7quqa2balpGrrf7/R4PGgcR76epomezydhbfP7tTrs93Q4HMhxHDoejxRFEYVhSLktBKBhuDJo13ZcUOJ2u5lnLfV9z4Su1ysp3IBRWVXMsCxLqsx1drnw9TAMvHGeZ9ouYba9hyKltUtpmvIHkCeBimDZGzDY4nk+F6yrmjOK9GYP9glbLLXf7eh0OpH2PPJ9n8HP5zPLBVOwzPOMwRurAIDiK2Icp18Fyvc0e+YHwZoNE9d1uUgcx+xtYN4VBkhYQBrifXFTfGYW8Mdg6Jl7BEABhGfIWZZxLsuKJULytrviqXINE1dr0iZC8wEywBMjHR2/2Obk1gKwhMeSLbc/QHiATqMqvEHHCwbIGQABUACiQZA6zwsty2Jn9XU2FR4CzHGOpF1NkWEHZmAKiWCL+exM0eebb2iEePnCcB3eYWUHaYYpMsZltO+kIV8BMUdNA6nr9DOQDYxKksTc/XQzSgjs/XQcFTZh9i6mi5g/iSiK7cytJwggUCAZXUb8A4zjiL2Cb0mS8HhgIyQixBIZZMno8EeGoC4y5C8j51L+ON/W9lz/ABx6gCPPr/YZAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/445895c8b26fd4e0d0b6b5cbca207451/8ac56/windbg-kernel-attach-001.webp 240w,
/static/445895c8b26fd4e0d0b6b5cbca207451/d3be9/windbg-kernel-attach-001.webp 480w,
/static/445895c8b26fd4e0d0b6b5cbca207451/c0b7e/windbg-kernel-attach-001.webp 782w"
              sizes="(max-width: 782px) 100vw, 782px"
              type="image/webp"
            />
          <source
            srcset="/static/445895c8b26fd4e0d0b6b5cbca207451/8ff5a/windbg-kernel-attach-001.png 240w,
/static/445895c8b26fd4e0d0b6b5cbca207451/e85cb/windbg-kernel-attach-001.png 480w,
/static/445895c8b26fd4e0d0b6b5cbca207451/2e195/windbg-kernel-attach-001.png 782w"
            sizes="(max-width: 782px) 100vw, 782px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/445895c8b26fd4e0d0b6b5cbca207451/2e195/windbg-kernel-attach-001.png"
            alt="WinDbg でカーネルデバッガをアタッチした画面"
            title="WinDbg でカーネルデバッガをアタッチした画面"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>カーネルデバッガが仮想マシンのカーネルをデバッグしている場合、仮想マシン側の動作は停止します。</p>
<p>そのため、Hyper-V の拡張セッションや RDP などにより仮想マシンにリモート接続している場合には、画面がブラックアウトしてリモートアクセスが切断されます。</p>
<p>Hyper-V で構築した仮想マシンのカーネルデバッグを行う際には、拡張セッションを無効化した状態でコンソールアクセスしておくことをおすすめします。</p>
<p>システムの操作を再開したい場合には <code class="language-text">g</code> コマンドを実行します。</p>
<h2 id="ネットワーク経由でカーネルデバッグを行う" style="position:relative;"><a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E7%B5%8C%E7%94%B1%E3%81%A7%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%82%92%E8%A1%8C%E3%81%86" aria-label="ネットワーク経由でカーネルデバッグを行う permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ネットワーク経由でカーネルデバッグを行う</h2>
<p>前項では COM ポートを使用するカーネルデバッガ接続をセットアップしましたが、COM ポートによるデータ転送はボーレートに設定可能な最大値である 115200 を設定している場合でも非常に遅いです。</p>
<p>lm や k などの一般的なデバッガコマンドの実行であれば特に遅延を感じることはないと思いますが、例えば .dump コマンド <sup id="fnref-15"><a href="#fn-15" class="footnote-ref">15</a></sup> などの大量のデータ転送が必要なコマンドを使用する場合、COM ポートを使用していると完了まで数時間以上かかる場合があります。</p>
<p>このような場合には、COM ポートではなくネットワーク経由でのカーネルデバッグをセットアップすることをおすすめします。</p>
<p>ネットワーク経由でのカーネルデバッグは手動でもセットアップできますが、kdnet.exe による設定方法を利用する方が確実です。<sup id="fnref-16"><a href="#fn-16" class="footnote-ref">16</a></sup></p>
<p>ネットワーク経由のカーネルデバッグを使用するため、まずはデバッグを行うホストマシンと、ターゲットである仮想マシンが IPv4 を利用するネットワーク通信が可能な環境を用意します。</p>
<p>仮想マシンプラットフォームとして Hyper-V を使用している場合は [仮想スイッチマネージャー] から内部通信用の仮想スイッチを作成して仮想マシンにアタッチし、静的な IPv4 アドレスを固定しておくと良いでしょう。</p>
<p>本書では、ホストマシンに <code class="language-text">192.168.50.1/25</code>、仮想マシンに <code class="language-text">192.168.50.12/25</code> の IP アドレスを割り当てています。</p>
<p>ホストマシンと仮想マシンのネットワーク接続を確立したら、次は仮想マシン側でコマンドプロンプトを管理者として実行し、<code class="language-text">"C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\kdnet.exe"</code> を実行します。</p>
<p>kdnet.exe は [Debugging Tools for Windows のインストール] の項で Debugging Tools for Windows をインストールしたフォルダに配置されています。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 682px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a8db3b45be79d88c5c924ad83d7a2bc5/160a3/kd-setup-001.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 9.166666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAYklEQVQI1y2NOxIAIQhDt7WzWBXxh6P3v2JWWKuEvEx41loQEZRSMMZAjBG1VvOa5ZzRWsPo/WQCZgbf7t7bmPFzK3t0QM2cEyklhBBskIjMq2pHVTlzub3XnhH9mfcezjl8jQo0Ft+8/rQAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/a8db3b45be79d88c5c924ad83d7a2bc5/8ac56/kd-setup-001.webp 240w,
/static/a8db3b45be79d88c5c924ad83d7a2bc5/d3be9/kd-setup-001.webp 480w,
/static/a8db3b45be79d88c5c924ad83d7a2bc5/57e27/kd-setup-001.webp 682w"
              sizes="(max-width: 682px) 100vw, 682px"
              type="image/webp"
            />
          <source
            srcset="/static/a8db3b45be79d88c5c924ad83d7a2bc5/8ff5a/kd-setup-001.png 240w,
/static/a8db3b45be79d88c5c924ad83d7a2bc5/e85cb/kd-setup-001.png 480w,
/static/a8db3b45be79d88c5c924ad83d7a2bc5/160a3/kd-setup-001.png 682w"
            sizes="(max-width: 682px) 100vw, 682px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/a8db3b45be79d88c5c924ad83d7a2bc5/160a3/kd-setup-001.png"
            alt="kdnet.exe によるネットワークアダプタの検証"
            title="kdnet.exe によるネットワークアダプタの検証"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>kdnet.exe をオプション無しで実行した際に <code class="language-text">Network debugging is supported by this Microsoft Hypervisor Virtual Machine</code> と表示されることを確認できたら、続けて <code class="language-text">"C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\kdnet.exe" &lt;HostComputerIPAddress> &lt;YourDebugPort></code> を実行します。</p>
<p>この時、HostComputerIPAddress にはデバッグを行うホストマシンの IP アドレス(<code class="language-text">192.168.50.1</code>) と、ホストマシン側の WinDbg で後程設定するポート番号(既定値 50000) を指定します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 871px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e1124a7258cb1e3c2f66a5f1a59b520e/9d5da/kd-setup-002.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 16.249999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAiElEQVQI11WP2wqEMAxEfS9autJb2tqL+v+fONtkccGHwwwTSCZLiISUEkIIQoxR1DknnohgrRX/zB6891N/Ge8wxmDp40TvHTln1FpxjoHWGsbU67rQaptU3PeN4zhkVkqWI/v+wbZt0FoL7BdK+dWOGyVKcoAbWOv+H5RSJGfPbdZ1hVLqxRefV0zndQnsHAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/e1124a7258cb1e3c2f66a5f1a59b520e/8ac56/kd-setup-002.webp 240w,
/static/e1124a7258cb1e3c2f66a5f1a59b520e/d3be9/kd-setup-002.webp 480w,
/static/e1124a7258cb1e3c2f66a5f1a59b520e/81b74/kd-setup-002.webp 871w"
              sizes="(max-width: 871px) 100vw, 871px"
              type="image/webp"
            />
          <source
            srcset="/static/e1124a7258cb1e3c2f66a5f1a59b520e/8ff5a/kd-setup-002.png 240w,
/static/e1124a7258cb1e3c2f66a5f1a59b520e/e85cb/kd-setup-002.png 480w,
/static/e1124a7258cb1e3c2f66a5f1a59b520e/9d5da/kd-setup-002.png 871w"
            sizes="(max-width: 871px) 100vw, 871px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/e1124a7258cb1e3c2f66a5f1a59b520e/9d5da/kd-setup-002.png"
            alt="kdnet.exe によるカーネルデバッグのセットアップ"
            title="kdnet.exe によるカーネルデバッグのセットアップ"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>このコマンドを実行すると、上記の画像の通り <code class="language-text">key=&lt;KEY 文字列></code> を含む出力が得られるので、<code class="language-text">key=</code> 以降の文字列をコピーしておきます。</p>
<p>続けてデバッグを行うホストマシンで WinDbg を起動し、[Attach to kernel] の [Net] タブの [Port number] と [Key] 欄に、kdnet.exe で設定したポート番号とコピーした <code class="language-text">key=</code> 以降の文字列を入力し、[OK] をクリックします。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 915px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ae401115a071d8cb066b330b02fb554c/4255a/kd-setup-003.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 58.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACD0lEQVQoz42S32vTUBzFrwp788EXn3zRJ//RYX+s4gaDUYfPMnC6MX3agyDSCWJhXbLSn2maJrn52SRtmnS1x29uVrc5Ngwckpsfn/s954StVSpg6+v4cHqKiefB4Byc5DgObNuG67oIguC/xV7u7uL52yoOGw0Mez20Ox00m03I5zJkSUK/34fv+xiPx0Iebep6rriXKVuvlK3Zi2oVz3Z2cCTLCGgi07IwmUwQRZHYMQzDv9Nyk+dni8MXgBy0ep69y55sbWHtdQV7DQncCaHrIxiGAZM+Dgl6BXQwncZY4v6DPd3exsONDexLMkI/QF/po0c2u90uFEWhPC2Ro84dGM5YiHsBLD+C5YV0HWI8TTBJf5MWYI83N8EKBXw8kxC5HlrtFtrtjgAOh5rIJZvQsrKCyB7B43iGNJ0jSVOhdH6B+UUuAr4Be1XAgUQtuxzKQIWqqtA0TUBWlgMqJEkSJLMZFovFP0aXWC5zsUdklxWKOJTqmHomtJFOOeoi7OgywyzwlCa5gRCAy/P1DB+UywL4qVFHaBsYkM3MqkVt2zSZ5/mikGy6K9DyxvV15cBiEfv1n/DNEXRDh6Hrom11oMCxs1JuA+8SYxmwVML7kxq65y1opoPhiGOo53KoRYPftnznb8NKBCyX8O57Dce1Fr78GOFzTcXxLwvf5BBfz0KcyI7IMo5j+hen9+oPzgVkpn5qXQoAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/ae401115a071d8cb066b330b02fb554c/8ac56/kd-setup-003.webp 240w,
/static/ae401115a071d8cb066b330b02fb554c/d3be9/kd-setup-003.webp 480w,
/static/ae401115a071d8cb066b330b02fb554c/632b0/kd-setup-003.webp 915w"
              sizes="(max-width: 915px) 100vw, 915px"
              type="image/webp"
            />
          <source
            srcset="/static/ae401115a071d8cb066b330b02fb554c/8ff5a/kd-setup-003.png 240w,
/static/ae401115a071d8cb066b330b02fb554c/e85cb/kd-setup-003.png 480w,
/static/ae401115a071d8cb066b330b02fb554c/4255a/kd-setup-003.png 915w"
            sizes="(max-width: 915px) 100vw, 915px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/ae401115a071d8cb066b330b02fb554c/4255a/kd-setup-003.png"
            alt="ホストの WinDbg でネットワークカーネルデバッグの待ち受け設定を行う"
            title="ホストの WinDbg でネットワークカーネルデバッグの待ち受け設定を行う"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>WinDbg でネットワーク経由のカーネルデバッグを実行すると、デバッグコンソールに <code class="language-text">Waiting to reconnect...</code> と表示されます。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 805px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/62913c287cc04aa9897df0519d1ea612/c946b/kd-setup-004.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 25.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAw0lEQVQY031P7Q6DIAzk/Z/RzaigTlFBwcTPW9tliz+2NWnuCr22p8I0YaIMIaDrOozjiKZpiPfw3sE5h77vEWOAGwYMlNzL74zbtmHfd8HjOKDWdaXPAXmeo65r2NYiTe9UF6jKEkWhZUFJPMsyaK3Rtq0Mm+dZkJOPWpYFavRetrLIWitojBFk4ePxQh7I/yzii36F4ka+jG1VVUWiDp7ssPUYI3Ev3NNitvSO8zy/prolidgzRiMj23zBv/iIL/U1ntIzgF6TtHPnAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/62913c287cc04aa9897df0519d1ea612/8ac56/kd-setup-004.webp 240w,
/static/62913c287cc04aa9897df0519d1ea612/d3be9/kd-setup-004.webp 480w,
/static/62913c287cc04aa9897df0519d1ea612/82ef0/kd-setup-004.webp 805w"
              sizes="(max-width: 805px) 100vw, 805px"
              type="image/webp"
            />
          <source
            srcset="/static/62913c287cc04aa9897df0519d1ea612/8ff5a/kd-setup-004.png 240w,
/static/62913c287cc04aa9897df0519d1ea612/e85cb/kd-setup-004.png 480w,
/static/62913c287cc04aa9897df0519d1ea612/c946b/kd-setup-004.png 805w"
            sizes="(max-width: 805px) 100vw, 805px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/62913c287cc04aa9897df0519d1ea612/c946b/kd-setup-004.png"
            alt="WinDbg でネットワーク経由のカーネルデバッグ接続を実行する"
            title="WinDbg でネットワーク経由のカーネルデバッグ接続を実行する"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>この状態で、kdnet.exe によるセットアップを行った仮想マシンを再起動すると、ネットワーク経由でホストマシンの WinDbg が仮想マシンのカーネルにアタッチし、ネットワーク経由でのカーネルデバッグが可能になります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 794px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/18a8503c934068cc9b9577fb2b914f85/7de01/kd-setup-005.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB1UlEQVQoz3VSa4/TQAzM//8twIkTSHxGJ/EPuIo2yabNa5tHs02aV5MOY/cqIQ5WGnlfHttje8uywLkGxhhYa1EWhe4PhxhZmiKOExyPR+R5hiAIkGUZCv4ZxxHTNGGc3izP8zzDq6qSDlaR0UkcIxKKo7U50jTRu/0+QlEWuF5nxf+WV5YNyvKMtp1IcELT9Bj6hVGBmRjHVffjeMPtD8fbTXB7B8+YF0b/jkP8giT5gWHY8MEQgWJZxIZYV9n7zM6n3ZFy+HeGvv8Vv7YfqdszNpsPCMPP2G4/qd3vv8D3n7HbPSmMkbcnyvENl0vOrK/ouo5JDKywY7ArPOcGiuyQ23vp1jrq6WDzhuUPqOsOVdXidOrfzhc0bqTzyqwXbYQQiZUGe2ka83PNi4mRekbu0PcXOpYMUOi5KI48V9qMeRKySQmkuw8r+mnJr68/WV7IDufspiW5NKbB+XymPamVsUmSRMcly3KS1/cyz9LMVv9Ilkoo4xDHMZsSU6OImvlEQP32SDiDMpPynjOgOEs2Qrau67uGaJejKKLgOyWQvcyfoK5qFVxIhOAufKtwzinxg+RRrmZoTIiAJRuSWXvUj5J+3/c6/UL00EruRXjBQ7u/8RuBP0TvwSVXxgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/18a8503c934068cc9b9577fb2b914f85/8ac56/kd-setup-005.webp 240w,
/static/18a8503c934068cc9b9577fb2b914f85/d3be9/kd-setup-005.webp 480w,
/static/18a8503c934068cc9b9577fb2b914f85/ae710/kd-setup-005.webp 794w"
              sizes="(max-width: 794px) 100vw, 794px"
              type="image/webp"
            />
          <source
            srcset="/static/18a8503c934068cc9b9577fb2b914f85/8ff5a/kd-setup-005.png 240w,
/static/18a8503c934068cc9b9577fb2b914f85/e85cb/kd-setup-005.png 480w,
/static/18a8503c934068cc9b9577fb2b914f85/7de01/kd-setup-005.png 794w"
            sizes="(max-width: 794px) 100vw, 794px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/18a8503c934068cc9b9577fb2b914f85/7de01/kd-setup-005.png"
            alt="WinDbg でネットワーク経由のカーネルデバッグを開始する"
            title="WinDbg でネットワーク経由のカーネルデバッグを開始する"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>なお、もしネットワーク経由でのカーネルデバッグが上手くいかない場合は、ホストマシンと仮想マシンのネットワーク接続や、ホストマシン側で WinDbg による通信が Microsoft Defender Firewall で許可されているか否かを確認してください。</p>
<h2 id="解析対象プログラムのダウンロード" style="position:relative;"><a href="#%E8%A7%A3%E6%9E%90%E5%AF%BE%E8%B1%A1%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89" aria-label="解析対象プログラムのダウンロード permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解析対象プログラムのダウンロード</h2>
<p>本書の解析対象となる DoP プログラムを以下のリリースページからダウンロードします。</p>
<p>本書では、この DoP プログラムを解析して 2 つの Flag を特定することを目標とします。</p>
<p>Flag のフォーマットは <code class="language-text">^FLAG\{[\x20-\x7E]+\}$</code> です。</p>
<br>
<p>DoP -The dream of a pumpkin-：</p>
<p><a href="https://github.com/kash1064/ctf-and-windows-debug/releases/tag/v1.0" target="_blank" rel="nofollow noopener noreferrer">https://github.com/kash1064/ctf-and-windows-debug/releases/tag/v1.0/</a></p>
<br>
<p>リリースページからは、以下の 2 つのファイルをダウンロードできます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">DoPClient.exe<span class="token punctuation">(</span>SHA256:59D52D6AF3479A75B21784916B8C73396971E75142A1AF0C0900C843E4491710<span class="token punctuation">)</span>

DoPDriver.sys<span class="token punctuation">(</span>SHA256:4C2F4F26A8F19083CE699B83F91C4430D03EB62DDECA509A16E66FCD7FE46D3D<span class="token punctuation">)</span></code></pre></div>
<p>ダウンロードした 2 つのファイルは、デバッグ用に作成した仮想マシン内の同じフォルダにコピーしてください。</p>
<p>なお、ほとんどの CTF の問題では、対象ファイルの解析に使用するシンボルファイル(pdb ファイルなど)は提供されません。</p>
<p>また、CTF ではなくトラブルシューティングの目的でデバッグを行う場合でも、読者がそのソフトウェアの開発に関わっている立場でない限り、適切なシンボルファイルを取得できることは稀でしょう。</p>
<p>そのため、本書でもシンボルファイルの無い未知のファイルのデバッグを行います。</p>
<p>シンボルファイルのない未知のプログラムの解析を WinDbg だけで行うことは非常に困難ですが、IDA や Ghidra、Binary Ninja などの解析ツールと併用することで効率的にデバッグを行うことができます。</p>
<p>ちなみに、これらのツールにはデバッグ機能も付属しているため、必ずしも WinDbg を使用する必要はありません。</p>
<p>しかし、本書で使用するようなスクリプトによるデバッガ操作の自動化などの強力な機能は、機能が制限される無料版の IDA や Binary Ninja では使用できません。</p>
<p>本書ではこれらの高度な機能を含むフル機能を利用可能な WinDbg を利用してユーザモードプログラムとカーネルドライバの解析を行います。</p>
<p>なお、DoP プログラムを実行するため、環境によっては事前に以下の URL からダウンロードできる vc_redist.x64.exe を実行して最新の再頒布可能パッケージをインストールする必要があります。</p>
<br>
<p>vc_redist.x64.exe:</p>
<p><a href="https://aka.ms/vs/17/release/vc_redist.x64.exe" target="_blank" rel="nofollow noopener noreferrer">https://aka.ms/vs/17/release/vc_redist.x64.exe</a></p>
<br>
<h2 id="各章へのリンク" style="position:relative;"><a href="#%E5%90%84%E7%AB%A0%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF" aria-label="各章へのリンク permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>各章へのリンク</h2>
<ul>
<li><a href="/magical-windbg-vol2-00">まえがき</a></li>
<li><a href="/magical-windbg-vol2-01">1 章 環境構築</a></li>
<li><a href="/magical-windbg-vol2-02">2 章 DoPClient と DoPDriver の表層解析</a></li>
<li><a href="/magical-windbg-vol2-03">3 章 DoPClient の静的解析を行う</a></li>
<li><a href="/magical-windbg-vol2-04">4 章 DoPClient を動的解析する</a></li>
<li><a href="/magical-windbg-vol2-05">5 章 DoPDriver の静的解析を行う</a></li>
<li><a href="/magical-windbg-vol2-06">6 章 DoPDriver を動的解析する</a></li>
</ul>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>Enable Loading of Test Signed Drivers <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/install/the-testsigning-boot-configuration-option" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/install/the-testsigning-boot-configuration-option</a></p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
<li id="fn-2">
<p>Setting Up Kernel-Mode Debugging of a Virtual Machine Manually using a Virtual COM Port <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/attaching-to-a-virtual-machine--kernel-mode-" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/attaching-to-a-virtual-machine—kernel-mode-</a></p>
<a href="#fnref-2" class="footnote-backref">↩</a>
</li>
<li id="fn-3">
<p>Signing a Driver <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/develop/signing-a-driver" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/develop/signing-a-driver</a></p>
<a href="#fnref-3" class="footnote-backref">↩</a>
</li>
<li id="fn-4">
<p>Driver Signing Policy <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/install/kernel-mode-code-signing-policy--windows-vista-and-later-" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/install/kernel-mode-code-signing-policy—windows-vista-and-later-</a></p>
<a href="#fnref-4" class="footnote-backref">↩</a>
</li>
<li id="fn-5">
<p>WinDbg とは <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/windbg-overview?source=recommendations" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/windbg-overview?source=recommendations</a></p>
<a href="#fnref-5" class="footnote-backref">↩</a>
</li>
<li id="fn-6">
<p>GFlags <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/gflags" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/gflags</a></p>
<a href="#fnref-6" class="footnote-backref">↩</a>
</li>
<li id="fn-7">
<p>Process Monitor <a href="https://learn.microsoft.com/ja-jp/sysinternals/downloads/procmon" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/sysinternals/downloads/procmon</a></p>
<a href="#fnref-7" class="footnote-backref">↩</a>
</li>
<li id="fn-8">
<p>Process Explorer <a href="https://learn.microsoft.com/ja-jp/sysinternals/downloads/process-explorer" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/sysinternals/downloads/process-explorer</a></p>
<a href="#fnref-8" class="footnote-backref">↩</a>
</li>
<li id="fn-9">
<p>Sysinternals <a href="https://learn.microsoft.com/ja-jp/sysinternals" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/sysinternals</a></p>
<a href="#fnref-9" class="footnote-backref">↩</a>
</li>
<li id="fn-10">
<p>Windows Sysinternals徹底解説 : 無償ツールで極めるトラブルシューティングテクニック (Mark E. Russinovich・Aaron Margosis 著 / 山内 和朗 訳 / 日経BP社 / 2017 年)</p>
<a href="#fnref-10" class="footnote-backref">↩</a>
</li>
<li id="fn-11">
<p>Symbols and Symbol Files <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/symbols-and-symbol-files" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/symbols-and-symbol-files</a></p>
<a href="#fnref-11" class="footnote-backref">↩</a>
</li>
<li id="fn-12">
<p>Using a Symbol Server <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/using-a-symbol-server" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/using-a-symbol-server</a></p>
<a href="#fnref-12" class="footnote-backref">↩</a>
</li>
<li id="fn-13">
<p>リバースエンジニアリングツール Ghidra 実践ガイド セキュリティコンテスト入門からマルウェア解析まで (中島 将太, 小竹 泰一, 原 弘明, 川畑 公平 著 / マイナビ出版 / 2020 年)</p>
<a href="#fnref-13" class="footnote-backref">↩</a>
</li>
<li id="fn-14">
<p>マスタリング Ghidra 基礎から学ぶリバースエンジニアリング完全マニュアル (Chris Eagle, Kara Nance 著 / 石川 朝久 監訳 / 中島 将太, 小竹 泰一, 原 弘明 訳 / オライリー・ジャパン / 2022 年)</p>
<a href="#fnref-14" class="footnote-backref">↩</a>
</li>
<li id="fn-15">
<p>.dump (ダンプ ファイルの作成) <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debuggercmds/-dump--create-dump-file-" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debuggercmds/-dump—create-dump-file-</a></p>
<a href="#fnref-15" class="footnote-backref">↩</a>
</li>
<li id="fn-16">
<p>KDNET ネットワーク カーネル デバッグを自動的に設定する <a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/setting-up-a-network-debugging-connection-automatically" target="_blank" rel="nofollow noopener noreferrer">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/setting-up-a-network-debugging-connection-automatically</a></p>
<a href="#fnref-16" class="footnote-backref">↩</a>
</li>
</ol>
</div></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->May 26, 2024</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/magical-win-dbg/">Magical WinDbg</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/windows/">Windows</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/win-dbg/">WinDbg</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたいCTF Player(Team: 0nePadding)。WinDbgとYARAが好き。OSCP / CISSP / AtCoder 緑 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/kash1064" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/magical-windbg-vol2-01";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-4426ef62af9f9b25b2f3.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-76f2006942127b3c7274.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-70ba56c0f46525baa629.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-d19905e5c8fc953958f1.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-6ba68ef37e264f701345.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-0faa242d92f89b71e668.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-4426ef62af9f9b25b2f3.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-8695bc0012d92a323104.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-a3c0f166cb4b802ff58f.js" async=""></script></body></html>