{"componentChunkName":"component---src-templates-post-template-js","path":"/azure-bastion-tutorial","result":{"data":{"markdownRemark":{"id":"1d460d4d-366e-5764-9b86-7ac6c3238c9c","html":"<p>AZ-500 の勉強をしていたところ、Azure Bastion を使うと Azure VM にパブリック IP を割り当てなくても RDP や SSH によるリモートアクセスをできるようになるということを知りました。</p>\n<p>また、Azure Bastion を使うとホストを VM に接続しなくても Azure ポータル上から操作ができるようになるとのことで、これはさっそく構築するしかないと思い実践してみました。</p>\n<p>今回は、Azure Bastion でリモートアクセスできる環境を構築した際のメモをまとめます。</p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li><a href=\"#azure-bastion-%E3%81%A8%E3%81%AF\">Azure Bastion とは</a></li>\n<li><a href=\"#virtual-network-%E3%81%A8%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\">Virtual network とサブネットを作成する</a></li>\n<li><a href=\"#virtual-machine-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\">Virtual machine を作成する</a></li>\n<li><a href=\"#virtual-network-%E3%81%AB-bastion-%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B%E3%81%8B%E3%82%93%E3%81%9F%E3%82%93%E8%A8%AD%E5%AE%9A\">Virtual network に Bastion をデプロイする(かんたん設定)</a></li>\n<li><a href=\"#virtual-network-%E3%81%AB-bastion-%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0\">Virtual network に Bastion をデプロイする(カスタム)</a></li>\n<li><a href=\"#%E3%83%8D%E3%82%A4%E3%83%86%E3%82%A3%E3%83%96%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%A7%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AB%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E6%8E%A5%E7%B6%9A%E3%82%92%E8%A1%8C%E3%81%86\">ネイティブクライアントで仮想マシンにリモート接続を行う</a></li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n</ul>\n<h2 id=\"azure-bastion-とは\" style=\"position:relative;\"><a href=\"#azure-bastion-%E3%81%A8%E3%81%AF\" aria-label=\"azure bastion とは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Azure Bastion とは</h2>\n<p>Azure Bastion は、Virtual network にデプロイされ、Azure VM に対する RDP、SSH 接続を可能にするフルマネージドなサービスです。</p>\n<p>Azure Bastion を使うと、Azure VM にパブリック IP を割り当てることなく、Azure Bastion 経由でセキュアにリモートアクセスを行うことができます。</p>\n<p>また、ホストマシンから RDP や SSH 接続を行うことなく、Azure portal 上から仮想マシンをリモートコントロールできるのも非常に嬉しいポイントです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 905px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/028f4a1a7c4ef63d480eccf7aba7948b/65d79/azure-bastion_prop-001resMode%3Dsharp2%26op_usm%3D1.5%2C0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuklEQVQoz3VT227VMBDM//8CqE8g9SN4r6oiAVJbIcFDb5yGoyTOxY7vGWbtc9pTBCutvNqsZ2fWm2bbNoiLHc8YEwI9HjznjEQPgXGq38Sl3ofXWjmbI+B2Aigf8jFPn03EvEbmN3Q6w4ZcaqSJABqfsVjJZTQ42CnTeOh+tFkHXN0b3Ow93l902C+JFwhGAAa4vLc4/zqW2ub8acbOxjeSpbsUyoV2cPitPIxLcGTWL6EwjSlXyayxPrGpQ0obmi/9iMG5ApQL4PYynwqeMepIaRma0s6uVJHtQsCDUgQLL0qiAAKWGB6ntnE28nEhKzkFdGUcyOrHsyFInaGhMkN2wxzxPPgK+PFO4XZa4b2G0jNsirjtV6w+4lFFPHUOO7owXOnvLhXaORYlI2f7rbX49H3Bh8+qqGqu9yN+ti3W1RDEcyYB/er5aqEATTpWhj6Vsx9tAY+MZxPgmNdk3ypbZ8jJlRc7NS8yJk8pvqyFprSFazORUTd6/OJl45iTdSKoSJdmkwvcw0L+7dqEw8ulVNdCYsXX7djkrjXYDRaTqU2EYQFkbeDsXxf7r7/lXyZDF2Dn839r/gDfbFmUaJlXTQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/028f4a1a7c4ef63d480eccf7aba7948b/8ac56/azure-bastion_prop-001resMode%3Dsharp2%26op_usm%3D1.5%2C0.webp 240w,\n/static/028f4a1a7c4ef63d480eccf7aba7948b/d3be9/azure-bastion_prop-001resMode%3Dsharp2%26op_usm%3D1.5%2C0.webp 480w,\n/static/028f4a1a7c4ef63d480eccf7aba7948b/4d060/azure-bastion_prop-001resMode%3Dsharp2%26op_usm%3D1.5%2C0.webp 905w\"\n              sizes=\"(max-width: 905px) 100vw, 905px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/028f4a1a7c4ef63d480eccf7aba7948b/8ff5a/azure-bastion_prop-001resMode%3Dsharp2%26op_usm%3D1.5%2C0.png 240w,\n/static/028f4a1a7c4ef63d480eccf7aba7948b/e85cb/azure-bastion_prop-001resMode%3Dsharp2%26op_usm%3D1.5%2C0.png 480w,\n/static/028f4a1a7c4ef63d480eccf7aba7948b/65d79/azure-bastion_prop-001resMode%3Dsharp2%26op_usm%3D1.5%2C0.png 905w\"\n            sizes=\"(max-width: 905px) 100vw, 905px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/028f4a1a7c4ef63d480eccf7aba7948b/65d79/azure-bastion_prop-001resMode%3Dsharp2%26op_usm%3D1.5%2C0.png\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>参考：<a href=\"https://azure.microsoft.com/en-us/products/azure-bastion\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Azure Bastion - Fully Managed RDP/SSH | Microsoft Azure</a></p>\n<p>参考：<a href=\"https://learn.microsoft.com/en-us/azure/bastion/bastion-overview\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">About Azure Bastion | Microsoft Learn</a></p>\n<h2 id=\"virtual-network-とサブネットを作成する\" style=\"position:relative;\"><a href=\"#virtual-network-%E3%81%A8%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\" aria-label=\"virtual network とサブネットを作成する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Virtual network とサブネットを作成する</h2>\n<p>Bastion を使用するためには、Bastion をデプロイするための Virtual network と、サブネット内にデプロイされた仮想マシンが必要です。</p>\n<p>そのため、まずはラボ環境用の Virtual network を作成します。</p>\n<p>Virtual network は、アドレススペースを<code class=\"language-text\">172.16.0.0/20</code>で作成し、<code class=\"language-text\">172.16.1.0/24</code>のサブネットを 1 つ作成しました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 506px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f528d8ca334a8197819aed45c389370b/29f4e/image-20230504095121475.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCklEQVQoz4VSi46DIBDk///R9IxJpYBFQQV8TXe9alPb8zbZwOIw7OwoyusVWZZBaQWOZVlwjOPZN8wWIqWItusoW0zTBMbyhS23SDGi6/oVc0YqmqbBTSlwp0z8V3f2fkdRFAgxnRM672CqCpUxsLVFCBGh79FTppR2YFPXKEuJmP4hjPFXMhN0JLumi945WGupfnXc057PhnHcCY+j4VVorZHnOX4uF0gpv0o+M+GIEzEENNQRz9J5//H6FiN1NgzDW7JB8zy/4QRLVNQly2GnX/N5EjIxVfytolkbo9dkI6W8rap4ZEzOKdrWE9B8uLr/Ps9iNU8bOFLiac+rre7rzNlURQ845/EADEfAKIu3gEMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f528d8ca334a8197819aed45c389370b/8ac56/image-20230504095121475.webp 240w,\n/static/f528d8ca334a8197819aed45c389370b/d3be9/image-20230504095121475.webp 480w,\n/static/f528d8ca334a8197819aed45c389370b/6b97b/image-20230504095121475.webp 506w\"\n              sizes=\"(max-width: 506px) 100vw, 506px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f528d8ca334a8197819aed45c389370b/8ff5a/image-20230504095121475.png 240w,\n/static/f528d8ca334a8197819aed45c389370b/e85cb/image-20230504095121475.png 480w,\n/static/f528d8ca334a8197819aed45c389370b/29f4e/image-20230504095121475.png 506w\"\n            sizes=\"(max-width: 506px) 100vw, 506px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f528d8ca334a8197819aed45c389370b/29f4e/image-20230504095121475.png\"\n            alt=\"Create virtual network\"\n            title=\"Create virtual network\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>この時、仮想マシンを配置する予定の<code class=\"language-text\">172.16.1.0/24</code>のサブネットには、vNet からのインバウンド通信が許可される既定の構成の NSG を割り当てておきます。</p>\n<h2 id=\"virtual-machine-を作成する\" style=\"position:relative;\"><a href=\"#virtual-machine-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\" aria-label=\"virtual machine を作成する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Virtual machine を作成する</h2>\n<p>続いて、Bastion でリモートアクセスを構成する仮想マシンを構成します。</p>\n<p>今回は RedHat 7.9 と Windows Server 2012 R2 の 2 台のマシンを構成しました。</p>\n<p>それぞれの仮想マシンは、先ほど作成した<code class=\"language-text\">172.16.1.0/24</code>のサブネットに追加しました。</p>\n<p>また、NSG は既定の規則のみが適用されているものを構成しました。</p>\n<h2 id=\"virtual-network-に-bastion-をデプロイするかんたん設定\" style=\"position:relative;\"><a href=\"#virtual-network-%E3%81%AB-bastion-%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B%E3%81%8B%E3%82%93%E3%81%9F%E3%82%93%E8%A8%AD%E5%AE%9A\" aria-label=\"virtual network に bastion をデプロイするかんたん設定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Virtual network に Bastion をデプロイする(かんたん設定)</h2>\n<p>先ほど作成した Virtual network のリソースページを開き、[Bastion] から [Deploy Bastion] をクリックします。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 902px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/698a971601630a90e1495a62b713e489/58213/image-20230504095648733.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/0lEQVQoz4VQCY7EIAzr//+5M51Syh3O1huoOts9pEWyCDkc40nYCGcNQgjY9x397HvDPM+QUuI4joGcM0opo37l/jqT2TwCBcQYkVIapB2WlxARdh5srfHbDtJ/CbXSY7A397vWOpq1UqxwHap6rhPeye6kZ4yByToH7/0YuopdYYyJldNQ13Pdkp+qTpLvCybPQxt7ZVjBvT3XwBY4lFxYfWKl+Y1UGte738cvTItYIVeBFAkU2E/vUPmblAkvqSA2h2WzEMpjkRbSBBg6YCIQyxeIwXswPYTCxoRaa+QUB3FrFSlXPOcVH88XHs9l3B1KOyjjIJXBup24YqKET/gdImSEn8rKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/698a971601630a90e1495a62b713e489/8ac56/image-20230504095648733.webp 240w,\n/static/698a971601630a90e1495a62b713e489/d3be9/image-20230504095648733.webp 480w,\n/static/698a971601630a90e1495a62b713e489/5cb76/image-20230504095648733.webp 902w\"\n              sizes=\"(max-width: 902px) 100vw, 902px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/698a971601630a90e1495a62b713e489/8ff5a/image-20230504095648733.png 240w,\n/static/698a971601630a90e1495a62b713e489/e85cb/image-20230504095648733.png 480w,\n/static/698a971601630a90e1495a62b713e489/58213/image-20230504095648733.png 902w\"\n            sizes=\"(max-width: 902px) 100vw, 902px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/698a971601630a90e1495a62b713e489/58213/image-20230504095648733.png\"\n            alt=\"image-20230504095648733\"\n            title=\"image-20230504095648733\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>20 分ほど待つと、Bastion が自動的に Virtual network にデプロイされます。</p>\n<p>ただし、この方法で構成した Bastion は既定の構成であり、有効なプランは Basic になります。</p>\n<p>そのため、後述する<a href=\"#%E3%83%8D%E3%82%A4%E3%83%86%E3%82%A3%E3%83%96%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%A7%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AB%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E6%8E%A5%E7%B6%9A%E3%82%92%E8%A1%8C%E3%81%86\">ネイティブクライアントによる仮想マシンへのリモート接続</a>など、Standard プランでしか使用できない機能を使用する場合は<a href=\"#virtual-network-%E3%81%AB-bastion-%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0\">カスタム構成で Bastion を作成する</a>必要がある点に注意が必要です。</p>\n<p>Bastion のデプロイが完了したら、VM の一覧に先ほど作成した仮想マシンが表示されることを確認します。</p>\n<p>仮想マシンの情報は Virtual network 内で連携される情報を元にしているため、仮想マシンが所属するサブネットと仮想マシン側の NSG で vNet からのインバウンド通信が許可されていない場合、Bastion 側で仮想マシンを選択することができなくなります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 713px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eff049c024ec45f55cebdac6588f4985/01267/image-20230504142633198.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAl0lEQVQY05WRyw4CIQxF+///596Vm1FK5SGVx3iBxGgyMXgWkAK3ty3EhoGINeaWUsprqCpWSoPHMjFG1f4eevI+QFxrLaXUBWD4HGAnZuuD35eBHrYhdEsSEQR/iXXQe2bGpEzJBzXjKJcvZnettZmI+uhST/P5CNHeysXo6czBWYBPcc7N23cVdBe5bls4ahsGtf1q4QXYqtXyAFlO0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/eff049c024ec45f55cebdac6588f4985/8ac56/image-20230504142633198.webp 240w,\n/static/eff049c024ec45f55cebdac6588f4985/d3be9/image-20230504142633198.webp 480w,\n/static/eff049c024ec45f55cebdac6588f4985/69b3e/image-20230504142633198.webp 713w\"\n              sizes=\"(max-width: 713px) 100vw, 713px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/eff049c024ec45f55cebdac6588f4985/8ff5a/image-20230504142633198.png 240w,\n/static/eff049c024ec45f55cebdac6588f4985/e85cb/image-20230504142633198.png 480w,\n/static/eff049c024ec45f55cebdac6588f4985/01267/image-20230504142633198.png 713w\"\n            sizes=\"(max-width: 713px) 100vw, 713px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/eff049c024ec45f55cebdac6588f4985/01267/image-20230504142633198.png\"\n            alt=\"image-20230504142633198\"\n            title=\"image-20230504142633198\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>仮想マシンを選択したら、そのマシンに対してパスワードや秘密鍵を用いて接続を行います。</p>\n<p>この時、パスワードやローカルファイルの証明書以外に、Key Vault で管理している秘密鍵を使用することもできます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 710px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e92f2ce03154aec945d82884f2996174/7131f/image-20230504142916198.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVQY03WQTVLEIBBGObyX8Aaz9gIuPYAHGMuFTiaBAAlN/wHG0dIEy1dvw1f9dVVjpou1gw022sHlJTMWzrpTjs9vKX3mxtvgXShSqzTlsldIBUWQOfdSIgIyyxJnP+cMotKOsKhfIAICSeeKDMgmpXUDUkLErgxUzu/z63UZPO29enpzOAUyAAlyrrW2P5SiiHlTmEUOMm8niWn/I6rjNDlnVbXe6AZMuYXlmH+NjVGeXzysIW4fE0JaU1++fxzvHi6nJ/fT+V3R+qUdHweR0m6aZTT1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e92f2ce03154aec945d82884f2996174/8ac56/image-20230504142916198.webp 240w,\n/static/e92f2ce03154aec945d82884f2996174/d3be9/image-20230504142916198.webp 480w,\n/static/e92f2ce03154aec945d82884f2996174/457aa/image-20230504142916198.webp 710w\"\n              sizes=\"(max-width: 710px) 100vw, 710px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e92f2ce03154aec945d82884f2996174/8ff5a/image-20230504142916198.png 240w,\n/static/e92f2ce03154aec945d82884f2996174/e85cb/image-20230504142916198.png 480w,\n/static/e92f2ce03154aec945d82884f2996174/7131f/image-20230504142916198.png 710w\"\n            sizes=\"(max-width: 710px) 100vw, 710px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e92f2ce03154aec945d82884f2996174/7131f/image-20230504142916198.png\"\n            alt=\"image-20230504142916198\"\n            title=\"image-20230504142916198\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これで、新しいブラウザウィンドウが起動して、サブネット内の仮想マシンに SSH でリモートアクセスを行うことができるようになりました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a506f2b33600189b20c568c3c1f50d37/20751/image-20230504143239855.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZUlEQVQoz32Q2W6CQBSGR1GQuiu4XHljXIJWcEsIGK8aU20v2ndo2pdvcQZNUZb2d6g2sUm/TP4cYL45hyHbD7pjO+/zEBxDrD3bU4exrcu2jDmUOpQ5bPtOXeru/0Dw1j/4PjexXl/eVnerzXqzvl8/rB8t0zZGxlifTCbT6WwKUI05hmEQ13U9z4ui8Ivz9PzUarVm8/lshpjruq4NBrej0XA40DSt3+93u91er9fpdNrtNjn6PpyIg8KyLEKIqqj5fL5UKiFvzmSz2VwuJ8syCjyiIHHD2AQYTBAEVVWr1aqiKMhyuRyb2C2m06lUily4kk3TTCaTtVoNJrJSqaBbsVhESpIkcNIcURRJEATRGciLxSKRSMApFAoYGwkTCRm/EB8B7UdmlIZhfFtRPDY+NJtNdG40GvV6/VLjRIkjcjDC79hx5+VyebowVUU3ODIHQiaTOe2+4kq2bRsvcSsJDvmXb9Af4M1iItGwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a506f2b33600189b20c568c3c1f50d37/8ac56/image-20230504143239855.webp 240w,\n/static/a506f2b33600189b20c568c3c1f50d37/d3be9/image-20230504143239855.webp 480w,\n/static/a506f2b33600189b20c568c3c1f50d37/e46b2/image-20230504143239855.webp 960w,\n/static/a506f2b33600189b20c568c3c1f50d37/7f429/image-20230504143239855.webp 1037w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a506f2b33600189b20c568c3c1f50d37/8ff5a/image-20230504143239855.png 240w,\n/static/a506f2b33600189b20c568c3c1f50d37/e85cb/image-20230504143239855.png 480w,\n/static/a506f2b33600189b20c568c3c1f50d37/d9199/image-20230504143239855.png 960w,\n/static/a506f2b33600189b20c568c3c1f50d37/20751/image-20230504143239855.png 1037w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a506f2b33600189b20c568c3c1f50d37/d9199/image-20230504143239855.png\"\n            alt=\"image-20230504143239855\"\n            title=\"image-20230504143239855\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>もちろん Windows マシンの方にもブラウザ上で RDP 接続を行うことができます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c1b71642f2c42e80c577ec3bc7058822/cad6c/image-20230504143520601.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACiElEQVQoz2NYumyFj49PZGRkWFgYkOFgb+8IBQ5OTo4uLs64gJOTE8Os2XPkFeXVNdXUNNRVVFUUlZWUwaScnJyMtIwsEMjISIOBDBhISUlJAoGUrJSUNMOsmbNa+xdtP3B+9+FTm3cf2nHw+K7Dp/ceO2/j4MjAwMDExMyAB0yfPm35yn2v3/x5/+H75y9/P33+/fHD9x/f//n5BwBlmZlxa2ZkZJgyddrp0ycePbx37dqVp08fP3v25MOXT////w+KjGJgZOARFOTg4eHg4QYhXh5OPj4o4uRkAeqfMWvWkaPHnj55eufO7Xv37t+7/7Bs0Z7EqVt96uda5vaYZ3UZJTcZJTcaJTWapLaaZ3dbZHebZnfbJ9T4h8YxzJw9+8ix4x8+fHrz5vWHj18+fP3pltrBpx4ia5bEqxnOpR7GpxXJpx3JoxnBrRHOrR7GoRrCqhQooBcXVd7JMHf+/IuXLgPd+ffvXyD57///wLx+ZZtUOctkAZ0IeatkVbs0CeM4Ef1oXk2gQeGc6iFsKoFCulHRRU0MEyZMcHJxTU5NjY6Li4mNi01MMg0uVbZOlbNIBGqQNk1QsEoBaTaIEdCJBGlWC2FTBmsubmbo7+8H+pyFhQUShMwsLKKmkUDXcmuEcqoGc6qGcKuHcqmHAPVwAZF6KKdaMLpmdnZ2YKwwMTGxcXCIGEewKASwKQUAFYEQkKEEYYAQu0ogq6K/gHZkdFEzyNlAzWzs7EzMzIxMTKwc7NL2KfwGiQKGCViRoGECn36cpGV6bEUXQ39fH7KzgXHLKSjBKSTNKSSFB3GLyPCLSjJsPXDEJqnQK7smOL/QOb3IM7PEPqPcKr3cGi+ySiu1T8oHAFzh92Ln8OBJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c1b71642f2c42e80c577ec3bc7058822/8ac56/image-20230504143520601.webp 240w,\n/static/c1b71642f2c42e80c577ec3bc7058822/d3be9/image-20230504143520601.webp 480w,\n/static/c1b71642f2c42e80c577ec3bc7058822/e46b2/image-20230504143520601.webp 960w,\n/static/c1b71642f2c42e80c577ec3bc7058822/44ab2/image-20230504143520601.webp 1339w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c1b71642f2c42e80c577ec3bc7058822/8ff5a/image-20230504143520601.png 240w,\n/static/c1b71642f2c42e80c577ec3bc7058822/e85cb/image-20230504143520601.png 480w,\n/static/c1b71642f2c42e80c577ec3bc7058822/d9199/image-20230504143520601.png 960w,\n/static/c1b71642f2c42e80c577ec3bc7058822/cad6c/image-20230504143520601.png 1339w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c1b71642f2c42e80c577ec3bc7058822/d9199/image-20230504143520601.png\"\n            alt=\"image-20230504143520601\"\n            title=\"image-20230504143520601\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"virtual-network-に-bastion-をデプロイするカスタム\" style=\"position:relative;\"><a href=\"#virtual-network-%E3%81%AB-bastion-%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0\" aria-label=\"virtual network に bastion をデプロイするカスタム permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Virtual network に Bastion をデプロイする(カスタム)</h2>\n<p>カスタム Bastion をデプロイする場合、Virtual network のリソースページを開き、[Bastion] から [Configure manually] をクリックします。</p>\n<p>今回はリモートアクセスにネイティブクライアントを使用したいので、Tier は Standard を選択しました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 748px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/383a7b171de04f552aee9ee6b8700d2d/f8915/image-20230505160629936.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.58333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABi0lEQVQ4y5WTiXKjMBBE+f/fjCsbx1y6bzo9wjisE1ftqngISdRMz6FhWWZM04R1VZCxbds+tw3RReRYUHP7BypqqRisMWi1PowdBuXw43LFfFuQfKbx9JLkE4KNiD5iMNogp4RjPAzSyTiOUEqhlIKSMym/w/MYI1JMGIIPfSGKzgpbbfj8uEFSYq2FYSSvsNbAOYsYAg3y5ZzjItJY+0ulNwHeO4QYIP91zt93RJDs50yF67qyKHtoEqLW+lEU3Nnq1td97t/4QeO+MHiqE6PO2J63Q11h5S5vE/QaUGND8RUlVGTOyeUfRJP6zJB9T/hzUQpzeJ1WjPPKPGkYu+dLciWOay0n6KzkzpBY4Xpvm2eDf0bVeb8pXMiiDIL3e9VPVJKlCzgP4nVmJed5RmvtsCoPNvz/GLRWNLiwPRb2Y8YukLekbLiuDloxv1QljhVvU6aK8yV4Zogstw/SHr6H892HFTOvpGHVJZwDSdFvSOvIeQ9ZWkZUyuYxJB9SfflZnEg6hFfKDr4AD5j5lz35yv4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/383a7b171de04f552aee9ee6b8700d2d/8ac56/image-20230505160629936.webp 240w,\n/static/383a7b171de04f552aee9ee6b8700d2d/d3be9/image-20230505160629936.webp 480w,\n/static/383a7b171de04f552aee9ee6b8700d2d/0bb9d/image-20230505160629936.webp 748w\"\n              sizes=\"(max-width: 748px) 100vw, 748px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/383a7b171de04f552aee9ee6b8700d2d/8ff5a/image-20230505160629936.png 240w,\n/static/383a7b171de04f552aee9ee6b8700d2d/e85cb/image-20230505160629936.png 480w,\n/static/383a7b171de04f552aee9ee6b8700d2d/f8915/image-20230505160629936.png 748w\"\n            sizes=\"(max-width: 748px) 100vw, 748px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/383a7b171de04f552aee9ee6b8700d2d/f8915/image-20230505160629936.png\"\n            alt=\"image-20230505160629936\"\n            title=\"image-20230505160629936\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>続いて、Advanced でも [Native client support] を有効にしておきます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 427px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c8ef33167a03de1676137dfb7bbce62c/a7c74/image-20230505160820277.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpElEQVQ4y6VTy07cQBD07/MFfE8OOeQEXHIJCLRm0eLxvJ/esV10zz4EHAKbtNSqkaUpV1fXdMYYOOewLgssnUuZUHKGkhJGa4QQsN/voZVCSgllKjBGE07gWtf1jNydcxbO2vaRcSJC7SNu/vTUz9jsFOZaIYRoP2bSYRgaci1HojNhCB4hhqbEe9/wf6rr+w0e7h+w3T7j8ekJ/aaHGAQkjSzF2MY+jH+whm3RWjV0uWJwZEecIUxEzgndus+YyLOJPJnIq1pnpJiaWu884lF5jLGdGXmKRGhSxdZM2BGpcAWV7nfXvwx+v1gkbzGSIilHKFKQc/m3kX8+euxMQqXtFSIpJTelvLuFNs+9fjL+b91lpxC8a76NI6mjeIxiaGfvAxHOH+LxpUJDPuVSaMR8bvYnp0x+1tbvs/YlYdACRsmWLU0blaRseB1aK0nqQ8Q8f19ld/uSMbqMkmILK2+RfTypZQ8vGvnqx4i73iA5DUs505Q3zp2gjTP5e3XfUrhk8pBeirMO/K5POWPvTnWRh5pILJOxf6SMX8NJGd+/hIzrDac7Q3JwL5lnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c8ef33167a03de1676137dfb7bbce62c/8ac56/image-20230505160820277.webp 240w,\n/static/c8ef33167a03de1676137dfb7bbce62c/b957b/image-20230505160820277.webp 427w\"\n              sizes=\"(max-width: 427px) 100vw, 427px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c8ef33167a03de1676137dfb7bbce62c/8ff5a/image-20230505160820277.png 240w,\n/static/c8ef33167a03de1676137dfb7bbce62c/a7c74/image-20230505160820277.png 427w\"\n            sizes=\"(max-width: 427px) 100vw, 427px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c8ef33167a03de1676137dfb7bbce62c/a7c74/image-20230505160820277.png\"\n            alt=\"image-20230505160820277\"\n            title=\"image-20230505160820277\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これでカスタム構成で Bastion を作成できました。</p>\n<h2 id=\"ネイティブクライアントで仮想マシンにリモート接続を行う\" style=\"position:relative;\"><a href=\"#%E3%83%8D%E3%82%A4%E3%83%86%E3%82%A3%E3%83%96%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%A7%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AB%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E6%8E%A5%E7%B6%9A%E3%82%92%E8%A1%8C%E3%81%86\" aria-label=\"ネイティブクライアントで仮想マシンにリモート接続を行う permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ネイティブクライアントで仮想マシンにリモート接続を行う</h2>\n<p>Bastion を使ってブラウザからリモートアクセスを行うのは非常に便利ですが、時にはホストマシンから RDP や SSH を使用して直接接続したい場合もあります。</p>\n<p>その場合は、Azure CLI を使用します。</p>\n<p>Azure CLI をインストールしていない場合は、以下の手順でインストールを行います。</p>\n<p>参考：<a href=\"https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-windows?tabs=azure-cli\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Install the Azure CLI for Windows | Microsoft Learn</a></p>\n<p>参考：<a href=\"https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-linux?pivots=apt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Install the Azure CLI on Linux | Microsoft Learn</a></p>\n<p>winget 使うとインストールが簡単です。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">winget <span class=\"token function\">install</span> -e --id Microsoft.AzureCLI</code></pre></div>\n<p>インストールが完了したら、コマンドプロンプトなどで以下のいずれかのコマンドを実行して Azure CLI の認証を行います。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">az login\naz login --use-device-code</code></pre></div>\n<p>Azure CLI の認証が完了したら、以下のコマンドでネイティブの RDP クライアントを使用して Bastion 経由で Windows マシンに接続できるようになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">az network bastion rdp --name <span class=\"token string\">\"&lt;BastionName>\"</span> --resource-group <span class=\"token string\">\"&lt;BastionResourceGroupName>\"</span> --target-resource-id <span class=\"token string\">\"&lt;VMResourceId>\"</span></code></pre></div>\n<p>参考：<a href=\"https://learn.microsoft.com/en-us/azure/bastion/vm-upload-download-native\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ネイティブ クライアント接続を使用してファイルをアップロードまたはダウンロードする - Azure Bastion | マイクロソフト ラーン</a></p>\n<p>ここで、<code class=\"language-text\">--target-resource-id</code>に指定する仮想マシンの ID は、リソースグループと仮想マシンの名前がわかっていれば以下のコマンドでも取得ができます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">az vm list --show-details --resource-group EPLab --query <span class=\"token string\">\"[?name == 'Win2012R2'].id\"</span></code></pre></div>\n<p>これで取得した仮想マシンの ID を使用してコマンドを実行すると、自動的に RDP クライアントが起動して Bastion 経由で仮想マシンに RDP 接続することができました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">az network bastion rdp --name <span class=\"token string\">\"EPBastion\"</span> --resource-group <span class=\"token string\">\"EPLab\"</span> --target-resource-id <span class=\"token string\">\"&lt;VMResourceId>\"</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9849b7f4a88415bdb0e26df4eb003893/dcccd/image-20230505162937635.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACEklEQVQoz5WRy2sTURyFx6BIsfVZH1UbjUmqafFRI0WtoEZBd6ZVa1BjbMVaWpWKKO5bsGAT0kSXihvBrf4FrlwF1EWaSSeE4JhMZjJJqiI07eLzTloRBRcuPu7cy51zzzk/qavnEd5zD2k/e4+203dxnBzB6buN69QdtnbfYsuRQVqODrL58E2a9l9jTWcIW1uA4P0IPt8J7K123G43LpcTj8eDtKrjKmsPhGhov4zkOI/U6v+NvRdppzjb7me1EBsZf8HoxEuGx57z9NVbnsTjjE2GGQ9HeRyNEwiGxH/dQ9iPDdHsHWDF7gDrD/bTfGiAjYJ1nddp6LiCzX0Jr/8Br98keff+M3ltlmS6QCpjkFVnxWqSN2qEY8+Q9oiYG7z9NO4N0rgviOP4MNtEzPpesNIjnO/orVcgKyrpmRwzSo6CVsIwKhSLJppm8P3bDyajUyKVcNci+rFiWwKW001dN+qrFbNJnNlcfXjOjKKXDD59/EAikSCVmkaWU2SzWVRVpTY3RyQWR1omLltRrVjW9y+svcVyMQCrR7dwqBV1ppNJISajKBnSskxGURYFazUiU0KwXrrz4j+xuftE0T3sEtPX9BLZnEo+n8comRRKX8kLDLPCwsL8kqDjwh/O/sZyKdkXBS0RraChF4tUKhXMcnWJMvN1h7H/E1Q1nXK1im6WlzCFu7KYepEv4qGJcISfivujarhf7x8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9849b7f4a88415bdb0e26df4eb003893/8ac56/image-20230505162937635.webp 240w,\n/static/9849b7f4a88415bdb0e26df4eb003893/d3be9/image-20230505162937635.webp 480w,\n/static/9849b7f4a88415bdb0e26df4eb003893/e46b2/image-20230505162937635.webp 960w,\n/static/9849b7f4a88415bdb0e26df4eb003893/0b154/image-20230505162937635.webp 1127w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9849b7f4a88415bdb0e26df4eb003893/8ff5a/image-20230505162937635.png 240w,\n/static/9849b7f4a88415bdb0e26df4eb003893/e85cb/image-20230505162937635.png 480w,\n/static/9849b7f4a88415bdb0e26df4eb003893/d9199/image-20230505162937635.png 960w,\n/static/9849b7f4a88415bdb0e26df4eb003893/dcccd/image-20230505162937635.png 1127w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9849b7f4a88415bdb0e26df4eb003893/d9199/image-20230505162937635.png\"\n            alt=\"image-20230505162937635\"\n            title=\"image-20230505162937635\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>次に、ホストマシンから Linux マシンに SSH 接続を行います。</p>\n<p>SSH 接続は、以下のコマンドでトンネリングを構成することで可能になります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">az network bastion tunnel --name <span class=\"token string\">\"&lt;BastionName>\"</span> --resource-group <span class=\"token string\">\"&lt;ResourceGroupName>\"</span> --target-resource-id <span class=\"token string\">\"&lt;VMResourceId>\"</span> --resource-port <span class=\"token string\">\"&lt;TargetVMPort>\"</span> --port <span class=\"token string\">\"&lt;LocalMachinePort>\"</span></code></pre></div>\n<p>今回は以下のようなコマンドを使用しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">az network bastion tunnel --name <span class=\"token string\">\"EPBastion\"</span> --resource-group <span class=\"token string\">\"EPLab\"</span> --resource-port <span class=\"token number\">22</span> --port <span class=\"token number\">2222</span> --target-resource-id <span class=\"token string\">\"&lt;VMResourceId>\"</span> </code></pre></div>\n<p>このコマンドにより、ローカルホストの 2222 ポートを Bastion 経由で仮想マシンの 22 ポートにフォワーディングできるため、以下のコマンドで SSH 接続ができるようになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> -p <span class=\"token number\">2222</span> azureuser@127.0.0.1</code></pre></div>\n<p>これで、ローカルホストから Azure VM に SSH 接続を実行することができました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1d6988a75efaff63fe40e31454cf4fb9/91b29/image-20230505163838605.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVQY022QxwrEMAxEc0wnkN5I74X8/8/NMgItWdjDQ7Jsj0Yy1nXFvu84jgPMSVEUKMvyJ+Z5jrqu5UyqqpI6Y5qmkodhCIOF67rwPA+2bZM4TROGYRD6vpcz32VZJiRJIsRxLLiu+8XwPA9d12FZFnFHUebqLooimKYJx3Fg2/YPWmNUDHakAF1y7PM8Mc+zuCJs1jSNjMWx1aU6Zc33fRETh0EQQPdI7vsWKMwmvKNTFaOwCryhmDjkDuiEYvzMnY3jiLZtxR2FLMv6K/BGax8anZwBXZVjnAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1d6988a75efaff63fe40e31454cf4fb9/8ac56/image-20230505163838605.webp 240w,\n/static/1d6988a75efaff63fe40e31454cf4fb9/d3be9/image-20230505163838605.webp 480w,\n/static/1d6988a75efaff63fe40e31454cf4fb9/e46b2/image-20230505163838605.webp 960w,\n/static/1d6988a75efaff63fe40e31454cf4fb9/b4d37/image-20230505163838605.webp 983w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1d6988a75efaff63fe40e31454cf4fb9/8ff5a/image-20230505163838605.png 240w,\n/static/1d6988a75efaff63fe40e31454cf4fb9/e85cb/image-20230505163838605.png 480w,\n/static/1d6988a75efaff63fe40e31454cf4fb9/d9199/image-20230505163838605.png 960w,\n/static/1d6988a75efaff63fe40e31454cf4fb9/91b29/image-20230505163838605.png 983w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1d6988a75efaff63fe40e31454cf4fb9/d9199/image-20230505163838605.png\"\n            alt=\"image-20230505163838605\"\n            title=\"image-20230505163838605\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>これで Azure Bastion 環境を構築できたので、また一つ検証環境がレベルアップしたような気がします。</p>\n<p>Azure ポータル上から VM の操作ができるのは、自分のローカル端末とネットワーク的に完全に分離したい用途で使うのにも非常に良さそうです。</p>\n<h2 id=\"追記2023年5月6日\" style=\"position:relative;\"><a href=\"#%E8%BF%BD%E8%A8%982023%E5%B9%B45%E6%9C%886%E6%97%A5\" aria-label=\"追記2023年5月6日 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>追記(2023年5月6日)</h2>\n<p>こんな感じで構築した Azure Bastion 環境は非常に快適なものになったのですが、利用料が 1 日 1000 円ほどかかるため個人での運用が難しく、削除してしまいました。</p>\n<p>残念。。</p>","fields":{"slug":"/azure-bastion-tutorial","tagSlugs":["/tag/azure/","/tag/security/","/tag/備忘録/","/tag/az-500/"]},"frontmatter":{"date":"2023-05-05","description":"Azure Bastion を使って Azure VM にセキュアにリモートアクセスできる環境を作ります。","tags":["Azure","Security","備忘録","AZ-500"],"title":"Azure Bastion を使って Azure VM にセキュアにリモートアクセスできる環境を作る","socialImage":{"publicURL":"/static/b8469c310f081fd58309a6836fce9b5c/azure-bastion-tutorial.png"}}}},"pageContext":{"slug":"/azure-bastion-tutorial"}},"staticQueryHashes":["251939775","401334301","825871152"]}