{"componentChunkName":"component---src-templates-post-template-js","path":"/ctf-cybersecurity-rumble-2023","result":{"data":{"markdownRemark":{"id":"ce8179de-80cf-5496-b640-6ad942123253","html":"<p>7/8 から開催されていた Cyber Security Rumble CTF 2023 に 0nePadding として参加し、35 位/ 622 チームでした。</p>\n<p>今回は日本の参加者が少なかったようで、まさかの国内チームとしては 1 位の結果でした笑</p>\n<p>いつも通り Writeup を書いていきます。</p>\n<h2 id=\"shellcode-ceptionrev\" style=\"position:relative;\"><a href=\"#shellcode-ceptionrev\" aria-label=\"shellcode ceptionrev permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SHELLCODE-CEPTION(Rev)</h2>\n<blockquote>\n<p>I think I lost my flag in some kind of inception. Can you help me find my flag?</p>\n</blockquote>\n<p>問題バイナリをデコンパイルすると、以下のような出力を得られました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 618px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0d315e27a85ebfec358455f84866abbd/6e6fb/image-20230709011605412.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABlUlEQVQoz52STUvcUBSG87dLNyKKC9GF4MKF4EJw4Q9oQap0qG2plKILa24Gh44fmUwnXzeZfNw4eTwJolOVmbYXHu5J4L73vOe91rv3J7x902Fp6ZiFhSPZD1lb67QsLx+yuPiBlZUjVlc/sr7eYWPjE5ubx2xtfWF7+ys7O9/Y3T1hb+87+/s/sE5Pzzk7+8xP+4AL+wKlIhxnxNVVSL8f8qsf0Je6+b6+jri5ibi9bYhx3ZjBIMbzNN5QMxQsx3HQSQ8zucRUCcYg1Pzvsmzbxg9yknEjlLY0azKpX1DX87G63a50mFGaQn5UM29vDrQ79WP9okMllqNIE/gxSZrghxrXz/CCClf/JsoSMpNTT+on0RkTkRnaMtQx3iAj0kPSNOJy5OHGIUGSMhJRX/uYO9NCPadDR0koWktZyPxyoRJRI5TkuaEyElRZUtyVjIvxQ3ezLCtbnkMg8ReM/JA884mLiKRIXz1UM8eyshvLYq9NWrdpTofwnLmWlVIPlnlVaDrdv3qHvV6PvCj+EPpXkel1D/LHlFDQsBz+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0d315e27a85ebfec358455f84866abbd/8ac56/image-20230709011605412.webp 240w,\n/static/0d315e27a85ebfec358455f84866abbd/d3be9/image-20230709011605412.webp 480w,\n/static/0d315e27a85ebfec358455f84866abbd/fd768/image-20230709011605412.webp 618w\"\n              sizes=\"(max-width: 618px) 100vw, 618px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0d315e27a85ebfec358455f84866abbd/8ff5a/image-20230709011605412.png 240w,\n/static/0d315e27a85ebfec358455f84866abbd/e85cb/image-20230709011605412.png 480w,\n/static/0d315e27a85ebfec358455f84866abbd/6e6fb/image-20230709011605412.png 618w\"\n            sizes=\"(max-width: 618px) 100vw, 618px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0d315e27a85ebfec358455f84866abbd/6e6fb/image-20230709011605412.png\"\n            alt=\"image-20230709011605412\"\n            title=\"image-20230709011605412\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>プログラム内のデータを XOR してメモリに保存して、その領域に mprotect で PROT_EXEC などの属性を設定しています。</p>\n<p>参考：<a href=\"https://man7.org/linux/man-pages/man2/mprotect.2.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">mprotect(2) - Linux manual page</a></p>\n<p>このことから、プログラム内でデコードしたシェルコードを実行する機能を持っていると推測できました。</p>\n<p>そこで、以下のスクリプトで対象のシェルコードをファイルとして抽出します。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">data <span class=\"token operator\">=</span> <span class=\"token string\">b'\\x3c\\x21\\xe0\\x8c\\x21\\xd1\\x6b\\x7b\\x7a\\x53\\x58\\x1c\\x4b\\x43\\x21\\xd3\\x41\\x46\\x4f\\x77\\x19\\x46\\x4b\\x1b\\x21\\xe0\\x2c\\xb9\\x21\\xe0\\x3c\\xb1\\x21\\xd1\\x58\\x5c\\x19\\x18\\x46\\x77\\x4b\\x1c\\x21\\xd3\\x46\\x77\\x4a\\x4d\\x77\\x1c\\x46\\x46\\x21\\xe0\\x2c\\x89\\x21\\xe0\\x3c\\x81\\xae\\x2c\\x99\\x47\\x51\\x19\\x46\\x0f\\xae\\x2c\\x9d\\x4f\\x55\\xaf\\x2c\\x9f\\x69\\xae\\x2c\\x95\\x69\\x69\\x69\\x69\\x82\\x75\\xe2\\x2c\\x95\\x21\\xf1\\x66\\xdf\\x2d\\x6c\\xb9\\xea\\x99\\x28\\xe0\\xab\\xe2\\x2c\\x95\\x21\\xf1\\xe1\\x3d\\x6c\\xb9\\xea\\x2c\\x95\\x68\\xea\\x14\\x95\\x4c\\x17\\xb7\\xae\\x2c\\x91\\x69\\x69\\x69\\x69\\x82\\x67\\xe2\\x2c\\x91\\x21\\xf1\\xaf\\x2d\\x6c\\xb9\\x69\\xea\\x2c\\x91\\x68\\xea\\x14\\x91\\x4c\\x17\\x85\\xf9\\x34\\xaa'</span>\ndist <span class=\"token operator\">=</span> <span class=\"token string\">b''</span>\n<span class=\"token keyword\">for</span> d <span class=\"token keyword\">in</span> data<span class=\"token punctuation\">:</span>\n    dist <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span>d<span class=\"token operator\">^</span><span class=\"token number\">0x69</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to_bytes<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">'big'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shellcode\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"wb\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n    f<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>dist<span class=\"token punctuation\">)</span></code></pre></div>\n<p>抽出したシェルコードをさらに Ghidra で解析すると、以下の結果が得られました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 734px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7233f866ad54b0d13f24b66e559b3753/c6d67/image-20230709011545535.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoklEQVQ4y6WSbVPiMBSF+f//Zx0ZV74yIzIwuChuKVIqFFEKNEmTNGnPHur4NvvBquncmSRNnpx772m1T89wcvIL7fZvxhnOzzvodDrodru46PXQu7xEv9/HYDDAcDjEaDTC1dUfjMdjXF/fYDKZ4Pb2L4IgwHQaohVNL+DdDjoHjHmOn4zWfL6AJkQoB+c0isKgqqpvRyuKYsSJQ7TUUGoNKR/5Az8ALghcO8yPQJkQ+ATy/jvYOOXZLEKysXhMLaw5wFr5+vMroFdgGM5ZQ8fLvlZWVuUHVd9QOKOyLVS+x4N8wEqssMxWSNXuA/CzqM/yq4F5nkCIJ9xnS0T7CItDjK3afh1Y1cA75GrDZmyRiDU2cgPjLHzp6zebjhcoa3hHdQYHIbDLBNIshSsEtNbc0/RmgVx7Gr6AVAV9quC9YYkcjLXQ9K4vyzeFYXhM2dPYtE2usRMHwgQP51wbdt3BFp5gT5gnrEBZOhSu5Jz7nJfvUz4CpXRI95ZKLDKpuVa8LAizz6pYgmP3G6UcBFMqBF+rGtXp06bE8X3jbjYx+z8/bo8evrs0bgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7233f866ad54b0d13f24b66e559b3753/8ac56/image-20230709011545535.webp 240w,\n/static/7233f866ad54b0d13f24b66e559b3753/d3be9/image-20230709011545535.webp 480w,\n/static/7233f866ad54b0d13f24b66e559b3753/a242a/image-20230709011545535.webp 734w\"\n              sizes=\"(max-width: 734px) 100vw, 734px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7233f866ad54b0d13f24b66e559b3753/8ff5a/image-20230709011545535.png 240w,\n/static/7233f866ad54b0d13f24b66e559b3753/e85cb/image-20230709011545535.png 480w,\n/static/7233f866ad54b0d13f24b66e559b3753/c6d67/image-20230709011545535.png 734w\"\n            sizes=\"(max-width: 734px) 100vw, 734px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7233f866ad54b0d13f24b66e559b3753/c6d67/image-20230709011545535.png\"\n            alt=\"image-20230709011545535\"\n            title=\"image-20230709011545535\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>処理自体はシンプルでしたので、以下の Solver を作成して Flag を取得しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> struct\n\na <span class=\"token operator\">=</span> <span class=\"token number\">0x2a2275313a131202</span>\nb <span class=\"token operator\">=</span> <span class=\"token number\">0x72222f701e262f28</span>\nc <span class=\"token operator\">=</span> <span class=\"token number\">0x75221e2f71703531</span>\nd <span class=\"token operator\">=</span> <span class=\"token number\">0x2f2f751e24231e2f</span>\ne <span class=\"token operator\">=</span> <span class=\"token number\">0x2f70382e</span>\nf <span class=\"token operator\">=</span> <span class=\"token number\">0x3c26</span>\n\n<span class=\"token comment\"># https://docs.python.org/ja/3.9/library/struct.html</span>\ndata <span class=\"token operator\">=</span> struct<span class=\"token punctuation\">.</span>pack<span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;qqqqih\"</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">,</span>e<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> d <span class=\"token keyword\">in</span> data<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>d<span class=\"token operator\">^</span><span class=\"token number\">0x41</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>end<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># CSR{p4cking_1nc3pt10n_c4n_be_4nnoy1ng}</span></code></pre></div>\n<h2 id=\"lightbulbrev\" style=\"position:relative;\"><a href=\"#lightbulbrev\" aria-label=\"lightbulbrev permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LIGHTBULB(Rev)</h2>\n<blockquote>\n<p>I have a very nice light bulb at home, and I found out I can switch with my phone using the app I wrote.</p>\n<p>But the app only works on my phone, so good luck switching my light!</p>\n</blockquote>\n<p>問題バイナリとして apk ファイルが与えられます。</p>\n<p>エミュレータで実行してみると、パスワードを使用してログインをした後に、電灯スイッチの ON/OFF を切り替えることができるアプリであることがわかりました。</p>\n<p>とりあえず apktool で展開したファイルを一通り眺めていくと、ログインパスワードに使用する情報である <code class=\"language-text\">583908295080</code> が平文で格納されていることがわかります。</p>\n<p>そして、ログイン後の動作を追うために Smali2Java を使用して Smali ファイルを Java にデコンパイルした結果を確認しました。</p>\n<p>すると、以下の処理が LightSwitchingActivity で行われていることがわかります。</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">String</span> string <span class=\"token operator\">=</span> sharedPreferences<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"secret_key\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"LIGHTSWITCH\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"the sk was \"</span> <span class=\"token operator\">+</span> string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNull</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> string<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Charsets</span><span class=\"token punctuation\">.</span>UTF_8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNullExpressionValue</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">,</span> <span class=\"token string\">\"this as java.lang.String).getBytes(charset)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">APIKeyHash</span> aPIKeyHash <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">APIKeyHash</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">StringBuilder</span> sb <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CSR{\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes2 <span class=\"token operator\">=</span> <span class=\"token string\">\"APIKEY\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Charsets</span><span class=\"token punctuation\">.</span>UTF_8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNullExpressionValue</span><span class=\"token punctuation\">(</span>bytes2<span class=\"token punctuation\">,</span> <span class=\"token string\">\"this as java.lang.String).getBytes(charset)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>apiKey <span class=\"token operator\">=</span> sb<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LightSwitchingActivityKt</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHex</span><span class=\"token punctuation\">(</span>aPIKeyHash<span class=\"token punctuation\">.</span><span class=\"token function\">hash</span><span class=\"token punctuation\">(</span>bytes2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token char\">'}'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">RequestQueue</span> newRequestQueue <span class=\"token operator\">=</span> <span class=\"token class-name\">Volley</span><span class=\"token punctuation\">.</span><span class=\"token function\">newRequestQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Context</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNullExpressionValue</span><span class=\"token punctuation\">(</span>newRequestQueue<span class=\"token punctuation\">,</span> <span class=\"token string\">\"newRequestQueue(this)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requestQueue <span class=\"token operator\">=</span> newRequestQueue<span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">SwitchCompat</span> findViewById <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token number\">2131231147</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNullExpressionValue</span><span class=\"token punctuation\">(</span>findViewById<span class=\"token punctuation\">,</span> <span class=\"token string\">\"findViewById(R.id.switch_light_bulb)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfindViewById<span class=\"token punctuation\">.</span><span class=\"token function\">setOnCheckedChangeListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LightSwitchingActivity</span>$<span class=\"token punctuation\">.</span><span class=\"token function\">ExternalSyntheticLambda0</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ここではまず、ログインパスワードにもなっている secret_key の文字列をバイト列に変換した後に、APIKeyHash クラスを作成しています。</p>\n<p>その後、APIKEY という文字列をバイト列に変換したものを引数として APIKeyHash クラスの hash メソッドを呼び出します。</p>\n<p>そして、hash メソッドの戻り値になるバイト列をさらに LightSwitchingActivityKt.toHex() に与えた結果が Flag になりることがわかりました。</p>\n<p>APIKeyHash クラスと LightSwitchingActivityKt の実装は、さきほどと同じく Smali2Java を使用することで Java にデコンパイルすることで確認しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// LightSwitchingActivityKt </span>\n<span class=\"token keyword\">package</span> <span class=\"token namespace\">club<span class=\"token punctuation\">.</span>redrocket<span class=\"token punctuation\">.</span>lightbulb</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">kotlin<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Metadata</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">kotlin<span class=\"token punctuation\">.</span>jvm<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/* compiled from: LightSwitchingActivity.kt */</span>\n<span class=\"token annotation punctuation\">@Metadata</span><span class=\"token punctuation\">(</span>d1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"\\u0000\\u0012\\n\\u0000\\n\\u0002\\u0010\\u0019\\n\\u0000\\n\\u0002\\u0010\\u000e\\n\\u0002\\u0010\\u0012\\n\\u0000\\u001a\\n\\u0010\\u0002\\u001a\\u00020\\u0003*\\u00020\\u0004\\\"\\u000e\\u0010\\u0000\\u001a\\u00020\\u0001X\\u0082\\u0004¢\\u0006\\u0002\\n\\u0000¨\\u0006\\u0005\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> d2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"HEX_CHARS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"toHex\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"app_release\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> k <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> mv <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> xi <span class=\"token operator\">=</span> <span class=\"token number\">48</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">/* loaded from: /tmp/jadx-9359415826287627730.dex */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LightSwitchingActivityKt</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> HEX_CHARS<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> charArray <span class=\"token operator\">=</span> <span class=\"token string\">\"0123456789ABCDEF\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">toCharArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNullExpressionValue</span><span class=\"token punctuation\">(</span>charArray<span class=\"token punctuation\">,</span> <span class=\"token string\">\"this as java.lang.String).toCharArray()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        HEX_CHARS <span class=\"token operator\">=</span> charArray<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toHex</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr4<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNullParameter</span><span class=\"token punctuation\">(</span>bArr4<span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;this>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">StringBuffer</span> stringBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span> b <span class=\"token operator\">:</span> bArr4<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> cArr <span class=\"token operator\">=</span> HEX_CHARS<span class=\"token punctuation\">;</span>\n            stringBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>cArr<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>b <span class=\"token operator\">&amp;</span> <span class=\"token number\">240</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>>></span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            stringBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>cArr<span class=\"token punctuation\">[</span>b <span class=\"token operator\">&amp;</span> <span class=\"token number\">15</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token class-name\">String</span> stringBuffer2 <span class=\"token operator\">=</span> stringBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNullExpressionValue</span><span class=\"token punctuation\">(</span>stringBuffer2<span class=\"token punctuation\">,</span> <span class=\"token string\">\"result.toString()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> stringBuffer2<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// APIKeyHash </span>\n<span class=\"token keyword\">package</span> <span class=\"token namespace\">club<span class=\"token punctuation\">.</span>redrocket<span class=\"token punctuation\">.</span>lightbulb</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">kotlin<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Metadata</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">kotlin<span class=\"token punctuation\">.</span>jvm<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/* compiled from: APIKeyHash.kt */</span>\n<span class=\"token annotation punctuation\">@Metadata</span><span class=\"token punctuation\">(</span>d1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"\\u0000\\u001a\\n\\u0002\\u0018\\u0002\\n\\u0002\\u0010\\u0000\\n\\u0000\\n\\u0002\\u0010\\u0012\\n\\u0002\\b\\u0005\\n\\u0002\\u0010\\u0002\\n\\u0002\\b\\u0002\\u0018\\u00002\\u00020\\u0001B\\u000f\\b\\u0000\\u0012\\u0006\\u0010\\u0002\\u001a\\u00020\\u0003¢\\u0006\\u0002\\u0010\\u0004J\\u000e\\u0010\\u0006\\u001a\\u00020\\u00032\\u0006\\u0010\\u0007\\u001a\\u00020\\u0003J\\b\\u0010\\b\\u001a\\u00020\\tH\\u0002J\\u0006\\u0010\\n\\u001a\\u00020\\tR\\u000e\\u0010\\u0002\\u001a\\u00020\\u0003X\\u0082\\u0004¢\\u0006\\u0002\\n\\u0000R\\u000e\\u0010\\u0005\\u001a\\u00020\\u0003X\\u0082\\u0004¢\\u0006\\u0002\\n\\u0000¨\\u0006\\u000b\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> d2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Lclub/redrocket/lightbulb/APIKeyHash;\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"([B)V\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"s\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hash\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"plaintext\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"initializeS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"reset\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"app_release\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> k <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> mv <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> xi <span class=\"token operator\">=</span> <span class=\"token number\">48</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">/* loaded from: /tmp/jadx-2851593408582218842.dex */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">APIKeyHash</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> key<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> s<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">APIKeyHash</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNullParameter</span><span class=\"token punctuation\">(</span>bArr<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>key <span class=\"token operator\">=</span> bArr<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>s <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>bArr<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> bArr<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"key length must be between 1 and 256\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">initializeS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initializeS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">256</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">)</span> i<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr2 <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">;</span>\n            bArr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> bArr2<span class=\"token punctuation\">[</span>i <span class=\"token operator\">%</span> bArr2<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">int</span> i2 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i3 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i3 <span class=\"token operator\">&lt;</span> <span class=\"token number\">256</span><span class=\"token punctuation\">;</span> i3<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr3 <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span> b <span class=\"token operator\">=</span> bArr3<span class=\"token punctuation\">[</span>i3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            i2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>i2 <span class=\"token operator\">+</span> b <span class=\"token operator\">+</span> bArr<span class=\"token punctuation\">[</span>i3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">255</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span> b2 <span class=\"token operator\">=</span> bArr3<span class=\"token punctuation\">[</span>i2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            bArr3<span class=\"token punctuation\">[</span>i2<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> b<span class=\"token punctuation\">;</span>\n            bArr3<span class=\"token punctuation\">[</span>i3<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> b2<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">initializeS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">hash</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNullParameter</span><span class=\"token punctuation\">(</span>bArr<span class=\"token punctuation\">,</span> <span class=\"token string\">\"plaintext\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span>bArr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> length <span class=\"token operator\">=</span> bArr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> i2 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i3 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i3 <span class=\"token operator\">&lt;</span> length<span class=\"token punctuation\">;</span> i3<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            i <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">255</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr3 <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span> b <span class=\"token operator\">=</span> bArr3<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            i2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>i2 <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">255</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span> b2 <span class=\"token operator\">=</span> bArr3<span class=\"token punctuation\">[</span>i2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            bArr3<span class=\"token punctuation\">[</span>i2<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> b<span class=\"token punctuation\">;</span>\n            bArr3<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> b2<span class=\"token punctuation\">;</span>\n            bArr2<span class=\"token punctuation\">[</span>i3<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>bArr3<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>b2 <span class=\"token operator\">+</span> bArr3<span class=\"token punctuation\">[</span>i2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">255</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">^</span> bArr<span class=\"token punctuation\">[</span>i3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> bArr2<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>上記のデコンパイル結果を元に以下の Solver を Java で作成し、アプリの動作を再現することで、静的解析で Flag を取得することに成功しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>charset<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Solver</span> <span class=\"token punctuation\">{</span>    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> key<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> s<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token string\">\"583908295080\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span>UTF_8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        key <span class=\"token operator\">=</span> bytes<span class=\"token punctuation\">;</span>\n        s <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// initializeS</span>\n        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">256</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            s<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">)</span> i<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr2 <span class=\"token operator\">=</span> key<span class=\"token punctuation\">;</span>\n            bArr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> bArr2<span class=\"token punctuation\">[</span>i <span class=\"token operator\">%</span> bArr2<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">int</span> i4 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i3 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i3 <span class=\"token operator\">&lt;</span> <span class=\"token number\">256</span><span class=\"token punctuation\">;</span> i3<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr3 <span class=\"token operator\">=</span> s<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span> b <span class=\"token operator\">=</span> bArr3<span class=\"token punctuation\">[</span>i3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            i4 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>i4 <span class=\"token operator\">+</span> b <span class=\"token operator\">+</span> bArr<span class=\"token punctuation\">[</span>i3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">255</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span> b2 <span class=\"token operator\">=</span> bArr3<span class=\"token punctuation\">[</span>i4<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            bArr3<span class=\"token punctuation\">[</span>i4<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> b<span class=\"token punctuation\">;</span>\n            bArr3<span class=\"token punctuation\">[</span>i3<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> b2<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// hash</span>\n        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bhash <span class=\"token operator\">=</span> <span class=\"token string\">\"APIKEY\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span>UTF_8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr4 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span>bhash<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> length <span class=\"token operator\">=</span> bhash<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> i5 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> i6 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i7 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i7 <span class=\"token operator\">&lt;</span> length<span class=\"token punctuation\">;</span> i7<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            i5 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>i5 <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">255</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bArr5 <span class=\"token operator\">=</span> s<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span> b <span class=\"token operator\">=</span> bArr5<span class=\"token punctuation\">[</span>i5<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            i6 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>i6 <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">255</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">byte</span> b2 <span class=\"token operator\">=</span> bArr5<span class=\"token punctuation\">[</span>i6<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            bArr5<span class=\"token punctuation\">[</span>i6<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> b<span class=\"token punctuation\">;</span>\n            bArr5<span class=\"token punctuation\">[</span>i5<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> b2<span class=\"token punctuation\">;</span>\n            bArr4<span class=\"token punctuation\">[</span>i7<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>bArr5<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>b2 <span class=\"token operator\">+</span> bArr5<span class=\"token punctuation\">[</span>i6<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">255</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">^</span> bhash<span class=\"token punctuation\">[</span>i7<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> charArray <span class=\"token operator\">=</span> <span class=\"token string\">\"0123456789ABCDEF\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">toCharArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> bArr4<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>charArray<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>bArr4<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">240</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>>></span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>charArray<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>bArr4<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// DE404B983322</span></code></pre></div>\n<h2 id=\"ransomware-traffic-analysis-part-1forensic\" style=\"position:relative;\"><a href=\"#ransomware-traffic-analysis-part-1forensic\" aria-label=\"ransomware traffic analysis part 1forensic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RANSOMWARE TRAFFIC ANALYSIS PART 1(Forensic)</h2>\n<blockquote>\n<p>DISCLAIMER: This might contain real ransomware. DO NOT EXECUTE ANY FILES IN AN UNSAFE ENVIRONMENT. Please use a virtual machine for this challenge.</p>\n<p>ARC Industries dedicated an entire month of hard work and effort to create a tender document for a highly esteemed project that held the key to their financial stability. Unfortunately, on Thursday, May 25th 2023, the company fell victim to a malicious act of ransomware, suspected to be orchestrated by a rival competitor. As a result, the crucial final version of the tender document has been rendered inaccessible due to encryption. It is both unreadable and has a file extension appended to the filename. Urgently, ARC Industries seeks the assistance of a skilled expert capable of decrypting this invaluable document.</p>\n<p>Armed with only the network traffic logs, it’s time for you to showcase your expertise, Defender!!</p>\n</blockquote>\n<p>問題バイナリとしてランサムウェアに感染した端末の pcap ファイルが与えられます。</p>\n<p>pcap を調査してみると、HTTP や SMB でいくつか怪しげなファイルのやり取りをしています。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f6c0f1465ffa8635e7f6b779650929b9/87a80/image-20230709010301843.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABFUlEQVQY012Q2W7CMBBF8/8/VJZAWiCICgEpUh8KATtxCGmzlweWNrmMJ2oFPFx5GfvMsQ0ZmPDDPvJyDD0P9hbSYow4G6E8THC6zFDjDUluw5Vt7D6fEUQWVtsWr//uC9XcNT6kCR0/GmLl9bD2+/CiAYLYxlcxQXmc41gtESY23t02xO4FG2XxOZci9wPE5SvSwxQZxZCqg41HnVSXs5G6cwtJNkT5PcblZwaQYVaM4IoW0nyE03mK32pO5guqOVxvRkcDuxB+Fyrskb4GtrmBBhYEPN8AdU3vAUtU9QIVAXi8iSHIcOt34O1MNnRl8zePQG22Fk/813p9D3L+w08WBGRD1RgykADF3ZNtbnYLrMnwMVf5vrIbh6OA6gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f6c0f1465ffa8635e7f6b779650929b9/8ac56/image-20230709010301843.webp 240w,\n/static/f6c0f1465ffa8635e7f6b779650929b9/d3be9/image-20230709010301843.webp 480w,\n/static/f6c0f1465ffa8635e7f6b779650929b9/e46b2/image-20230709010301843.webp 960w,\n/static/f6c0f1465ffa8635e7f6b779650929b9/0ea8a/image-20230709010301843.webp 973w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f6c0f1465ffa8635e7f6b779650929b9/8ff5a/image-20230709010301843.png 240w,\n/static/f6c0f1465ffa8635e7f6b779650929b9/e85cb/image-20230709010301843.png 480w,\n/static/f6c0f1465ffa8635e7f6b779650929b9/d9199/image-20230709010301843.png 960w,\n/static/f6c0f1465ffa8635e7f6b779650929b9/87a80/image-20230709010301843.png 973w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f6c0f1465ffa8635e7f6b779650929b9/d9199/image-20230709010301843.png\"\n            alt=\"image-20230709010301843\"\n            title=\"image-20230709010301843\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>特に SMB の通信を見たところ、以下のようなランサムノートとともに暗号化された .micro 拡張子付きのファイルが送信されていました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5c94c13112f9756d103526e5e0598cfb/86a1e/image-20230709010859694.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvklEQVQoz32RW5OaQBCF+f+/KEmZzT5Ed2sr0fKyakABGebGRRBYkBU5mRkvycMmXfVVDzDVfc7BmntLLOkUM7KGI39hLdaYhQ5eyQqbyEWQE9CSgWkqbs4fwa5YgRzBDr8jEBSERdiFApRxSEYg1DufMIg4NXAZQyb6nCBK94j3iixDouBpjkBmsEI2gON+AqMJ3E0Bb3sA2ZXgwQERr1BkR0N1aFHmR3TtGeh64Hylu3A+9ejee1hUPMANBghIDNvO4XkHhGEJGdVg/A1RXCNNG9RNh0ZRN6cL9QnHYwddPf6URfkDPDKA60nM53szMAgK03d+ccdzlfJALZJqiVqWxI0Zequ+1yiFXH7Dxv8C1xfw/QqMVaBKoe5CvIHS6zO9fCOkxG5XGBe3O0XRom0vai2mBtruZ9gbjp8/Yry8cEzGESaTCE9PDI6TGcu5yi9TWR5Ulho9xHTFWWWpMQN59GgsO1uB+WyPxTzBdBpjsUhVBIlhu82RJI3K8IT/lbEs4kf44Vd4vsTyNcNqlSJWGWkFVfWOrjvfL9/6v7hb1gqXK4rRkGM4pBiPJZ6fGUYjan6CtnrL6O/BH9VvJR/wCpq5oIEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5c94c13112f9756d103526e5e0598cfb/8ac56/image-20230709010859694.webp 240w,\n/static/5c94c13112f9756d103526e5e0598cfb/d3be9/image-20230709010859694.webp 480w,\n/static/5c94c13112f9756d103526e5e0598cfb/e46b2/image-20230709010859694.webp 960w,\n/static/5c94c13112f9756d103526e5e0598cfb/0b716/image-20230709010859694.webp 1296w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5c94c13112f9756d103526e5e0598cfb/8ff5a/image-20230709010859694.png 240w,\n/static/5c94c13112f9756d103526e5e0598cfb/e85cb/image-20230709010859694.png 480w,\n/static/5c94c13112f9756d103526e5e0598cfb/d9199/image-20230709010859694.png 960w,\n/static/5c94c13112f9756d103526e5e0598cfb/86a1e/image-20230709010859694.png 1296w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5c94c13112f9756d103526e5e0598cfb/d9199/image-20230709010859694.png\"\n            alt=\"image-20230709010859694\"\n            title=\"image-20230709010859694\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これは、以下の記事のランサムウェアの特徴に一致します。</p>\n<p>参考：<a href=\"https://www.pcrisk.com/removal-guides/20097-micro-ransomware\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Micro Ransomware - Decryption, removal, and lost files recovery (updated)</a></p>\n<p>このランサムウェアは TESLACRYPT と呼ばれるマルウェアのようですが、どうやらすでに攻撃者が復号用のマスターキーを開示しているようです。</p>\n<p>そのため、複数のセキュリティベンダが TESLACRYPT の復号ツールを公開していました。</p>\n<p>今回は、Trendmicro のツールを利用します。</p>\n<p>参考：<a href=\"https://success.trendmicro.com/dcx/s/solution/1114221-downloading-and-using-the-trend-micro-ransomware-file-decryptor?language=en_US\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Using the Trend Micro Ransomware File Decryptor Tool</a></p>\n<p>上記からダウンロードしたツールを起動し、以下のように TESLACRYPT を指定して問題バイナリを復号します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 514px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b72877acb92cee5e0de583874451aa39/dea13/image-20230709011100079.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.41666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC1klEQVQ4y31Uy27TUBT0R4JYVAghISQkKFJBYsWCH+ADkAqooEJBIEJa2IBYIJZV1IhH3Lyah5PYvn7biR0/hnNukialDZZG9zjnZjwz59qK8WwHvYeP0Lq1ifbN2+hsPcDJ5n3CPZzcpfXO1unKvda1G2hc3kDzytUlNq6jcWkD+pNtKN73HwhLZUz23sB5+QruhzLC8if4pX0EjPclBOUDBB8PEO5/hv/6LcTTHZgkRBBMqsWLXZjbz8FcCuiqpcCeAHyq/XiCrmGgbwm56r6Pketi6NgY2BaGnod1V0FQxmmO3bqDx4d9VLwcrjBxrB6j2+mg3WyirqqEY7QaDai1mrwfhxHSJEEyiQkTxOMxpnGCLE2hpFmOQz3E144NLS6oMYFhmBDCguM4MA0dtm3P7m0HtmVhNBrCME0Yuo6BpkHTBrAdF0VRQGHWjKSGrLco1tspcuR5Lv8021pILPsFUlaY0aa03UFKaiKSP44ijMlCGIaIqI7C2T2T/Q9MOJ1OiZDYx+9K8H7/gUGkthDSokEDscge196aQTDJGUKpMMuwanRCGUZzlbwyoczSNAgCQRBI+DT9CTlakDJHQq5mhIScQQ1WpVPYrJDX6tERKpUKqtUj1GjKus7Epuyx8jOE9IBzCmdh5+dCP9tfYtUycykZFfGXb/DrDeikTtDTWeVCxcLuIlNWaNszF67rLhWeTpnUJNWfiGljlMRyypwd58Q58uTiOEZMdhI6zDJbyooz5HqVcDblueWFOd7Ig+Cnd+htadAb0qQ3pt1uy3UwGMge7+GjdSFhns3PE/0oCckmB97r9SRRr9tFl8CEw9FI9jiKkM5oLgmLVUL6MiBfg4vPHovIslwOj/cVeSZ7MkNhe1B7FtSuhTqv87rRt6S1f8HqGL7vQTMc/DoRGAgfqlqTg1J8kt03fWhz9I1lzZai6Dz4dx6e7QbojDwIN5IfCo7rLyXIRvTVQZW9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b72877acb92cee5e0de583874451aa39/8ac56/image-20230709011100079.webp 240w,\n/static/b72877acb92cee5e0de583874451aa39/d3be9/image-20230709011100079.webp 480w,\n/static/b72877acb92cee5e0de583874451aa39/7a333/image-20230709011100079.webp 514w\"\n              sizes=\"(max-width: 514px) 100vw, 514px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b72877acb92cee5e0de583874451aa39/8ff5a/image-20230709011100079.png 240w,\n/static/b72877acb92cee5e0de583874451aa39/e85cb/image-20230709011100079.png 480w,\n/static/b72877acb92cee5e0de583874451aa39/dea13/image-20230709011100079.png 514w\"\n            sizes=\"(max-width: 514px) 100vw, 514px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b72877acb92cee5e0de583874451aa39/dea13/image-20230709011100079.png\"\n            alt=\"image-20230709011100079\"\n            title=\"image-20230709011100079\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>復号が完了すると、以下のように Flag を取得することができました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3304cf8faa96c4bd578894296701d784/906b5/image-20230709011117849.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBklEQVQoz7WOaWqEQBCFPY4KKuLuiKKX8AbieTyEC95G/OkdEgiBjHb70l1jJpMFhoGk4KNeVb2qbiUvChR5jiRJkGUZgiCAaRgwTZOwLOuqb3sf6LoOQ/gdx6FaSU4npGkK13URhiGiKKJa4nkefN+nXhxHNI/jmLKceb53PGBSLT+l2LaNsiwxjiP6vscw9KQlbdsKuqM/iDyQ7rrumLXXWvqbpoGiqirqusZfxLIsUDRNQ1VV2PcdjDFi2xhWYrvhey1YN/JuQsuYpunzoAx5VLJuHOdVILLUzy8rnogzXt/YZX54GN/BOaf9eZ5/P8j5Txjbj+WvXPx3Dj4adw8+yr/+8B1c1oOkha60TAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3304cf8faa96c4bd578894296701d784/8ac56/image-20230709011117849.webp 240w,\n/static/3304cf8faa96c4bd578894296701d784/d3be9/image-20230709011117849.webp 480w,\n/static/3304cf8faa96c4bd578894296701d784/4a41d/image-20230709011117849.webp 950w\"\n              sizes=\"(max-width: 950px) 100vw, 950px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3304cf8faa96c4bd578894296701d784/8ff5a/image-20230709011117849.png 240w,\n/static/3304cf8faa96c4bd578894296701d784/e85cb/image-20230709011117849.png 480w,\n/static/3304cf8faa96c4bd578894296701d784/906b5/image-20230709011117849.png 950w\"\n            sizes=\"(max-width: 950px) 100vw, 950px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3304cf8faa96c4bd578894296701d784/906b5/image-20230709011117849.png\"\n            alt=\"image-20230709011117849\"\n            title=\"image-20230709011117849\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"ransomware-traffic-analysis-part-2forensic\" style=\"position:relative;\"><a href=\"#ransomware-traffic-analysis-part-2forensic\" aria-label=\"ransomware traffic analysis part 2forensic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RANSOMWARE TRAFFIC ANALYSIS PART 2(Forensic)</h2>\n<blockquote>\n<p>DISCLAIMER: This might contain real ransomware. DO NOT EXECUTE ANY FILES IN AN UNSAFE ENVIRONMENT. Please use a virtual machine for this challenge.</p>\n<p>In the aftermath of the ransomware attack, ARC Industries faces a new challenge. The threat actor has hidden the vital private key required for decryption within their network. As the defender, your mission is to tirelessly locate this elusive key. Analyze network traffic logs, investigate suspicious activities, and unravel the threat actor’s techniques. Time is critical as the financial stability of ARC Industries hangs in the balance. Your expertise is essential to recover the key and restore the remaining files.</p>\n<p>Take up the challenge and safeguard the future of the organization. Success relies on your determination and investigative skills. Armed with only the network traffic logs, it’s time for you to showcase your expertise, Defender!! Your colleague who captured the network traffic logs also started gathering the evidence and put this in a fileshare…</p>\n</blockquote>\n<p>PART 1 は面白かったのですが、正直 PART 2 は意図がよくわかりませんでした。(そして結局 Solver も 1 チームのみという)</p>\n<p>PART 1 と同じ pcap から鍵を見つけろという問題でしたが、正直とっかかりがなさすぎて全くわかりませんでした。</p>\n<p>どうやら、SMB でやり取りしている eml ファイルに着目する必要があったようです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6ee45c2c8f81e3c871e4ce017e489ea7/bb3b7/image-20230709104545133.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3ElEQVQoz42R3Y7SUBSF+yoztGUEnT9sBuTORBP1Mbzwfu6MxqjRMf7EGF/JB/BGFDoUQgJt6UxPof8I7XKfUzoZmTHxJF/WWqd7726KpGktHBw0cEg0Ghrq9VvY2amhVrsJuaKgsoEsq1CIUhWlzFXRJ9XrbTSbD9BqPUS7/Qiadh+qeoStrUNsb9++gqIcoVptCVXVpvBc93bv0EJ3Ib17UcPX9/v4crKHz293BR9e3sCbZzJOnsv4+GqTypoif3pd6JPH9/D0WIM0Nb8hDr5jlf5AtuhgReS/fwLLXwX5BugS3FPNqgNkHaHz2QhJpEMyjAkGQwsT08V44sK0GHm29h55D5Y9o8xEHo+Luqnjg7EELovBvATlkQYDA5zh0ICu99Dv65T7InNvGH3iVNTwPBoNadA5PI8hCgOEoY80jZHnOZFBmrk+oigkIsRxQsTCFzm+oiU8h2EoSJIEWZYVG3a7XXB0XUev16OfNIZlWTBN80Jt24ZNnivP5TOeS+VDxUD+0HEc8ab5fA7fDxAEgfCX8X3/wvPazU2Xy2Ux8PzsjD4so8tANPFhvIBrOSRYZ97M7xaLBa47/DtKznQK12WiMU1T/O8p/oS/ERuWq5YX1xX+q7nUy+cPGJkZK6v/AxUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6ee45c2c8f81e3c871e4ce017e489ea7/8ac56/image-20230709104545133.webp 240w,\n/static/6ee45c2c8f81e3c871e4ce017e489ea7/d3be9/image-20230709104545133.webp 480w,\n/static/6ee45c2c8f81e3c871e4ce017e489ea7/e46b2/image-20230709104545133.webp 960w,\n/static/6ee45c2c8f81e3c871e4ce017e489ea7/52f78/image-20230709104545133.webp 1211w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6ee45c2c8f81e3c871e4ce017e489ea7/8ff5a/image-20230709104545133.png 240w,\n/static/6ee45c2c8f81e3c871e4ce017e489ea7/e85cb/image-20230709104545133.png 480w,\n/static/6ee45c2c8f81e3c871e4ce017e489ea7/d9199/image-20230709104545133.png 960w,\n/static/6ee45c2c8f81e3c871e4ce017e489ea7/bb3b7/image-20230709104545133.png 1211w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6ee45c2c8f81e3c871e4ce017e489ea7/d9199/image-20230709104545133.png\"\n            alt=\"image-20230709104545133\"\n            title=\"image-20230709104545133\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>このメールには画像が 2 つ添付されているので、まずは画像をロードしました。</p>\n<p>これをファイルとして保存してみると、フッターに使用されている jpg ファイルにステガノで Flag が埋め込まれていました。</p>\n<p>以下のコマンドで Flag を取得できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">steghide extract -sf image.jpg</code></pre></div>\n<p>解凍用のパスワードは、HTTP でやり取りしている password.txt に記載されていたものを使用しました。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>RISC-V の Reversing 問題が解けなかったので、もう少し勉強したら改めて Writeup を書きます。</p>","fields":{"slug":"/ctf-cybersecurity-rumble-2023","tagSlugs":["/tag/ctf/","/tag/rev/","/tag/forensic/"]},"frontmatter":{"date":"2023-07-12","description":"Cyber Security Rumble CTF 2023 の Writeup です。","tags":["CTF","Rev","Forensic"],"title":"Cyber Security Rumble CTF 2023 Writeup","socialImage":{"publicURL":"/static/e896b189daf825dfc86bef394b230f76/ctf-cybersecurity-rumble-2023.png"}}}},"pageContext":{"slug":"/ctf-cybersecurity-rumble-2023"}},"staticQueryHashes":["251939775","401334301","825871152"]}