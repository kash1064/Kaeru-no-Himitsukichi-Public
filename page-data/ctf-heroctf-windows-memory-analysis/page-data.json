{"componentChunkName":"component---src-templates-post-template-js","path":"/ctf-heroctf-windows-memory-analysis","result":{"data":{"markdownRemark":{"id":"47c66ddd-d42f-57a7-b297-b7fd996d3d03","html":"<p>先日参加した Hero CTF 2023 で出題された Forensic の問題である「Windows Stands for Loser」をテーマに、Volatility を使った Windows メモリダンプの解析手法について学んだことを書いていきます。</p>\n<p>他の問題の Writeup は以下です。</p>\n<p>参考：<a href=\"/ctf-heroctf-2023\">Hero CTF 2023 Writeup - かえるのひみつきち</a></p>\n<!-- omit in toc -->\n<h2 id=\"windows-stands-for-loserforensic\" style=\"position:relative;\"><a href=\"#windows-stands-for-loserforensic\" aria-label=\"windows stands for loserforensic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows Stands for Loser(Forensic)</h2>\n<blockquote>\n<p>This time, no realistic context, we just need you to find the commands that were executed and the time. (we don’t talk about windows commands here :p) (time to find : UTC+2)\nFormat: Hero{secret:dd/mm/YYYY-hh:mm:ss}\nAuthor: Malon</p>\n</blockquote>\n<p>問題バイナリとして与えられた memdump.mem を strings コマンドで参照してみると、どうやら Windows マシンのメモリダンプのようなものであることが読み取れます。</p>\n<p>ただし、WinDbg で参照できるクラッシュダンプ形式のファイルではありませんでした。(たぶん FTK Imager で取得したファイルかも？)</p>\n<p>とりあえずどのような情報が含まれているのかを確認するため、Volatility3 のオプションをいくつか試しつつ、問題を解いていくことにします。</p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li>\n<p><a href=\"#volatility3-%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8Bwindows\">Volatility3 のコマンドを実行する(Windows)</a></p>\n<ul>\n<li><a href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%8B%E3%82%89-os-%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\">メモリから OS 情報を取得する</a></li>\n<li><a href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%8B%E3%82%89%E7%AB%AF%E6%9C%AB%E3%81%AE%E9%80%9A%E4%BF%A1%E7%8A%B6%E6%B3%81%E3%82%92%E8%AA%BF%E6%9F%BB%E3%81%99%E3%82%8B\">メモリから端末の通信状況を調査する</a></li>\n<li><a href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%8B%E3%82%89%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E4%B8%80%E8%A6%A7%E3%81%A8%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\">メモリからプロセスの一覧とコマンドラインを取得する</a></li>\n<li><a href=\"#%E7%89%B9%E5%AE%9A%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E9%A0%98%E5%9F%9F%E5%85%A8%E4%BD%93%E3%82%92%E3%83%80%E3%83%B3%E3%83%97%E3%81%99%E3%82%8B\">特定のプロセスのメモリ領域全体をダンプする</a></li>\n<li><a href=\"#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\">プロセスからイメージファイルを取得する</a></li>\n<li><a href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%8B%E3%82%89%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E5%8F%8E%E9%9B%86%E3%81%99%E3%82%8B\">メモリからファイルオブジェクトを収集する</a></li>\n<li><a href=\"#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AB%E3%83%AD%E3%83%BC%E3%83%89%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B-dll-%E3%81%AE%E4%B8%80%E8%A6%A7%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\">プロセスにロードされている DLL の一覧を取得する</a></li>\n<li><a href=\"#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AB%E3%82%92%E5%88%97%E6%8C%99%E3%81%99%E3%82%8B\">オブジェクトハンドルを列挙する</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#volshell3-%E3%81%A7%E5%AF%BE%E8%A9%B1%E7%9A%84%E3%81%AB%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\">Volshell3 で対話的にメモリを解析する</a></p>\n<ul>\n<li><a href=\"#eprocess-%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B\">EPROCESS にアクセスする</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%95%8F%E9%A1%8C%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\">問題ファイルを解析する</a></p>\n<ul>\n<li><a href=\"#wsl-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E8%AA%BF%E6%9F%BB%E3%81%99%E3%82%8B\">WSL のプロセスを調査する</a></li>\n<li><a href=\"#bash-%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%92%E6%89%8B%E5%8B%95%E3%81%A7%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\">bash プロセスのメモリを手動で解析する</a></li>\n<li><a href=\"#volshell-%E3%81%A7%E4%BB%AE%E6%83%B3%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%81%8B%E3%82%89%E5%80%A4%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\">Volshell で仮想アドレスから値を取得する</a></li>\n</ul>\n</li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n</ul>\n<h2 id=\"volatility3-のコマンドを実行するwindows\" style=\"position:relative;\"><a href=\"#volatility3-%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8Bwindows\" aria-label=\"volatility3 のコマンドを実行するwindows permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Volatility3 のコマンドを実行する(Windows)</h2>\n<p>とりあえずいくつかの基本的なコマンドを実行してメモリの情報を参照してみます。</p>\n<p>今回使用しているコマンドはすべて Windows のメモリダンプを解析するためのコマンドです。</p>\n<p>Linux などのメモリ内から情報を収集する場合は、<a href=\"https://volatility3.readthedocs.io/en/latest/getting-started-linux-tutorial.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Linux Tutorial</a> にあるような専用のコマンドを使用します。</p>\n<h3 id=\"メモリから-os-情報を取得する\" style=\"position:relative;\"><a href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%8B%E3%82%89-os-%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\" aria-label=\"メモリから os 情報を取得する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>メモリから OS 情報を取得する</h3>\n<p>以下のコマンドで OS の情報を調べることができます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">vol3 -f memdump.mem windows.info.Info</code></pre></div>\n<p>出力結果は以下のようになりました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c99569f53a8bcdb6055854354239b7ee/c45c7/image-20230521214224535.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAArUlEQVQoz6WRSwuDMBCEc/YR4yM+iookIpqe/P8/bsospLSXgvbwsbDZzE4map5nLMuCvu9hjEHTNKjrGkVRIEmSS6RpCkWxcRwxTRO6rkNVVSIasdZ+EXtt2wq8w0oTeZ5DresqTYryQGst7lh/wZlP2MuyDOo4DjjnEEJAWZZi+x/Uvu9gjoTPpW1uuos6zxPbtsF7L9nEgOMAt14SDM8A5504HB7D+5fviJEXSBKm+Waff4YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c99569f53a8bcdb6055854354239b7ee/8ac56/image-20230521214224535.webp 240w,\n/static/c99569f53a8bcdb6055854354239b7ee/d3be9/image-20230521214224535.webp 480w,\n/static/c99569f53a8bcdb6055854354239b7ee/e46b2/image-20230521214224535.webp 960w,\n/static/c99569f53a8bcdb6055854354239b7ee/16abe/image-20230521214224535.webp 1346w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c99569f53a8bcdb6055854354239b7ee/8ff5a/image-20230521214224535.png 240w,\n/static/c99569f53a8bcdb6055854354239b7ee/e85cb/image-20230521214224535.png 480w,\n/static/c99569f53a8bcdb6055854354239b7ee/d9199/image-20230521214224535.png 960w,\n/static/c99569f53a8bcdb6055854354239b7ee/c45c7/image-20230521214224535.png 1346w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c99569f53a8bcdb6055854354239b7ee/d9199/image-20230521214224535.png\"\n            alt=\"image-20230521214224535\"\n            title=\"image-20230521214224535\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>NtMajorVersion が 10 なので OS は Windows 10 だということがわかります。</p>\n<p>また、Minor Version が 19041 なので Windows 10 の 20H1 に該当することがわかります。</p>\n<h3 id=\"メモリから端末の通信状況を調査する\" style=\"position:relative;\"><a href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%8B%E3%82%89%E7%AB%AF%E6%9C%AB%E3%81%AE%E9%80%9A%E4%BF%A1%E7%8A%B6%E6%B3%81%E3%82%92%E8%AA%BF%E6%9F%BB%E3%81%99%E3%82%8B\" aria-label=\"メモリから端末の通信状況を調査する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>メモリから端末の通信状況を調査する</h3>\n<p>以下のコマンドでメモリから端末の通信状況を調査できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">vol3 -f memdump.mem windows.netstat.NetStat\nvol3 -f memdump.mem windows.netscan.NetScan</code></pre></div>\n<p>出力は、Netstat コマンドを実行した場合と似たような形式で行われます。</p>\n<p>この時 <code class=\"language-text\">Offset(V)</code> 列に記録されるアドレスは、そのプロセスの EPROCESS 構造体のアドレスに一致します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f3b1ab8ec24395280a12ae797a958811/0b79a/image-20230521214710883.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVQoz2WSW4+CQAyFeUMSMEFUBOQiyB0JGPn/P62br8mwa/ahYeb09PS0g1XXtbRtK0mSSBRF8ng8JI5jybJMfN+Xy+UiQRDo+XQ66Zf7+XwWz/O+4ng8ilVVlTyfzz0QpwlnhMMw1GbmfLvdtDFxvV4V4wxOE+v1ekme5xoUQSqKQmgEBqlpGg2KwMdxVLzrOsXRwIRt22K9328py3IXQBR3kMFoMAyDOidHIQI4Q7jve1mWRfOHw+FXkGBv2DeCYOyQIrMCCud5VkEa/RNc13V3+FcQMjgOccJoJscdHDF4mMLAlyB7M4K8NONDppAxacjjkJumSXl8zQPCdxxHrM/ns+8PUQTML8QYYGmayv1+Vx7NzSNs26Y5nLmuq/EDBGbZ87PoPwgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f3b1ab8ec24395280a12ae797a958811/8ac56/image-20230521214710883.webp 240w,\n/static/f3b1ab8ec24395280a12ae797a958811/d3be9/image-20230521214710883.webp 480w,\n/static/f3b1ab8ec24395280a12ae797a958811/e46b2/image-20230521214710883.webp 960w,\n/static/f3b1ab8ec24395280a12ae797a958811/d6e92/image-20230521214710883.webp 1331w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f3b1ab8ec24395280a12ae797a958811/8ff5a/image-20230521214710883.png 240w,\n/static/f3b1ab8ec24395280a12ae797a958811/e85cb/image-20230521214710883.png 480w,\n/static/f3b1ab8ec24395280a12ae797a958811/d9199/image-20230521214710883.png 960w,\n/static/f3b1ab8ec24395280a12ae797a958811/0b79a/image-20230521214710883.png 1331w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f3b1ab8ec24395280a12ae797a958811/d9199/image-20230521214710883.png\"\n            alt=\"image-20230521214710883\"\n            title=\"image-20230521214710883\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>特に気になる点としては 192.229.221.95 の 80 番ポートに UWP アプリのコンテナとして動作する WWAHost.exe が接続している点ですが、一旦保留します。</p>\n<p>また、NetScan プラグインを使用した出力は以下のようになりました。</p>\n<p>ほぼ同じような出力結果ですが、NetScan の方が <a href=\"https://www.sciencedirect.com/science/article/pii/S1742287616000062\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Pool tag quick scanning</a>という手法を使用しており、カーネルのメモリ空間から隠蔽された情報も含めて収集できるようになるようです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e72f6ad2f97fd42795c94e52cc07502d/d5c6f/image-20230521215535469.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.75000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYElEQVQoz22SWY+CQBCEeVQgGvACAQ9EblTiwf//Zb35etOb3WQfOjPDVFVX9eAURSHU6XSSIAjkcDhIFEWSJIlst1tZLpey2WxksVjoPWcqDEM9e56nNZ/PtZyqqlQEASpNUy1EWbMsU2FWa3I8HuVyuch+v5c8z7UhtdvtxPl8PtI0jQLKspQ4jpX8uyA+Hg9tQJq2bRULD0EM0QSu83w+BZdEBgwAERzSETIr94hABNN1nZ7v97sK/UR+v99S17UCLQqCRMARDZkXJBwhfL1eZRgG5dFwvV6L67ri+744r9dLLywagpBXq5XOjKjs+QbOkvR9r2fS/SuIO4A2FyLb7CDQELJFvt1ucj6fZZomxc1ms29Bi2xzY89KTByO46h7SNyxIoQgaeDbDFWQVzaHiPJiAHgIZohja4YQ98zQBOH/EaQDJIAQIeGCR8Ehr8i/hziRwSDEd6IjCN4EvwByug7KhZo1bAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e72f6ad2f97fd42795c94e52cc07502d/8ac56/image-20230521215535469.webp 240w,\n/static/e72f6ad2f97fd42795c94e52cc07502d/d3be9/image-20230521215535469.webp 480w,\n/static/e72f6ad2f97fd42795c94e52cc07502d/e46b2/image-20230521215535469.webp 960w,\n/static/e72f6ad2f97fd42795c94e52cc07502d/8f19f/image-20230521215535469.webp 1261w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e72f6ad2f97fd42795c94e52cc07502d/8ff5a/image-20230521215535469.png 240w,\n/static/e72f6ad2f97fd42795c94e52cc07502d/e85cb/image-20230521215535469.png 480w,\n/static/e72f6ad2f97fd42795c94e52cc07502d/d9199/image-20230521215535469.png 960w,\n/static/e72f6ad2f97fd42795c94e52cc07502d/d5c6f/image-20230521215535469.png 1261w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e72f6ad2f97fd42795c94e52cc07502d/d9199/image-20230521215535469.png\"\n            alt=\"image-20230521215535469\"\n            title=\"image-20230521215535469\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"メモリからプロセスの一覧とコマンドラインを取得する\" style=\"position:relative;\"><a href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%8B%E3%82%89%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E4%B8%80%E8%A6%A7%E3%81%A8%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\" aria-label=\"メモリからプロセスの一覧とコマンドラインを取得する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>メモリからプロセスの一覧とコマンドラインを取得する</h3>\n<p>以下のコマンドでメモリからプロセスの一覧を取得できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">vol3 -f memdump.mem windows.pslist.PsList\nvol3 -f memdump.mem windows.psscan.PsScan</code></pre></div>\n<p>出力結果は以下のようになりました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fbd8296bf30019f116f188882737b2e2/c23ad/image-20230521213729449.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWUlEQVQoz32S246CQBBEeQRULkYUUS4OKkRQiTFR///DWk8bzLK78WHSZKg6XT0zVlalYvZ7yYtS4jiWzcZIlmWvupE0TWU+n0sYhjKZTHR5nie+78t4PNZv1mg0kiAI9NsK/VCS5VKMeQPKstQKBBhN1uu1rFYrbZTnuex2O91bvnz9QofHCsJAAVVVa+fj8Sj3+12Ntm2raDabSVEUst1u9T/1er2+PJVEUaR+9vFb0Onctq0mappGbrebAlzXVSCjfAOS9nw+69gWUQEiZCzAv4F0JjHHgY56uVwGQPYVSEIiA0qSZADksKfT6Qf4M+FXIAkZFRNAfpK8B2IyxigAXV3XqmMPHZXUnzMkIcLFYiGHw0ETAncc59+EmLuuGyQ8nU7vhP1zQAiQzo/H4w+QI+C5YKQyMkm5SAJ9LgUIKRHxPPoUNOJS+gfbN0ZHBcbjx4OftDR+ArGxDXXO3KyPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fbd8296bf30019f116f188882737b2e2/8ac56/image-20230521213729449.webp 240w,\n/static/fbd8296bf30019f116f188882737b2e2/d3be9/image-20230521213729449.webp 480w,\n/static/fbd8296bf30019f116f188882737b2e2/e46b2/image-20230521213729449.webp 960w,\n/static/fbd8296bf30019f116f188882737b2e2/1d5af/image-20230521213729449.webp 1193w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fbd8296bf30019f116f188882737b2e2/8ff5a/image-20230521213729449.png 240w,\n/static/fbd8296bf30019f116f188882737b2e2/e85cb/image-20230521213729449.png 480w,\n/static/fbd8296bf30019f116f188882737b2e2/d9199/image-20230521213729449.png 960w,\n/static/fbd8296bf30019f116f188882737b2e2/c23ad/image-20230521213729449.png 1193w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fbd8296bf30019f116f188882737b2e2/d9199/image-20230521213729449.png\"\n            alt=\"image-20230521213729449\"\n            title=\"image-20230521213729449\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>何か既定のプログラム以外のプロセスや見慣れないプロセスがないか探してみると、以下のようなプロセスが見つかりました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token number\">5768</span>    <span class=\"token number\">1464</span>    ubuntu2204.exe\n<span class=\"token number\">8888</span>    <span class=\"token number\">5128</span>    <span class=\"token function\">bash</span>\n<span class=\"token number\">5464</span>    <span class=\"token number\">8020</span>    FTK Imager.exe</code></pre></div>\n<p><code class=\"language-text\">FTK Imager</code>は良いとして、WSL が稼働している環境だということがわかります。</p>\n<p>また、PsScan プラグインでも同等の出力を得ることができます。</p>\n<p>プロセスの情報をツリー形式で表示できる PsTree プラグインというのもあるようです。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">vol3 -f memdump.mem windows.pstree.PsTree</code></pre></div>\n<p>以下のような情報を取得できました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/738f986db8428225d32c8548196b27fc/6edca/image-20230521220046786.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABU0lEQVQoz12S2ZKCMBBF84qiCCqgbIqKsoNFlf7/j/XU6ak8zDx0BZLbd+nEZFkmaZrK5XKRJEn0O4oiCcNQTqeTrofDQYIgkOPxqGfb7Vb2+724rvun1uu1mPP5LLvdTqqqUtLX6yXTNEkcx+J5nq55nsv9fpemaaRtW+m6TujzfV9Wq5USUZCa6/WqTc/nU3D7eDzk8/moO8CI0Xy73ZQQwXme9Ry3m81GMZCBNxARtSxLBfM/DIPUda0RaWDFJXuQ9n2vWPoQoxDAsSEKShwSh0Ncf79fJUHVkuISUlIsy6LJ+MYMQuANs4OM+UFIAaCZBoaPOnvWPSYoLgwhnNnYhkYbhxnaJsAMGjCCOAFDVCKTiiT0coa44zi/DouiUBJ7KcTFMYo8EcaAI26XaMTleSHKOHgNrPpsIEAFINFw/H6/1ZUltJGtw3EcVYRx/H82P4Uw79Gi7uBBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/738f986db8428225d32c8548196b27fc/8ac56/image-20230521220046786.webp 240w,\n/static/738f986db8428225d32c8548196b27fc/d3be9/image-20230521220046786.webp 480w,\n/static/738f986db8428225d32c8548196b27fc/e46b2/image-20230521220046786.webp 960w,\n/static/738f986db8428225d32c8548196b27fc/2d20a/image-20230521220046786.webp 1351w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/738f986db8428225d32c8548196b27fc/8ff5a/image-20230521220046786.png 240w,\n/static/738f986db8428225d32c8548196b27fc/e85cb/image-20230521220046786.png 480w,\n/static/738f986db8428225d32c8548196b27fc/d9199/image-20230521220046786.png 960w,\n/static/738f986db8428225d32c8548196b27fc/6edca/image-20230521220046786.png 1351w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/738f986db8428225d32c8548196b27fc/d9199/image-20230521220046786.png\"\n            alt=\"image-20230521220046786\"\n            title=\"image-20230521220046786\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>さらに、メモリからシステム内で実行されているプロセスのコマンドライン情報を収集することもできます。</p>\n<p>コマンドラインは以下のコマンドで列挙できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">vol3 -f memdump.mem windows.cmdline.CmdLine</code></pre></div>\n<p>出力結果もかなり読みやすいです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3affdffc5fc8aef109d5dc799f965025/1b19f/image-20230521223144899.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVQoz22S167CMBBE/YZogdAJJPQWSmgP+f8fm6uz0qIg7sPIm3g9ntlxyPNc6/Vau91Om81G/X5fnU5Hg8HAMBwO7V+9Xlej0TA0m01Dq9X6QeDQZDIx0vl8/iGZTqcaj8cajUZfNWi320boF1QRIFssFjqfz4rjWPv9Xq/XS0VR6Ha76Xq96nA4aLlcmgPWLMuMuNvtqtfr2TlWnASaUAch5NvtVo/HQ8fj0Yj4Zh+FKAfUgH7gNU6McLVa6XK5mGUI7vf7Fxn7s9nsQ1S177WTBuxiAXtJklj9fD5FWJC6TeZWq9W+wvl3hqgCkECWpqne77fNEIWuwMNj9VBYf1KGBDsMH4WA+nQ6GQgJy/QxV3p5VgSC2mraRuipYRn7qOUg7xIyVNIDEfPkHwGyEgIJ+wwhD1h0Vf7m3DKoPhvmysW+B1DPPpdAGlCCMt4exCgpy9Jmyj8Sp5lwIAM4cJWchZSzURTpD4yEJEs958PaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3affdffc5fc8aef109d5dc799f965025/8ac56/image-20230521223144899.webp 240w,\n/static/3affdffc5fc8aef109d5dc799f965025/d3be9/image-20230521223144899.webp 480w,\n/static/3affdffc5fc8aef109d5dc799f965025/e46b2/image-20230521223144899.webp 960w,\n/static/3affdffc5fc8aef109d5dc799f965025/5e0bb/image-20230521223144899.webp 991w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3affdffc5fc8aef109d5dc799f965025/8ff5a/image-20230521223144899.png 240w,\n/static/3affdffc5fc8aef109d5dc799f965025/e85cb/image-20230521223144899.png 480w,\n/static/3affdffc5fc8aef109d5dc799f965025/d9199/image-20230521223144899.png 960w,\n/static/3affdffc5fc8aef109d5dc799f965025/1b19f/image-20230521223144899.png 991w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3affdffc5fc8aef109d5dc799f965025/d9199/image-20230521223144899.png\"\n            alt=\"image-20230521223144899\"\n            title=\"image-20230521223144899\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"特定のプロセスのメモリ領域全体をダンプする\" style=\"position:relative;\"><a href=\"#%E7%89%B9%E5%AE%9A%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E9%A0%98%E5%9F%9F%E5%85%A8%E4%BD%93%E3%82%92%E3%83%80%E3%83%B3%E3%83%97%E3%81%99%E3%82%8B\" aria-label=\"特定のプロセスのメモリ領域全体をダンプする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>特定のプロセスのメモリ領域全体をダンプする</h3>\n<p>また、以下のコマンドでプロセスのメモリ全体のダンプも取得できます。</p>\n<p>※ メモリのサイズによっては出力には少し時間がかかります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># vol3 -o &lt;出力先のパス> -f memdump.mem windows.memmap --dump --pid &lt;PID></span>\nvol3 -o /tmp -f memdump.mem windows.memmap --dump --pid <span class=\"token number\">1000</span></code></pre></div>\n<h3 id=\"プロセスからイメージファイルを取得する\" style=\"position:relative;\"><a href=\"#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\" aria-label=\"プロセスからイメージファイルを取得する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>プロセスからイメージファイルを取得する</h3>\n<p>PsList プラグインでは、プロセスの列挙だけでなくプロセスのイメージファイルの取得が可能です。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># vol3 -o &lt;出力先のディレクトリ> -f memdump.mem windows.pslist.PsList --pid &lt;プロセスの PID> --dump</span>\nvol3 -o /tmp -f memdump.mem windows.pslist.PsList --pid <span class=\"token number\">6724</span> --dump</code></pre></div>\n<p>上記のコマンドを実行すると、以下のように指定したプロセスをダンプできます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c27e3362f1a40b66d34baaef2a4c57ba/cad6c/image-20230521222656884.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXklEQVQI1z1NWQoAIRTqv6ioaKGF6v53dPBB8yHigqreO3LOmHOi1opSCsYYiDEKUkowxsB7D+ccQgjCWus/s9aKT1YcpLj34pyDd0DvDVK31uSUOQ/XWn+Pnb23ZB9/3TIXmVYfWAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c27e3362f1a40b66d34baaef2a4c57ba/8ac56/image-20230521222656884.webp 240w,\n/static/c27e3362f1a40b66d34baaef2a4c57ba/d3be9/image-20230521222656884.webp 480w,\n/static/c27e3362f1a40b66d34baaef2a4c57ba/e46b2/image-20230521222656884.webp 960w,\n/static/c27e3362f1a40b66d34baaef2a4c57ba/44ab2/image-20230521222656884.webp 1339w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c27e3362f1a40b66d34baaef2a4c57ba/8ff5a/image-20230521222656884.png 240w,\n/static/c27e3362f1a40b66d34baaef2a4c57ba/e85cb/image-20230521222656884.png 480w,\n/static/c27e3362f1a40b66d34baaef2a4c57ba/d9199/image-20230521222656884.png 960w,\n/static/c27e3362f1a40b66d34baaef2a4c57ba/cad6c/image-20230521222656884.png 1339w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c27e3362f1a40b66d34baaef2a4c57ba/d9199/image-20230521222656884.png\"\n            alt=\"image-20230521222656884\"\n            title=\"image-20230521222656884\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>※ 拡張子は .dmp として表示されていますが、実際には PE としてダンプできます。</p>\n<h3 id=\"メモリからファイルオブジェクトを収集する\" style=\"position:relative;\"><a href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%8B%E3%82%89%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E5%8F%8E%E9%9B%86%E3%81%99%E3%82%8B\" aria-label=\"メモリからファイルオブジェクトを収集する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>メモリからファイルオブジェクトを収集する</h3>\n<p>以下のコマンドでメモリからファイルオブジェクトのアドレスとフルパスを取得できます。</p>\n<p>出力結果は非常に大きくなります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">vol3 -f memdump.mem windows.filescan.FileScan</code></pre></div>\n<p>今回の問題メモリの場合、jane というユーザフォルダの配下にある WSL 内のファイルのパスを特定することができます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/aa440/image-20230521220421822.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.499999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAq0lEQVQY01WQWwqFMAxE3YEfWhW0vvGJuv/VzeUEIt6P4SRpM0mb7PuuZVkEp2lSXdcqikIhBJVlaSTP81xVVb1nXoecZVmmNE2VPM+j8zx137dxHEcz7rpOfd+rbVuLm6bRMAyWoxjjSwYhTBNM1nWVExNvxOhryDDibx1R9+G2Ic+F13Vp2zYdx/GKnC+h0enCxA0h2/5tSDOH8zzbs51sTIPHyL/mG3PnBxJzict+baSsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/8ac56/image-20230521220421822.webp 240w,\n/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/d3be9/image-20230521220421822.webp 480w,\n/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/e46b2/image-20230521220421822.webp 960w,\n/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/f992d/image-20230521220421822.webp 1440w,\n/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/293e0/image-20230521220421822.webp 1500w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/8ff5a/image-20230521220421822.png 240w,\n/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/e85cb/image-20230521220421822.png 480w,\n/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/d9199/image-20230521220421822.png 960w,\n/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/07a9c/image-20230521220421822.png 1440w,\n/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/aa440/image-20230521220421822.png 1500w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/87dbcd19b4ce12ed18e6b3c5da3f14b3/d9199/image-20230521220421822.png\"\n            alt=\"image-20230521220421822\"\n            title=\"image-20230521220421822\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>また、ここで特定したアドレスを使用して、メモリ内からファイルを取得することもできます。</p>\n<p>以下のコマンド例では、0xa38f15daa4d0 に存在する WSL 内の .bashrc ファイルを tmp ディレクトリに保存しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># vol3 -o &lt;出力先のディレクトリ> -f memdump.mem windows.dumpfiles.DumpFiles --virtaddr &lt;ファイルオブジェクトの仮想アドレス></span>\nvol3 -o /tmp -f memdump.mem windows.dumpfiles.DumpFiles --virtaddr 0xa38f15daa4d0</code></pre></div>\n<p>取得に成功すると以下のように表示されます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a4e538d2a93aa92558cf8710ce0f5bdc/d0143/image-20230521222011526.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.249999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAYUlEQVQI13WNuQoAMQgFt80BaTQHISeB/P8XvkWL7bYYxmLU596LMQbEMUYwM0opSClhrYWcM0IIMMbAWvuLcw7eezxzTl2Uo0SsPuegtYbeuyLN3vtDerG0Mtda9TER4QXPUTNczzew3wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a4e538d2a93aa92558cf8710ce0f5bdc/8ac56/image-20230521222011526.webp 240w,\n/static/a4e538d2a93aa92558cf8710ce0f5bdc/d3be9/image-20230521222011526.webp 480w,\n/static/a4e538d2a93aa92558cf8710ce0f5bdc/e46b2/image-20230521222011526.webp 960w,\n/static/a4e538d2a93aa92558cf8710ce0f5bdc/d1bdf/image-20230521222011526.webp 1025w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a4e538d2a93aa92558cf8710ce0f5bdc/8ff5a/image-20230521222011526.png 240w,\n/static/a4e538d2a93aa92558cf8710ce0f5bdc/e85cb/image-20230521222011526.png 480w,\n/static/a4e538d2a93aa92558cf8710ce0f5bdc/d9199/image-20230521222011526.png 960w,\n/static/a4e538d2a93aa92558cf8710ce0f5bdc/d0143/image-20230521222011526.png 1025w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a4e538d2a93aa92558cf8710ce0f5bdc/d9199/image-20230521222011526.png\"\n            alt=\"image-20230521222011526\"\n            title=\"image-20230521222011526\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>取得したファイルを参照してみると、実際にメモリダンプ内から .bashrc ファイルを取得できていることがわかります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 906px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e599bc9e9871c908f482ccc185e6ccc6/6029f/image-20230521222131165.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.58333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQ0lEQVQoz3WT25KCMBBEeVRUREGucsnKJSyy/v/X9dpTNZS62YeuiTE56UwHL+4jZD8pLl2E+vaNWz/B2hHTNKHveyzLgsfjgWEYYIxB13Vo2xZN04jKskRRFKiqCqfTCZ5pDGxvMY0TmrpCLaplwfV6FXFDmj4PvVykJkmCOI6x3W5Fvu9L3e12T+CXQWta5EUui3RjFEU4n88rgIs/td/v/8gjhC7yPMfxeHxb+Dl2AT/BHkFhGIorOmIfKM7p+HVO5w+Hg9OlZ63F/X7HOI5S2XT2kAfQPaW9098cE+wEMjECKI51I92ysn9sxWazWUPQAJxXZvRMUcEMgyDWLMtWhxoUnfEwF+ztyvM8C4CLNWGVQjmv8P+SFof6UPn2CNXU6ZiVIfDq/I+beGXXS1gd8gtgpUuFKVgTDYJA5Hp7r/oF8nUQPgfFokgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e599bc9e9871c908f482ccc185e6ccc6/8ac56/image-20230521222131165.webp 240w,\n/static/e599bc9e9871c908f482ccc185e6ccc6/d3be9/image-20230521222131165.webp 480w,\n/static/e599bc9e9871c908f482ccc185e6ccc6/45005/image-20230521222131165.webp 906w\"\n              sizes=\"(max-width: 906px) 100vw, 906px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e599bc9e9871c908f482ccc185e6ccc6/8ff5a/image-20230521222131165.png 240w,\n/static/e599bc9e9871c908f482ccc185e6ccc6/e85cb/image-20230521222131165.png 480w,\n/static/e599bc9e9871c908f482ccc185e6ccc6/6029f/image-20230521222131165.png 906w\"\n            sizes=\"(max-width: 906px) 100vw, 906px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e599bc9e9871c908f482ccc185e6ccc6/6029f/image-20230521222131165.png\"\n            alt=\"image-20230521222131165\"\n            title=\"image-20230521222131165\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"プロセスにロードされている-dll-の一覧を取得する\" style=\"position:relative;\"><a href=\"#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AB%E3%83%AD%E3%83%BC%E3%83%89%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B-dll-%E3%81%AE%E4%B8%80%E8%A6%A7%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\" aria-label=\"プロセスにロードされている dll の一覧を取得する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>プロセスにロードされている DLL の一覧を取得する</h3>\n<p>以下のコマンドでメモリからプロセスにロードされている DLL の一覧を取得できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">vol3 -f memdump.mem windows.dlllist.DllList</code></pre></div>\n<p>以下のようにプロセスごとにロードしている DLL の列挙が可能ですが、<code class=\"language-text\">--pid</code>オプションで PID を指定することが可能です。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9479d309ba26d2472ae4f4cb52ec12fa/252a4/image-20230521223949079.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApElEQVQY0zWPSwqAMAxEu3TtQlAEtVbrlwpK73+zkRfoYqCdZD5xIQRt22ZY11Xv++q6LqWUNM+zmqbR8zyG+76NO8/T9tlBM46jhmFQVVVyLBTDGKO+7zNDRMwQMNv3XcdxGA9HEbhSZJomtW0r5723AQ0Y5pztjRARIaTzpz2gETwBtKYAu/xd3/cqppDljGVZ1HWdJcNjCOAxQMMFgEBQ17V+bR9z/OyPTR0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9479d309ba26d2472ae4f4cb52ec12fa/8ac56/image-20230521223949079.webp 240w,\n/static/9479d309ba26d2472ae4f4cb52ec12fa/d3be9/image-20230521223949079.webp 480w,\n/static/9479d309ba26d2472ae4f4cb52ec12fa/e46b2/image-20230521223949079.webp 960w,\n/static/9479d309ba26d2472ae4f4cb52ec12fa/bf23a/image-20230521223949079.webp 1314w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9479d309ba26d2472ae4f4cb52ec12fa/8ff5a/image-20230521223949079.png 240w,\n/static/9479d309ba26d2472ae4f4cb52ec12fa/e85cb/image-20230521223949079.png 480w,\n/static/9479d309ba26d2472ae4f4cb52ec12fa/d9199/image-20230521223949079.png 960w,\n/static/9479d309ba26d2472ae4f4cb52ec12fa/252a4/image-20230521223949079.png 1314w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9479d309ba26d2472ae4f4cb52ec12fa/d9199/image-20230521223949079.png\"\n            alt=\"image-20230521223949079\"\n            title=\"image-20230521223949079\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>また、プロセスのイメージファイルをダンプしたのと同じように、<code class=\"language-text\">--dump</code>オプションを使用することでプロセスにロードされているすべての DLL ファイルをダンプすることもできます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">vol3 -o /tmp -f memdump.mem windows.dlllist.DllList --pid <span class=\"token number\">6724</span> --dump</code></pre></div>\n<p>こちらも DLL ファイルとしてエクスポートされていることがわかります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4650ce4819f6275a1866c511dbfdf3f1/a0730/image-20230521224303356.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.166666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcklEQVQI1zWMOQ7EIAAD01MgasQdQcINEv9/mlcQbeHGM/YVa8QbXzxPxJwTpRTUWrHWQmsNjDEQQqCUQs4ZYwyEEOC9P3z7MX7blBIu1SRMumHvdOAut9B7PwfOOVhrz8GfGWMgpTwRQkBrDc45KKX4AW4wOe/gzzqJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4650ce4819f6275a1866c511dbfdf3f1/8ac56/image-20230521224303356.webp 240w,\n/static/4650ce4819f6275a1866c511dbfdf3f1/d3be9/image-20230521224303356.webp 480w,\n/static/4650ce4819f6275a1866c511dbfdf3f1/e46b2/image-20230521224303356.webp 960w,\n/static/4650ce4819f6275a1866c511dbfdf3f1/bcfd3/image-20230521224303356.webp 1131w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4650ce4819f6275a1866c511dbfdf3f1/8ff5a/image-20230521224303356.png 240w,\n/static/4650ce4819f6275a1866c511dbfdf3f1/e85cb/image-20230521224303356.png 480w,\n/static/4650ce4819f6275a1866c511dbfdf3f1/d9199/image-20230521224303356.png 960w,\n/static/4650ce4819f6275a1866c511dbfdf3f1/a0730/image-20230521224303356.png 1131w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4650ce4819f6275a1866c511dbfdf3f1/d9199/image-20230521224303356.png\"\n            alt=\"image-20230521224303356\"\n            title=\"image-20230521224303356\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"オブジェクトハンドルを列挙する\" style=\"position:relative;\"><a href=\"#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AB%E3%82%92%E5%88%97%E6%8C%99%E3%81%99%E3%82%8B\" aria-label=\"オブジェクトハンドルを列挙する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>オブジェクトハンドルを列挙する</h3>\n<p>以下のコマンドでオブジェクトハンドルを列挙することができます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">vol3 -f memdump.mem windows.handles.Handles</code></pre></div>\n<h2 id=\"volshell3-で対話的にメモリを解析する\" style=\"position:relative;\"><a href=\"#volshell3-%E3%81%A7%E5%AF%BE%E8%A9%B1%E7%9A%84%E3%81%AB%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\" aria-label=\"volshell3 で対話的にメモリを解析する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Volshell3 で対話的にメモリを解析する</h2>\n<p>Volshell3 は対話的にメモリダンプを解析するためのインターフェースとして動作し、Python のインタプリタと同じように操作することができます。</p>\n<p>参考：<a href=\"https://volatility3.readthedocs.io/en/latest/volshell.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Volshell - A CLI tool for working with memory — Volatility 3 2.4.2 documentation</a></p>\n<p>Windows のメモリダンプを Volshell3 で解析する場合には以下のコマンドを実行します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">volshell3 -f memdump.mem -w</code></pre></div>\n<p><code class=\"language-text\">-w</code>オプションは既知のシンボルを利用することを指定する重要なオプションであり、このオプションを使用しないとほとんどの情報を参照することができなくなります。</p>\n<p>Volshell3 が起動すると以下のような画面になります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 523px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5f5c7b76fc65b1e85193e2d5ebdfee3f/3e286/image-20230522211054743.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWElEQVQoz21R146CUBTkRQVbWAWkSBOkiZQQ9f+/bNY5ySUkuw+X0yczgxZUPqIuRPD04VUuomeIOE+R3EcEYYqmqdF1Pdq2xfV6RZ7nqKpKcs/z4DgOTNPEbrfDfr+HNnQDpmFCkRXyxn5E+3igLHLcv8dN02AcRyRJgqIoBDDLMkRRhDAMcbvdUJalAG+3W2i6ocP8MeG6rjRdz8X5fIZtO1JfLhdhwmfbNnzfRxAEMjscDsJKPbLU+CGAAqQUHrImGAHYY+Rc1dxRMhlnyYZhyCGlUQ6XmZP+arWCruvSe3xt4Jys2F+v1+DtElAYsskD+lTXtRg+TdPM9nQ6iX/v91tm3CN7eqh8W8rWNpuN+NP3vZhOg4dhkPz1eokdaZri8/kICNXw8Yf8C2hZ1uwf/aE37FHa8XicvWHNnBZQlYp/PCRIHMfCkpGAlLlcWnq0ZKNmy/oXSTPljCP+QZAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5f5c7b76fc65b1e85193e2d5ebdfee3f/8ac56/image-20230522211054743.webp 240w,\n/static/5f5c7b76fc65b1e85193e2d5ebdfee3f/d3be9/image-20230522211054743.webp 480w,\n/static/5f5c7b76fc65b1e85193e2d5ebdfee3f/210f1/image-20230522211054743.webp 523w\"\n              sizes=\"(max-width: 523px) 100vw, 523px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5f5c7b76fc65b1e85193e2d5ebdfee3f/8ff5a/image-20230522211054743.png 240w,\n/static/5f5c7b76fc65b1e85193e2d5ebdfee3f/e85cb/image-20230522211054743.png 480w,\n/static/5f5c7b76fc65b1e85193e2d5ebdfee3f/3e286/image-20230522211054743.png 523w\"\n            sizes=\"(max-width: 523px) 100vw, 523px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5f5c7b76fc65b1e85193e2d5ebdfee3f/3e286/image-20230522211054743.png\"\n            alt=\"image-20230522211054743\"\n            title=\"image-20230522211054743\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"eprocess-にアクセスする\" style=\"position:relative;\"><a href=\"#eprocess-%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B\" aria-label=\"eprocess にアクセスする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EPROCESS にアクセスする</h3>\n<p>例えば以下のコマンドを実行すると、メモリ内の EPROCESS 構造体の情報を列挙できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">proc <span class=\"token operator\">=</span> ps<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">p</span> <span class=\"token keyword\">in</span> proc:\n\tprint<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span></code></pre></div>\n<p>出力結果は以下のようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 696px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/73a9602291aa6ac2522b7e247ac9f6c3/82158/image-20230522211220844.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZ0lEQVQoz12SW4+CQAyFeRRUICTGSOQmXlBUQLlEY2L0//+nmq+bMbv70HSmPT1zTsHabrdSlqVEUSRZlkme55IkiWw2G/E8TyaTicZ0OhXXdb9nU/8fVhAEsl6vZbVayXw+F9/3lWg2mylgNBqJ4zhi2/afoG7C1MbjsVj7/V7iOJaiKCRNU1UJOSpRi/rFYqE10yMOh4MwSx83OEWI1fe9Xo7Ho2aAkO92O63RNw/SJzg3TSPX61XatlVSsEpIAQBNyE6nk1RVpQCAXdep2vP5/K2RwYMjc6evhM/nU0G3202Ll8tFw4DpYxFF1AjO9/tdZ+gjiofZv0WTj4I6MlaxxV7YEeTL5VJr9AnOOCGYxyFY/gILFZAwCKmRj2ruvM4Of9fIEDFjLEOult/vt4KxQDaLZgAb9PnaDNd1/SV6PB5q9/V6KW4Yhh/LyGXpqGQQO+YX4U4/DEO1Ss38WuCxCd5gsfwBRNEeolVWAAIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/73a9602291aa6ac2522b7e247ac9f6c3/8ac56/image-20230522211220844.webp 240w,\n/static/73a9602291aa6ac2522b7e247ac9f6c3/d3be9/image-20230522211220844.webp 480w,\n/static/73a9602291aa6ac2522b7e247ac9f6c3/038cb/image-20230522211220844.webp 696w\"\n              sizes=\"(max-width: 696px) 100vw, 696px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/73a9602291aa6ac2522b7e247ac9f6c3/8ff5a/image-20230522211220844.png 240w,\n/static/73a9602291aa6ac2522b7e247ac9f6c3/e85cb/image-20230522211220844.png 480w,\n/static/73a9602291aa6ac2522b7e247ac9f6c3/82158/image-20230522211220844.png 696w\"\n            sizes=\"(max-width: 696px) 100vw, 696px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/73a9602291aa6ac2522b7e247ac9f6c3/82158/image-20230522211220844.png\"\n            alt=\"image-20230522211220844\"\n            title=\"image-20230522211220844\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>また、Volshell3 では dt コマンドを使用できます。</p>\n<p>これは、WinDbg の dt コマンドとほぼ同等の働きをします。</p>\n<p>そのため、例えば以下のようなコマンドを実行することで構造体のオフセットを表示したり、特定の EPROCESS 構造体の中身を列挙できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># EPROCESS 構造体の情報を列挙</span>\ndt<span class=\"token punctuation\">(</span><span class=\"token string\">'_EPROCESS'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># ps()[0] で取得した EPROCESS の情報を列挙</span>\nproc <span class=\"token operator\">=</span> ps<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\ndt<span class=\"token punctuation\">(</span>proc<span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"問題ファイルを解析する\" style=\"position:relative;\"><a href=\"#%E5%95%8F%E9%A1%8C%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\" aria-label=\"問題ファイルを解析する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>問題ファイルを解析する</h2>\n<p>Volatility を使ってシステムの基本的な情報を把握できたので、CTF の問題を解き進めていきます。</p>\n<p>今回の問題では、メモリ内から何らかのコマンドとそのコマンドが実行された時刻が Flag になるようです。</p>\n<p>しかし、CmdLine プラグインで列挙した情報からは、Flag になりそうなものはありませんでした。</p>\n<p>そこで、システム内で実行されている WSL のプロセスに着目します。</p>\n<p>Writeup で引用されている以下のページを見ると、WSL の bash プロセスの場合も、通常の Linux と同じコマンドを使用してメモリ内の情報を探索できるようです。</p>\n<p>参考：<a href=\"https://www.sciencedirect.com/science/article/pii/S1742287618301944\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Memory forensics and the Windows Subsystem for Linux - ScienceDirect</a></p>\n<p>また、Volatility の linux_bash は bash プロセスのヒープをスキャンすることで、コマンドの実行履歴を簡単に探索できるようです。</p>\n<p>参考：<a href=\"https://volatility-labs.blogspot.com/2013/05/movp-ii-33-automated-linuxandroid-bash.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Volatility Labs: MoVP II - 3.3 - Automated Linux/Android Bash History Scanning</a></p>\n<p>参考：<a href=\"https://volatility3.readthedocs.io/en/latest/getting-started-linux-tutorial.html#linux-bash\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Linux Tutorial — Volatility 3 2.4.2 documentation</a></p>\n<p>つまり、WSL で稼働している bash プロセスに対して linux_bash プラグインの探索をかけることができれば実行されたコマンドを特定できそうです。</p>\n<h3 id=\"wsl-のプロセスを調査する\" style=\"position:relative;\"><a href=\"#wsl-%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E8%AA%BF%E6%9F%BB%E3%81%99%E3%82%8B\" aria-label=\"wsl のプロセスを調査する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WSL のプロセスを調査する</h3>\n<p>冒頭に Info プラグインで確認した通り、このシステムのビルドは 20H1  なので、稼働している WSL のバージョンは 1 であることがわかります。</p>\n<p>インサイド Windows の上巻に記載のある通り、WSL1 では、Lxss.sys と Lxcore.sys という PICO プロバイダ(PsRegisterPicoProvider API を使用してカーネルインターフェースへのアクセスを得るカーネルドライバ) によって提供されたインターフェースを使用します。</p>\n<p>Pico プロバイダの下で実行されるプロセスは Pico プロセスとして管理されます。</p>\n<p>WSL の Pico プロバイダ下で提供されるプロセスのメモリには Linux の vDSO(Virtual Dynamic Shared Object) に近しい構造体が書き込まれます。</p>\n<p>参考：<a href=\"https://qiita.com/akachochin/items/d5d1ba84fefae2f781f3\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">VDSO(arm)の実装をちょっと調べてみました - Qiita</a></p>\n<p>以下の画像のように WSL の /bin/bash は Pico プロバイダによって管理される Pico プロセスとして動作します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 775px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1d35da6d6ab6a90327aadfbaf89d232a/0098c/image-20230522220013888.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABS0lEQVQoz31SwWrCQBDN//+BRbAnexHMwdKkniwWLGoRrLtJql4sRoMJojEabXydGZRCDD547DC783bm7Rrn8xl5MiS+rHkU5a4wipL5gjiOEQQBVqsVjsfjXVFju90iiiLh4XCQIqWUUGuNNE0xnUzw0emg3+thNpv9T1BA473dhlmv47nRwNdwCIdEarUaTNPEq23Dn8/R7XZhWRasFwtDOnMPxm63w5UpdRhSh1ppEf/2POz3eywWC3gUM4PlElmWIabJNpuN7P+eTjgROS+CSUK8iLJXSypyHQe+78uIvI7HY0ynE7FkvV7LJT+0F4WheMzWcUM3j8Jd9D/70I6G4zoYqRFcz5V4MBhAaSWFDO7oZuS8qXwoSRK8tVqwyUPTrKPZbMImD0PqJi908yhF34V9eapWUS6X8VipCB9KJbFCzpFg0b9l/AGpYaccFjHh5wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1d35da6d6ab6a90327aadfbaf89d232a/8ac56/image-20230522220013888.webp 240w,\n/static/1d35da6d6ab6a90327aadfbaf89d232a/d3be9/image-20230522220013888.webp 480w,\n/static/1d35da6d6ab6a90327aadfbaf89d232a/05e2a/image-20230522220013888.webp 775w\"\n              sizes=\"(max-width: 775px) 100vw, 775px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1d35da6d6ab6a90327aadfbaf89d232a/8ff5a/image-20230522220013888.png 240w,\n/static/1d35da6d6ab6a90327aadfbaf89d232a/e85cb/image-20230522220013888.png 480w,\n/static/1d35da6d6ab6a90327aadfbaf89d232a/0098c/image-20230522220013888.png 775w\"\n            sizes=\"(max-width: 775px) 100vw, 775px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1d35da6d6ab6a90327aadfbaf89d232a/0098c/image-20230522220013888.png\"\n            alt=\"image-20230522220013888\"\n            title=\"image-20230522220013888\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>引用元：インサイド Windows 第 7 版 (上)</p>\n<p>Pico プロバイダは Pico プロセスやスレッドの作成および終了を行う関数を持つとともに、Pico スレッドの syscall や例外が発生したときのコールバックを受け取ります。</p>\n<p>そのため、Pico プロバイダ下で実行される Pico プロセスはカプセル化され、以下のようにラップされます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 871px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/751b9cbcf95b0a539c6d4291457eba0a/9d5da/image-20230522220328415.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGklEQVQoz4VTaU8aURTl/9cP9os0kdZYdYSmyD6gwqgJgy2Lw+YMyyzVDw5ESCSVZcJyeu9DtMuHTnLy3n3Leffec8YH+haLBWzbRtfsol6vodUyYFkWej0XzWYDtVqVUBN7Bu3d399BVfPIKTmcnZ9BURTkKR6NRvCtVivmxOXVJb6ehCGnZcSTCYQjJ+KRVqf9B0zbEqR8JhqPCcQScREPBoM3wisiDBNh+jSDBG0y7igT0zIFyQb2DwftdhspepghZ9Kv8+FwCB+TzedzhL6EcCQdCVIpeIy9vU/odjuCpEukG6wJW0jJMpJyShDxyHgl5C9DLwU+BnBweID9z/vwf/BT/5qwHfv/hOm/CJckSjZ7jkQqiTj1I0ljJBqBYZA4RPh7lpuS5fRbqf+UzCpzidvvt7Eb2MWOfwdbW+9QqVQEiUFi8Nh6GXX9FtFYFBECJxF5mQtRNiU3Gg2Uy2VhgWLxO81L6LkuXMKD+yCswyK5ZKV+v0cWqqNKa9lsFpqmoUbxZDKBr9/vk+dMcdmbzVDI58Wc1ecD0+kU4/EYF/TQ4PERnudhQjFX5c08FFQVzz+fsVouxbpvSpdGT09rM1Ovrr9dU0k6HOoVC2KRFzudDtSCKvzHa47joFpdZxcKBZHL5VAqldbG5nI5mwb9EbeGLvqk08Um9Umn+Ea7QbFUhFbVUKQ2cMz7yoUiHBEkQkmShJCc6S/JKvZv0zGNGgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/751b9cbcf95b0a539c6d4291457eba0a/8ac56/image-20230522220328415.webp 240w,\n/static/751b9cbcf95b0a539c6d4291457eba0a/d3be9/image-20230522220328415.webp 480w,\n/static/751b9cbcf95b0a539c6d4291457eba0a/81b74/image-20230522220328415.webp 871w\"\n              sizes=\"(max-width: 871px) 100vw, 871px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/751b9cbcf95b0a539c6d4291457eba0a/8ff5a/image-20230522220328415.png 240w,\n/static/751b9cbcf95b0a539c6d4291457eba0a/e85cb/image-20230522220328415.png 480w,\n/static/751b9cbcf95b0a539c6d4291457eba0a/9d5da/image-20230522220328415.png 871w\"\n            sizes=\"(max-width: 871px) 100vw, 871px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/751b9cbcf95b0a539c6d4291457eba0a/9d5da/image-20230522220328415.png\"\n            alt=\"image-20230522220328415\"\n            title=\"image-20230522220328415\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>引用元：インサイド Windows 第 7 版 (上)</p>\n<p>例えば、以下のいずれかのコマンドで bash プロセスの EPROCESS 構造体の情報を列挙できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 8888 5128 bash 0xa38f11b8a080</span>\nproc <span class=\"token operator\">=</span> ps<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">p</span> <span class=\"token keyword\">in</span> proc:\n\t<span class=\"token keyword\">if</span> p.UniqueProcessId <span class=\"token operator\">==</span> <span class=\"token number\">8888</span>:\n\t\tprint<span class=\"token punctuation\">(</span>dt<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">))</span>\n\n<span class=\"token comment\"># 8888 5128 bash 0xa38f11b8a080ｆ</span>\ndt<span class=\"token punctuation\">(</span><span class=\"token string\">\"_EPROCESS\"</span>,0xa38f11b8a080<span class=\"token punctuation\">)</span></code></pre></div>\n<p>ただし、この bash プロセスは前述の通り Pico プロバイダにカプセル化されている Pico プロセスなので、PEB の情報を持ちません。</p>\n<h3 id=\"bash-プロセスのメモリを手動で解析する\" style=\"position:relative;\"><a href=\"#bash-%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%92%E6%89%8B%E5%8B%95%E3%81%A7%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\" aria-label=\"bash プロセスのメモリを手動で解析する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>bash プロセスのメモリを手動で解析する</h3>\n<p>正直ここからは自力で進めるのが完全に無理になってしまったので、Writeup の解説をなぞって進めていきます。</p>\n<p>参考：<a href=\"https://github.com/HeroCTF/HeroCTF_v5/blob/main/Forensics/Windows_Stands_For_Loser/README.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">HeroCTF<em>v5/README.md at main · HeroCTF/HeroCTF</em>v5 · GitHub</a></p>\n<p>まず、以下のコマンドで PID:8888 として稼働している bash プロセスのメモリ空間をダンプします。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">vol3 -o /tmp -f memdump.mem windows.memmap --dump --pid <span class=\"token number\">8888</span> </code></pre></div>\n<p>出力したダンプファイルに file コマンドをかけてみると、<code class=\"language-text\">glibc locale file LC_CTYPE</code>として認識されました。</p>\n<p>前述の通り、Vollatility の linux_bash プラグインを使うことで、Linux のメモリダンプからコマンドの実行履歴を抽出できます。</p>\n<p>ただし、今回抽出したのは bash プロセスのメモリ空間のみのため、単純にこのプラグインを使用することはできません。</p>\n<p>ここで、linux_bash の挙動について以下のように記載されているページがあります。</p>\n<blockquote>\n<ol>\n<li>Scan the heap of all running /bin/bash instances, or all processes period if —scan-all is supplied. The ---scan-all allows you to ignore the process name, in case an attacker copied a /bin/bash shell to /tmp/a and then entered commands. Furthermore, since we’re only scanning the heap of the process, its much quicker than a whole process address space scan.</li>\n<li>Look for # characters in heap segments. With the address in process memory for each # character, do a second scan for pointers to that address elsewhere on the heap. The goal is to find the timestamp member of the <em>hist</em>entry structure. We’re essentially linking up data with pointers to the data.</li>\n<li>With each potential timestamp, we subtract 8 bytes (since it exists at offset 8 of the structure). That should give us the base address of the <em>hist</em>entry. Now we can associate any other members of <em>hist</em>entry (in particular the line member) with the timestamp.</li>\n<li>Once the scan is finished, collect all <em>hist</em>entry structures and place them in chronological order by timestamp. Then report the results.</li>\n</ol>\n</blockquote>\n<p>参考：<a href=\"https://volatility-labs.blogspot.com/2013/05/movp-ii-33-automated-linuxandroid-bash.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Volatility Labs: MoVP II - 3.3 - Automated Linux/Android Bash History Scanning</a></p>\n<p>bash プロセスからコマンドの履歴を取得するには、まず bash のプロセス全体をスキャンしたあと、ヒープセグメント内で <code class=\"language-text\">#</code> の文字を探しだし、そこから <em>hist</em>entry 構造体のタイムスタンプを特定します。</p>\n<p><em>hist</em>entry 構造体には、入力された行のコマンドライン文字列や実行時のタイムスタンプなどが含まれます。</p>\n<p>参考：<a href=\"https://linux.die.net/man/3/history\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">history(3): GNU History Library - Linux man page</a></p>\n<p>続いて、これらのタイムスタンプのアドレスから 8 バイト引くと <em>hist</em>entry 構造体のベースアドレスを得ることができます。</p>\n<p>最後に、メモリ内のすべての <em>hist</em>entry 構造体をタイムスタンプ順に列挙してコマンドの実行履歴をメモリから収集します。</p>\n<p>あとは、出力した bash プロセスのメモリダンプから上記の手順を手動で実行していきます。</p>\n<p>まずは、プロセス全体から <code class=\"language-text\">#</code> の文字を探しだし、メモリ内の UNIX タイムスタンプを探索します。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\ni <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nmemdump <span class=\"token operator\">=</span> <span class=\"token string\">\"./pid.8888.dmp\"</span>\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>memdump<span class=\"token punctuation\">,</span> <span class=\"token string\">\"rb\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># ファイルから 1 バイトずつ探索して # が存在するか調べる</span>\n    <span class=\"token keyword\">while</span> i <span class=\"token operator\">&lt;</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>getsize<span class=\"token punctuation\">(</span>memdump<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        diese <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> diese<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">break</span>\n        <span class=\"token comment\"># '#' の文字列が見つかるまで進める</span>\n        <span class=\"token keyword\">if</span> diese <span class=\"token operator\">==</span> <span class=\"token string\">b\"\\x23\"</span><span class=\"token punctuation\">:</span>\n            one <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> \n            \n            <span class=\"token comment\"># 探索対象は UNIX タイムスタンプなので、先頭は必ず 1 になる</span>\n            <span class=\"token keyword\">if</span> one <span class=\"token operator\">==</span> <span class=\"token string\">b\"\\x31\"</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># \"1\"</span>\n                <span class=\"token comment\"># タイムスタンプが見つかったら 9 バイト分読み出してファイルに書き込みする</span>\n                next_data <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span> \n                <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./8888_extracted_info.txt\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f2<span class=\"token punctuation\">:</span>\n                    f2<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"offset: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> - #1\"</span></span><span class=\"token punctuation\">)</span>\n                    <span class=\"token keyword\">for</span> byte <span class=\"token keyword\">in</span> next_data<span class=\"token punctuation\">:</span>\n                        f2<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>byte<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n                    f2<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"\\n\"</span></span><span class=\"token punctuation\">)</span>\n                i<span class=\"token operator\">+=</span><span class=\"token number\">9</span>\n            i<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n        i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></code></pre></div>\n<p>上記のスクリプトを実行すると、ノイズは多くなりますが以下の 3 つのタイムスタンプとそのオフセット見つかりました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">offset: 0x30a100 - <span class=\"token comment\">#1683741543</span>\noffset: 0x362d30 - <span class=\"token comment\">#1683741570</span>\noffset: 0x376d10 - <span class=\"token comment\">#1683741539</span></code></pre></div>\n<p>続いて、これらのタイムスタンプのオフセットから仮想アドレスを特定の上、そのアドレスを参照しているポインタを見つけ出して <em>hist</em>entry 構造体のベースアドレスを特定します。</p>\n<p>抽出したメモリダンプのオフセットとロードされている仮想アドレスの対応は、先ほどの<code class=\"language-text\">vol3 -o /tmp -f memdump.mem windows.memmap --dump --pid 8888</code>の出力結果から参照できます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 504px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b99dbdb7c97fa3263bb8f6069ea34ec3/08115/image-20230522231930837.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.91666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnUlEQVQ4y5WT2Y6CUBBE+REQVBB3EcF994H//6GenE6K4DgxmYfOvb1VVfeFYLVa2Ww2s/l8bqPRyKbTqW02G1sulzaZTNzSNLUwDK3X67lFUfTnGcexBePx2LA8z72ZM0kS6/f77lMIEaRZlrkRHwwG3oevHMABxRgBAcMEKD6ANBNH6XA49BNCxagj7oBlWdp2u3U7n89WFIWPX1WV+4zPGk6nk69hsVh4jlXRQ369XrsIyIPdbmfH49EbHo+H1XXtjfjP59ObASEHGc3cIQUM0svlYuCg+g0QAABh7/o0cweMibizN+7UAbjf7z8BYUYRSohRKEByAJK73W6tQvpQ2Sqk4XA4eEA7k8Lr9eoEqOFOHND7/e4xwOmFnH1+VcgIXYWMqR0KsKuwHRlkATKKXhBmVH0bmR3S+wYohRjMelWK5AvwXwoxjYxCfJRIISBSyJ1vE1/TtY/SBdTIfIe/ATUyZAAyrj6bj1fujqxXZocUChBw1JEjjhDIqQOU0wEBUjNNFKKQe9M07gP4er1cETleXHU8HEaO//8H6Ize20XM8k8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b99dbdb7c97fa3263bb8f6069ea34ec3/8ac56/image-20230522231930837.webp 240w,\n/static/b99dbdb7c97fa3263bb8f6069ea34ec3/d3be9/image-20230522231930837.webp 480w,\n/static/b99dbdb7c97fa3263bb8f6069ea34ec3/062aa/image-20230522231930837.webp 504w\"\n              sizes=\"(max-width: 504px) 100vw, 504px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b99dbdb7c97fa3263bb8f6069ea34ec3/8ff5a/image-20230522231930837.png 240w,\n/static/b99dbdb7c97fa3263bb8f6069ea34ec3/e85cb/image-20230522231930837.png 480w,\n/static/b99dbdb7c97fa3263bb8f6069ea34ec3/08115/image-20230522231930837.png 504w\"\n            sizes=\"(max-width: 504px) 100vw, 504px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b99dbdb7c97fa3263bb8f6069ea34ec3/08115/image-20230522231930837.png\"\n            alt=\"image-20230522231930837\"\n            title=\"image-20230522231930837\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>例えば、以下のように 0x30a000 は 0x00007fffeca66000 と対応しているので、0x30a100 のアドレスは 0x00007fffeca66100 と対応していることがわかります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 571px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ec359b28743f317d41c23c363ec6ff1/17d73/image-20230522232313436.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVQoz1VSSW7bQBDkQySYiygO91WkSJESqY0QLMCHAD7k6pP9Cd/yjvy0MtUJDzk0ZnqZ6urqMSzLgm3bMPXpOA7oW//um81GcpK3HbzEPczsDFNl2t/AdFzYrgeLZuka04Sx2+3Qti36vsf9fkdVVeKfTidcLhfxx/EEPy7g/fiF9OM31PEdrvLhpxXK/QFZ00MFEVxNwEjTFGVZoigKdF2HJEnkTlA2831f4mEYIY5CNHUF13Xhbj3khX5XVnJyqtVqBaOua+z3e2E4z7Mwok92x+MRURThdrtJ/HA44Pl86liIIAgkfz6fMY2jNFmv1zAWRmS5MMyyTNg1TSOAbBDHsa7LMQwDPM8TYxMSolFzAeRDPiDYwpBAo+56vV6lEdnyrOoO1/kVfhBqKZRMxToy5QIFMM9zKWYXJsiO/iJDnmd61B5lkeJ1ivHzrUWeeBowkBpqTdtut3+3zCDHINjj8fhPT9FOg9/uM4Zuh6/3BN+furbRGoaJbJ/sp2mCUkq+l2yZtohOrchy2TLF7/Q90vE41ZO0g2xYaQ0XnWmLhn8AUYEfytC8Q0AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3ec359b28743f317d41c23c363ec6ff1/8ac56/image-20230522232313436.webp 240w,\n/static/3ec359b28743f317d41c23c363ec6ff1/d3be9/image-20230522232313436.webp 480w,\n/static/3ec359b28743f317d41c23c363ec6ff1/9ac82/image-20230522232313436.webp 571w\"\n              sizes=\"(max-width: 571px) 100vw, 571px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3ec359b28743f317d41c23c363ec6ff1/8ff5a/image-20230522232313436.png 240w,\n/static/3ec359b28743f317d41c23c363ec6ff1/e85cb/image-20230522232313436.png 480w,\n/static/3ec359b28743f317d41c23c363ec6ff1/17d73/image-20230522232313436.png 571w\"\n            sizes=\"(max-width: 571px) 100vw, 571px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3ec359b28743f317d41c23c363ec6ff1/17d73/image-20230522232313436.png\"\n            alt=\"image-20230522232313436\"\n            title=\"image-20230522232313436\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>同じように他の 2 つのオフセットの対応も特定すると、以下の対応になることを特定しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">offset: 0x30a100 <span class=\"token builtin class-name\">:</span> 0x00007fffeca66100\noffset: 0x362d30 <span class=\"token builtin class-name\">:</span> 0x00007fffecabed30\noffset: 0x376d10 <span class=\"token builtin class-name\">:</span> 0x00007fffecad2d10</code></pre></div>\n<p>これらの仮想アドレスをリトルエンディアンに変換し、メモリ内で探索します。</p>\n<p>探索には適当な Hex Editor が使用できますが、今回は HxD を使用しました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 628px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/667446fdfaa802b35f70f1990f6ed0c0/3d84d/image-20230522234809916.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.75000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABv0lEQVQoz4VSS5KbMBTk9sliKvfIGVKV7Cer7DKZsrGNASH0AyQxY5h0WpInlV0WXdD6vNevW9W17dFcGkxuwr7v2Lbtjv0/2HC7FbyvpfvVICKMWeH9DTHuGd4XBF/4smwZ83xDCDvctN333qD1BilfodQrC/5GdThEXJoXGG2gRwVrbPmSpzVnXdlTGuq+P8oRYVk4lYPl/jhqDGLIKqunp4DzeeWiwjgM+dIgBJSUkOSpkOThkTwh8b7rsUwTBM81zRV9L9B1HUKMqJ5/BRyPEY7dnDFZWVFS/meuz9ZkLISfqEopvARP5TorXOOKNcTi4alOI6+Y2HG+Q/NCKu5YwLgZ18GiERpXopUWp3aEsjP905xsxMCR+2GEZ9HsYX1a/ypMXZNn1jjE2eHH2eLjlxafvnUZD187fCD//L1D9DODWvCztXg8aAiGVh1TKJdS0KYRTAnHUGUeKYVABYre6RQOG0mp4BefQxH01/HJLeT7/oaqpn9ty5R50ZqSajafoyQvnbW5eG5GTOQpsJSyED3qukbX9wzqn1BOHDmZq1OSg8zPwtwLGCpLDd6TN9pmHjxDMUW59yE3T4/9D8hj85Lkck/WAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/667446fdfaa802b35f70f1990f6ed0c0/8ac56/image-20230522234809916.webp 240w,\n/static/667446fdfaa802b35f70f1990f6ed0c0/d3be9/image-20230522234809916.webp 480w,\n/static/667446fdfaa802b35f70f1990f6ed0c0/724e7/image-20230522234809916.webp 628w\"\n              sizes=\"(max-width: 628px) 100vw, 628px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/667446fdfaa802b35f70f1990f6ed0c0/8ff5a/image-20230522234809916.png 240w,\n/static/667446fdfaa802b35f70f1990f6ed0c0/e85cb/image-20230522234809916.png 480w,\n/static/667446fdfaa802b35f70f1990f6ed0c0/3d84d/image-20230522234809916.png 628w\"\n            sizes=\"(max-width: 628px) 100vw, 628px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/667446fdfaa802b35f70f1990f6ed0c0/3d84d/image-20230522234809916.png\"\n            alt=\"image-20230522234809916\"\n            title=\"image-20230522234809916\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これでタイムスタンプのポインタを持つアドレスが特定できました。</p>\n<p>つまり、この直前分の 8 バイトに書き込まれているアドレスが  <em>hist</em>entry 構造体に含まれるコマンドラインの文字列を指すポインタであるとと特定できました。</p>\n<h3 id=\"volshell-で仮想アドレスから値を取得する\" style=\"position:relative;\"><a href=\"#volshell-%E3%81%A7%E4%BB%AE%E6%83%B3%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%81%8B%E3%82%89%E5%80%A4%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\" aria-label=\"volshell で仮想アドレスから値を取得する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Volshell で仮想アドレスから値を取得する</h3>\n<p>最後に、特定した <em>hist</em>entry 構造体の仮想アドレスを用いて、メモリ内から生データを出力させることでコマンドラインの情報を取得しました。</p>\n<p>まず、cc コマンドでコンテキストを bash プロセスに変換した後、db コマンドで仮想アドレスの情報を取得しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># cc(offset=None, pid=None, name=None) : Change current shell context.</span>\ncc<span class=\"token punctuation\">(</span>pid<span class=\"token operator\">=</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># >>> db(0x00007fffecabc4c0) /!\\ you can ask to display more bits</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> db<span class=\"token punctuation\">(</span>0x00007fffecabc4c0,200<span class=\"token punctuation\">)</span>\n0x7fffecabc4c0  <span class=\"token number\">65</span> <span class=\"token number\">63</span> <span class=\"token number\">68</span> 6f <span class=\"token number\">20</span> 4b <span class=\"token number\">48</span> <span class=\"token number\">42</span> <span class=\"token number\">73</span> 5a <span class=\"token number\">57</span> <span class=\"token number\">46</span> 7a 5a <span class=\"token number\">53</span> <span class=\"token number\">42</span>   echo.KHBsZWFzZSB\n0x7fffecabc4d0  6b <span class=\"token number\">62</span> <span class=\"token number\">32</span> <span class=\"token number\">34</span> 6e <span class=\"token number\">64</span> <span class=\"token number\">43</span> <span class=\"token number\">42</span> 6d <span class=\"token number\">61</span> <span class=\"token number\">57</span> <span class=\"token number\">35</span> 6b <span class=\"token number\">49</span> <span class=\"token number\">47</span> <span class=\"token number\">31</span>   kb24ndCBmaW5kIG1\n0x7fffecabc4e0  6c <span class=\"token number\">49</span> <span class=\"token number\">48</span> <span class=\"token number\">64</span> <span class=\"token number\">70</span> <span class=\"token number\">64</span> <span class=\"token number\">47</span> <span class=\"token number\">67</span> <span class=\"token number\">67</span> <span class=\"token number\">64</span> <span class=\"token number\">47</span> <span class=\"token number\">68</span> 6c <span class=\"token number\">49</span> <span class=\"token number\">43</span> 4a   lIHdpdGggdGhlICJ\n0x7fffecabc4f0  7a <span class=\"token number\">64</span> <span class=\"token number\">48</span> 4a <span class=\"token number\">70</span> <span class=\"token number\">62</span> 6d <span class=\"token number\">64</span> 7a <span class=\"token number\">49</span> <span class=\"token number\">69</span> <span class=\"token number\">42</span> 6a <span class=\"token number\">62</span> <span class=\"token number\">32</span> <span class=\"token number\">31</span>   zdHJpbmdzIiBjb21\n0x7fffecabc500  <span class=\"token number\">74</span> <span class=\"token number\">59</span> <span class=\"token number\">57</span> <span class=\"token number\">35</span> 6b 4c <span class=\"token number\">43</span> <span class=\"token number\">42</span> <span class=\"token number\">30</span> <span class=\"token number\">61</span> <span class=\"token number\">47</span> <span class=\"token number\">56</span> <span class=\"token number\">79</span> 5a <span class=\"token number\">53</span> <span class=\"token number\">42</span>   tYW5kLCB0aGVyZSB\n0x7fffecabc510  <span class=\"token number\">70</span> <span class=\"token number\">63</span> <span class=\"token number\">79</span> <span class=\"token number\">42</span> <span class=\"token number\">68</span> <span class=\"token number\">49</span> <span class=\"token number\">47</span> 5a <span class=\"token number\">31</span> <span class=\"token number\">62</span> 6d <span class=\"token number\">35</span> <span class=\"token number\">70</span> 5a <span class=\"token number\">58</span> <span class=\"token number\">49</span>   pcyBhIGZ1bm5pZXI\n0x7fffecabc520  <span class=\"token number\">67</span> <span class=\"token number\">62</span> <span class=\"token number\">57</span> <span class=\"token number\">56</span> <span class=\"token number\">30</span> <span class=\"token number\">61</span> <span class=\"token number\">47</span> <span class=\"token number\">39</span> 6b 4b <span class=\"token number\">53</span> <span class=\"token number\">35</span> <span class=\"token number\">55</span> <span class=\"token number\">61</span> <span class=\"token number\">47</span> <span class=\"token number\">55</span>   gbWV0aG9kKS5UaGU\n0x7fffecabc530  <span class=\"token number\">67</span> <span class=\"token number\">63</span> <span class=\"token number\">32</span> <span class=\"token number\">56</span> 6a <span class=\"token number\">63</span> 6d <span class=\"token number\">56</span> <span class=\"token number\">30</span> <span class=\"token number\">49</span> <span class=\"token number\">47</span> 6c 7a <span class=\"token number\">49</span> <span class=\"token number\">44</span> 6f   gc2VjcmV0IGlzIDo\n0x7fffecabc540  <span class=\"token number\">67</span> <span class=\"token number\">64</span> 7a <span class=\"token number\">56</span> <span class=\"token number\">73</span> <span class=\"token number\">58</span> 7a <span class=\"token number\">42</span> <span class=\"token number\">75</span> 4d <span class=\"token number\">77</span> 3d 3d <span class=\"token number\">20</span> 7c <span class=\"token number\">20</span>   <span class=\"token assign-left variable\">gdzVsXzBuMw</span><span class=\"token operator\">==</span>.<span class=\"token operator\">|</span><span class=\"token builtin class-name\">.</span>\n0x7fffecabc550  <span class=\"token number\">62</span> <span class=\"token number\">61</span> <span class=\"token number\">73</span> <span class=\"token number\">65</span> <span class=\"token number\">36</span> <span class=\"token number\">34</span> <span class=\"token number\">20</span> 2d <span class=\"token number\">64</span> 00 ab ec ff 7f 00 00   base64.-d<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> db<span class=\"token punctuation\">(</span>0x00007fffecabed30<span class=\"token punctuation\">)</span>\n0x7fffecabed30  <span class=\"token number\">23</span> <span class=\"token number\">31</span> <span class=\"token number\">36</span> <span class=\"token number\">38</span> <span class=\"token number\">33</span> <span class=\"token number\">37</span> <span class=\"token number\">34</span> <span class=\"token number\">31</span> <span class=\"token number\">35</span> <span class=\"token number\">37</span> <span class=\"token number\">30</span> 00 00 00 00 00   <span class=\"token comment\">#1683741570.....</span></code></pre></div>\n<p>これによって実行されたコマンドラインとタイムスタンプを特定でき、Flag を取得でいました。</p>\n<p>※ cc コマンドが Volshell3 だとなぜかエラーになってしまうので、ここだけ Vollatility 2 を使用します。</p>\n<p>参考：<a href=\"https://github.com/volatilityfoundation/volatility/wiki/Command-Reference\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Command Reference · volatilityfoundation/volatility Wiki</a></p>\n<p>参考：<a href=\"https://blog.onfvp.com/post/volatility-cheatsheet/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Volatility 3 CheatSheet - onfvpBlog [Ashley Pearson]</a></p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>今回のテーマにした問題は結構難易度が高く、Solver も 3 チームのみの問題でした。</p>\n<p>Vollatility の活用方法の幅が広がり、勉強になる良い問題だったと思います。</p>\n<p>フォレンジッカーになりたい。</p>","fields":{"slug":"/ctf-heroctf-windows-memory-analysis","tagSlugs":["/tag/ctf/","/tag/windows/","/tag/volatility/"]},"frontmatter":{"date":"2023-05-23","description":"HeroCTF 2023 の問題をテーマに、Vollatility で Windows のメモリを解析して WSL のプロセスからコマンドラインを抽出しました。","tags":["CTF","Windows","Volatility"],"title":"Volatility3 で Windows のメモリを解析し、WSL の bash プロセスからコマンド履歴を特定","socialImage":{"publicURL":"/static/4f6c6e5db0b60c8a5e5bdc889052ff86/ctf-heroctf-windows-memory-analysis.png"}}}},"pageContext":{"slug":"/ctf-heroctf-windows-memory-analysis"}},"staticQueryHashes":["251939775","401334301","825871152"]}