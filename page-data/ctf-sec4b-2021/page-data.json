{"componentChunkName":"component---src-templates-post-template-js","path":"/ctf-sec4b-2021","result":{"data":{"markdownRemark":{"id":"99144b60-3c0d-5de2-880e-77a4d9d89077","html":"<p>5/22-5/23 に開催された<a href=\"https://www.seccon.jp/2021/seccon_beginners/_seccon_beginners_ctf_2021.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SECCON Beginners CTF 2021</a>に参加しました。</p>\n<p>実は僕がCTFを初めて最初にチャレンジしたコンテストが、昨年のSECCON Beginners CTFであり、当時は1~2問程度しか解けずに惨敗しました。</p>\n<p>今回はその雪辱戦として、1年の成長を確認するために気合い入れて参加をしておりました。</p>\n<p>そして結果はなんと、Reversing問題を5問全完することができました！</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/df22497720fe60257b6c301d04b99b74/0b533/c41386c0-f785-7f56-864e-a96189007346.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAARlAAAEZQAGA43XUAAABQklEQVQoz3VR2W6EMAzk/7+u6kvVly6ly2YLwTk4lpBj6mTvVo00cewBezSuXj5e8da+Q8NA8T0kuiMSKKk7Fx84rudIl3hF5YJDbyRELyCkwLqt0J4bbBo+eth1RL2v0akeIQUQ1/VmynerXzG5CSd/gvOu/FOBzzAQmqbhOOQUYxgx+bm8iQifzCmlLtwEfdI4tALfXYd9u8fhKKDoPKhaI3eeOVkMzMnCpQ2KFWaVf7i4gbzGFBYgoTRs2/Y2zHiLqvMSMl49Uch5HwaGxDNHJe+4ToEdDRYmnlHejCGwhxERejIQncCxPyLGWCaZzWYRsMuIpv1CTxIpJVjm+iQxgJ4XiDOKhx1L3+12HPsi3fq7h5mr6xpSypuHuSHx3vOGf6PKfpiVFTkLu42YOSevyjZnv0AzZ934wGnINPzb8AfQj2agevw54wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/df22497720fe60257b6c301d04b99b74/8ac56/c41386c0-f785-7f56-864e-a96189007346.webp 240w,\n/static/df22497720fe60257b6c301d04b99b74/d3be9/c41386c0-f785-7f56-864e-a96189007346.webp 480w,\n/static/df22497720fe60257b6c301d04b99b74/b0a15/c41386c0-f785-7f56-864e-a96189007346.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/df22497720fe60257b6c301d04b99b74/8ff5a/c41386c0-f785-7f56-864e-a96189007346.png 240w,\n/static/df22497720fe60257b6c301d04b99b74/e85cb/c41386c0-f785-7f56-864e-a96189007346.png 480w,\n/static/df22497720fe60257b6c301d04b99b74/0b533/c41386c0-f785-7f56-864e-a96189007346.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/df22497720fe60257b6c301d04b99b74/0b533/c41386c0-f785-7f56-864e-a96189007346.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>今回は、Reversing問題の中から、「firmware」という問題について簡単なWriteUpを書こうと思います。</p>\n<h2 id=\"本記事の注意点\" style=\"position:relative;\"><a href=\"#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\" aria-label=\"本記事の注意点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>本記事の注意点</h2>\n<p>本記事の内容は社会秩序に反する行為を推奨することを目的としたものではございません。</p>\n<p>自身の所有する環境、もしくは許可された環境以外への攻撃の試行は、「不正アクセス行為の禁止等に関する法律（不正アクセス禁止法）」に違反する可能性があること、予めご留意ください。</p>\n<h2 id=\"writeup\" style=\"position:relative;\"><a href=\"#writeup\" aria-label=\"writeup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WriteUp</h2>\n<p>まず、渡されたアーカイブファイルを解凍すると、次の2つのファイルが現れました。</p>\n<ul>\n<li>firmware.bin </li>\n<li>README.txt</li>\n</ul>\n<p>README.txtの内容は次のようなものでした。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ctf4b networks SUPER SECURE device's firmware\n\n*NOTE*\n\nIt is allowed to reverse engineer this firmware.\nI hope you enjoy reversing this file!</code></pre></div>\n<p>どうやらfirmware.binは、何らかのネットワーク機器のファームウェアプログラムのようです。</p>\n<p>fileコマンドにかけてみると、dataファイルであると表示されました。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$file firmware.bin \nfirmware.bin: data</code></pre></div>\n<p>次に、stringsにかけてみると、以下のようなファイル名が確認できました。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ascii.txt \nsquare.svg\nbootstrap-grid.css\nfa-regular-400.woff2\nfile.svg\nlogo.png\nfirm\nlogo.jpg\nfolder.svg\ncertificate.pem\nindex.html\nplus-square.svg\nstar.svg</code></pre></div>\n<p>また、次のようなテキストも確認されました。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">This is a IoT device made by ctf4b networks. Password authentication is required to operate.\nInput password (password is FLAG) > \nIncorrect password.\nCorrect password!!!\nGCC: (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0</code></pre></div>\n<p>どうやらこのfirmware.binというファイルは、複数のファイルから構成されており、この中の実行ファイルがFLAGとなるパスワード文字列を要求しそうであることがわかりました。</p>\n<p>しかし、firmware.binはdataファイルとなっていて、Ghidraやradare2、objdumpなどに食わせてもうまく解析ができませんでした。</p>\n<h2 id=\"firmwarebinについて\" style=\"position:relative;\"><a href=\"#firmwarebin%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\" aria-label=\"firmwarebinについて permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>firmware.binについて</h2>\n<p>そこで方針を変えて、ファームウェアプログラムの解析について調べてみたところ、<a href=\"https://github.com/ReFirmLabs/binwalk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">binwalk</a>がファームウェア解析のためのツールであることを見つけました。</p>\n<p>binwalkは過去に何度かZLIBファイルの解凍などで使用したことがあるのですが、当時使用したのはステガノグラフィーの問題で、本来ファームウェア解析のためのツールであるということを知りませんでした。</p>\n<p>そこで、firmware.binに対してbinwalkで解析をかけたところ、次のような出力結果が得られました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token variable\">$binwalk</span> firmware.bin \n\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n<span class=\"token number\">127</span>           0x7F            Base64 standard index table\n<span class=\"token number\">2343</span>          0x927           Copyright string: <span class=\"token string\">\"Copyright 2011-2021 The Bootstrap Authors\"</span>\n<span class=\"token number\">2388</span>          0x954           Copyright string: <span class=\"token string\">\"Copyright 2011-2021 Twitter, Inc.\"</span>\n<span class=\"token number\">83503</span>         0x1462F         PNG image, <span class=\"token number\">594</span> x <span class=\"token number\">100</span>, <span class=\"token number\">8</span>-bit grayscale, non-interlaced\n<span class=\"token number\">83544</span>         0x14658         Zlib compressed data, best compression\n<span class=\"token number\">90593</span>         0x161E1         ELF, <span class=\"token number\">32</span>-bit LSB shared object, ARM, version <span class=\"token number\">1</span> <span class=\"token punctuation\">(</span>SYSV<span class=\"token punctuation\">)</span>\n<span class=\"token number\">100906</span>        0x18A2A         Unix path: /usr/lib/gcc/arm-linux-gnueabihf/9/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/arm-linux-gnueabihf/Scrt1.o\n<span class=\"token number\">103485</span>        0x1943D         JPEG image data, JFIF standard <span class=\"token number\">1.01</span>\n<span class=\"token number\">117167</span>        0x1C9AF         PEM certificate\n<span class=\"token number\">117786</span>        0x1CC1A         HTML document header\n<span class=\"token number\">118641</span>        0x1CF71         HTML document footer</code></pre></div>\n<p>どうやらここから、FLAGとなるパスワード文字列を扱っているELFファイルを抽出すればよさそうです。</p>\n<h2 id=\"ファイルから任意のアドレス間のバイナリデータを抜き出す\" style=\"position:relative;\"><a href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8B%E3%82%89%E4%BB%BB%E6%84%8F%E3%81%AE%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E9%96%93%E3%81%AE%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%8A%9C%E3%81%8D%E5%87%BA%E3%81%99\" aria-label=\"ファイルから任意のアドレス間のバイナリデータを抜き出す permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ファイルから任意のアドレス間のバイナリデータを抜き出す</h2>\n<p>ここは、以前にも何度か試したことがありあまり苦労しませんでした。</p>\n<p>具体的にはddコマンドを使用します。</p>\n<p>ddコマンドは、LinuxでISOイメージをUSBメモリに書き出すときに使ったことのある方は多いと思いますが、ファイル変換とコピーを行う機能を持ったコマンドです。</p>\n<p>参考：<a href=\"https://man7.org/linux/man-pages/man1/dd.1.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dd(1) - Linux manual page</a></p>\n<p>ddコマンドでバイナリデータを抜き出すために、特別難しいことは必要ありません。</p>\n<p>以下のコマンドのように、インプットするファイルにfirmware.binを指定し、1バイト単位で書き出すためにbsを1に設定します。</p>\n<p>そして、binwalkで取得した開始アドレスと、次のセクションまでの差分をそれぞれ設定すればOKです。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">dd</span> <span class=\"token assign-left variable\">if</span><span class=\"token operator\">=</span>./firmware.bin <span class=\"token assign-left variable\">of</span><span class=\"token operator\">=</span>./program <span class=\"token assign-left variable\">bs</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">skip</span><span class=\"token operator\">=</span><span class=\"token number\">90593</span> <span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span><span class=\"token number\">12892</span>\n<span class=\"token number\">12892</span>+0 records <span class=\"token keyword\">in</span>\n<span class=\"token number\">12892</span>+0 records out\n<span class=\"token number\">12892</span> bytes <span class=\"token punctuation\">(</span><span class=\"token number\">13</span> kB, <span class=\"token number\">13</span> KiB<span class=\"token punctuation\">)</span> copied, <span class=\"token number\">0.0391655</span> s, <span class=\"token number\">329</span> kB/s</code></pre></div>\n<p>これで抜きだしたファイルを見てみると、ちゃんとELFファイルとして取得されたことがわかります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">file</span> program \nprogram: ELF <span class=\"token number\">32</span>-bit LSB pie executable, ARM, EABI5 version <span class=\"token number\">1</span> <span class=\"token punctuation\">(</span>SYSV<span class=\"token punctuation\">)</span>, dynamically linked, interpreter /lib/ld-linux-armhf.so.3, missing section headers</code></pre></div>\n<h2 id=\"バイナリファイルを解析する\" style=\"position:relative;\"><a href=\"#%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%99%E3%82%8B\" aria-label=\"バイナリファイルを解析する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>バイナリファイルを解析する</h2>\n<p>FLAGを抜き出すために、ELF32を実行する環境を用意して動的解析をしようかとも思ったのですが、動的リンクのライブラリを準備するのがめんどくさくてやめました。</p>\n<p>あまり癖のないバイナリだったので静的解析だけで十分FLAGが取得できます。</p>\n<p>とりあえずGhidraに食わせます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3efbaae8748ba0bbaa401c106a680e15/0b533/d6775f71-5216-e201-8d62-ea3f2f3ab0fa.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.083333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAARlAAAEZQAGA43XUAAACO0lEQVQoz12SiXKbQAyG8/4P1mNSxxNcJz6wDeaGZZfLXE7yVWC3aatBsxrBfuj4H/Z7G9vxWB8CdueUvZdxCHKOoebgK4kVtpzPr3u+fF3z8pry7dHDWltstmte3T1O7GFMycn1eKjKiu4N4vqD7AJpA0nzMfscSz7vYePERFHAZHWdkeQujnaph4Lr2zjntSl4yFVO2Y74ZiAyI1FxFR8JzadnLTz93GM9W3fgkTDbsEpf6MaO35YpLcBcU3VXAoEEWU+ox9mneHY9kMudx9WOp+VyvpjrnCQ9o+RsW0XblXNe5eY/oBpuVelbHOTDP8DlHah1iylCitqnbmLMRdGPJVHs86D/AK/EU7vl3ed2b+3PQGvLYrGYgW2bkmYWVmrJrON7w++kSk0V5jPQk1tOdMFLR9xgOjv8tMVTLfKwWNusVqs7sCBJDvgqorrkDEP92XKWKd4/wPN9Hp9skkw2LYSy7gTmkTUl8prD6cwksdtSBsrK0Fw049jQD82cjzJZipItT5YkIeufR5GG/EmA7aUjSiO8SM/vXddhu93dgJVNWBzYGJu/zVfmEzhpbLncywahqnu6bhAZRBydBJVe2NlnTs75tpT8yDlyZGGhfKelwvYGnCqcWp41lMasrCNGgGXZ03cjiQmoWmlHena9EMd173prqJpQQDXX60VG9jbn01k22jCMV+zTie8/tsSZLCMSnSU5p8CRWTZ0fS8zdNnsbJlvwznMiXVCUhhM1chMG5lnSxDG/AIzIol9/u+SUAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3efbaae8748ba0bbaa401c106a680e15/8ac56/d6775f71-5216-e201-8d62-ea3f2f3ab0fa.webp 240w,\n/static/3efbaae8748ba0bbaa401c106a680e15/d3be9/d6775f71-5216-e201-8d62-ea3f2f3ab0fa.webp 480w,\n/static/3efbaae8748ba0bbaa401c106a680e15/b0a15/d6775f71-5216-e201-8d62-ea3f2f3ab0fa.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3efbaae8748ba0bbaa401c106a680e15/8ff5a/d6775f71-5216-e201-8d62-ea3f2f3ab0fa.png 240w,\n/static/3efbaae8748ba0bbaa401c106a680e15/e85cb/d6775f71-5216-e201-8d62-ea3f2f3ab0fa.png 480w,\n/static/3efbaae8748ba0bbaa401c106a680e15/0b533/d6775f71-5216-e201-8d62-ea3f2f3ab0fa.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3efbaae8748ba0bbaa401c106a680e15/0b533/d6775f71-5216-e201-8d62-ea3f2f3ab0fa.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>main関数はつらつらと長ったらしい感じですが、重要な部分はそこまで多くありません。</p>\n<p>事前にstringsでパスワードの入力を受け付け、正誤判定を行っていそうな部分があることがわかっているので、そこを探します。</p>\n<p>”Correct Password”のアドレスにたどり着く直前の分岐が怪しそうです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f49c0166b80270ed614d7a8517b35166/0b533/bcba90e2-d275-8406-2412-0e6b6214cd05.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAARlAAAEZQAGA43XUAAABwklEQVQoz42SWW/TUBCF/f//AYKyFPHEAw+8swiJVoAiUkpUEicteMm1HS/Xsa+X2P4Y2wiJPnGkkWek4zNzZq6l8wJnH3HreLiqJsl72n4gziTXDVXbo4uCfRxzp0LisCAJS/K8oe4G8qrBCCfJDY/OnmIdkoy1l7BxE3aqYRd0kjcsb2I+Xx/4dWhwkxI70PyUJkEB6tij8g5fn/iuFNs4x4lKEXyCZaqa1c2aL4sFPzYGXw00JwiE4Hg5PbAPXWzHIctKiqIkyjVF3dJ2CHfgJKT0WPHw8TlWWRq2W5tvV0ts25CmTMiyaooRnr9ns/PRcUnXisXG0PXdTByG6VOI9Qdnz7AqmdC2ba5EcLszKJmwriGWn11PT+QgUKxu7/ClW/9HYNYa/tZHmfz8+QusumnYiOBy+VWEx6lmcpIYIrE9Ik58PHUgkmOkWcm/mAUznfPuw8dRsGW1WnF5ecF6bTgcZloo14yiYsrT1KFtzeSu73tOp07qfoqm6aSWV5Fo3rx9Px8lDENc1xWxlmpeG8a0k+0RZZlPlsZ9G2PQemxmCMeQqZWSY/oxr1+9xBqvNtyzMNzb0/8g05qLTwt+AxWsqnz+n0ZHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f49c0166b80270ed614d7a8517b35166/8ac56/bcba90e2-d275-8406-2412-0e6b6214cd05.webp 240w,\n/static/f49c0166b80270ed614d7a8517b35166/d3be9/bcba90e2-d275-8406-2412-0e6b6214cd05.webp 480w,\n/static/f49c0166b80270ed614d7a8517b35166/b0a15/bcba90e2-d275-8406-2412-0e6b6214cd05.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f49c0166b80270ed614d7a8517b35166/8ff5a/bcba90e2-d275-8406-2412-0e6b6214cd05.png 240w,\n/static/f49c0166b80270ed614d7a8517b35166/e85cb/bcba90e2-d275-8406-2412-0e6b6214cd05.png 480w,\n/static/f49c0166b80270ed614d7a8517b35166/0b533/bcba90e2-d275-8406-2412-0e6b6214cd05.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f49c0166b80270ed614d7a8517b35166/0b533/bcba90e2-d275-8406-2412-0e6b6214cd05.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>探してみると、明らかにパスワードチェックを行っていそうな分岐を発見しました。\n※変数名は解析の過程で編集しています。</p>\n<p>デコンパイル結果読むと、入力値とFLAG文字列の0から60文字目までを順に比較しているようです。</p>\n<p>そして、入力値は1文字ごとに0x53(83)とのXORで比較されていることがわかります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 402px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cba23adf2bb49534e4c9efeee5f9c4d7/0ec92/fe4c1939-bc8d-a1e7-4eca-688a0abac51d.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9ElEQVQoz22SW08aURSF+f8vVQERkLsCc59hBjQ2IH3oe/9A00QNitxmuIiI8HUzCCkND9/ZeydnVtY6eyLNXoXbvs5dcIM19GiOTVoTF2/soQ5U7qRv+gYN3+X7aDPfUuvbYf2xbtNetmh/trhf3tNetYmUewaFbo7Ug0W+U0TtxaiOklyNLsg+n1LsyjytkA0ypPtJqoGCOimhBymMaR5lmEEZpCn7FbR3nYi7srBGKeESe5jAHJXIC9GXqBAj3j1Hm+vUaeDKKd6/6q4/JOJ86Bi9OObwAqP7TWqevF/kpHPCaeeUs+coykyRq3Vqa5eafBbW//svQkGzv3GWxng9E8FC6DDejZPsJUOXyts/gl+Ejtbetl97eyLO0hSRNKaflaWcY/k5CkGBpMS/lKfIybwV2EVshHUnuhffRa59mth+DCvIovWzlDsquVedcqChvt1gzG2MmcbmXm1l47yrOEvnUBR3T8Re2Fw9VFB6OdShQvGxzvWjRuZ3gcKTRrVf4vohhjlISII06stm8+J65e1jH0TWZw2iv36S+yPRB1GcSRonSFB+imLPSrhLcbdQsOZVHMFeiPO5hvNZOx5ZmxpYizr6zMP+MHA2yLtaCx1nLYtgi7v/berbBR3ZcLjl8XLMlC0TOQ9Yj48yDuvkKH8BACzhJUPOtwoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/cba23adf2bb49534e4c9efeee5f9c4d7/8ac56/fe4c1939-bc8d-a1e7-4eca-688a0abac51d.webp 240w,\n/static/cba23adf2bb49534e4c9efeee5f9c4d7/56632/fe4c1939-bc8d-a1e7-4eca-688a0abac51d.webp 402w\"\n              sizes=\"(max-width: 402px) 100vw, 402px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/cba23adf2bb49534e4c9efeee5f9c4d7/8ff5a/fe4c1939-bc8d-a1e7-4eca-688a0abac51d.png 240w,\n/static/cba23adf2bb49534e4c9efeee5f9c4d7/0ec92/fe4c1939-bc8d-a1e7-4eca-688a0abac51d.png 402w\"\n            sizes=\"(max-width: 402px) 100vw, 402px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/cba23adf2bb49534e4c9efeee5f9c4d7/0ec92/fe4c1939-bc8d-a1e7-4eca-688a0abac51d.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>ここまでわかれば後は楽勝ですね。</p>\n<p>デコンパイル結果からこのflag_valの配列のアドレスを割り出します。</p>\n<p>0xea4から0xf94までがこの配列のアドレスであることがわかりました。</p>\n<p>この配列はuint型で定義されているので、差分は0xF0であり、ちょうど60文字分の領域が確保されていることがわかります。</p>\n<p>というわけで、ここまで読めればあとは指定したアドレス範囲のバイナリデータを抜き出して0x53とXORをとった値を順に出力するSolverを書けばFLAGを取得できます。</p>\n<p>SolverはPythonで書きました。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"program\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rb\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> prog<span class=\"token punctuation\">:</span>\n    data <span class=\"token operator\">=</span> prog<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token number\">3748</span><span class=\"token punctuation\">:</span><span class=\"token number\">3988</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">240</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">^</span><span class=\"token number\">83</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> end<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>実行したらFLAGが取得できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python3 solver.py \nctf4b<span class=\"token punctuation\">{</span>i0t_dev1ce_xxxxxxxx_xxxxxxxx_xxxxxxxx_a_l0t_of_5ecre7s<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>解けてみればEasyな問題ではありましたが、あほなことをしてずいぶん時間を使ってしまいました。</p>\n<p>特に、展開直後のファイルをエディタで適当にいじったせいで破損させて、binwalkの解析が正常にできなくさせてしまったのは痛恨のミスでした。</p>\n<p>今後はしばらく迷ったらとりあえず問題ファイルを再ダウンロードするのを試してみてもいいかもしれません。</p>\n<p>とはいえ、昨年の雪辱を果たし、得意ジャンルならSECCON Beginners CTFの問題を全完できるようになったというのは大きな成長を感じられてよかったです。</p>\n<p>今後はもっと上位も目指しながら引き続き勉強していこうと思います。</p>\n<p>改めて、作問運営の方には感謝です！\nインフラでトラブルがあったと聞いていますが、特にストレスはなく、個人的には非常に快適に楽しめました。</p>\n<p>次はSECCON CTFでも納得いく結果が出せるよう頑張ります。</p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://man7.org/linux/man-pages/man1/dd.1.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dd(1) - Linux manual page</a></li>\n<li><a href=\"https://github.com/ReFirmLabs/binwalk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ReFirmLabs/binwalk: Firmware Analysis Tool</a></li>\n</ul>","fields":{"slug":"/ctf-sec4b-2021","tagSlugs":["/tag/ctf/","/tag/reversing/"]},"frontmatter":{"date":"2021-10-03","description":"Reversing問題の中から、「firmware」という問題について簡単なWriteUpを書こうと思います。","tags":["CTF","Reversing"],"title":"firmware Writeup (Reversing) 【SECCON Beginners CTF 2021】","socialImage":{"publicURL":"/static/334bd91f01f5d703919e643c6130dca6/ctf-elf-training.png"}}}},"pageContext":{"slug":"/ctf-sec4b-2021"}},"staticQueryHashes":["251939775","401334301","825871152"]}