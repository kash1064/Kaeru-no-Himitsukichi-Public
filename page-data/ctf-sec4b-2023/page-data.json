{"componentChunkName":"component---src-templates-post-template-js","path":"/ctf-sec4b-2023","result":{"data":{"markdownRemark":{"id":"b83d9260-d30e-5c2e-a2fe-b9a76fc9b625","html":"<p>6/3 から開催されていた SECCON Beginners CTF 2023 に 0nePadding で参加していました。</p>\n<p>最終順位は 35 位 / 778 チームでした。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 867px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/43d099397a397f0343dd7253023f0b56/264eb/image-20230604164204980.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.58333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAADG0lEQVQ4y3VT22vTUBjPqw/+Bf4hCgoiKIIgingBwQs+qOjAh00URQVFERT24pzaedsmOue8TRwTL3OKl62ll7RpmmZZm7XLpU3TNjlJczvHkxw39cGPj5DzXX/fjVKUuihWChzP5LlsLp/N5tOZHFcUALARQr4fBAH8DweUJKuSrJTKYo4tFPk5OsdyHJ9KZ/VmCztDCNG/BJcYEwWAhf5D2BMn/s2+70UchFDCtPiPMk2gabrrukRKyDTM6qLU6TjLcbASY9EaumXZWO55HjYLncvigokBWBYOTGxNw5iNJxWlRvITkpVakZ9flNSFharjhHEpM4INIyQkNUYYLJW6JA9hY8tmq22YoNlsETkFLPtPeBRy2I4oBKZI+Fv7dzuikgOqVCrTNF0oFPIMw3N4WkwimeZ43nU9bCQIQiaT4Vg8Am5ufi6eSNLZXC7HEC2l1HShWtMbmqoboqYbDcmSubaueUbN9TzLtoWKKtcVUak3G2ZLzmmLvFGXHNCGUc22h2vE++BYqvhtNpUuluQQmO8StK4PgQPYWp5RmA/peEVWsS2G/WfOUOODb73oY0/3xb4NPSOx13HH9ZeX5A396vTk8Ys/zm7subfr3LNpWiQqCnQ8BFQ4fRlOnkSpgbGJLzsvjK09NhAbT5DefCq+33Jr/b7hHS+50SvDU/uvjt/4JIjNaFRWgJzpa+Dmasg8Jw3lq9ruC093nBuRGyZ+9rzs2hbb9FWYIrMrKGBgRnnLaJFzx7WfH9Yvr/LK3/Ebrxr+Xnr4eV3XXbbcAJ5+cHhP1+gh0zGiRfM7XvAoIT1OKm4AKctDnYlT4PwKl34WZQ4Mq3Pk+vjm7qGS1ILIOfzkwLb7Wyt6mWRWDfd2whijtbBmy0eQf8feO/jiJ5uRbMn0YpP0mqOxM3c+kOMZmr07OLIXzvQhJetzk+2H26dGe1OLIOp2uGEwXrX6Z+p9Xyv936Xej/Pd/e/LcpMcYOB1gvQgensCvTtpP9jSOr/SeXUcL+eyc2gmtZ0f5fa00GRUy/EhWjpaUiqSkoh97aeGXXZieVV/Aciovxv+FAxpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/43d099397a397f0343dd7253023f0b56/8ac56/image-20230604164204980.webp 240w,\n/static/43d099397a397f0343dd7253023f0b56/d3be9/image-20230604164204980.webp 480w,\n/static/43d099397a397f0343dd7253023f0b56/415aa/image-20230604164204980.webp 867w\"\n              sizes=\"(max-width: 867px) 100vw, 867px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/43d099397a397f0343dd7253023f0b56/8ff5a/image-20230604164204980.png 240w,\n/static/43d099397a397f0343dd7253023f0b56/e85cb/image-20230604164204980.png 480w,\n/static/43d099397a397f0343dd7253023f0b56/264eb/image-20230604164204980.png 867w\"\n            sizes=\"(max-width: 867px) 100vw, 867px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/43d099397a397f0343dd7253023f0b56/264eb/image-20230604164204980.png\"\n            alt=\"image-20230604164204980\"\n            title=\"image-20230604164204980\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>最初の 6 時間くらいは 5 位以内をギリギリキープできていたのですが、途中から解ける問題がなくなり、ずるずると順位を落とした結果 35 位で着地しました。</p>\n<p>悔しいところではありますが完全に実力不足ですので精進します。</p>\n<p>いつも通り Rev を中心に解きましたが、例年同様 Rev はあっさり全完できたので、今回は Misc や Pwn などにも挑戦してみていました。</p>\n<p>今回は Rev と Misc の問題の一部の Writeup を書きます。</p>\n<p>Pwn で挑戦していたカーネルエクスプロイトの問題はいい機会でしたので別の記事で詳しく書こうと思っています。</p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li><a href=\"#halfrev\">Half(Rev)</a></li>\n<li><a href=\"#threerev\">Three(Rev)</a></li>\n<li><a href=\"#pokerrev\">Poker(Rev)</a></li>\n<li><a href=\"#leakrev\">Leak(Rev)</a></li>\n<li><a href=\"#heavenrev\">Heaven(Rev)</a></li>\n<li><a href=\"#yaromisc\">YARO(Misc)</a></li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n</ul>\n<h2 id=\"halfrev\" style=\"position:relative;\"><a href=\"#halfrev\" aria-label=\"halfrev permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Half(Rev)</h2>\n<blockquote>\n<p>バイナリファイルってなんのファイルなのか調べてみよう！</p>\n<p>あとこのファイルってどうやって中身を見るんだろう…？</p>\n</blockquote>\n<p>ダウンロードしたバイナリを strings で調べると Flag が取得できます。</p>\n<h2 id=\"threerev\" style=\"position:relative;\"><a href=\"#threerev\" aria-label=\"threerev permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Three(Rev)</h2>\n<blockquote>\n<p>このファイル、中身をちょっと見ただけではフラグは分からないみたい！</p>\n<p>バイナリファイルを解析する、専門のツールとか必要かな？</p>\n</blockquote>\n<p>Ghidra でデコンパイルした結果を読むと、3 つのデータ領域内で 4 バイトごとに定義されている値を 1 文字ずつ参照して Flag としていることがわかりました。</p>\n<p>そのため、以下の Solver スクリプトで Flag を取得できました。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">f1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0x63</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x63</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x75</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x62</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x64</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x74</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x72</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span> <span class=\"token punctuation\">]</span>\nf2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0x74</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x62</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x79</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x74</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x75</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x74</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x73</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x69</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x66</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x67</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span> <span class=\"token punctuation\">]</span>\nf3 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0x66</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x61</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x70</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x74</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x33</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span> <span class=\"token punctuation\">]</span>\n\nflag <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x31</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> i <span class=\"token operator\">%</span> <span class=\"token number\">3</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n        flag <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>f1<span class=\"token punctuation\">[</span>i<span class=\"token operator\">//</span><span class=\"token number\">3</span><span class=\"token operator\">*</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">elif</span> i <span class=\"token operator\">%</span> <span class=\"token number\">3</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n        flag <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>f2<span class=\"token punctuation\">[</span>i<span class=\"token operator\">//</span><span class=\"token number\">3</span><span class=\"token operator\">*</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">elif</span> i <span class=\"token operator\">%</span> <span class=\"token number\">3</span> <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\n        flag <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>f3<span class=\"token punctuation\">[</span>i<span class=\"token operator\">//</span><span class=\"token number\">3</span><span class=\"token operator\">*</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ctf4b{c4n_y0u_ab1e_t0_und0_t4e_t4ree_sp1it_f14g3}</span></code></pre></div>\n<h2 id=\"pokerrev\" style=\"position:relative;\"><a href=\"#pokerrev\" aria-label=\"pokerrev permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Poker(Rev)</h2>\n<blockquote>\n<p>みんなでポーカーで遊ぼう！点数をたくさん獲得するとフラグがもらえるみたい！</p>\n<p>でもこのバイナリファイル、動かしてみると…？実行しながら中身が確認できる専門のツールを使ってみよう！</p>\n</blockquote>\n<p>バイナリを実行すると、以下のようにランダムで勝ったり負けたりしてスコアが増減するプログラムであることがわかります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 901px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7586f1105e5622609ffb239f6307b336/0955e/image-20230604165010482.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 110.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsTAAALEwEAmpwYAAACuElEQVQ4y41Ua0sUURgeM2+p6aar697c66x7mZmd3dn76Mys61q2fgg1oqztAhlUVBRBfqyoPgSCZaBhiWBkJKHlGi15oxShlCSE/k3POCJ9ahaeD+ecOc/7Pu/zvmeIsIWlDd6AiRJJnq5lWG0g2MD5aihaw1AaJtGcaNMHT7DpsMZDl9viDbRkDrfqA6FaN7bE9vrm2MPh8Scvvn1e+vD6bX5mfj2/8mlq5sHVwazYuzA9uzA9N/roWW567tXT0S8z81MjEyu5xYmhMV+JhfizvbOc+7qz+Ruft9Z/ylj78Wtj63t+9fLxc5PD46OPn4/cH9pYXlvNLS59zL8ZmZidfP/u5VSo1kPcPDnQL/Tc7b8+ePH2le7zWanvrNB7IXVqIJM96mrr9iXZKuedM9ew7eG6bvQN3MveupQ+jUK4GjchGrmUNYpicMlJNLmLje6DRleRgSzSQ5ivpJmpsDsJnatI7yk24QLQcsDgKTbjnEhaoh32OEIkGv2BKtJ/yAGwlc59YIvzQCWJ6PJiF8o5IZrDGa8kmkJpR0IwcoKBw5qraUFgJdB/QICTdsTbrVFex+wlQf5KhypTJsOVjDeJ7iV0fuyRcB/qZMHEZTySZA6lnTy6D+W8zg/lojmkToZbnSTfbokiM2wIVrv2XKkmC6q5wxZDqpiWostsCgrRLJMlcwQ1g5yyxngdi4ajZ8HDrkLdRqs6bHF4FjniidVTAMQX5jbZCqvABMdXKo8UBosqtUJ8IbJDGGBMWNqeaG0KAPFGRlmok1EtrAZZeaXRegpPN1rnA9TJXW6xyy3svg0GamXNZVZZf6lFnYzB7KZSSA7PYDVCIDkMB/wVauSkJXKsRWi3xiRTOKzxxrV0pM6HngPK01GZ7U4njxAxLY3fEsCU25WFuuw2QxATyjexyFlIb//FXzaWAjcEsLJVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7586f1105e5622609ffb239f6307b336/8ac56/image-20230604165010482.webp 240w,\n/static/7586f1105e5622609ffb239f6307b336/d3be9/image-20230604165010482.webp 480w,\n/static/7586f1105e5622609ffb239f6307b336/2b666/image-20230604165010482.webp 901w\"\n              sizes=\"(max-width: 901px) 100vw, 901px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7586f1105e5622609ffb239f6307b336/8ff5a/image-20230604165010482.png 240w,\n/static/7586f1105e5622609ffb239f6307b336/e85cb/image-20230604165010482.png 480w,\n/static/7586f1105e5622609ffb239f6307b336/0955e/image-20230604165010482.png 901w\"\n            sizes=\"(max-width: 901px) 100vw, 901px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7586f1105e5622609ffb239f6307b336/0955e/image-20230604165010482.png\"\n            alt=\"image-20230604165010482\"\n            title=\"image-20230604165010482\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Ghidra でデコンパイルすると、スコアの合計が現実的に困難なほど大きな値になると Flag を取得する関数が実行されることがわかりました。</p>\n<p>gdb などで実行時のメモリを書き換えてもよさそうでしたが、面倒だったので Ghidra で勝利条件のスコアを 0 に書き換えることにしました。</p>\n<p>パッチしたバイナリを実行すると、1 勝すると Flag を取得できるようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/99043d35649d0608ff6ac6534348e610/ec3e2/image-20230604165229548.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhUlEQVQY02PQl9U1VTS0U7bWFTI0EjcFIh1BfX1hQ30RYxt5Kzdl62BjT0NuNWM+dTtpYztpI0tRPX0uFQMwYphU27144tz1C1ZuWrxm24qN+zftWjRhTnlcXqp79OlDJ2a0Tp7fN2vd/JWzO6cBZed2Tz++93CgkbsWs6whjyrD/s177t64vWnx2ns37h7eceDskVMXjp9bO39lln/SyplLJtf3rp699Oq5y+sXrj625/DiSfMObN2T7h2nziBlxKPGEGTkkembkOoRE2MXHGLiBUKmXpFWfk7yZraShjaShrlBKf66LiBlPgnJ7lF+ei720sZ67EqG3KoMTvLm1uL6QDeoMUhqMctpMslqscgBGUBpPQ4QAlqizSIPROoM0hqMMjqs8kBBoE6Qn701HdxUrIGBYcynAQwVEz4NfU5lEOKAagayIaQBRBzC5VAGaQ4z9/HRcQowdPfVdQay/fVdXVWsXZQsXZWtnRUt3FQhpI2zoqWLkhXQGiDXVcnSXtoEaAoA/op7YvaQvyYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/99043d35649d0608ff6ac6534348e610/8ac56/image-20230604165229548.webp 240w,\n/static/99043d35649d0608ff6ac6534348e610/d3be9/image-20230604165229548.webp 480w,\n/static/99043d35649d0608ff6ac6534348e610/e46b2/image-20230604165229548.webp 960w,\n/static/99043d35649d0608ff6ac6534348e610/c5bb7/image-20230604165229548.webp 997w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/99043d35649d0608ff6ac6534348e610/8ff5a/image-20230604165229548.png 240w,\n/static/99043d35649d0608ff6ac6534348e610/e85cb/image-20230604165229548.png 480w,\n/static/99043d35649d0608ff6ac6534348e610/d9199/image-20230604165229548.png 960w,\n/static/99043d35649d0608ff6ac6534348e610/ec3e2/image-20230604165229548.png 997w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/99043d35649d0608ff6ac6534348e610/d9199/image-20230604165229548.png\"\n            alt=\"image-20230604165229548\"\n            title=\"image-20230604165229548\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"leakrev\" style=\"position:relative;\"><a href=\"#leakrev\" aria-label=\"leakrev permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Leak(Rev)</h2>\n<blockquote>\n<p>サーバーから不審な通信を検出しました！</p>\n<p>調査したところさらに不審なファイルを発見したので、通信記録と合わせて解析してください。</p>\n<p>機密情報が流出してしまったかも…？</p>\n</blockquote>\n<p>与えられた pcap ファイルを参照すると、以下のようなバイト列を C2 に送信していることがわかりました。</p>\n<p>これは何かしら暗号化されたバイト列のようなので、Ghidra でプログラムの解析を行います。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">0x8e,0x57,0xff,0x59,0x45,0xda,0x90,0x06,0x28,0xb2,0xab,0xfa,0x49,0x73,0x32,0x33,0x4a,0x73,0x29,0x41,0x3c,0x34,0xb7,0xf6,0x62,0x73,0x25,0x0f,0x95,0x40,0x16,0xfa,0x47,0xe9,0x22,0x8d,0xa5,0xcd,0x3d,0x53,0xee,0xb4,0xb3,0x51,0x8e,0xd2,0x89,0x93,0x5b,0xe0,0x59,0xcb,0xfb,0xb1,0x1b</code></pre></div>\n<p>デコンパイルした結果を参照したところ、Flag の暗号化は以下の処理で行っているようでした。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 715px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7441c00a033de05e146f64364add24d4/d0c0e/image-20230604165644627.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeklEQVQoz31S7a7bMAjN+z/nbtc2TWKbLwO2M+L7Y6p6N4QQwhwDBxZEInoCHqkA4RPhcZTXTivzwRXM2Y3VdIxxfsiiKlqTKrhTpEp1EgvfXVCxjz5GG1N+ACMi88ZSPKRJawEXdQqnufWmrdV4+Ql7Lm4WlWvFx0op3xG+ctm3tBNtalxrCVWldv0o4vUNbJYR74iPlG85PUr+BeXJLKr5wjTvvfXuo0df7t3fwQoiq0h8n8yoCpjhnDMw/fyvLETR4YoMMVQkT2oC1U1npW5TZ329zBtY2AG+EF9IW8o55W/mrZQijG6hFL2YieXLvBPmhHALeoR/z4UnqVCrIHeprTc2l3+2rVaQboSvPR3rhvtxpLyWIK/cqwqRAKoZ20Ve+1wV475ifr22tB0kNQeFwXOwHSN6697GnNk+72Q5xxl8l/UZPWuc1GT4+6Bm8ph6zmAff+Xyl4hqbKlALrWgz50VES5gRNFwbC52HjYHERkMZrDWuF//A2YD9wacjgAsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7441c00a033de05e146f64364add24d4/8ac56/image-20230604165644627.webp 240w,\n/static/7441c00a033de05e146f64364add24d4/d3be9/image-20230604165644627.webp 480w,\n/static/7441c00a033de05e146f64364add24d4/cb533/image-20230604165644627.webp 715w\"\n              sizes=\"(max-width: 715px) 100vw, 715px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7441c00a033de05e146f64364add24d4/8ff5a/image-20230604165644627.png 240w,\n/static/7441c00a033de05e146f64364add24d4/e85cb/image-20230604165644627.png 480w,\n/static/7441c00a033de05e146f64364add24d4/d0c0e/image-20230604165644627.png 715w\"\n            sizes=\"(max-width: 715px) 100vw, 715px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7441c00a033de05e146f64364add24d4/d0c0e/image-20230604165644627.png\"\n            alt=\"image-20230604165644627\"\n            title=\"image-20230604165644627\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>パット見で Flag の文字列とローカル関数内で作成している Key で XOR しているだけであることがわかります。</p>\n<p>1 文字ずつ生成されている Key を作成する演算を手動でやるのは少々面倒だったので以下の gdb スクリプトで抽出することにしました。</p>\n<p>Key の作成は暗号化対象の文字列には依存しないので、ここで取得した Key はそのまま復号に利用できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># gdb -x run.py</span>\n<span class=\"token keyword\">import</span> gdb\n<span class=\"token keyword\">from</span> pprint <span class=\"token keyword\">import</span> pprint\n\n<span class=\"token comment\"># pprint(dir(gdb))</span>\nBINDIR <span class=\"token operator\">=</span> <span class=\"token string\">\"/home/ubuntu/Hacking/CTF/2023/sec4b/Rev/Leak\"</span>\nBIN <span class=\"token operator\">=</span> <span class=\"token string\">\"leak\"</span>\nINPUT <span class=\"token operator\">=</span> <span class=\"token string\">\"./in.txt\"</span>\nOUT <span class=\"token operator\">=</span> <span class=\"token string\">\"./out.txt\"</span>\nBREAK <span class=\"token operator\">=</span> <span class=\"token string\">\"0x555555555518\"</span>\n\ngdb<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'file {}/{}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>BINDIR<span class=\"token punctuation\">,</span> BIN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ngdb<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'b *{}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>BREAK<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ngdb<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'run &lt; {}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>INPUT<span class=\"token punctuation\">,</span> OUT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nkey <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># register</span>\n    reg <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">.</span>parse_and_eval<span class=\"token punctuation\">(</span><span class=\"token string\">\"$rcx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    key<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> reg <span class=\"token operator\">==</span> <span class=\"token string\">\"0x29\"</span><span class=\"token punctuation\">:</span>\n        gdb<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">\"continue\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># ['0xed', '0x23', '0x99', '0x6d', '0x27', '0xa1', '0xe0', '0x32', '0x51', '0xed', '0xc5', '0xca', '0x16', '0x47', '0x46', '0x47', '0x2f', '0x1d', '0x5d', '0x70', '0xc', '0x5a', '0xe8', '0x82', '0x52', '0x2c', '0x51', '0x3b', '0xf4', '0x34', '0x49', '0x97', '0x73', '0x87', '0x7d', '0xef', '0xc0', '0xa5', '0xc', '0x3d', '0x8a', '0xeb', '0xc7', '0x65', '0xeb', '0x8d', '0xea', '0xe6', '0x29']</span></code></pre></div>\n<p>これで、特定した Key と pcap から抜き出した暗号化バイト列を XOR することで Flag を取得できました。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">key<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">0xed</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x23</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x99</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x27</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x51</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xed</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xca</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x47</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x46</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x47</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x70</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x82</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x52</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x51</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x49</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x97</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x73</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x87</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xef</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xeb</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xeb</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xea</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x29</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xfa</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x95</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xcc</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x11</span><span class=\"token punctuation\">]</span>\nenc<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">0x8e</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x57</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x59</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x45</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xda</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x06</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x28</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb2</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xab</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xfa</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x49</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x73</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x32</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x33</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x4a</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x73</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x29</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x3c</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb7</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xf6</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x62</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x73</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x25</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x0f</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x95</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x16</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xfa</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x47</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xe9</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x22</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x8d</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xa5</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xcd</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x3d</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x53</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xee</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb3</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x51</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x8e</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xd2</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x89</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x93</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x5b</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x59</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xcb</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xfb</span><span class=\"token punctuation\">,</span><span class=\"token number\">0xb1</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x1b</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>enc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">^</span>enc<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>end<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># ctf4b{p4y_n0_4ttent10n_t0_t4at_m4n_beh1nd_t4e_cur4a1n}</span></code></pre></div>\n<h2 id=\"heavenrev\" style=\"position:relative;\"><a href=\"#heavenrev\" aria-label=\"heavenrev permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Heaven(Rev)</h2>\n<blockquote>\n<p>メッセージを暗号化するプログラムを作りました。</p>\n<p>解読してみてください！</p>\n</blockquote>\n<p>問題バイナリとして、暗号化に使用する ELF ファイルと Flag を暗号化した際の出力結果が与えられます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ ./heaven\n------ menu ------\n<span class=\"token number\">0</span>: encrypt message\n<span class=\"token number\">1</span>: decrypt message\n<span class=\"token number\">2</span>: <span class=\"token builtin class-name\">exit</span>\n<span class=\"token operator\">></span> <span class=\"token number\">0</span>\nmessage: ctf4b<span class=\"token punctuation\">{</span>---CENSORED---<span class=\"token punctuation\">}</span>\nencrypted message: ca6ae6e83d63c90bed34a8be8a0bfd3ded34f25034ec508ae8ec0b7f</code></pre></div>\n<p>Ghidra でデコンパイルすると、暗号化を行うための処理は以下のように実装されていることがわかりました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 603px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/058cbfda59067e75e21dbb6779d1d36a/9128f/image-20230604170357860.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 102.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuElEQVQ4y41Ta2+jMBDM//+Xp14gFPBzX/Ya0yVNo/vQ5LAErGTGszM7vvS+x9CmiaalBIAZ55WClLKfWBd7vCvDTGOMS54d+ZVQSj0LznlCmFKCmNETeZZu/ZwEMxfEpQgxe1Vu26Zdt75t21H+B9waEg1orHjL5D/S3yGPUlgkicQ3TdyZCZbFJI8p/lnjHDiVVs50fteconMxpU+iNWCMBral9RRYRBAGc6oUFBUs2A/eM8x9Fy5EjjnVSlWr9fzcPs649/8U0Z+vH+aS85UpZezWbspqBzVFFn6v/GK7WqE1M7cjidVsZ0nCiqUqUEsp5QyIrVQUYaRWK5QiD2YADOHDeeeCeRZqq6wsTVQb8YZo8//GsPlohSrVWn7mrD3nBfEGFEnKdi5eD7D9DDlLId3avm+//vfKsKMiBIARgJJPLmVvA6hcKx7+V+kvDbuDWemWP12MfnVzpCFDjAOCs6ib1Fc6Lt8fy4mPlmSjnFulTU/H065PDJt3ZjuBpEBrJJdsWop4xIZUUZu+uhj9dtuv130cdYAwwhpgihRMCylrExPffgUft1bbPYb7I9B9/8fRd+sLX/aW+cDTnYMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/058cbfda59067e75e21dbb6779d1d36a/8ac56/image-20230604170357860.webp 240w,\n/static/058cbfda59067e75e21dbb6779d1d36a/d3be9/image-20230604170357860.webp 480w,\n/static/058cbfda59067e75e21dbb6779d1d36a/e7dd8/image-20230604170357860.webp 603w\"\n              sizes=\"(max-width: 603px) 100vw, 603px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/058cbfda59067e75e21dbb6779d1d36a/8ff5a/image-20230604170357860.png 240w,\n/static/058cbfda59067e75e21dbb6779d1d36a/e85cb/image-20230604170357860.png 480w,\n/static/058cbfda59067e75e21dbb6779d1d36a/9128f/image-20230604170357860.png 603w\"\n            sizes=\"(max-width: 603px) 100vw, 603px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/058cbfda59067e75e21dbb6779d1d36a/9128f/image-20230604170357860.png\"\n            alt=\"image-20230604170357860\"\n            title=\"image-20230604170357860\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>暗号化を行う対象である message の値が変化していないことから、とりあえず以下の実装以外は無視できることがわかります。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n    lVar11 <span class=\"token operator\">=</span> lVar10 <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    bVar2 <span class=\"token operator\">=</span> <span class=\"token function\">calc_xor</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">[</span>lVar10<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>uVar1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    message<span class=\"token punctuation\">[</span>lVar10<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sbox<span class=\"token punctuation\">[</span>bVar2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    lVar10 <span class=\"token operator\">=</span> lVar11<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>lVar7 <span class=\"token operator\">!=</span> lVar11<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">__printf_chk</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"encrypted message: %02x\"</span><span class=\"token punctuation\">,</span>local_21<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">print_hexdump</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span>lVar7<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>上記のデコンパイル結果から、以下のような処理で暗号化と出力が行われていることがわかります。</p>\n<ol>\n<li>事前にランダムな 1 バイトの値 uVar1 を生成しておく。</li>\n<li>暗号化対象の文字列 message を先頭から 1 文字ずつ、uVar1 とともに calc_xor に与える。</li>\n<li>calc_xor の演算結果を添え字として使用し、sbox にハードコードされている 1 文字を message の文字と置き換える。</li>\n<li>最後に、使用した uVar1 と暗号化した message の Hex 文字列を表示する。</li>\n</ol>\n<p>ここで、Flag を暗号化した際に使用された uVar1 は 0xca であることが出力結果から特定できます。</p>\n<p>また、sbox のバイト列はハードコードされているので、あとは calc_xor の実装さえ特定すれば Flag を復号できます。</p>\n<p>しかし、Ghidra で calc_xor を解析しても、うまく処理を特定することができませんでした。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 914px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef2c3056ff2dd55e0229b7e5a1db78ab/076ca/image-20230604171234531.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrUlEQVQoz22SbW+bMBSF8/9/WdJMTbp+yabRUSjB72AbbIzfZgKtstTWlSXrnodzfM2OqbAWHT0WFos5FeIG8Qn2aZ/J4Igw1dtJilbKqJSNn2vX8nDloRXho7cl1TWxNTWp/oIh7Q2zTe8BU3XdKOVDCPFu7aCMJTN1b2toLkVXQv/rqksyARFb7tvelZ0uGvz68zWpH+GG6hKqtg9YhAY5JB3gGsqAtvJwjH9qcDgcMjBGuCgAY3G2AaLBWscFFmIalfUher+oMSHH448MzPv+2lDvl47Wznk/zlP0MdywVU0pO59fMjCjrKpgglPDzt4F3ymZTmv7E6an0zkHs66u0Oo832Cuh6/2qsYYPz+fMnDX9R81XuAYZrPB7nb+UhNCnp6O2di0qvAWO8Hed3rw4T8YIbTf7/MDa9ttYOud+TQ+xOacXy6/MzAltCyhc0vHGGe9Y0rcCRb1MMjqvYzf1i59FYJuvbO16V29NOrBWUpRFG8ZeHNep22Wd+5v077Pp7VGCGfgvks/Cdmc55vzpB5ESikAQAYWQiDULenCFns004MoOQMAv8P/AG1/n9RyLHTAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ef2c3056ff2dd55e0229b7e5a1db78ab/8ac56/image-20230604171234531.webp 240w,\n/static/ef2c3056ff2dd55e0229b7e5a1db78ab/d3be9/image-20230604171234531.webp 480w,\n/static/ef2c3056ff2dd55e0229b7e5a1db78ab/38f11/image-20230604171234531.webp 914w\"\n              sizes=\"(max-width: 914px) 100vw, 914px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ef2c3056ff2dd55e0229b7e5a1db78ab/8ff5a/image-20230604171234531.png 240w,\n/static/ef2c3056ff2dd55e0229b7e5a1db78ab/e85cb/image-20230604171234531.png 480w,\n/static/ef2c3056ff2dd55e0229b7e5a1db78ab/076ca/image-20230604171234531.png 914w\"\n            sizes=\"(max-width: 914px) 100vw, 914px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ef2c3056ff2dd55e0229b7e5a1db78ab/076ca/image-20230604171234531.png\"\n            alt=\"image-20230604171234531\"\n            title=\"image-20230604171234531\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>仕方がないので objdmp でディスアセンブル結果を取得します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 708px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6502df515445a061c53b247d3611cde3/3cb0f/image-20230604171419586.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.083333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQY0z2RWU/CUBCFXUgAERBXFCnQFrrQlhawOxC6AkoFYhR9UnzU///sKUiTk5vcufPNnJl7EDbtL2/t1HUpQ02YYSR5Tk3TzoVunukXOTlLP0v+4FZZKeGr9uQ1jH6RlU/onQ6m3Oh3+e02DPbwfsqOlkrokQau46oaNgfgEUFpnzLXRrSQg7Blg+9kqRhGsU/3zalrfIoA9siP9UtRypBSmhTTDWjCDIxryaPMueBOWgM+VduRMezW9a1tjT+O4bngICOgLXTG+XDGYRa7rIS0/WEtXvoznzb7hX3nGTf6WWw80uSOqlN2GImeVZZ7Baabb8Ee+q+6kzGhAo5EF+bVUlvJNf874w7beG6nanAxrPSwKpDKaRPqZCgw1o2MNJ+yUBRMDOf28CZ438JEQFlYwajSg2GfNHzKUEs8TA3vunCOcfARPmli+agbw/qF4BAqkuDQuBIxJOZJjCVCJFES/AMQvlbOGa46GAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6502df515445a061c53b247d3611cde3/8ac56/image-20230604171419586.webp 240w,\n/static/6502df515445a061c53b247d3611cde3/d3be9/image-20230604171419586.webp 480w,\n/static/6502df515445a061c53b247d3611cde3/3f436/image-20230604171419586.webp 708w\"\n              sizes=\"(max-width: 708px) 100vw, 708px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6502df515445a061c53b247d3611cde3/8ff5a/image-20230604171419586.png 240w,\n/static/6502df515445a061c53b247d3611cde3/e85cb/image-20230604171419586.png 480w,\n/static/6502df515445a061c53b247d3611cde3/3cb0f/image-20230604171419586.png 708w\"\n            sizes=\"(max-width: 708px) 100vw, 708px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6502df515445a061c53b247d3611cde3/3cb0f/image-20230604171419586.png\"\n            alt=\"image-20230604171419586\"\n            title=\"image-20230604171419586\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>なぜこのようなことをしているのかはよくわからなかったのですが、0x404181 のアドレスから定義されている値をスタックポインタに格納した後、lret で pop させる処理をしているようです。</p>\n<p>意図はわかりませんでしたが、gdb で解析すると以下のような処理を行っていることがわかりました。</p>\n<ol>\n<li>受け取った Flag 文字を1 バイト減らす。</li>\n<li>[1.] の結果を uVar1 で XOR する。</li>\n</ol>\n<p>というわけで、これらをリバースするために以下のスクリプトを作成し、 Flag を取得することができました。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">sbox <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0xc2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x53</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xbb</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xb5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x17</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x24</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xcd</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x39</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x52</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x99</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x03</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x69</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x73</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x43</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x19</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x94</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xb9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x36</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x25</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x18</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x02</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xdb</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xb3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x90</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x98</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x74</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xaa</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xea</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x72</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x14</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x23</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x96</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x62</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x46</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x22</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x08</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xac</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x44</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xfe</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x84</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xfb</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x15</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x91</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x56</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xeb</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x33</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x27</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x54</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xbf</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xda</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x68</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xb7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x35</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xca</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x09</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xb8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xde</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x82</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xad</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x64</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x45</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x85</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xaf</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xfc</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xb4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x29</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x60</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x75</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xce</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xcc</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x04</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x67</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x92</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x93</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xdd</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x13</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x95</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x88</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x47</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x05</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xed</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x63</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xcb</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xdc</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xb0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x57</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xbe</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xbd</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xec</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x59</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x26</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xb1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x86</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x70</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x37</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x71</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x77</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xdf</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xba</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x55</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x79</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x07</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x83</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x97</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x61</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xab</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xbc</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x89</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xae</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x51</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xb6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xb2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xfd</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xfa</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x87</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xef</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xee</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4e</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x66</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xcf</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x49</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x48</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x21</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x76</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xd0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x42</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x58</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span> <span class=\"token punctuation\">]</span>\n\nenc <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0x6a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x63</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xed</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xa8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xbe</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xfd</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3d</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xed</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xf2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xec</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xe8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xec</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0b</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7f</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># unk はランダムな 1 バイト</span>\n<span class=\"token comment\"># bVar1 = calc_xor(message[k],unk);</span>\n<span class=\"token comment\"># message[k] = sbox[bVar1];</span>\n\n<span class=\"token comment\"># for i in range(256):</span>\nflag <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n<span class=\"token keyword\">for</span> e <span class=\"token keyword\">in</span> enc<span class=\"token punctuation\">:</span>\n    bVar1 <span class=\"token operator\">=</span> sbox<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n    flag <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>bVar1 <span class=\"token operator\">^</span> <span class=\"token number\">0xca</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"yaromisc\" style=\"position:relative;\"><a href=\"#yaromisc\" aria-label=\"yaromisc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>YARO(Misc)</h2>\n<blockquote>\n<p>サーバーにマルウェアが混入している可能性があるので、あなたの完璧なシグネチャで探してください</p>\n</blockquote>\n<p>比較的珍しい YARA の問題でテンションが上がりました。</p>\n<p>サーバには YARA ルールのテキストを送ることができ、root 配下のファイルに対して送信したルールを検証した結果を返してくれます。</p>\n<p>このとき、サーバには複数のルールをまとめて送ることができ、マッチしたルールのルール名についても教えてくれます。</p>\n<p>シンプルに先頭から 1 文字ずつ特定すればいいことがわかるので、効率的にブルートフォースを行うために Flag の文字種と長さを特定することにしました。</p>\n<p>まず、以下のような定義を含むルールを送り付けて Flag の長さを 2 分探索で特定しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token variable\">$ctf4b_string</span> <span class=\"token operator\">=</span> /.*ctf4b<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">{</span>.<span class=\"token punctuation\">{</span><span class=\"token number\">20,30</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">}</span>.*/\n<span class=\"token variable\">$ctf4b_string</span> <span class=\"token operator\">=</span> /.*ctf4b<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">{</span>.<span class=\"token punctuation\">{</span><span class=\"token number\">25,30</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">}</span>.*/\n<span class=\"token variable\">$ctf4b_string</span> <span class=\"token operator\">=</span> /.*ctf4b<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">{</span>.<span class=\"token punctuation\">{</span><span class=\"token number\">28,30</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">}</span>.*/\n<span class=\"token variable\">$ctf4b_string</span> <span class=\"token operator\">=</span> /.*ctf4b<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">{</span>.<span class=\"token punctuation\">{</span><span class=\"token number\">28</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">}</span>.*/</code></pre></div>\n<p>最終的に Flag のかっこ内の長さは 28 文字であることがわかりました。</p>\n<p>つづいて、以下のような定義を送り、Flag の文字種を特定しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token variable\">$ctf4b_string</span> <span class=\"token operator\">=</span> /.*ctf4b<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span>-9<span class=\"token operator\">|</span>A-Z<span class=\"token operator\">|</span>a-z<span class=\"token punctuation\">]</span><span class=\"token punctuation\">{</span><span class=\"token number\">28</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">}</span>.*/\n<span class=\"token variable\">$ctf4b_string</span> <span class=\"token operator\">=</span> /.*ctf4b<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span>-9<span class=\"token operator\">|</span>a-z<span class=\"token operator\">|</span>_<span class=\"token punctuation\">]</span><span class=\"token punctuation\">{</span><span class=\"token number\">28</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">}</span>.*/\n<span class=\"token variable\">$ctf4b_string</span> <span class=\"token operator\">=</span> /.*ctf4b<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>A-Z<span class=\"token operator\">|</span>a-z<span class=\"token operator\">|</span>_<span class=\"token punctuation\">]</span><span class=\"token punctuation\">{</span><span class=\"token number\">28</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">}</span>.*/\n<span class=\"token variable\">$ctf4b_string</span> <span class=\"token operator\">=</span> /.*ctf4b<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span>-9<span class=\"token operator\">|</span>A-Z<span class=\"token operator\">|</span>_<span class=\"token punctuation\">]</span><span class=\"token punctuation\">{</span><span class=\"token number\">28</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">}</span>.*/</code></pre></div>\n<p>大文字、小文字、数字、そしてアンダーバーが使用されていることがわかります。</p>\n<p>というわけで、先頭から 1 文字ずつ Flag の文字を特定可能なルールを送信する以下のような Solver スクリプトを作成し、Flag を取得することができました。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    allrule <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n    p <span class=\"token operator\">=</span> remote<span class=\"token punctuation\">(</span><span class=\"token string\">\"yaro.beginners.seccon.games\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5003</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">for</span> c <span class=\"token keyword\">in</span> <span class=\"token string\">\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_\"</span><span class=\"token punctuation\">:</span>\n        c <span class=\"token operator\">=</span> c\n        R <span class=\"token operator\">=</span> <span class=\"token string\">\".\"</span> <span class=\"token operator\">*</span> i\n        L <span class=\"token operator\">=</span> <span class=\"token number\">28</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token operator\">-</span>i\n        sig <span class=\"token operator\">=</span> R <span class=\"token operator\">+</span> c <span class=\"token operator\">+</span> <span class=\"token string\">\"[0-9|A-Z|a-z|_]{\"</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>L<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span><span class=\"token string\">\"}\"</span>\n        <span class=\"token keyword\">if</span> c <span class=\"token operator\">==</span> <span class=\"token string\">\"_\"</span><span class=\"token punctuation\">:</span>\n            c <span class=\"token operator\">=</span> <span class=\"token string\">\"ubar\"</span>\n        rule <span class=\"token operator\">=</span> <span class=\"token string\">\"rule check_\"</span> <span class=\"token operator\">+</span> c <span class=\"token operator\">+</span><span class=\"token triple-quoted-string string\">\"\"\" {\n    strings:\n        $ctf4b_string = /.*ctf4b\\{\"\"\"</span> <span class=\"token operator\">+</span> sig <span class=\"token operator\">+</span> <span class=\"token triple-quoted-string string\">\"\"\"\\}.*/\n    condition:\n        $ctf4b_string\n}\n\"\"\"</span>\n        allrule <span class=\"token operator\">+=</span> rule\n\n    r <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>recvuntil<span class=\"token punctuation\">(</span><span class=\"token string\">b\"rule:\\n\"</span><span class=\"token punctuation\">)</span>\n    p<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>allrule<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    r <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>recvuntil<span class=\"token punctuation\">(</span><span class=\"token string\">b\"Not found: ./server.py\\n\"</span><span class=\"token punctuation\">)</span>\n    r <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span>\n    p<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_Y]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_3]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_t]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_ubar]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_A]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_n]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_0]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_t]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_h]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_3]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_r]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_ubar]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_R]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_3]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_4]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_d]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_ubar]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_O]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_p]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_p]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_0]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_r]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_t]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_u]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_n]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_1]\\n'</span>\n<span class=\"token comment\"># b'Found: ./flag.txt, matched: [check_t]\\n'</span>\n\n<span class=\"token comment\"># ctf4b{Y3t_An0th3r_R34d_Opp0rtun1ty}</span></code></pre></div>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>上位までの壁の厚さを感じますが、今回も楽しく参加することができました。</p>\n<p>0nePadding のチームも少しメンバーが増えて楽しくなってきたところですので、引き続き頑張ります。</p>","fields":{"slug":"/ctf-sec4b-2023","tagSlugs":["/tag/ctf/","/tag/rev/","/tag/misc/"]},"frontmatter":{"date":"2023-06-04","description":"SECCON Beginners CTF 2023 の Writeup です。","tags":["CTF","Rev","Misc"],"title":"SECCON Beginners CTF 2023 Writeup","socialImage":{"publicURL":"/static/1bfd4cd0fea6a9c48d5416f52eb429fa/ctf-sec4b-2023.png"}}}},"pageContext":{"slug":"/ctf-sec4b-2023"}},"staticQueryHashes":["251939775","401334301","825871152"]}