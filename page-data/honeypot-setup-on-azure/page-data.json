{"componentChunkName":"component---src-templates-post-template-js","path":"/honeypot-setup-on-azure","result":{"data":{"markdownRemark":{"id":"db342424-2a34-5bd5-87cf-d7dcd2a461f1","html":"<p>これからAzureで遊んでいこうと思っているわけですが、まずは前から興味のあった<a href=\"https://github.com/telekom-security/tpotce\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">T-Pot</a>というハニーポットを植えてみたいと思います。</p>\n<p><a href=\"https://amzn.to/34tqh58\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">サイバー攻撃の足跡を分析する ハニーポット観察記録 [ハニーポット観察記録]</a>という本を読んでからずっとやりたいと思っていたのですが、リスクやコスト面からなかなか実施に踏み切れずにいました。</p>\n<p>今回はAzureを使うといい感じにできそうということになったので、Azure環境上でT-Potを構築していきます。</p>\n<p>色々手探りですが安全第一で進めていきます。</p>\n<p>当方初心者につき、本記事の内容は必ずしもベストプラクティスにはなっていないと思いますので、改善点があり次第追加していこうと思います。</p>\n<h2 id=\"記事について\" style=\"position:relative;\"><a href=\"#%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\" aria-label=\"記事について permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>記事について</h2>\n<p><strong>本記事の内容は社会秩序に反する行為を推奨することを目的としたものではございません。</strong></p>\n<p>自身の所有する環境、もしくは許可された環境以外への攻撃の試行は、「不正アクセス行為の禁止等に関する法律（不正アクセス禁止法）」に違反する可能性があること、予めご留意ください。</p>\n<p>またすべての発言は所属団体ではなく個人に帰属します。</p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li><a href=\"#%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\">記事について</a></li>\n<li><a href=\"#%E4%BA%8B%E5%89%8D%E3%81%AB%E6%B1%BA%E3%82%81%E3%81%9F%E3%81%93%E3%81%A8%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8\">事前に決めたこと&#x26;確認したこと</a></li>\n<li>\n<p><a href=\"#%E8%AD%A6%E5%AF%9F%E3%81%AE%E3%81%8A%E4%B8%96%E8%A9%B1%E3%81%AB%E3%81%AA%E3%82%89%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\">警察のお世話にならないようにする</a></p>\n<ul>\n<li><a href=\"#%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E4%B8%8D%E6%AD%A3%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E5%8F%96%E5%BE%97%E4%BF%9D%E6%8C%81%E3%81%97%E3%81%AA%E3%81%84\">マルウェア、不正プログラムを取得・保持しない</a></li>\n<li><a href=\"#247%E7%A8%BC%E5%83%8D%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F%E4%BB%BB%E6%84%8F%E3%81%AB%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%9F%E6%99%82%E9%96%93%E4%BB%A5%E5%A4%96%E3%81%AF%E8%87%AA%E5%8B%95%E7%9A%84%E3%81%AB%E3%82%B7%E3%83%A3%E3%83%83%E3%83%88%E3%83%80%E3%82%A6%E3%83%B3%E3%81%95%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\">24*7稼働ではなく、任意に起動した時間以外は自動的にシャットダウンされるようにする</a></li>\n<li><a href=\"#%E3%83%9B%E3%82%B9%E3%83%88%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E5%AF%BE%E7%AD%96%E3%82%92%E5%8D%81%E5%85%A8%E3%81%AB%E3%81%99%E3%82%8B\">ホストのセキュリティ対策を十全にする</a></li>\n<li><a href=\"#%E3%83%9B%E3%82%B9%E3%83%88%E3%81%AE%E7%A8%BC%E5%83%8D%E7%8A%B6%E6%B3%81%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%9B%A3%E8%A6%96%E3%81%A8%E9%80%9A%E7%9F%A5%E3%81%AE%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\">ホストの稼働状況について監視と通知のシステムを構築する</a></li>\n<li><a href=\"#%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%81%B8%E3%81%AE%E6%8E%A5%E7%B6%9A%E3%81%AB%E3%81%AFazure%E3%81%A7%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%9F%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%81%AE%E3%83%9E%E3%82%B7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%86\">ハニーポットへの接続にはAzureで構築した踏み台のマシンを使う</a></li>\n<li><a href=\"#%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E8%BF%BD%E8%A8%98\">踏み台サーバに関する追記</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#azure%E3%81%AE%E8%A6%8F%E7%B4%84%E3%82%92%E5%AE%88%E3%82%8B\">Azureの規約を守る</a></p>\n<ul>\n<li><a href=\"#%E7%A6%81%E6%AD%A2%E4%BA%8B%E9%A0%85\">禁止事項</a></li>\n<li><a href=\"#%E8%A8%B1%E5%8F%AF%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8\">許可されていること</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#azure%E3%81%AB%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\">Azureに仮想マシンを構築する</a></p>\n<ul>\n<li><a href=\"#%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E7%92%B0%E5%A2%83%E7%94%A8%E3%81%AE%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E4%BD%9C%E6%88%90\">ハニーポット環境用のリソースグループの作成</a></li>\n<li><a href=\"#%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AB%E9%81%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E4%BD%9C%E6%88%90\">ハニーポットマシンに適用するセキュリティグループの作成</a></li>\n<li><a href=\"#%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E4%BB%AE%E6%83%B3%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E4%BD%9C%E6%88%90\">ハニーポットマシンの仮想ネットワークの作成</a></li>\n<li><a href=\"#%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90\">仮想マシンの作成</a></li>\n<li><a href=\"#%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3\">ハニーポットマシン</a></li>\n<li><a href=\"#%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90\">踏み台サーバ</a></li>\n<li><a href=\"#%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%BF%BD%E8%A8%98\">踏み台サーバのサイズについて(追記)</a></li>\n<li><a href=\"#%E7%92%B0%E5%A2%83%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97\">環境のセットアップ</a></li>\n<li><a href=\"#dns%E5%90%8D%E3%81%AE%E6%A7%8B%E6%88%90\">DNS名の構成</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#azure-sentinel%E3%81%AE%E6%A7%8B%E7%AF%89\">Azure Sentinelの構築</a></p>\n<ul>\n<li><a href=\"#%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%81%ABlinux-agent%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\">踏み台サーバにLinux Agentをインストールする</a></li>\n<li><a href=\"#%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE514%E3%83%9D%E3%83%BC%E3%83%88%E5%BE%85%E3%81%A1%E5%8F%97%E3%81%91%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B\">踏み台サーバの514ポート待ち受けを有効化する</a></li>\n<li><a href=\"#cloud-one%E3%81%AEsyslog%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%8B%E3%82%89%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AB%E8%BB%A2%E9%80%81%E3%81%99%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B\">Cloud OneのSyslogイベントをハニーポットマシンから踏み台サーバに転送するように構成する</a></li>\n</ul>\n</li>\n<li><a href=\"#%E8%A3%9C%E8%B6%B3%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E6%8B%A1%E5%BC%B5\">補足：ハニーポットマシンのディスク拡張</a></li>\n<li><a href=\"#%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\">スナップショットの作成</a></li>\n<li>\n<p><a href=\"#t-pot%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\">T-Potのインストール</a></p>\n<ul>\n<li><a href=\"#docker%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%AE%E8%BF%BD%E5%8A%A0\">Dockerユーザの追加</a></li>\n<li><a href=\"#ssh%E3%83%80%E3%82%A4%E3%83%8A%E3%83%9F%E3%83%83%E3%82%AF%E3%83%95%E3%82%A9%E3%83%AF%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%A7%E8%B8%8F%E3%81%BF%E5%8F%B0%E7%B5%8C%E7%94%B1%E3%81%A7t-pot%E3%81%AB%E6%8E%A5%E7%B6%9A\">SSHダイナミックフォワーディングで踏み台経由でT-Potに接続</a></li>\n</ul>\n</li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n<li><a href=\"#%E5%8F%82%E8%80%83%E6%9B%B8%E7%B1%8D\">参考書籍</a></li>\n</ul>\n<h2 id=\"事前に決めたこと確認したこと\" style=\"position:relative;\"><a href=\"#%E4%BA%8B%E5%89%8D%E3%81%AB%E6%B1%BA%E3%82%81%E3%81%9F%E3%81%93%E3%81%A8%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8\" aria-label=\"事前に決めたこと確認したこと permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>事前に決めたこと&#x26;確認したこと</h2>\n<p>とりあえずAzureでハニーポット環境を作るにあたって以下の2点について事前に決定&#x26;確認を行いました</p>\n<ul>\n<li>警察のお世話にならないようにする</li>\n<li>Azureの規約を守る</li>\n</ul>\n<p>特に上記の2点に気を付けてやっていこうと思います。</p>\n<h2 id=\"警察のお世話にならないようにする\" style=\"position:relative;\"><a href=\"#%E8%AD%A6%E5%AF%9F%E3%81%AE%E3%81%8A%E4%B8%96%E8%A9%B1%E3%81%AB%E3%81%AA%E3%82%89%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\" aria-label=\"警察のお世話にならないようにする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>警察のお世話にならないようにする</h2>\n<p>何よりもこれを重視してます笑</p>\n<p>普通に警察に逮捕・勾留、またはコインハイブ事件やWizard Bible事件みたいに略式起訴されたら、PCが押収されたり仕事ができなくなったりして詰む感じですね。</p>\n<p>実際に自分に全く罪はなくても、警察側の誤解で家宅捜索されたりする負けイベントが発生する場合もあるらしいので無理ゲーですが、できる対策は可能な限り取っていきたいと思います。</p>\n<p>参考：<a href=\"https://yashio.hatenablog.com/entry/20220208/1644325200\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">逮捕にそなえる人生継続計画 - やしお</a></p>\n<p>他の例でも、「レンタルサーバで運営していたサイトがクラッキングされた結果、警察の家宅捜索が入った」とか、詐欺サイトが運営されていたレンタルサーバの管理者が事情聴取されたとか、結構怖い話がちらほらあります。</p>\n<p>正直日本で生活している人間が、個人的にセキュリティ関連の活動をするのは結構リスクがあると考えてます。</p>\n<p>(それもあってずっとハニーポット建てるの避けてました。)</p>\n<p>とはいえやることに決めた以上はできるだけリスクを避けられる運用に取り組んでいこうと思います。</p>\n<p>具体的には、環境を建てることにした2022/02/09時点では以下の点を想定しています。</p>\n<ul>\n<li>マルウェア、不正プログラムを取得・保持しない</li>\n<li>24*7稼働ではなく、任意に起動した時間以外は自動的にシャットダウンされるようにする</li>\n<li>ホストのセキュリティ対策を十全にする</li>\n<li>ホストの稼働状況について監視と通知のシステムを構築する</li>\n<li>ハニーポットへの接続にはAzureで構築した踏み台のマシンを使う</li>\n</ul>\n<h3 id=\"マルウェア不正プログラムを取得保持しない\" style=\"position:relative;\"><a href=\"#%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E4%B8%8D%E6%AD%A3%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E5%8F%96%E5%BE%97%E4%BF%9D%E6%8C%81%E3%81%97%E3%81%AA%E3%81%84\" aria-label=\"マルウェア不正プログラムを取得保持しない permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>マルウェア、不正プログラムを取得・保持しない</h3>\n<p>そもそも<a href=\"https://github.com/telekom-security/tpotce\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">T-Pot</a>は、ざっくり言うと様々なハニーポットを動かすことができるツールです。</p>\n<p>この中には、マルウェア収集を目的としたハニーポットもあります。</p>\n<p>参考：<a href=\"https://tech-lab.sios.jp/archives/26325\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ハニーポット is 何？実際に作って触ってみる 構築編 | SIOS Tech. Lab</a></p>\n<p>今回は、このマルウェア収集を目的としたハニーポットは当面使用せずに運用しようと思います。</p>\n<p>というのも、<a href=\"https://www.keishicho.metro.tokyo.lg.jp/kurashi/cyber/law/virus.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">不正指令電磁的記録に関する罪</a>に引っかかるのが怖いからです。</p>\n<p>この法律ですが、「悪用目的での」マルウェアの保持を禁止する法律ではあるのですが、残念ながらこの基準はかなりあいまいな現状があるようです。</p>\n<blockquote>\n<p>ウイルスの取得・保管罪とは</p>\n<p>正当な理由がないのに、その使用者の意図とは無関係に勝手に実行されるようにする目的で、コンピュータ・ウイルスやコンピュータ・ウイルスのソースコードを取得、保管する行為をいいます。</p>\n</blockquote>\n<p>参考：<a href=\"https://www.keishicho.metro.tokyo.lg.jp/kurashi/cyber/law/virus.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">不正指令電磁的記録に関する罪　警視庁</a></p>\n<p>下記サイトには、<a href=\"https://twitter.com/it_giron\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@it_giron</a>さんが各県警に「不正指令電磁的記録に関する罪」の構成要件について開示請求を行った結果がまとまっており、非常に参考になります。</p>\n<p>参考：<a href=\"https://it-giron.com/262\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">「不正指令電磁的記録に関する罪」 各都道府県警への構成要件等の開示請求状況 | IT議論</a></p>\n<h3 id=\"247稼働ではなく任意に起動した時間以外は自動的にシャットダウンされるようにする\" style=\"position:relative;\"><a href=\"#247%E7%A8%BC%E5%83%8D%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F%E4%BB%BB%E6%84%8F%E3%81%AB%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%9F%E6%99%82%E9%96%93%E4%BB%A5%E5%A4%96%E3%81%AF%E8%87%AA%E5%8B%95%E7%9A%84%E3%81%AB%E3%82%B7%E3%83%A3%E3%83%83%E3%83%88%E3%83%80%E3%82%A6%E3%83%B3%E3%81%95%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\" aria-label=\"247稼働ではなく任意に起動した時間以外は自動的にシャットダウンされるようにする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>24*7稼働ではなく、任意に起動した時間以外は自動的にシャットダウンされるようにする</h3>\n<p>当面は、Azureの自動シャットダウン機能を用いてハニーポットのマシンを夜間は停止して運用していこうと思います。</p>\n<p>ある程度運用が確立してきたら稼働時間を延ばしていこうと思います。</p>\n<h3 id=\"ホストのセキュリティ対策を十全にする\" style=\"position:relative;\"><a href=\"#%E3%83%9B%E3%82%B9%E3%83%88%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E5%AF%BE%E7%AD%96%E3%82%92%E5%8D%81%E5%85%A8%E3%81%AB%E3%81%99%E3%82%8B\" aria-label=\"ホストのセキュリティ対策を十全にする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ホストのセキュリティ対策を十全にする</h3>\n<p>たぶんここが一番リスクが大きいように感じます。</p>\n<p>何かの理由でハニーポットが侵害されてBOT化した場合、他のユーザに対して攻撃を行ったり、不正なファイルの中継サーバになる可能性があります。</p>\n<p>これを防ぐために、セキュリティ対策と監視の仕組みを作っていきたいと思ってます。</p>\n<p>とりあえずハニーポットを構築するマシンでは、<a href=\"https://www.trendmicro.com/ja_jp/business/products/hybrid-cloud/cloud-one-workload-security.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Trend Micro Cloud One Workload Security</a>のAgentをインストールします。</p>\n<p>このセキュリティソフトですが、最大5台まで無料で管理でき、かつアンチマルウェアやホスト型IDS、重要ファイルの変更監視、アプリケーションのホワイトリスト運用などができます。</p>\n<p>（また、前の仕事で使ったことがあり、個人的に運用に精通しているという理由もあります）</p>\n<p>※ 以下追記</p>\n<p>なんと、2022/01/31よりライセンス方式が変更になり、5台までの無料利用ができなくなってしまったようです。。</p>\n<p>悲しい。</p>\n<p>参考：<a href=\"https://community-trendmicro.force.com/solution/000290385\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">“Free - 5 Computers” End of Support for Trend Micro Cloud One - Workload Security and Deep Security as a Service</a></p>\n<p>近いうちにOSSのEDRツールあたりに切り替えようと思います。</p>\n<h3 id=\"ホストの稼働状況について監視と通知のシステムを構築する\" style=\"position:relative;\"><a href=\"#%E3%83%9B%E3%82%B9%E3%83%88%E3%81%AE%E7%A8%BC%E5%83%8D%E7%8A%B6%E6%B3%81%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%9B%A3%E8%A6%96%E3%81%A8%E9%80%9A%E7%9F%A5%E3%81%AE%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\" aria-label=\"ホストの稼働状況について監視と通知のシステムを構築する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ホストの稼働状況について監視と通知のシステムを構築する</h3>\n<p>ホストの稼働状況について監視と稼働をちゃんとやっていこうと思います。</p>\n<p>各種ログやイベントをSlackかDiscordに転送します。</p>\n<p>また、コスト面については、SMSとメール通知を実施しています。</p>\n<p>コストのアラート設定については以下の記事でまとめました。</p>\n<p>参考：<a href=\"/azure-setup-on-money\">Azure Active Directory の ID セキュリティスコアを確認してみる</a></p>\n<!-- ### アウトバウンド通信の制御\n\nもし万が一ハニーポットのホストがBOT化されてしまった場合のために、セキュリティグループでアウトバウンド通信を制御しておこうと思います。\n\nなお、恐らくすべてのアウトバウンド通信をブロックするとハンドシェイクもできなくなるので、0-1023までの範囲のポートへのアウトバウンド通信のみを制御ます。\n\nこれならもし何か問題が起きた場合でも、他のサービスに対してハニーポットマシン側から自発的に攻撃を仕掛けるリスクは最小化できるかと思います。\n\nなお、後述する Cloud One の管理マネージャとの接続やSyslogの転送など、必要なアウトバウンド通信は明示的に許可しておく必要があります。 -->\n<h3 id=\"ハニーポットへの接続にはazureで構築した踏み台のマシンを使う\" style=\"position:relative;\"><a href=\"#%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%81%B8%E3%81%AE%E6%8E%A5%E7%B6%9A%E3%81%AB%E3%81%AFazure%E3%81%A7%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%9F%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%81%AE%E3%83%9E%E3%82%B7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%86\" aria-label=\"ハニーポットへの接続にはazureで構築した踏み台のマシンを使う permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ハニーポットへの接続にはAzureで構築した踏み台のマシンを使う</h3>\n<p>一応今回はマルウェアは収集しない予定ですのでそこまでリスクはないかと思いますが、うっかり自分の環境にハニーポット上の悪いものを落としてこないように、ハニーポットへの接続は踏み台経由になるようにしておきます。</p>\n<h3 id=\"踏み台サーバに関する追記\" style=\"position:relative;\"><a href=\"#%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E8%BF%BD%E8%A8%98\" aria-label=\"踏み台サーバに関する追記 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>踏み台サーバに関する追記</h3>\n<p>踏み台サーバ経由のアクセスのために踏み台用の仮想マシンを作成してSSHポートフォワーディングでアクセスさせたものの、非常に通信が不安定になりました。</p>\n<p>恐らく踏み台マシンが1vCPU / 1 RAMのスペックであるせいかとは思うのですが、踏み台サーバのスペックを上げるのはコスト的に厳しいこともあり、最終的にプライベートマシン上に建てた仮想マシンからT-Potマシンにアクセスさせることにしました。</p>\n<p>Azure上の踏み台サーバは、Sentinel Agentを動かすSyslogサーバ兼、ハニーポットの監視ツールや通知プログラムを動かす用途に使おうと思います。</p>\n<p>なお、T-Potコンソールへのアクセスは、自宅のグローバルIPアドレスで絞りました。</p>\n<h2 id=\"azureの規約を守る\" style=\"position:relative;\"><a href=\"#azure%E3%81%AE%E8%A6%8F%E7%B4%84%E3%82%92%E5%AE%88%E3%82%8B\" aria-label=\"azureの規約を守る permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Azureの規約を守る</h2>\n<p>今回はAzureにハニーポットを建てるので規約を確認しておきました。</p>\n<p>AzureのQ&#x26;Aサイトを見ると、特にハニーポットの運用は禁止されていないようです。</p>\n<p>参考：<a href=\"https://docs.microsoft.com/en-us/answers/questions/318375/deployed-tpot-on-azure-vm.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Deployed tpot on azure VM - Microsoft Q&#x26;A</a></p>\n<p>参考：<a href=\"https://blackle0pard.net/wxn7jq/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ハニーポットの運用が規約違反でないか調べてみた#2 - くろひょうのぶろぐ</a></p>\n<p>ただし、以下の行為は禁止されているため、これらに該当しないように注意する必要があります。</p>\n<p>いずれの場合も、影響範囲が自分の環境のみであれば問題なく、他のユーザやAzureそのものへの攻撃がNGになるようです。</p>\n<h3 id=\"禁止事項\" style=\"position:relative;\"><a href=\"#%E7%A6%81%E6%AD%A2%E4%BA%8B%E9%A0%85\" aria-label=\"禁止事項 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>禁止事項</h3>\n<ul>\n<li>他のマイクロソフトクラウドのお客様が所有する資産をスキャンまたはテストすること。</li>\n<li>完全に自分自身のものではないデータにアクセスすること。</li>\n<li>あらゆる種類のサービス拒否のテストを実行すること。</li>\n<li>お客様の Azure 仮想マシン以外の資産に対して、ネットワーク集約的なファジングを実行すること。</li>\n<li>大量のトラフィックを発生させるサービスの自動テストを実施すること。</li>\n<li>他のお客様のデータへ故意にアクセスすること。</li>\n<li>インフラストラクチャの実行問題に対する「概念実証」以上の再現手順を実施すること。\n（例：SQLiでシステム管理者アクセス権があることを証明することは許容されるが、xp_cmdshellを実行することは許されない）</li>\n<li>Microsoft Online Service Terms に規定されている Acceptable Use Policy に違反する方法で弊社のサービスを使用すること。</li>\n<li>当社の従業員に対してフィッシングやその他のソーシャルエンジニアリング攻撃を試みること。</li>\n</ul>\n<h3 id=\"許可されていること\" style=\"position:relative;\"><a href=\"#%E8%A8%B1%E5%8F%AF%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8\" aria-label=\"許可されていること permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>許可されていること</h3>\n<p>逆に、以下の行為は許可されているようです。</p>\n<ul>\n<li>アカウント間またはテナント間のデータ アクセスを実演および証明するために、少数のテストアカウントおよび/またはトライアルテナントを作成すること。\n※ ただし、これらのアカウントの1つを使用して、他のお客様やアカウントのデータにアクセスすることは禁止されています。</li>\n<li>お客様自身のAzure仮想マシンに対して、ファジング、ポートスキャン、または脆弱性評価ツールを実行する。</li>\n<li>通常の業務で発生することが予想されるトラフィックを生成して、お客様のアプリケーションを負荷テストすること。これには、サージキャパシティのテストも含まれます。</li>\n<li>セキュリティ監視と検出のテストの実施。（例：異常なセキュリティログの生成、EICARのドロップなど）</li>\n<li>\n<p>Azure Websites や Azure Functions などの共有サービスコンテナからの脱却を試みる。</p>\n<p>ただし、成功した場合は、直ちにマイクロソフトに報告し、深掘りを中止する必要があります。他のお客様のデータに故意にアクセスすることは、規約違反となります。</p>\n</li>\n<li>Microsoft Intune 内で条件付きアクセスまたはモバイルアプリケーション管理 (MAM) ポリシーを適用し、これらのポリシーによって強制される制限の実施をテストすること。</li>\n</ul>\n<h2 id=\"azureに仮想マシンを構築する\" style=\"position:relative;\"><a href=\"#azure%E3%81%AB%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\" aria-label=\"azureに仮想マシンを構築する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Azureに仮想マシンを構築する</h2>\n<p><a href=\"https://github.com/telekom-security/tpotce\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">T-Pot</a>のシステム要件は以下です。</p>\n<ul>\n<li>RAM 8GB</li>\n<li>SSD 128GB</li>\n<li>Network via DHCP</li>\n<li>インターネットアクセス環境(プロキシ無し)</li>\n</ul>\n<p>上記を満たすように、Debian 10 (Buster) のマシンを作成します。</p>\n<p>仮想マシン作成のために、以下のリソースを先に作成することにします。</p>\n<ul>\n<li>ハニーポット環境用のリソースグループ</li>\n<li>ハニーポットマシンに適用するセキュリティグループ</li>\n<li>ハニーポットマシンの仮想ネットワーク</li>\n</ul>\n<h3 id=\"ハニーポット環境用のリソースグループの作成\" style=\"position:relative;\"><a href=\"#%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E7%92%B0%E5%A2%83%E7%94%A8%E3%81%AE%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"ハニーポット環境用のリソースグループの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ハニーポット環境用のリソースグループの作成</h3>\n<p>リソースグループを設定することで、複数のリソースをまとめて管理することができます。</p>\n<p>参考：<a href=\"https://docs.microsoft.com/ja-jp/azure/azure-resource-manager/management/manage-resource-groups-portal\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">リソース グループの管理 - Azure portal - Azure Resource Manager | Microsoft Docs</a></p>\n<p>今回は以下のようなリソースグループを作成し、タグの設定も行いました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3534bac660d0649f6f4767c34aff2da0/0b533/image-17.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAARlAAAEZQAGA43XUAAACTUlEQVQ4y51TTW/VMBDM3+8HgkP/CJeeOHEBtaByKRIVBdT3eG0+7SS2YydOhlm3qRr1hqVVnLU9np0dZ3k3oFAdilpB24AxzgAW/O/Iis5gv7vD4fAX0xiwLI9gMUZMDO95ycT5NGEcx5Sb+B/nOe1JMS9pfWYuK4sCdV3BDw7WGPR9x4UFPoyJpx8GBJJmCsF7GGvRW5fWB8cz/HdhQtd1CCEg298/oCpydK2GswaGgPv9Ht+vr3Hz8xY/fu9wT/aSK8vyubQwxgT0quTOeDRNnW5ax8XFBY6PjnB8coI3b9/h7OwMp6enOD8/f97TGoeS2ssQmdbIrBmok4RPicim/Lq9xYePn/D58iuurq5SfLm8xG63ewRIGk9JplXzZ4bDYBM7AZQxUgelNCo7oaIDTIibAyL8/MRmZfcylxljNwdE2KqqYZxHT6G11jwQuXm100tGW3YJULEZwnC9UQDrpkFHjQy77rgmthDNNCPEBWYInA9wfkLvIxpar3ePFWaKLNZyV8CGgC2Z1XUNsVVJxneHBxQNc7rFIS9TQ6TLhoAyl5yjjTLdueS1DaBSaFtFOxXJRq1WyB/uk4lD8MmPcRq3UjEn5s6aRnEybgC1apDz1qqTEoGBERdsNJQqhJE0ROQSjyaGStdk06bbZUEAFTcb6mPGmWXF1GmR5f2fATelgyrzBCBRsAoBknV5mllvGz45m4DkNklKya+6SN99K9kw9/p1zE/vOjUlZ3maAHKbMBRAxdzLFyBjIANLR7Tc2/d9ervyXWMF/AdiioXttqttPQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3534bac660d0649f6f4767c34aff2da0/8ac56/image-17.webp 240w,\n/static/3534bac660d0649f6f4767c34aff2da0/d3be9/image-17.webp 480w,\n/static/3534bac660d0649f6f4767c34aff2da0/b0a15/image-17.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3534bac660d0649f6f4767c34aff2da0/8ff5a/image-17.png 240w,\n/static/3534bac660d0649f6f4767c34aff2da0/e85cb/image-17.png 480w,\n/static/3534bac660d0649f6f4767c34aff2da0/0b533/image-17.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3534bac660d0649f6f4767c34aff2da0/0b533/image-17.png\"\n            alt=\"image-17.png\"\n            title=\"image-17.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"ハニーポットマシンに適用するセキュリティグループの作成\" style=\"position:relative;\"><a href=\"#%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AB%E9%81%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"ハニーポットマシンに適用するセキュリティグループの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ハニーポットマシンに適用するセキュリティグループの作成</h3>\n<p>ネットワークセキュリティグループは、Azureのリソースが送受信するネットワークトラフィックに対するフィルタです。</p>\n<p>仮想マシンのネットワークインターフェースや、サブネットに対して関連づけることでフィルタを適用できます。</p>\n<p>参考：<a href=\"https://docs.microsoft.com/ja-jp/azure/virtual-network/network-security-groups-overview\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Azure ネットワーク セキュリティ グループの概要 | Microsoft Docs</a></p>\n<p>参考：<a href=\"https://docs.microsoft.com/ja-jp/azure/virtual-network/network-security-group-how-it-works\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ネットワーク セキュリティ グループ - しくみ | Microsoft Docs</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/80e75d1c4ca09a72e899cb8d9f300005/0b533/image-18-164640095564925.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAARlAAAEZQAGA43XUAAABmElEQVQoz1VS247VMAzs18O+LULs9yCEtPwH22VL77m1aS4dPF56OESyHMfJeDxO89K+4udrh64fMAwDjiOh1oqcs1opVazgPM+b3a/7s1Iyml/9hH4NWF1AjBE2bNhTwbZHjXM9se+7FuFDehagcX+twnu5olnnEWctsGYVM4jC8G2ywnhE8A7ruiKlpI8IYK3VQs453R/HoXkWI2jDBJf3HqsApnLi67fv+PDxAZ+/POHT4yN+PD/ftVj/b5ksbzIIoBEQ0g8COBupKq0759ENMxaJjcSz8XBbxGw9tphh/A6/H1hskDhpbPyGKsDNNE5KO4h2yzJjmkZ4YZ1z0orUMpd37+VOyqJvPNQ7HyRXESRHI9GGYFfLIQTVg9MlS8ZXXj0nKi2yGxaMUYYlgFsUqVLUe82lCQGpJ0E4Ve7pCcTKHMQ13W3btDDPqF70Fun4C8h/dmMoRgAyJJh+G9lzXZPmNP+xjhrvSSQq7/km3bW8LAs4JH6Vtm3RdR3GcdTvwU/P83me9Yz3+v43DHNvLUbJB2H+B0NGBlfJzAH0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/80e75d1c4ca09a72e899cb8d9f300005/8ac56/image-18-164640095564925.webp 240w,\n/static/80e75d1c4ca09a72e899cb8d9f300005/d3be9/image-18-164640095564925.webp 480w,\n/static/80e75d1c4ca09a72e899cb8d9f300005/b0a15/image-18-164640095564925.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/80e75d1c4ca09a72e899cb8d9f300005/8ff5a/image-18-164640095564925.png 240w,\n/static/80e75d1c4ca09a72e899cb8d9f300005/e85cb/image-18-164640095564925.png 480w,\n/static/80e75d1c4ca09a72e899cb8d9f300005/0b533/image-18-164640095564925.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/80e75d1c4ca09a72e899cb8d9f300005/0b533/image-18-164640095564925.png\"\n            alt=\"image-18.png\"\n            title=\"image-18.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>ここでは、以下の2種類のセキュリティグループを作成しました。</p>\n<ul>\n<li>ハニーポットマシンに適用するセキュリティグループ</li>\n<li>ハニーポットマシンに接続する踏み台サーバ用のセキュリティグループ</li>\n</ul>\n<p>踏み台サーバのセキュリティグループは、自分のプライベートマシンからのSSHポートおよびHTTPSポートへのインバウンド接続と、すべてのアウトバウンド通信を許可します。</p>\n<p>※ SSHポートについては念のため22ポートではなくランダムなポートにしておきます。</p>\n<p>ちなみにセキュリティグループは「既定の規則」でVirtualNetworkからのすべてのインバウンド通信が許可されているガバガバ設計なので、ここで明示的にすべてのVirtualNetworkからのインバウンド通信を拒否する設定をいれています。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/781f6e35708cafa7ce7d8dd38867b910/0b533/image-24.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAARlAAAEZQAGA43XUAAAA1UlEQVQY002Q627DIAxGef+n3I+pS5MUGu5Xf7NZiWYJYQv7cEAdxwHnHEopSDHO/bwCntrCuISf18W1n2s3Dm+f8DjfsKnOvu9dI9cGidEHVIhhFq13WB8xBoG4LiVzPuaZ5DmnmXfpsxdqrSA+9yyzQrsdKuf8RyfC7jseV0WsBGct+gfovZ/mEgLato2h9gO3N/D1/IJajUQDIUQ4Hu6tIaX0z7CgtfWsfn8RsUQI4b7MBw0lg7ORh43RvAzEWoYWMPLfitkyFCuBiKHYC1jCnht+AapFhepdxkVdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/781f6e35708cafa7ce7d8dd38867b910/8ac56/image-24.webp 240w,\n/static/781f6e35708cafa7ce7d8dd38867b910/d3be9/image-24.webp 480w,\n/static/781f6e35708cafa7ce7d8dd38867b910/b0a15/image-24.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/781f6e35708cafa7ce7d8dd38867b910/8ff5a/image-24.png 240w,\n/static/781f6e35708cafa7ce7d8dd38867b910/e85cb/image-24.png 480w,\n/static/781f6e35708cafa7ce7d8dd38867b910/0b533/image-24.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/781f6e35708cafa7ce7d8dd38867b910/0b533/image-24.png\"\n            alt=\"image-24.png\"\n            title=\"image-24.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>SSHなどのVirtualNetwork単位で許可する通信についてはこれより若い優先順位に設定していくイメージです。</p>\n<h3 id=\"ハニーポットマシンの仮想ネットワークの作成\" style=\"position:relative;\"><a href=\"#%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E4%BB%AE%E6%83%B3%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"ハニーポットマシンの仮想ネットワークの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ハニーポットマシンの仮想ネットワークの作成</h3>\n<p>Azureの仮想ネットワークはAzure内のプライベートネットワークを構成する要素です。</p>\n<p>Azure仮想ネットワークを利用することで、Azure内に他ネットワークと論理的に分離されたプライベートなネットワークを構築することができます。</p>\n<p>参考：<a href=\"https://docs.microsoft.com/ja-jp/azure/virtual-network/virtual-networks-overview\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Azure Virtual Network | Microsoft Docs</a></p>\n<p>参考：<a href=\"https://www.rworks.jp/cloud/azure/azure-column/azure-entry/22165/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Azureの仮想ネットワークAzure VNetとは？通信方法や料金などを解説</a></p>\n<p>今回はとりあえずガチガチに絞ったサブネット空間を作成してみました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eb85c6083c126077ca22cb5198b3a3b9/0b533/image-20.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAARlAAAEZQAGA43XUAAABxElEQVQ4y4VT2W7bMBDU//9diyB9ax6aWpIp85Cok5Sns2uzsZygJTDgPTucXVZtmPHzt4HxA95MxNlHWOexrSukXa/Xvyjzf7WqDx4v37+hrk/w7oKmqfHj9RXW2sPBR+KvUM5Ued8Plx5bSgkrlW7bhv+1crea5xnOOZyMRd05ji2895imCSEEKq/RdR2WZVFiwcqxzCWgzHeKKkqrlBMvehheOhuj5EImgQQxRkU/9BjHURH6oMF0f4zIe/7wMKcMR2X1e4321GDfdqQlfcaaiaTIHAvK+jKtcGFAprgqbVRoA/yFzxyoLDJqPyKG+NEfcFwbeSa4Hh05boT0Ybl7Is/o+Zz9nqhPmXzK6leJVELHEhHjDT2U3tNH8W1ZZvVTULwU38RHSdwwDBxHFSJrNw8zPWBpyOGSDDko81IymlmOZU96ec1z4mTtXjbcJDpzpjKLTMUSpJCVy0VBqU8heq7PW2GnTRWdHaXPzNqDJfJkay8KOVPatq0apBAefsrI1LduRD9RJf/zECctXK05XhriqGSiWEhKAm/qZx0//iYSZjSXCHcxaPmP27bR5DT8Ib9M0GDx7mkxX1C8Ll4WD/8AIqpB4cjNp3AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/eb85c6083c126077ca22cb5198b3a3b9/8ac56/image-20.webp 240w,\n/static/eb85c6083c126077ca22cb5198b3a3b9/d3be9/image-20.webp 480w,\n/static/eb85c6083c126077ca22cb5198b3a3b9/b0a15/image-20.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/eb85c6083c126077ca22cb5198b3a3b9/8ff5a/image-20.png 240w,\n/static/eb85c6083c126077ca22cb5198b3a3b9/e85cb/image-20.png 480w,\n/static/eb85c6083c126077ca22cb5198b3a3b9/0b533/image-20.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/eb85c6083c126077ca22cb5198b3a3b9/0b533/image-20.png\"\n            alt=\"image-20.png\"\n            title=\"image-20.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>この段階では、ファイアウォールなどの設定は一旦無効化しています。</p>\n<h3 id=\"仮想マシンの作成\" style=\"position:relative;\"><a href=\"#%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"仮想マシンの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>仮想マシンの作成</h3>\n<p>続いて、以下の構成でAzureの仮想マシンを作成していきます。</p>\n<h3 id=\"ハニーポットマシン\" style=\"position:relative;\"><a href=\"#%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3\" aria-label=\"ハニーポットマシン permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ハニーポットマシン</h3>\n<ul>\n<li>OS: Ubuntu20.04</li>\n<li>インフラストラクチャ冗長：なし</li>\n<li>セキュリティの種類：Standard</li>\n<li>削除の種類：容量のみ</li>\n<li>削除ポリシー：停止/割り当て解除</li>\n<li>マシンサイズ：Standard<em>D2s</em>v3(2vCPU 8GB RAM)</li>\n</ul>\n<p>また、ネットワークについては、事前に作成しておいたセキュリティグループと仮想ネットワークを使用します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/637348a6273b784de375fd7a9a66a503/0b533/image-21-164640097030027.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAARlAAAEZQAGA43XUAAAB+klEQVQ4y5VU7XKbMBDk/d+vf5KaYDvlw4CQDQaBBJtbxXIZGsepZnbOYLS3d7dS9JK8Y59VKFWD3SFFWmoYO2NZlofgCnG7ovj3K05Fjqoq8RbvoFWN79Z3iYhou8HNM6ZpumO+PQ/D4OOzFWmtcb1e0QvyqkFaaWh9FsUVmkah73ucz2cUReHfjeMIay2skDOGRCF5VNc18jzD8XhElmW+9P1+jziOPUme5/6/NE1xOByQJG/I5F1cXJDWLXTT4HK5oOs6nyBSSoEgMeNdgcA55yPfBQUE2yJzg/tiLlFZlp6MkZlYHuMgpV47UaAbX2rbtpvpLnz4dyidbGIP2ZO1FcxkkYidalFtjPFqQ6+oeI0wNF8ymz7KBpay9tkwWhyKBkoGpEU1FRJh49oJ1n4mcU4ImT0QrksarROTK7z8Udhlyjf9IeEUCB0ifkCVW+cbUfh6zFGUtE9zU2IflmzMrWQqJGEgZmQm9jBvxArye5nnpyfkPpSvspGAhKn4ku34nxVtM/heShzsIgNpMQnhMst7Nz8Fv/MlE6HhNLcZejghTPYVTrlCKfZRpwbjVXooGDeYejmCrZHk0kN6kE3nFP2ZZg8ng6Tq8aswwcI/L5nnl2eWl8OnWjl604jTxaC+ur9WWvCzofC2obrt1VR0Du96+tEduMYHocd9D4XhBksAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/637348a6273b784de375fd7a9a66a503/8ac56/image-21-164640097030027.webp 240w,\n/static/637348a6273b784de375fd7a9a66a503/d3be9/image-21-164640097030027.webp 480w,\n/static/637348a6273b784de375fd7a9a66a503/b0a15/image-21-164640097030027.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/637348a6273b784de375fd7a9a66a503/8ff5a/image-21-164640097030027.png 240w,\n/static/637348a6273b784de375fd7a9a66a503/e85cb/image-21-164640097030027.png 480w,\n/static/637348a6273b784de375fd7a9a66a503/0b533/image-21-164640097030027.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/637348a6273b784de375fd7a9a66a503/0b533/image-21-164640097030027.png\"\n            alt=\"image-21.png\"\n            title=\"image-21.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>また、もし何らかの原因でSSH接続ができなくなった時のためにシリアルコンソールで操作できるようにしておくとよさそうです。</p>\n<p>シリアルコンソールを有効にするためにブート診断を有効化します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 497px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9415485878d364de711d9802a795860a/15d25/image-29.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoUlEQVQY042Q0Q6DIAxF/f9P3Is+MARmDEFchlruaMmcM9myJpe2CRxu20zTBI6cs+gY5/6faIwxIKL98TvLKTk8COu6Fa1YlgXbVutXn1ISxRgrcBgGgX4CaybKuNgZ1t3gnC1yGMcRWmsY06NtW3RdB9PXuvk23g4sbu4x4KoUrLWYiwteE0O99/IBix3KyMfdnevqkBAKQBUgA34F330CHZyG31gDDmYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9415485878d364de711d9802a795860a/8ac56/image-29.webp 240w,\n/static/9415485878d364de711d9802a795860a/d3be9/image-29.webp 480w,\n/static/9415485878d364de711d9802a795860a/a4aa0/image-29.webp 497w\"\n              sizes=\"(max-width: 497px) 100vw, 497px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9415485878d364de711d9802a795860a/8ff5a/image-29.png 240w,\n/static/9415485878d364de711d9802a795860a/e85cb/image-29.png 480w,\n/static/9415485878d364de711d9802a795860a/15d25/image-29.png 497w\"\n            sizes=\"(max-width: 497px) 100vw, 497px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9415485878d364de711d9802a795860a/15d25/image-29.png\"\n            alt=\"image-29.png\"\n            title=\"image-29.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>※ もしマネージドストレージアカウントの互換性がない場合は、カスタムストレージアカウントを作成します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 661px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4f1fac449ca3d6f114a354dca0d6d712/0012b/image-30.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABN0lEQVQoz62S3YqDMBCFQ9k+TK9LH6K9aaGw7LKF/aFv4bMq1GWtWutvNNEYzyahSi9a2OIOfIzg5GRmToifcSSUI0op/KRCkDJ4cYkwY/DTCqdc/aMCJRcqN8iZQNdJRXcT8v3jwLEd2LaNMAyRpimiKML5fEamvos8g6o06AN9SClvQoLgiDiOIYRA27YQTXO5TaKRQN0ClEuFAOccjDGT7wXJshyUFqiqyhRrtKBlWXh+ecXnfo/dxxfedu/YbrdYLpdYrVbYbDZYr9cmX0OSJFGCdLihH2s2m4EQ8jju4QDXdVHX9bAHHYvFwhQ8TaeYTCZ/hnieh6IoUJal2WHf4Xw+N4Km6JEOT8pRpvZ37d4oQe2YvHSmGS3Ym6LF9MiaUYK+f1Qjs8Hh0R0GQYBGPeb/EvwFYd1NdBfrM9AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4f1fac449ca3d6f114a354dca0d6d712/8ac56/image-30.webp 240w,\n/static/4f1fac449ca3d6f114a354dca0d6d712/d3be9/image-30.webp 480w,\n/static/4f1fac449ca3d6f114a354dca0d6d712/84ccf/image-30.webp 661w\"\n              sizes=\"(max-width: 661px) 100vw, 661px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4f1fac449ca3d6f114a354dca0d6d712/8ff5a/image-30.png 240w,\n/static/4f1fac449ca3d6f114a354dca0d6d712/e85cb/image-30.png 480w,\n/static/4f1fac449ca3d6f114a354dca0d6d712/0012b/image-30.png 661w\"\n            sizes=\"(max-width: 661px) 100vw, 661px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4f1fac449ca3d6f114a354dca0d6d712/0012b/image-30.png\"\n            alt=\"image-30.png\"\n            title=\"image-30.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"踏み台サーバ\" style=\"position:relative;\"><a href=\"#%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90\" aria-label=\"踏み台サーバ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>踏み台サーバ</h3>\n<p>今回はハニーポットマシンに自分の環境から直接接続できないようにしたいです。</p>\n<p>そのため、踏み台サーバも同じネットワーク上に作成します。</p>\n<p>今回、踏み台サーバはUbuntuで作成しました。</p>\n<p>踏み台サーバについては常時稼働を想定しているので、(主にコストの理由から)Standard_B1s(1vCPU 1GB RAM)のサイズを選択しました。(GUI使うにはちょっときついかもですが)</p>\n<p>Standard_B1sは大体月に1000円くらいです。</p>\n<p>踏み台用途なのでディスクは作成せず、先ほど作成した踏み台用のセキュリティグループを割り当てます。</p>\n<p>ハニーポットに使用するStandard<em>D2s</em>v3は月に1万円くらいなので結構差が大きいですね。</p>\n<p>T-PotのWebコンソールに踏み台からアクセスしたいので、GUIをインストールした上でホストマシンからRDP接続します。</p>\n<p>とりあえず必要なパッケージをインストールします。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> ubuntu-desktop xrdp -y</code></pre></div>\n<p>RDPの設定方法については下リンクなどを参考にしました。</p>\n<p>参考：<a href=\"https://gihyo.jp/admin/serial/01/ubuntu-recipe/0621\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">第621回　Ubuntu 20.04 LTSでxrdpを使用する：Ubuntu Weekly Recipe｜gihyo.jp … 技術評論社</a></p>\n<p>セキュリティグループでホストマシンからのRDPを許可するのも忘れずに。</p>\n<p>踏み台へのSSHやRDPは、インターネットにオープンにすると攻撃されるので、自分のIPアドレスなどで固定するのがよさそうです。</p>\n<h3 id=\"踏み台サーバのサイズについて追記\" style=\"position:relative;\"><a href=\"#%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%BF%BD%E8%A8%98\" aria-label=\"踏み台サーバのサイズについて追記 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>踏み台サーバのサイズについて(追記)</h3>\n<p>Standard_B1sでGUI使おうと思っていたのですが、やはり恐ろしく遅延して使い物にならないので断念しました。</p>\n<p>踏み台サーバはCUIのみとして、T-Potのコンソールには踏み台サーバをSSHダイナミックフォワーディングでプロキシとしてホストマシンから接続することにします。</p>\n<p>設定方法は後述します。</p>\n<h3 id=\"環境のセットアップ\" style=\"position:relative;\"><a href=\"#%E7%92%B0%E5%A2%83%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97\" aria-label=\"環境のセットアップ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>環境のセットアップ</h3>\n<p>さて、マシンにSSH接続ができたら、ハニーポットと踏み台サーバのパッケージをとりあえずアップグレードしておきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> upgrade -y</code></pre></div>\n<p>次に、<a href=\"https://www.trendmicro.com/ja_jp/business/products/hybrid-cloud/cloud-one-workload-security.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Trend Micro Cloud One Workload Security</a>のAgentをインストールして適当にポリシーをセットアップしていきます。</p>\n<p>(まじで5台永久無料ライセンスがなくなったのが辛い。。)</p>\n<p>ざっくりですがポリシーこんな感じにしてます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 719px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0eec95449ec99e0b992f29f6a0026f93/073e9/image-22.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9ElEQVQ4y3WT6ZLaMBCE/f6vlh+pIsmGxcEYn1i+7wPsjnq8IlQ2cdUUthh90z0aWa7rIfACTNOEZVkwzzO6tkXbtMizHIEfIMsyRFGEOIrRdR34bNv2KdZ1hfXDduF5noTrugjDEK0GjuOIvu+lyP1+R1VVaJoGdV1LMIdrfH88HgJjnvXVtQXk+76EUko2DsMgao0aAqjObP47uC7Ag39BEASi8Hw+I45jqWrU8WEy14zC/wEpwEr9L3Auu+00VWK5LEsJ9o3WqZAFqIBh2kCIUfwE/nw/4HQ6iW0CbrfbU0lRFALmgRFI263+5RrtE/yqkt+Wc7wIiLYdx3keikkwCj6aCUzLn2/g04lb6nQQdbSc57kEFf4r+aFtdkUE73qVwmbUXvMsz/6Gq05gEJYkidgOswq5tmxs89T1FtSTLtg2ksv/DNSott6O76KOIA4wg4DvuUJW7jCePA+Bzzwv0j8G59C4YmsE+Mu2Bcj542YCabmsjvpdybeZwWmeMM7D/j9z0wwqUUi0I2PdIowKONRpmkq1um4Qh662HguQSozlalT6WmrLaS4xDqNc1d2B7iEhJoxlGRvd00LDuU4gN2zbinbcr1tyU0jVXozqOVYsahUfjTdhgFMRaGCmE4fnia8aOC7dfo/LCn3bi8LXMfoNTQUwDlc7vOEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0eec95449ec99e0b992f29f6a0026f93/8ac56/image-22.webp 240w,\n/static/0eec95449ec99e0b992f29f6a0026f93/d3be9/image-22.webp 480w,\n/static/0eec95449ec99e0b992f29f6a0026f93/05ca6/image-22.webp 719w\"\n              sizes=\"(max-width: 719px) 100vw, 719px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0eec95449ec99e0b992f29f6a0026f93/8ff5a/image-22.png 240w,\n/static/0eec95449ec99e0b992f29f6a0026f93/e85cb/image-22.png 480w,\n/static/0eec95449ec99e0b992f29f6a0026f93/073e9/image-22.png 719w\"\n            sizes=\"(max-width: 719px) 100vw, 719px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0eec95449ec99e0b992f29f6a0026f93/073e9/image-22.png\"\n            alt=\"image-22.png\"\n            title=\"image-22.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>リアルタイムのアンチマルウェア機能とホスト型IDSを有効化してます。</p>\n<p>このホスト型IDSは、端末内のDockerコンテナ間の通信もフィルタできるので(たぶん)色々防いでくれるはずです。</p>\n<p>あとホストマシンが侵害されないように、「変更監視、セキュリティログ監視」という機能も有効化しています。</p>\n<p>これで設定ファイルとかシステム内の重要ファイルが改ざんされたらイベントを発生してくれます。</p>\n<h3 id=\"dns名の構成\" style=\"position:relative;\"><a href=\"#dns%E5%90%8D%E3%81%AE%E6%A7%8B%E6%88%90\" aria-label=\"dns名の構成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DNS名の構成</h3>\n<p>仮想マシンにアクセスするためにマシンに割り当てるパブリックIPの設定でDNS名を構成します。</p>\n<p>この設定を行うことで、パブリックIPを動的割り当てにした場合でも常に同じFQDNで接続することが可能になります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e6114111a096ad9a34d95ea92a220506/0b533/image-55-164640097941129.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAARlAAAEZQAGA43XUAAACAUlEQVQ4y31Uy5LaMBD0///G5gZfk+TCjQC7gLElWU/LltyZkbELCBtVdWHGmlbPTMtVfWvwdalxbSTqRsCGAcOY0dgRV3pXX68QQqBtW0zThHfrMV4ZYyBVB+ccnLX8mjZkHBuHz/MFbdNAaw3vPXJKJTmljBBjifd9v5IyKkskShsIqSgpYBxHUjiioc2G8Kgg9BFSSnBOH4eVcCErhMfzGbdWzJuCRyAlrLbV/apuWUI7XC5X2mv+KXklPHUWX60pJTEhw3P5pkeksljxsgb6H8JcRbqX/7qqkWLpJZ5zxp/PMzolywGOFAXv5nYMQ8GijEuOkdDPqHgI8yCm9cREhLU0UFJQciTSUOK/f/3Ej48PbLdbbDYb7Ha7cvhMGguqx/oXwpwndNqWsoqSpYdK43A44nQ6Yb/fQylVJr+oHgnVa2OXknlzSaBnBtMKM6DryELOzopIWWcdrPNlBtzf94Tkw0Y2lNw92cZTwoXMXwsNbWxxhAwZMT0M5TuFwkiw6R/j/TBCdAa2H0obeEhM+mSb9wonSDJ7uA9jNTYl605RIHOw9I/7lu5tYXyrsCOb8P1lky9x7tWB7NTScAbyWiTPpfxs8G8JNTWbe8gfBh4ALxczbvTRkJ6R0LgRin79kMsB/+nhbBu+t4yF0N4JVUhoiYyfa0NfJYLw8835C3G1kaBDBTzzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e6114111a096ad9a34d95ea92a220506/8ac56/image-55-164640097941129.webp 240w,\n/static/e6114111a096ad9a34d95ea92a220506/d3be9/image-55-164640097941129.webp 480w,\n/static/e6114111a096ad9a34d95ea92a220506/b0a15/image-55-164640097941129.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e6114111a096ad9a34d95ea92a220506/8ff5a/image-55-164640097941129.png 240w,\n/static/e6114111a096ad9a34d95ea92a220506/e85cb/image-55-164640097941129.png 480w,\n/static/e6114111a096ad9a34d95ea92a220506/0b533/image-55-164640097941129.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e6114111a096ad9a34d95ea92a220506/0b533/image-55-164640097941129.png\"\n            alt=\"image-55.png\"\n            title=\"image-55.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>固定IPによる接続でもいいですが、無駄にコストがかかるのと、IPでのアクセスは柔軟性が無いのでDNS名を設定しておくのが良いと思います。</p>\n<h2 id=\"azure-sentinelの構築\" style=\"position:relative;\"><a href=\"#azure-sentinel%E3%81%AE%E6%A7%8B%E7%AF%89\" aria-label=\"azure sentinelの構築 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Azure Sentinelの構築</h2>\n<p>Azure SentinelはAzureの提供しているSIEMサービスです。</p>\n<p>参考：<a href=\"https://azure.microsoft.com/ja-jp/services/microsoft-sentinel/#overview\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Azure Sentinel – クラウドネイティブの SIEM ソリューション | Microsoft Azure</a></p>\n<ul>\n<li>Common Event Format (CEF) Syslog メッセージを収集するLinuxエージェントを踏み台サーバにインストールする</li>\n<li>踏み台サーバで、ハニーポットマシンからの514ポートのインバウンド通信を許可する</li>\n<li>Cloud OneのSyslogイベントをハニーポットマシンから踏み台サーバに転送するように構成する</li>\n</ul>\n<h3 id=\"踏み台サーバにlinux-agentをインストールする\" style=\"position:relative;\"><a href=\"#%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%81%ABlinux-agent%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\" aria-label=\"踏み台サーバにlinux agentをインストールする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>踏み台サーバにLinux Agentをインストールする</h3>\n<p>Cloud OneとAzure Sentinelの連携については、以下のようにAzure Sentinel側の「データコネクタ」に詳細な手順が書かれています。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2a017365d5cfe2a47c166f12bb75bcc9/0b533/image-23.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAARlAAAEZQAGA43XUAAABVUlEQVQoz5VSW1LDMAzM/U/FHfjlA5qmLWWal235FWeR1LjTYYCCZnbiyNZ6rVVz2Lfoug5932McRxB5pJSxlgU11nV9CIlSCppluRaasOAyGoToMQwXOCY1PiDnXFkVUiSoJDVqrskpaSJEJrCOCRIrjIhLQW8I1kc4QUigmG8EKXJunuGI4L2/KW2kuB6Yhh4f53dM4wBPDtZahTFGYa3RfPCEaeL2OAcfExx/IwuT1zTkrC4C3zKezzidjko6MrkUe973tIHXtMGwuv2+w9vbK3a7Hdq2xcy5RjYklHRTRPyMtLXip5D90/GoRl7VW80pYW1oYYPEpPr/m6MioBoq7arRhOCV4K9RCaV3/Wy1NjNxzTdOG03q7n9mjphwsF7NsNx/HyLKKgrZsfubv87XNxIhJ3TwlyArFrPwHLMHmQf7nuAh2d2ZiTKeXmY8H4hz5YZPhEFewEj2la8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2a017365d5cfe2a47c166f12bb75bcc9/8ac56/image-23.webp 240w,\n/static/2a017365d5cfe2a47c166f12bb75bcc9/d3be9/image-23.webp 480w,\n/static/2a017365d5cfe2a47c166f12bb75bcc9/b0a15/image-23.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2a017365d5cfe2a47c166f12bb75bcc9/8ff5a/image-23.png 240w,\n/static/2a017365d5cfe2a47c166f12bb75bcc9/e85cb/image-23.png 480w,\n/static/2a017365d5cfe2a47c166f12bb75bcc9/0b533/image-23.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2a017365d5cfe2a47c166f12bb75bcc9/0b533/image-23.png\"\n            alt=\"image-23.png\"\n            title=\"image-23.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これを参考に、踏み台サーバにSyslog Agentをインストールします。</p>\n<p>インストールのためのPythonが必要なので、まずはパッケージをインストールしておきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> python -y</code></pre></div>\n<p>次に、「データコネクタ」に表示されている以下のようなコマンドを実行して、Agentをインストールします。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">wget</span> -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py<span class=\"token operator\">&amp;&amp;</span><span class=\"token function\">sudo</span> python cef_installer.py <span class=\"token operator\">&lt;</span>TENANT<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>TOKEN<span class=\"token operator\">></span></code></pre></div>\n<h3 id=\"踏み台サーバの514ポート待ち受けを有効化する\" style=\"position:relative;\"><a href=\"#%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE514%E3%83%9D%E3%83%BC%E3%83%88%E5%BE%85%E3%81%A1%E5%8F%97%E3%81%91%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B\" aria-label=\"踏み台サーバの514ポート待ち受けを有効化する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>踏み台サーバの514ポート待ち受けを有効化する</h3>\n<p>セキュリティグループの設定を変更して、ハニーポットマシンからの514ポートあての通信を受け入れる設定を実施しました。</p>\n<h3 id=\"cloud-oneのsyslogイベントをハニーポットマシンから踏み台サーバに転送するように構成する\" style=\"position:relative;\"><a href=\"#cloud-one%E3%81%AEsyslog%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%8B%E3%82%89%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AB%E8%BB%A2%E9%80%81%E3%81%99%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B\" aria-label=\"cloud oneのsyslogイベントをハニーポットマシンから踏み台サーバに転送するように構成する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cloud OneのSyslogイベントをハニーポットマシンから踏み台サーバに転送するように構成する</h3>\n<p>まずCloud One側で踏み台サーバの514ポートに検出イベントを転送する設定をいれます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 862px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1af645f7caefa0b4ba714f1c00ca5f10/f0551/image-25.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABc0lEQVQoz52SWW+DMBCE+Z1NFKKIKEmvl6o/uICgEG4wKVemO6aOUJWX1tLIB7vjb9dY76dnvB0esV+v4axWOG5sOA8rHDYbPO12OG23ONmzjrZ9Wy/FnBfHwet+Dys5n0GdoxiB56MuKmRxgjIvMfYDcL3iL8OK4xiXywVlWcIXwzwvZP8F1Sg0dYO+78XzinEc0Uoc53sahgGTxFlJkmhDpRSyNNPrrutuM82MmLTcG03TpKUJwzBEXddSdoIwCBF9RlpVWaFV7U/gTNg0zUwiZ9wv57ZtkabpXDLpeEAimvODudEMJhZFcTNcipRsmeu6sM7yILw5yzJUVaUNTU+XpjRkDHtqyIy4Z7zneTMhN7kEMyHPc017j5Bxpo+/CQnj+z6sIAhQCZWSfvGQj2Rolwk0YslsC9fUkpB/x4crhLq8WiFOSxRCEMjD8KGiKNLlsx0052xawUtN3ymeE4IX6pLZF44oU1Bth14oeiH4z/gGmfI1KPYbqrIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1af645f7caefa0b4ba714f1c00ca5f10/8ac56/image-25.webp 240w,\n/static/1af645f7caefa0b4ba714f1c00ca5f10/d3be9/image-25.webp 480w,\n/static/1af645f7caefa0b4ba714f1c00ca5f10/e32b8/image-25.webp 862w\"\n              sizes=\"(max-width: 862px) 100vw, 862px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1af645f7caefa0b4ba714f1c00ca5f10/8ff5a/image-25.png 240w,\n/static/1af645f7caefa0b4ba714f1c00ca5f10/e85cb/image-25.png 480w,\n/static/1af645f7caefa0b4ba714f1c00ca5f10/f0551/image-25.png 862w\"\n            sizes=\"(max-width: 862px) 100vw, 862px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1af645f7caefa0b4ba714f1c00ca5f10/f0551/image-25.png\"\n            alt=\"image-25.png\"\n            title=\"image-25.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これで試しにEicarをハニーポットマシンで検出させてみると、Azure Sentinelのポータルで検出イベントが確認できました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 530px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0bd98c2a6a97378984c1f37340305a7f/b6a9b/image-26.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 131.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAADCUlEQVRIx5VVy47TQBDMF3LmG/gkxGUvcAMJIXHmsgcQiI04hSWb3SR+JH7Ejh+xPXbR1ck43pCwYKnl8UxPTXd19Xh04+R4djXD8zcPePHeQZYm+DWdYjKZYLlcYjabYbFYYDweY1eWcNMGD0tXxgXKpoMbpojCAKZtkZQNRnFe49Ntgg/fI3z8FsJ1Xdze/sT07g7z+RxTAV+tVthsNqh2O2zLGoUAN3WNXVWj3FU6X8t3JTYCOgAGaFrUmUGaptjEMbbbrVoqEVdVBT5dR9+uH+v34W1t1EqobWfdLj97MN2PbuB8uk8Bhydesn/x6SP8V+f/BnwEPOTpzIHH9C8ADkF773Pzf5nrOWyqnWqJIEUh+hJZ1KbFtqhUDvThu2kaNZ0zBnllsM1yVQP3UA0jogZxgi8/JqKcTmWTJBsU4uzFGYo8U4CdaM1anucKTCH7qzWWIvwgCHSvAnoi3IW7wnyxRLKJcSeiTkTInuNop9zf38shieozDMOnUzamgWlqjUSFLZuZBkFIAVPhO8syXc/zQgHpXx4i5hp9FJCHGUNgo4vcsN1mwk8m7VXpPEE5R0DOK6+SNilI2VFimfB5ADxKgSet12vdeCoX8maf0319yjx96BBKtR3hjpeEBdD2FIuiCL7v62H0tfNDGzHVYSSMMBbyudleEBaYY66RltMoL3YKK8l7kDLglUUAe9uEwT56Al9q10eAbdv1HFKow66gsepcYyH26jBqw/EfEZIfRsKUKQvLVb8mHDN6AvPi9TxXvzmm9YDHooSaMqMYFoRrjuth6bh6U9uIbDuejZBmiY8lQuXORkjZFClMvpHbvThm9VRRCMZ0yKWtbte1elm8u1nj1bWL118l7VxELb8NXhBF3fb2KGWtslSWXOhPRyKsqj2PVWPwdhzi5bWPq88rPATSmlmJMM3VIr6T/HxRhiTzALtW5/LDSgP5mcUIJAulRoxiJ/f+uaKwuuySYUvZwgRhBMfz4fmrw4H+gJYLHKaiNYIyMp4aiVlNco7VH7bdqbB/AxP85jvF4pZ4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0bd98c2a6a97378984c1f37340305a7f/8ac56/image-26.webp 240w,\n/static/0bd98c2a6a97378984c1f37340305a7f/d3be9/image-26.webp 480w,\n/static/0bd98c2a6a97378984c1f37340305a7f/c2b64/image-26.webp 530w\"\n              sizes=\"(max-width: 530px) 100vw, 530px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0bd98c2a6a97378984c1f37340305a7f/8ff5a/image-26.png 240w,\n/static/0bd98c2a6a97378984c1f37340305a7f/e85cb/image-26.png 480w,\n/static/0bd98c2a6a97378984c1f37340305a7f/b6a9b/image-26.png 530w\"\n            sizes=\"(max-width: 530px) 100vw, 530px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0bd98c2a6a97378984c1f37340305a7f/b6a9b/image-26.png\"\n            alt=\"image-26.png\"\n            title=\"image-26.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>今はこれだけですが、今後は何かAzure Sentinel上での分析とかもやっていけるとよさそうです。</p>\n<h2 id=\"補足ハニーポットマシンのディスク拡張\" style=\"position:relative;\"><a href=\"#%E8%A3%9C%E8%B6%B3%E3%83%8F%E3%83%8B%E3%83%BC%E3%83%9D%E3%83%83%E3%83%88%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AE%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E6%8B%A1%E5%BC%B5\" aria-label=\"補足ハニーポットマシンのディスク拡張 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>補足：ハニーポットマシンのディスク拡張</h2>\n<p>もし仮想マシンにディスクを追加する場合は、Azureコンソールから追加ディスクを設定した後、普通にLinuxにマウントするのと同じように設定が必要です。</p>\n<p>まずは<code class=\"language-text\">lsblk</code>でディスクの一覧を確認します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ lsblk\nNAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nloop0     <span class=\"token number\">7</span>:0    <span class=\"token number\">0</span> <span class=\"token number\">61</span>.9M  <span class=\"token number\">1</span> loop /snap/core20/1328\nloop1     <span class=\"token number\">7</span>:1    <span class=\"token number\">0</span> <span class=\"token number\">43</span>.4M  <span class=\"token number\">1</span> loop /snap/snapd/14549\nloop2     <span class=\"token number\">7</span>:2    <span class=\"token number\">0</span> <span class=\"token number\">67</span>.2M  <span class=\"token number\">1</span> loop /snap/lxd/21835\nsda       <span class=\"token number\">8</span>:0    <span class=\"token number\">0</span>  128G  <span class=\"token number\">0</span> disk\nsdb       <span class=\"token number\">8</span>:16   <span class=\"token number\">0</span>   30G  <span class=\"token number\">0</span> disk\n├─sdb1    <span class=\"token number\">8</span>:17   <span class=\"token number\">0</span> <span class=\"token number\">29</span>.9G  <span class=\"token number\">0</span> part /\n├─sdb14   <span class=\"token number\">8</span>:30   <span class=\"token number\">0</span>    4M  <span class=\"token number\">0</span> part\n└─sdb15   <span class=\"token number\">8</span>:31   <span class=\"token number\">0</span>  106M  <span class=\"token number\">0</span> part /boot/efi\nsdc       <span class=\"token number\">8</span>:32   <span class=\"token number\">0</span>   16G  <span class=\"token number\">0</span> disk\n└─sdc1    <span class=\"token number\">8</span>:33   <span class=\"token number\">0</span>   16G  <span class=\"token number\">0</span> part /mnt</code></pre></div>\n<p>今回追加したディスクは<code class=\"language-text\">sda</code>として認識されているので、これをマウントしていきます。</p>\n<p>今回は空の新規ディスクとして追加しているので、まずはパーティション作成を行う必要があります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">parted</span> /dev/sda --script mklabel gpt mkpart xfspart xfs <span class=\"token number\">0</span>% <span class=\"token number\">100</span>%</code></pre></div>\n<p>これでもう一度<code class=\"language-text\">lsblk</code>を叩くと<code class=\"language-text\">sda1</code>ができているので、以下のコマンドでXFSファイルシステムのフォーマットを実施します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> mkfs.xfs /dev/sda1\n<span class=\"token function\">sudo</span> partprobe /dev/sda1</code></pre></div>\n<p>UbuntuではなくDebianの場合は、事前に<code class=\"language-text\">xfsprogs</code>をインストールする必要がある場合があります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> xfsprogs</code></pre></div>\n<p>参考：<a href=\"https://techviewleo.com/fix-mkfs-xfs-no-such-file-or-directory/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fix “mkfs.xfs: No such file or directory” on CentOS/Ubuntu/Debian - TechViewLeo</a></p>\n<p>最後にこれからハニーポットをインストールするために<code class=\"language-text\">tpot</code>ディレクトリを作成し、<code class=\"language-text\">/dev/sda1</code>をマウントしました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> ~/tpot\n<span class=\"token function\">sudo</span> <span class=\"token function\">mount</span> /dev/sda1 ~/tpot</code></pre></div>\n<p>これで再度<code class=\"language-text\">lsblk</code>を叩くと、マウントが適切に反映されていることがわかります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ lsblk\nNAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nloop0     <span class=\"token number\">7</span>:0    <span class=\"token number\">0</span> <span class=\"token number\">61</span>.9M  <span class=\"token number\">1</span> loop /snap/core20/1328\nloop1     <span class=\"token number\">7</span>:1    <span class=\"token number\">0</span> <span class=\"token number\">43</span>.4M  <span class=\"token number\">1</span> loop /snap/snapd/14549\nloop2     <span class=\"token number\">7</span>:2    <span class=\"token number\">0</span> <span class=\"token number\">67</span>.2M  <span class=\"token number\">1</span> loop /snap/lxd/21835\nsda       <span class=\"token number\">8</span>:0    <span class=\"token number\">0</span>  128G  <span class=\"token number\">0</span> disk\n└─sda1    <span class=\"token number\">8</span>:1    <span class=\"token number\">0</span>  128G  <span class=\"token number\">0</span> part /home/azureuser/tpot\nsdb       <span class=\"token number\">8</span>:16   <span class=\"token number\">0</span>   30G  <span class=\"token number\">0</span> disk\n├─sdb1    <span class=\"token number\">8</span>:17   <span class=\"token number\">0</span> <span class=\"token number\">29</span>.9G  <span class=\"token number\">0</span> part /\n├─sdb14   <span class=\"token number\">8</span>:30   <span class=\"token number\">0</span>    4M  <span class=\"token number\">0</span> part\n└─sdb15   <span class=\"token number\">8</span>:31   <span class=\"token number\">0</span>  106M  <span class=\"token number\">0</span> part /boot/efi\nsdc       <span class=\"token number\">8</span>:32   <span class=\"token number\">0</span>   16G  <span class=\"token number\">0</span> disk\n└─sdc1    <span class=\"token number\">8</span>:33   <span class=\"token number\">0</span>   16G  <span class=\"token number\">0</span> part /mnt</code></pre></div>\n<p>参考：<a href=\"https://docs.microsoft.com/ja-jp/azure/virtual-machines/linux/expand-disks\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Linux VM の仮想ハード ディスクを拡張する - Azure Virtual Machines | Microsoft Docs</a></p>\n<h2 id=\"スナップショットの作成\" style=\"position:relative;\"><a href=\"#%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"スナップショットの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>スナップショットの作成</h2>\n<p>だいたい準備が終わったのでいよいよT-Potをインストールしていきますが、その前に一応ディスクのスナップショットを取得しておきます。</p>\n<p>Azure のディスクのスナップショットを取得しておくことで、何か問題があった場合に新しくマシンを立て直して復旧することができます。</p>\n<p>正直スナップショットだけでも意外と月額料金かかるのであまり個人では使いたくないのですが、とりあえずやっておきます。</p>\n<p>詳しいやり方は以下リンクがわかりやすいと思います。</p>\n<p>参考：<a href=\"https://jpaztech.github.io/blog/vm/vm-replica-3/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">VM 複製方法について part.3/3 OS ディスクのスナップショットから複製する手順 | Japan Azure IaaS Core Support Blog</a></p>\n<p>仮想マシンの電源を落としてディスクからスナップショットを作成するだけです。</p>\n<p>スナップショットが作成できたら、最後にT-Potのインストールを行います。</p>\n<h2 id=\"t-potのインストール\" style=\"position:relative;\"><a href=\"#t-pot%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" aria-label=\"t potのインストール permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>T-Potのインストール</h2>\n<p>T-Potのインストール前に、Cloud Oneのアンチマルウェア機能を無効化しておきます。</p>\n<p>続いて以下のコマンドを順に実行していきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> ~/tpot\n<span class=\"token function\">git</span> clone https://github.com/telekom-security/tpotce\n<span class=\"token builtin class-name\">cd</span> tpotce/iso/installer/</code></pre></div>\n<p>ここで、<code class=\"language-text\">tpot.conf.dist</code>というファイルに以下の設定が書かれています。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># tpot configuration file</span>\n<span class=\"token comment\"># myCONF_TPOT_FLAVOR=[STANDARD, SENSOR, INDUSTRIAL, COLLECTOR, NEXTGEN, MEDICAL]</span>\n<span class=\"token assign-left variable\">myCONF_TPOT_FLAVOR</span><span class=\"token operator\">=</span><span class=\"token string\">'STANDARD'</span>\n<span class=\"token assign-left variable\">myCONF_WEB_USER</span><span class=\"token operator\">=</span><span class=\"token string\">'webuser'</span>\n<span class=\"token assign-left variable\">myCONF_WEB_PW</span><span class=\"token operator\">=</span><span class=\"token string\">'w3b$ecret'</span></code></pre></div>\n<p>デフォルトだとT-Potのタイプが<code class=\"language-text\">STANDARD</code>になっています。</p>\n<p>次に、ユーザ名とパスワードを任意に変更した後、以下のコマンドを実行します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> tpot.conf.dist tpot.conf\n<span class=\"token function\">sudo</span> ./install.sh --type<span class=\"token operator\">=</span>auto --conf<span class=\"token operator\">=</span>tpot.conf</code></pre></div>\n<p>これで問題なく完了すれば、以下のような出力になります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 586px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3fd95a38ed4642336665649abe7a5a59/a76f4/image-28-164640098996331.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACjUlEQVQ4y41U23LaQAz1U1uadNqZPjSQpCEhQIFwsQHfwDYGzM0Gh5CWtv//H6qOYDOhk5I+nNFetGel1dFqDcOlthVQrWlRudamb3cdMkyfKvUuYQ/Ael23Se96vOdRs+2Kn/J/Dg0OvWBKHXvACITc6o0EGDvemK1PrU5fxjavd53wIAAFzDU42v2x3AxS2K4zEIDQdIcSJaIG4HPXsqlUNahY0cUCilwIccj1J5KSivQpWt6DBbCHi5rtnlwCf5zHvNowdxFOFmsCWryIVECMCxwvksi9cEEmp4k59lx/Kk9k8R7meBr413VHItXidEtNw6ar6yJ9/PSZ3rzN0LvMKZ3l8nRxVaLcZYHOvxYZtwfAXqHclLQldZVyrWFQ/qZElVqLbst1yp7nmeSGDxVknL24phxDxnuc7X1eLIofziiapeT0h9SxPK7ikFMYcCohpzunYJyQP4ppNE25KAHLyZQKVxvWi9LR4Lja/OZ3iTjVE3p/8oEybL9kL0WLOKAOqfFz/E2q9fmBh5MlR7DiKFl/bsjFCfjBIwqjRCpZrBhHSQ4iRPkhERxEpZAOdAYLB0QJQBawx8j2neKLttAF0BNkoMQN7WF/J3z/SeSQxz8JRdisPzijR6E3EJpuKGnrIvxQ2g/ErxKqDgCxskhffQoqZelnzuBYukI4jTeU3G9pPLsXO18+8jil0WQlUatCqH59tShx+oNWD7+40ishRLWxNks20mKqOP8LbcYRov0Q1XL9k+bJo5BCMm0uhPpNjkG1n3RKNF9LhLAANDlffqck3YrFu6L6gN7tS7Vh8dYKux9qINLSEBlIFnzY4zbEfBo/sGNPCoEfSB3c/Y+hrKnfG2v4daAAPM8fiDNjAzu1lgMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3fd95a38ed4642336665649abe7a5a59/8ac56/image-28-164640098996331.webp 240w,\n/static/3fd95a38ed4642336665649abe7a5a59/d3be9/image-28-164640098996331.webp 480w,\n/static/3fd95a38ed4642336665649abe7a5a59/7fed0/image-28-164640098996331.webp 586w\"\n              sizes=\"(max-width: 586px) 100vw, 586px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3fd95a38ed4642336665649abe7a5a59/8ff5a/image-28-164640098996331.png 240w,\n/static/3fd95a38ed4642336665649abe7a5a59/e85cb/image-28-164640098996331.png 480w,\n/static/3fd95a38ed4642336665649abe7a5a59/a76f4/image-28-164640098996331.png 586w\"\n            sizes=\"(max-width: 586px) 100vw, 586px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3fd95a38ed4642336665649abe7a5a59/a76f4/image-28-164640098996331.png\"\n            alt=\"image-28.png\"\n            title=\"image-28.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これでT-Potのインストールは完了です。</p>\n<p>T-Potインストールが完了すると、ポート22でのSSHが無効化されます。</p>\n<p>デフォルトの設定の場合SSHの接続ポートは64295になるのでSSH接続できることを確認します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> -i .ssh/id_rsa -p <span class=\"token number\">64295</span> <span class=\"token operator\">&lt;</span>T-Pot<span class=\"token operator\">></span></code></pre></div>\n<p>ちなみに、T-Potのサービスごとのポートはデフォルトで以下に設定されています。</p>\n<ul>\n<li>SSH：64295</li>\n<li>WEBコンソール：64297</li>\n<li>ADMINサイト：64294</li>\n</ul>\n<p>これらのポートはインターネット側からアクセスできないよう、セキュリティグループで踏み台サーバからのみアクセス可能なように設定しておきます。</p>\n<h3 id=\"dockerユーザの追加\" style=\"position:relative;\"><a href=\"#docker%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%AE%E8%BF%BD%E5%8A%A0\" aria-label=\"dockerユーザの追加 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerユーザの追加</h3>\n<p>T-Potのインストールが完了するとマシン内にDockerがインストールされます。</p>\n<p>ただし、インストール直後の時点ではDockerサービスには一般ユーザではアクセスできません。</p>\n<p>今後、一般ユーザでログインしたPilotコンソールからDockerサービスの監視を行えるようにするために、以下のコマンドでDockerグループにユーザを追加しておきましょう。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">usermod</span> -aG <span class=\"token function\">docker</span> <span class=\"token environment constant\">$USER</span></code></pre></div>\n<p>一般ユーザでDockerサービスを使用可能にすることで、以下のようにPilotコンソールからDockerコンテナを監視できるようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1132a19df371b0c9c5f364cb064ddd1e/0b533/image-56-164640099393233.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAARlAAAEZQAGA43XUAAABW0lEQVQoz3WSUUrDQBCGcyV9KFSsVAQrPlgUBE/lMQSP4IMH8Aj2yQeTWjANTXaT3TTZ35nZrl2iDfxsd6bz5f+nTcbTC1zN7/C+WGC1WiHPczS1xmazQVEUWJPydYGqqkRlWcqptYZW2p+RktHkXIBfBOOnaVto22K73cr96fUNj88vcK5H13WwrUXf9zj0JNPZNeb3D/hMU7o6VI3FWtU0TEPOISsUPr7LP4OOerFCjRxOxaEHUpHe3pMTbnqXTjR0FcO411IyTpCMznzkNMvEEUMU7YJPaw3qpoGua/pspcbiwSHY9wh4ND7F5c0t0jSTLwhQKRkyBFO7Zdc7KCu4Ca6DQ55Njk8mmDEwW/4C2RUPBEf/KUBDZEnAkRnIDrPlUnbFRWM8MI423Ft8D8AuAL3DTBr8dk3/Q3bA4hpr+KvG4L1DjjzeOaTIIUrd7PfFMsZI7xA0jvwD4P7kBk8yjXEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1132a19df371b0c9c5f364cb064ddd1e/8ac56/image-56-164640099393233.webp 240w,\n/static/1132a19df371b0c9c5f364cb064ddd1e/d3be9/image-56-164640099393233.webp 480w,\n/static/1132a19df371b0c9c5f364cb064ddd1e/b0a15/image-56-164640099393233.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1132a19df371b0c9c5f364cb064ddd1e/8ff5a/image-56-164640099393233.png 240w,\n/static/1132a19df371b0c9c5f364cb064ddd1e/e85cb/image-56-164640099393233.png 480w,\n/static/1132a19df371b0c9c5f364cb064ddd1e/0b533/image-56-164640099393233.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1132a19df371b0c9c5f364cb064ddd1e/0b533/image-56-164640099393233.png\"\n            alt=\"image-56.png\"\n            title=\"image-56.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"sshダイナミックフォワーディングで踏み台経由でt-potに接続\" style=\"position:relative;\"><a href=\"#ssh%E3%83%80%E3%82%A4%E3%83%8A%E3%83%9F%E3%83%83%E3%82%AF%E3%83%95%E3%82%A9%E3%83%AF%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%A7%E8%B8%8F%E3%81%BF%E5%8F%B0%E7%B5%8C%E7%94%B1%E3%81%A7t-pot%E3%81%AB%E6%8E%A5%E7%B6%9A\" aria-label=\"sshダイナミックフォワーディングで踏み台経由でt potに接続 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSHダイナミックフォワーディングで踏み台経由でT-Potに接続</h3>\n<p>次は踏み台サーバ経由でT-PotのWEBコンソールに接続します。</p>\n<p>まずは、ホストマシン側で、踏み台サーバに対して以下のようにSSH接続を行います。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> -fN -D <span class=\"token operator\">&lt;</span>Forwarding Port<span class=\"token operator\">></span> -i .ssh/honeypot.pem <span class=\"token operator\">&lt;</span>Username@IP Addr<span class=\"token operator\">></span></code></pre></div>\n<p>これでホストマシンの<code class=\"language-text\">&lt;Forwarding Port></code>を経由して踏み台サーバに接続できるようになります。</p>\n<p>次に、以下のようにブラウザの<code class=\"language-text\">SOCKS v5</code>プロキシの設定を、ローカルホストと設定したフォワーディングポートにします。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fec6a1243e2d96b99bcf05bf3f5161bc/0b533/image-31-164640099658235.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAARlAAAEZQAGA43XUAAABWklEQVQoz5VT0W6DMAzM/3/Vnveyva1Sh1YYEQMKCSRQQhNudlY6aVLpGunkRJHPd7EjsizD226HPJf4zHOkaQYpc+SywUfyBKOfwWtZAmG5C6G1BpMqiuM4wlgDa0dYU0GrBM75C+HyP8LB9ijLEmVVoa5rFEVB5ERqJFTzSoQBjyzxsq/J5iFaTtMU70kCpdRFFeD9GefzNoIP171QZiKFX4QqWp6mCZNzmOeZsMZttKrFMAwxX6xSvfdo2xbH4zFa58hgtZ4U8P0thPB7L1hR0zTg5jhSxrKdm+Oeq/N5i4zR93105twEwQnW2qvk8XSiij6OCVe+934MzmOOaJmTuAITcre5y9rO0D0XsZTg7yrkXHbYG0NjQ6zxQKQVjQ4P9UHWyGQRCR9dYpW8YohxiO/Bg8oOtrCEBY7eWnddnA7RdT11s4kN+Lt+km7/inD5jmz7RE3h+A3BFqb6TQ3ydwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fec6a1243e2d96b99bcf05bf3f5161bc/8ac56/image-31-164640099658235.webp 240w,\n/static/fec6a1243e2d96b99bcf05bf3f5161bc/d3be9/image-31-164640099658235.webp 480w,\n/static/fec6a1243e2d96b99bcf05bf3f5161bc/b0a15/image-31-164640099658235.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fec6a1243e2d96b99bcf05bf3f5161bc/8ff5a/image-31-164640099658235.png 240w,\n/static/fec6a1243e2d96b99bcf05bf3f5161bc/e85cb/image-31-164640099658235.png 480w,\n/static/fec6a1243e2d96b99bcf05bf3f5161bc/0b533/image-31-164640099658235.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fec6a1243e2d96b99bcf05bf3f5161bc/0b533/image-31-164640099658235.png\"\n            alt=\"image-31.png\"\n            title=\"image-31.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これで踏み台サーバ経由でT-PotマシンのローカルIPアドレスに接続できるようになります。</p>\n<p>実際にブラウザで<code class=\"language-text\">https://&lt;T-PotのローカルIPアドレス>:64297</code>などに接続することでコンソールを開くことができます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/649eec9e8fe1936c330106e802345168/0b533/image-32-164640099891937.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAARlAAAEZQAGA43XUAAACaElEQVQ4y3WTy26bQBSG2VayMTADA5iBwYCJcqkVJ4DvWVTuIokqdV9VUTZ9gb5Ua2XTPODfw9hxLCdZfPrH45n/XOZgjC9OsZg2mF2P0YxHOB1myFSMNI6QRCHUB+j/ZB+DRJJGKIshztMAxmIxR103aKoKs8kE8/kcy9UNqmZO6wWayXTL1TWa6wp1M9Hnq7qm/Yk+M65qXFxVqM5LGDLqo9/vIySCMITneWCMafhObduGZVmwiVZ7pglzR6fbhej2EHyyELIOjERKRFGEIAi02TGu6+4DHNIGaTFtC5nloTB9RF4PRhj4+4uee2C2W3PO4TjOq5mz1XZvnzmZdkiVZ8EQnktmR5m5R9k57EPdZmrB7NlQggx9fdH7uFyHvVvyIY5jHxq6b8slhBD7DF9KbvU9GHNgWjZSbSg85HmBYVEgTVPESbLvTZdesFXOXvvY9vQ4Q84ZLIcjCx0Y2SBFlucYjUZYLpd6DmezGaY0e9PZHKdnZ4jjmILmGAwGkDQVSZzovReSJEYkE3zOIxjDoj2Y4eHhAc/Pz9hsNnh6esJf0n+bP3j8+UNn3TS1DlpQJUqpN8hEYVTEMIo8Q1mWWK1WuL+/x+3tLe7u7vB1vcb6129crr9BhgFloYhEX271EKUSRDEZ5pIyJMOTkxPdQ0kDLneDHvoC8ZfvUPUNUvpW2/6mqUKq3oH2Ywp4OaQMfT8A93y4wocIQk27Zq4A63bgWD3Y3IPNXDjt43B3D9PQ8NOE9JiHYeTBKCW9Mi2KSBCkUiALOIZ9jiIWyPsuyph+t+ekj0HoEhxpwDTK36oUDJeK4z+SDpshgEFNLAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/649eec9e8fe1936c330106e802345168/8ac56/image-32-164640099891937.webp 240w,\n/static/649eec9e8fe1936c330106e802345168/d3be9/image-32-164640099891937.webp 480w,\n/static/649eec9e8fe1936c330106e802345168/b0a15/image-32-164640099891937.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/649eec9e8fe1936c330106e802345168/8ff5a/image-32-164640099891937.png 240w,\n/static/649eec9e8fe1936c330106e802345168/e85cb/image-32-164640099891937.png 480w,\n/static/649eec9e8fe1936c330106e802345168/0b533/image-32-164640099891937.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/649eec9e8fe1936c330106e802345168/0b533/image-32-164640099891937.png\"\n            alt=\"image-32.png\"\n            title=\"image-32.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>T-Potコンソールもカッコいい！！</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f0ab2d6a94b5abd4c24262218ad0c256/0b533/image-33-164640100164239.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAARlAAAEZQAGA43XUAAACPUlEQVQ4y61T227TQBCdtdfx3Y6dOEnj0OZGYqemqIibRGhaGokH/gAkXnkF/oBP4J1/PcxsUhFSJF76MFrv7pkzZ45niYjwoKFI/RekjvaaLBPHOFu4nIMLpdRfSfZR0r+Ky5m1P98XeeCW7z7ipI3pvEIUhuh2uhgOh3BdF49GI8RxjDzPUZYlAt9HGAfIsjafdQwuTdMDD/dtTpcNPn/5ygQlVqsVrq6ukHdyrN+8xngyQV3X2Gw26Pf6yLsx6lWFpmmwXq+xmD8+tGzHbHG0LG3UZFmGXr+P0PGwaJdIksQoHAwG8DwPpF0E3Iko6zNOcu61HPoRxuM5ZrMZzlfnWN9s0BRj/Hr/Hc2yxvmTBjfX10zQg3VacUc1VlVlOlkulvcVOkrD0hrato13osS2bMTah8/foqIoCnMnY2QzznEceOyp0vYfhfpgFKyjNdAeXk2fY86qLy8vsb3dYtAf3JvRJXXQJm+Xd0ptzFUPIWkzR+pwDpUFv+UZhUEUIslS2I6Gz1ghEFyLbMwpR8p7j9VTk8xwsbjFU2sEh9XKhYA9Tgpol2yb4SW8pTN8oAoVFXhBIxbhGAGCcdmyPOLx+Xj9CT++/URNJ6bijOU/oxJiRUQtZHtyKfKOZthwJOTihCIu6BiMs39VqReCXvpTbNsX6KrQJIoabZS67E2BM7ZkSDG6FBiimAmkTQmXQ0hHlCBWfBdGoNb+pwiRgKSarEI+oYwV+mYvbRUUouTkO++EULwWlfKmZRJ+A3asU7y3MdUnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f0ab2d6a94b5abd4c24262218ad0c256/8ac56/image-33-164640100164239.webp 240w,\n/static/f0ab2d6a94b5abd4c24262218ad0c256/d3be9/image-33-164640100164239.webp 480w,\n/static/f0ab2d6a94b5abd4c24262218ad0c256/b0a15/image-33-164640100164239.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f0ab2d6a94b5abd4c24262218ad0c256/8ff5a/image-33-164640100164239.png 240w,\n/static/f0ab2d6a94b5abd4c24262218ad0c256/e85cb/image-33-164640100164239.png 480w,\n/static/f0ab2d6a94b5abd4c24262218ad0c256/0b533/image-33-164640100164239.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f0ab2d6a94b5abd4c24262218ad0c256/0b533/image-33-164640100164239.png\"\n            alt=\"image-33.png\"\n            title=\"image-33.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>とりあえず今回やったことは以下です。</p>\n<ul>\n<li>AzureにT-Potと踏み台サーバを構築</li>\n<li>T-Potマシンに Cloud One Wordload Security の Agentをインストールして、SentinelとSIEM連携</li>\n<li>踏み台サーバのSSHフォワーディング経由でT-Potコンソールに接続(後にオンプレ仮想マシンから直接接続する方法に構成を変更)</li>\n<li>T-Potのコンソールログインを確認</li>\n</ul>\n<p>まだT-Potマシンのセキュリティグループのインバウンドポートは解放していないので、実際には稼働していない状況です。</p>\n<p>T-Potに含まれるどのハニーポットを使用するか、Azure Sentinelでどんな解析をしていくかなども含めてこれから決めていきたいと思います。</p>\n<h2 id=\"参考書籍\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83%E6%9B%B8%E7%B1%8D\" aria-label=\"参考書籍 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考書籍</h2>\n<ul>\n<li><a href=\"https://amzn.to/34tqh58\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">サイバー攻撃の足跡を分析する ハニーポット観察記録 [ハニーポット観察記録]</a></li>\n<li><a href=\"https://amzn.to/34tPAnt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">WOWHoneypotの遊びかた　“おもてなし”機能でサイバー攻撃を観察する！</a></li>\n</ul>","fields":{"slug":"/honeypot-setup-on-azure","tagSlugs":["/tag/security/","/tag/honey-pot/","/tag/azure/","/tag/備忘録/"]},"frontmatter":{"date":"2022-02-11","description":"","tags":["Security","HoneyPot","Azure","備忘録"],"title":"新米ハニーポッターは安心安全にT-Potで遊びたい[Azure/ハニーポット]","socialImage":{"publicURL":"/static/468e7a49d62ff965c34f93a43fc98e2c/honeypot-setup-on-azure.png"}}}},"pageContext":{"slug":"/honeypot-setup-on-azure"}},"staticQueryHashes":["251939775","401334301","825871152"]}