{"componentChunkName":"component---src-templates-post-template-js","path":"/magical-windbg-vol1-01","result":{"data":{"markdownRemark":{"id":"52c49537-f44a-5e4d-a273-92195313068c","html":"<p>本章では、本書で使用する環境構築の手順について紹介します。</p>\n<p>なお、本書では Home エディションの Windows マシンを利用している読者の環境を想定しているため、1 章で紹介する環境構築手順では仮想マシンを使用しませんが、本書で紹介している設定の適用やツールのインストールを行う場合には、可能な限り仮想マシンの利用を推奨いたします。(Windows 10 / 11 の Home エディションを利用する場合でも、Virtual Box や VMWare などのサードパーティ製の仮想化アプリケーションを使用することは可能です)</p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li><a href=\"#%E6%9C%AC%E6%9B%B8%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\">本書で使用する環境について</a></li>\n<li><a href=\"#%E6%9C%80%E6%96%B0%E3%81%AE%E5%86%8D%E9%A0%92%E5%B8%83%E5%8F%AF%E8%83%BD%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\">最新の再頒布可能パッケージをインストールする</a></li>\n<li><a href=\"#debugging-tools-for-windows-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\">Debugging Tools for Windows のインストール</a></li>\n<li><a href=\"#sysinternals-%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\">Sysinternals ユーティリティのインストール</a></li>\n<li><a href=\"#ghidra-23-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\">Ghidra 2.3 のインストール</a></li>\n<li><a href=\"#d4c-%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\">D4C のダウンロード</a></li>\n<li><a href=\"#%E3%83%80%E3%83%B3%E3%83%97%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%8F%96%E5%BE%97%E3%81%A8%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E8%A8%AD%E5%AE%9A\">ダンプファイル取得とキーボードクラッシュの設定</a></li>\n<li><a href=\"#%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%A7%E3%83%95%E3%83%AB%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%80%E3%83%B3%E3%83%97%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\">マシンでフルメモリダンプを取得してみる</a></li>\n<li><a href=\"#windbg-%E3%81%A8-procmon-%E3%81%AB%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AB%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\">WinDbg と Procmon にシンボルサーバを設定する</a></li>\n<li><a href=\"#1-%E7%AB%A0%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81\">1 章のまとめ</a></li>\n<li><a href=\"#%E5%90%84%E7%AB%A0%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF\">各章へのリンク</a></li>\n</ul>\n<h2 id=\"本書で使用する環境について\" style=\"position:relative;\"><a href=\"#%E6%9C%AC%E6%9B%B8%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\" aria-label=\"本書で使用する環境について permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>本書で使用する環境について</h2>\n<p>本書の内容については、以下の環境で確認を行っています。</p>\n<p>まず、本書で使用する環境は以下の通りです。</p>\n<ul>\n<li>端末: ThinkPad X280(CPU: Intel i7-8550U / RAM: 16 GB / SSD: 256 GB)</li>\n<li>OS  : Windows 10 Pro 22H2</li>\n</ul>\n<p>本書で使用する環境は上記ですが、端末と OS を合わせていただく必要はありません。</p>\n<p>ただし、快適に操作を行うためにも CPU は Intel Core i3 以上、RAM は 8 GB 以上の端末を使用することを推奨します。</p>\n<p>なお、Windows OS のバージョンやエディションについては指定はありません。</p>\n<h2 id=\"最新の再頒布可能パッケージをインストールする\" style=\"position:relative;\"><a href=\"#%E6%9C%80%E6%96%B0%E3%81%AE%E5%86%8D%E9%A0%92%E5%B8%83%E5%8F%AF%E8%83%BD%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\" aria-label=\"最新の再頒布可能パッケージをインストールする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>最新の再頒布可能パッケージをインストールする</h2>\n<p>まず、以下の URL からダウンロードできる vc_redist.x64.exe を実行して、仮想マシンに最新の再頒布可能パッケージをインストールします。</p>\n<br>\n<p>vc_redist.x64.exe:</p>\n<p><a href=\"https://aka.ms/vs/17/release/vc_redist.x64.exe\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://aka.ms/vs/17/release/vc_redist.x64.exe</a></p>\n<br>\n<p>この再頒布可能パッケージのインストールは、本書で使用する D4C.exe というプログラムを実行するために使用します。</p>\n<h2 id=\"debugging-tools-for-windows-のインストール\" style=\"position:relative;\"><a href=\"#debugging-tools-for-windows-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" aria-label=\"debugging tools for windows のインストール permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Debugging Tools for Windows のインストール</h2>\n<p>続けて Windows ダンプ解析を行うマシンに Debugging Tools for Windows をインストールします。</p>\n<p>Debugging Tools for Windows には、WinDbg<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup> などのデバッガや、GFlags<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup> のような Windows 環境のトラブルシューティングに役立つツールが含まれています。</p>\n<p>Debugging Tools for Windows をインストールする方法はいくつかありますが、本書では Windows SDK (10.0.22621) を使用して Debugging Tools for Windows のインストールを行います。</p>\n<p>まずは、以下の URL で Windows SDK のダウンロードページにアクセスし、[Download the installer] から winsdksetup.exe をダウンロードします。</p>\n<br>\n<p>Windows SDK：</p>\n<p><a href=\"https://developer.microsoft.com/ja-jp/windows/downloads/windows-sdk/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://developer.microsoft.com/ja-jp/windows/downloads/windows-sdk/</a> <sup id=\"fnref-3\"><a href=\"#fn-3\" class=\"footnote-ref\">3</a></sup></p>\n<br>\n<p>続いて、ダウンロードした winsdksetup.exe をダブルクリックして実行します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4243068539b87bc45f865df668fc4dde/0b533/winsdksetup-001.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABsUlEQVQ4y51U2W7CMBDk/78NwQMVEk8IEo6Q20lIyDXdWce0pQi1WFpsb5z1HBtm+8MBaZIiiRNEYSxzKvsEYRgijmOEUYgsy9C27dO43W6o6xp93+s7My6yNEUUxTDGaJFxHPHOKMsSs67rcLlcNFj0fD5jGIZ/FXIAiqKwCBmdRNt2SuN6vaKqGJXSqa+15GrN6762a+Z4uQNwL2hMjuPxKChDTRoJnSVPGsW0Lwqjs80ZeV78QKoFWZ2Qfd9DEAQweS46JmJEjlS07Xt5PtEiMzvbNQel2mw2aggZKULS5IY305jvwRwpUgJHWyVhlJVcmuEonZILEC1IhNxst1ttD0vVKG3OueRYwOSWLhmwENfsDl5SVaWCUpdZkBu6GwRnvZkch95K4UR30jwOx5DvaEEmeLBpGuviRMtJ4AwpixLuLIu77uAZ6kikd4S99CINIGUGJSDd4QHROMmjiJ6MyeVRDtzgeR58z8d+t1OXaYTrL0e1aWqcTid9Bnw5/qsPX30Bj/FqqMt4cxAVC7g2oob8H5jxh7pRw78Gz/PLWiwWWK0+sF6vMZ/PsVwu8QktAI2JUKzRxQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4243068539b87bc45f865df668fc4dde/8ac56/winsdksetup-001.webp 240w,\n/static/4243068539b87bc45f865df668fc4dde/d3be9/winsdksetup-001.webp 480w,\n/static/4243068539b87bc45f865df668fc4dde/b0a15/winsdksetup-001.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4243068539b87bc45f865df668fc4dde/8ff5a/winsdksetup-001.png 240w,\n/static/4243068539b87bc45f865df668fc4dde/e85cb/winsdksetup-001.png 480w,\n/static/4243068539b87bc45f865df668fc4dde/0b533/winsdksetup-001.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4243068539b87bc45f865df668fc4dde/0b533/winsdksetup-001.png\"\n            alt=\"Debugging Tools for Windows のインストール\"\n            title=\"Debugging Tools for Windows のインストール\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>デフォルト設定のままインストーラの指示に従っていくと、最後にインストールするパッケージの選択画面が表示されます。</p>\n<p>ここではどの項目をダウンロードしても問題ありませんが、必ず [Debugging Tools for Windows] にチェックが入っていることを確認してください。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/18062a9c40ea76c2449d9f48fc9ad448/0b533/winsdksetup-002.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABwElEQVQ4y41T13LDMAzz//9e+5TUo/Xe2/FGCTlO7euK7hDKCgWSIKUFSYauH9HeesEg+wG3YfvmnrYfJ0zLimGcMUxn8D9iENBfW5cFeZYhy3Nl0yRBWZZomgZlkaMqK8RRjKqqoNa64q+lTdME0zDwbr3DEui6IdaCLmemZSIvCviej7pufiVZJcgOjQd9f4PruvB9H2EYwiNBU58uxXECQ4IEweaT55n4eUiS9ESsCLuukwwt2LYNz/Vgf3ygkMx2p0VkSUQK13WQpqnypyS0XdviJrbv+61k/gzDAE+yY4ZBEKjI3GdZri6SNE1iCebCcRw4d8s7dV2jvZM/CMdxRBRFCls5Bajtrsuz61EyM2RmRVGq1JcDyU54FP43nEu+l0liYm/Srs1/RCfCR8nxVnYqnWMTeP5Tlj/vtxk9ZPjVlJBZsiky7M9mp3AsmZnFcfwAx4YNYnP+a8S3plAnakYdPW+znDeejeNGyAA8o+UzLKWBk7xlLn7vc6sI53lGKwNKdF2rhpVB+NymebsURSEcGfzr9apeTMb3L6C/49i4XC9qFrVn5uzoQ51NwxStQ7y8vkiAi5JGf9NVZZ/hlYjYXXFasgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/18062a9c40ea76c2449d9f48fc9ad448/8ac56/winsdksetup-002.webp 240w,\n/static/18062a9c40ea76c2449d9f48fc9ad448/d3be9/winsdksetup-002.webp 480w,\n/static/18062a9c40ea76c2449d9f48fc9ad448/b0a15/winsdksetup-002.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/18062a9c40ea76c2449d9f48fc9ad448/8ff5a/winsdksetup-002.png 240w,\n/static/18062a9c40ea76c2449d9f48fc9ad448/e85cb/winsdksetup-002.png 480w,\n/static/18062a9c40ea76c2449d9f48fc9ad448/0b533/winsdksetup-002.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/18062a9c40ea76c2449d9f48fc9ad448/0b533/winsdksetup-002.png\"\n            alt=\"Debugging Tools for Windows のインストール\"\n            title=\"Debugging Tools for Windows のインストール\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>[Debugging Tools for Windows] にチェックが入った状態でインストーラを実行します。</p>\n<p>インストーラの実行が完了したら、<code class=\"language-text\">C:\\Program Files (x86)\\Windows Kits\\10\\Debuggers\\x64</code> 内に windbg.exe と gflags.exe が存在することを確認します。(本書では使用しませんが、x86 用の windbg.exe は <code class=\"language-text\">C:\\Program Files (x86)\\Windows Kits\\10\\Debuggers\\x86</code> 内に存在します)</p>\n<p>これらのプログラムは頻繁に使用するため、必要に応じてショートカットを作成しておくと良いでしょう。</p>\n<p>ちなみに、WinDbg には、最新の Windows アプリ版の WinDbg が存在します。</p>\n<p>Windows アプリ版の WinDbg は、本書で使用する WinDbg(Classic) と比較してよりモダンな UI や、Time Travel Debugging(TTD) などの協力な機能を利用できます。</p>\n<p>本書では Windows アプリ版の WinDbg は使用しませんが、ダンプ解析に使用する機能やコマンドなどは WinDbg(Classic) と同一です。</p>\n<p>そのため、ダンプの解析のために Windows アプリ版の WinDbg を利用いただいても問題ありません。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f8ee24592aaee568dfa5627b73f082fe/0b533/store-001.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 112.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB90lEQVQ4y+VUy27TQBT1J4EQIn/Q7+IhVL6EFZuyCixKxYZdRemqKmnkxm97HDv2jB/jHO6MYydxcEPVJRMd3Tt3bo7v3McYF9cLLBYuHNvD/b0Di3S1N00bnhvi99zC5Y2N2dzG2Y8ZLq4dRGEMx4thu0xLP1iCsRRhmMD4NfPw/WqOmekSoQ1Tkdo+FpYHz2MwrQBXty79OcLtnaX3YbhEFCkkGmrfwfj0M8DHSx93QYY45QiWGSKSHVgqwJIcbEUyzelDNpHEyDKO1SpvkSmZUUAWDDxirddrlGV5aKefWlmewahqCUmO6yNQS0qJqqp6cmVu0Z4XRQFDyqZ3eCiyvxPuf1AI8TTC4fn/SyiPVvhRRXkosuFqmoYI69EbaMI850iSlLo9Q5quqJdKat6qhyLopBAFBPXaWISccxiO48P1Avh+pMGYmkkGy3JplsONTc1rrG1BEG1HbgCPeEavrHKlzlTeuojquu6vPJpDlZddh+3MVgc52s3haJWPER5W+YkR7hP+Q4SSCLsXo0OzIdyz7/Sh0puBv67yboTQbtsIqz6HW3vTSF2YsVW0EbbvWrNBp5dlfWBXvpx6kfOCHlOBnCu0uhAl9TL14eT0HJMP3zA53UDr53g1tG/2L959xfM3Uzx7PSX5RUPpL99OcfL+M/4A9yafk0s7Yt4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f8ee24592aaee568dfa5627b73f082fe/8ac56/store-001.webp 240w,\n/static/f8ee24592aaee568dfa5627b73f082fe/d3be9/store-001.webp 480w,\n/static/f8ee24592aaee568dfa5627b73f082fe/b0a15/store-001.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f8ee24592aaee568dfa5627b73f082fe/8ff5a/store-001.png 240w,\n/static/f8ee24592aaee568dfa5627b73f082fe/e85cb/store-001.png 480w,\n/static/f8ee24592aaee568dfa5627b73f082fe/0b533/store-001.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f8ee24592aaee568dfa5627b73f082fe/0b533/store-001.png\"\n            alt=\"Windows アプリ版の WinDbg\"\n            title=\"Windows アプリ版の WinDbg\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>なお、以下のドキュメントに記載されている通り、Microsoft Store からダウンロード可能な「WinDbg Preview」は既に更新を終了している点に注意が必要です。</p>\n<br>\n<p>Windows デバッガーをインストールする：</p>\n<p><a href=\"https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/</a></p>\n<br>\n<p>Windows アプリ版の最新の WinDbg を入手するには、上記のドキュメント内のリンクからダウンロード可能なインストーラを使用します。</p>\n<h2 id=\"sysinternals-ユーティリティのインストール\" style=\"position:relative;\"><a href=\"#sysinternals-%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" aria-label=\"sysinternals ユーティリティのインストール permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sysinternals ユーティリティのインストール</h2>\n<p>次に、Process Monitor<sup id=\"fnref-4\"><a href=\"#fn-4\" class=\"footnote-ref\">4</a></sup> や Process Explorer<sup id=\"fnref-5\"><a href=\"#fn-5\" class=\"footnote-ref\">5</a></sup> などの便利なツールを含む Sysinternals<sup id=\"fnref-6\"><a href=\"#fn-6\" class=\"footnote-ref\">6</a></sup> を取得します。</p>\n<p>これらのツールについて、本書では詳しい説明は割愛します。</p>\n<p>詳しく知りたい方は公式ドキュメントや「Windows Sysinternals徹底解説」<sup id=\"fnref-7\"><a href=\"#fn-7\" class=\"footnote-ref\">7</a></sup> などが参考になると思います。</p>\n<p>これらのツールをまとめてインストールするため、以下の URL にアクセスして [Sysinternals Suite] をクリックします。</p>\n<br>\n<p>Sysinternals ユーティリティ：</p>\n<p><a href=\"https://learn.microsoft.com/ja-jp/sysinternals/downloads/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://learn.microsoft.com/ja-jp/sysinternals/downloads/</a></p>\n<br>\n<p>ここからダウンロードした ZIP ファイルを解凍することで、Process Monitor や Process Explorer などのツールを利用できるようになります。</p>\n<h2 id=\"ghidra-23-のインストール\" style=\"position:relative;\"><a href=\"#ghidra-23-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" aria-label=\"ghidra 23 のインストール permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ghidra 2.3 のインストール</h2>\n<p>次に、リバースエンジニアリングツールの Ghidra 2.3<sup id=\"fnref-8\"><a href=\"#fn-8\" class=\"footnote-ref\">8</a></sup> のセットアップを行います。</p>\n<p>Ghidra の詳細や詳しい利用方法については本書では解説しませんが、Ghidra に同梱されている Help や、「リバースエンジニアリングツール Ghidra 実践ガイド」<sup id=\"fnref-9\"><a href=\"#fn-9\" class=\"footnote-ref\">9</a></sup> や「マスタリング Ghidra」<sup id=\"fnref-10\"><a href=\"#fn-10\" class=\"footnote-ref\">10</a></sup> などの書籍が参考になると思います。</p>\n<p>Ghidra のセットアップのため、以下の Github の Release ページから Ghidra 10.2.3 のパッケージ (<code class=\"language-text\">ghidra_10.2.3_PUBLIC_20230208.zip</code>) をダウンロードし、解凍しておきます。</p>\n<br>\n<p>Ghidra Release Page：</p>\n<p><a href=\"https://github.com/NationalSecurityAgency/ghidra/releases\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/NationalSecurityAgency/ghidra/releases</a></p>\n<br>\n<p>続いて、Ghidra を実行するために必要な JDK 17 をインストールするため、以下のダウンロードページから Windows x64 用の MSI Installer をダウンロードします。</p>\n<br>\n<p>Java Downloads：</p>\n<p><a href=\"https://www.oracle.com/jp/java/technologies/downloads/#jdk17-windows\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.oracle.com/jp/java/technologies/downloads/#jdk17-windows</a></p>\n<br>\n<p>ダウンロードした JDK 17 の MSI インストーラを実行し、JDK 17 のインストールを完了します。</p>\n<p>インストールの完了後、展開した <code class=\"language-text\">ghidra_10.2.3_PUBLIC_20230208.zip</code> 内の ghidraRun.bat をダブルクリックして Ghidra を起動します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f4181953724ed3e06043574694a36498/0b533/ghidra-setup-001.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABMElEQVQ4y52T646CMBBGef+H25hNjMqlC6VAkZugyx2+7dSA6x9vTU4CneF02g7G76XADCA/HhF4HqJIIggCFEWBvu/Rdd1TmqZBXdfI8xxGLrc4X1olCrHZfMM0TTDGtJQSsix7CSogDEMYRbxH109auNt+Ybfba4QIdGKapi9Bi7uuC+OU2KrkQU1kGIdal9+2rT6GeX4VygaklDAc28YPc1WFEa7Ty7h/ezTuhJz78FSptEUKfMoqXFahc5imaV3xY+EykSTJGvh0SBlfhTRIOI6jZhiGt6B+JQ/dwyrknMP3hbrtAqeyRFWdFdUTzmteWV1gMn4TRqopLcuCYzv6LKhRqbcecWvsVBfi8X9CCsRxfNeoz6At0h9F0DNznJuQZL7v66AQ4m3ou4Np4w8qFebNnCdcUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f4181953724ed3e06043574694a36498/8ac56/ghidra-setup-001.webp 240w,\n/static/f4181953724ed3e06043574694a36498/d3be9/ghidra-setup-001.webp 480w,\n/static/f4181953724ed3e06043574694a36498/b0a15/ghidra-setup-001.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f4181953724ed3e06043574694a36498/8ff5a/ghidra-setup-001.png 240w,\n/static/f4181953724ed3e06043574694a36498/e85cb/ghidra-setup-001.png 480w,\n/static/f4181953724ed3e06043574694a36498/0b533/ghidra-setup-001.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f4181953724ed3e06043574694a36498/0b533/ghidra-setup-001.png\"\n            alt=\"Ghidra のセットアップ\"\n            title=\"Ghidra のセットアップ\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Ghidra の起動が完了したら、[File]>[New Project] から任意の名称の Project を作成しておきましょう。</p>\n<h2 id=\"d4c-のダウンロード\" style=\"position:relative;\"><a href=\"#d4c-%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\" aria-label=\"d4c のダウンロード permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>D4C のダウンロード</h2>\n<p>本書で解析に使用するダンプファイルの生成に使用するツール D4C.exe(v0.1) を以下のリポジトリからダウンロードします。</p>\n<br>\n<p>D4C Release Page: </p>\n<p><a href=\"https://github.com/kash1064/garyu-windbg/releases/tag/v0.1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/kash1064/garyu-windbg/releases/tag/v0.1</a><sup id=\"fnref-11\"><a href=\"#fn-11\" class=\"footnote-ref\">11</a></sup></p>\n<br>\n<p>なお、本書ではバイナリやダンプの解析にシンボルファイルは使用しないため、D4C.pdb ファイルについては初めはダウンロードしないことを推奨します。</p>\n<h2 id=\"ダンプファイル取得とキーボードクラッシュの設定\" style=\"position:relative;\"><a href=\"#%E3%83%80%E3%83%B3%E3%83%97%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%8F%96%E5%BE%97%E3%81%A8%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E8%A8%AD%E5%AE%9A\" aria-label=\"ダンプファイル取得とキーボードクラッシュの設定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ダンプファイル取得とキーボードクラッシュの設定</h2>\n<p>次に、ダンプファイルを取得するマシンでフルメモリダンプの取得設定とキーボードクラッシュの有効化を行います。</p>\n<p>設定は簡単で、先ほど共有フォルダに配置した D4C.exe を仮想マシンのローカルフォルダにコピーして実行し、最初のメニューで 0 を入力して Enter キーを押すだけです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9964efa8e3ff7976102f383021848655/0b533/d4c-setting-001.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA8klEQVQoz82Py2rCQBSGxy4zM4kBMzExLnMxD9tLtM9Q0SgiIhoT0ycodNHn+TszIihoG8GFi4+5cM5/vkPy+QLj6QwfkxyrTYFtVWNb7jVF9YndXlKdUsv/A/pe1tgUJZarNb6+f0D6QQDf8xAEPfi+h27XhetKhIBlWeCcweT8T2y7jadWC88vryBJnCCKIoRhiGQwQJqmiOMYQrgwDAOU0n8xTROEEGTDdxDhOLpZWQlp5XQ6cqINxlhj1CY6cCQDtbaccITLtypSk0/PRoHKkF5Z65bQs0B2pbiJ2WXDGxobG9KHDrzryqM7B75lQ/wCLpxNrjs09/0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9964efa8e3ff7976102f383021848655/8ac56/d4c-setting-001.webp 240w,\n/static/9964efa8e3ff7976102f383021848655/d3be9/d4c-setting-001.webp 480w,\n/static/9964efa8e3ff7976102f383021848655/b0a15/d4c-setting-001.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9964efa8e3ff7976102f383021848655/8ff5a/d4c-setting-001.png 240w,\n/static/9964efa8e3ff7976102f383021848655/e85cb/d4c-setting-001.png 480w,\n/static/9964efa8e3ff7976102f383021848655/0b533/d4c-setting-001.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9964efa8e3ff7976102f383021848655/0b533/d4c-setting-001.png\"\n            alt=\"D4C.exe を使用した設定変更\"\n            title=\"D4C.exe を使用した設定変更\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これで、OS を再起動すると、フルメモリダンプの設定とキーボードクラッシュの設定が有効化されます。</p>\n<p>ちなみに、D4C.exe では以下の PowerShell スクリプトを実行した場合と同等の設定を行います。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Settings of Full memory dump</span>\n<span class=\"token variable\">$crashControlRegPath</span> = <span class=\"token string\">\"HKLM:System\\CurrentControlSet\\Control\\CrashControl\"</span>\n<span class=\"token variable\">$isExistKey</span> = <span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$crashControlRegPath</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$isExistKey</span> <span class=\"token operator\">-eq</span> <span class=\"token boolean\">$False</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">New-Item</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$crashControlRegPath</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$CrashControlRegPath</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"CrashDumpEnabled\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"DWord\"</span> <span class=\"token operator\">-</span>Value <span class=\"token string\">\"1\"</span> <span class=\"token operator\">-</span>Force\n<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$CrashControlRegPath</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"AutoReboot\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"DWord\"</span> <span class=\"token operator\">-</span>Value <span class=\"token string\">\"1\"</span> <span class=\"token operator\">-</span>Force\n<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$CrashControlRegPath</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"DumpFile\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"ExpandString\"</span> <span class=\"token operator\">-</span>Value <span class=\"token string\">\"%SystemRoot%\\FULL_MEMORY.DMP\"</span> <span class=\"token operator\">-</span>Force\n<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$CrashControlRegPath</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"LogEvent\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"DWord\"</span> <span class=\"token operator\">-</span>Value <span class=\"token string\">\"1\"</span> <span class=\"token operator\">-</span>Force\n\n<span class=\"token comment\"># Settings of Full application dump</span>\n<span class=\"token variable\">$localDumpsRegPath</span> = <span class=\"token string\">\"HKLM:SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\\LocalDumps\"</span>\n<span class=\"token variable\">$isExistKey</span> = <span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$localDumpsRegPath</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$isExistKey</span> <span class=\"token operator\">-eq</span> <span class=\"token boolean\">$False</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">New-Item</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$localDumpsRegPath</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$localDumpsRegPath</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"DumpFolder\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"ExpandString\"</span> <span class=\"token operator\">-</span>Value <span class=\"token string\">\"%LOCALAPPDATA%\\CrashDumps\"</span> <span class=\"token operator\">-</span>Force\n<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$localDumpsRegPath</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"DumpCount\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"DWord\"</span> <span class=\"token operator\">-</span>Value <span class=\"token string\">\"2\"</span> <span class=\"token operator\">-</span>Force\n<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$localDumpsRegPath</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"DumpType\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"DWord\"</span> <span class=\"token operator\">-</span>Value <span class=\"token string\">\"2\"</span> <span class=\"token operator\">-</span>Force\n\n<span class=\"token comment\"># Disable CrashOnCtrlScroll</span>\n<span class=\"token variable\">$parameterRegPaths</span> = @<span class=\"token punctuation\">(</span><span class=\"token string\">\"HKLM:System\\CurrentControlSet\\Services\\i8042prt\\Parameters\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t\t  <span class=\"token string\">\"HKLM:System\\CurrentControlSet\\Services\\kbdhid\\Parameters\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t\t  <span class=\"token string\">\"HKLM:System\\CurrentControlSet\\Services\\hyperkbd\\Parameters\"</span>\n\t\t\t\t\t<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$parameterRegPath</span> in <span class=\"token variable\">$parameterRegPaths</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token variable\">$isExistKey</span> = <span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$parameterRegPath</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$isExistKey</span> <span class=\"token operator\">-eq</span> <span class=\"token boolean\">$False</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">New-Item</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$parameterRegPath</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$parameterRegPath</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"CrashOnCtrlScroll\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"DWord\"</span> <span class=\"token operator\">-</span>Value <span class=\"token string\">\"0\"</span> <span class=\"token operator\">-</span>Force\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Setting alt dump key</span>\n<span class=\"token variable\">$parameterRegPaths</span> = @<span class=\"token punctuation\">(</span><span class=\"token string\">\"HKLM:System\\CurrentControlSet\\Services\\i8042prt\\crashdump\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t\t  <span class=\"token string\">\"HKLM:System\\CurrentControlSet\\Services\\kbdhid\\crashdump\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t\t  <span class=\"token string\">\"HKLM:System\\CurrentControlSet\\Services\\hyperkbd\\crashdump\"</span>\n\t\t\t\t\t<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$parameterRegPath</span> in <span class=\"token variable\">$parameterRegPaths</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token variable\">$isExistKey</span> = <span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$parameterRegPath</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$isExistKey</span> <span class=\"token operator\">-eq</span> <span class=\"token boolean\">$False</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">New-Item</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$parameterRegPath</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$parameterRegPath</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"Dump1Keys\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"DWord\"</span> <span class=\"token operator\">-</span>Value <span class=\"token string\">\"0x2\"</span> <span class=\"token operator\">-</span>Force\n\t<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token variable\">$parameterRegPath</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"Dump2Key\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"DWord\"</span> <span class=\"token operator\">-</span>Value <span class=\"token string\">\"0x3d\"</span> <span class=\"token operator\">-</span>Force\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Change PageFileSize</span>\n<span class=\"token variable\">$totalPhysicalMemSize</span> = $<span class=\"token punctuation\">(</span><span class=\"token namespace\">[Math]</span>::Round<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get-WmiObject</span> Win32_OperatingSystem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>TotalVisibleMemorySize <span class=\"token operator\">/</span> 1024<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$freeStorageSizeofC</span> = $<span class=\"token punctuation\">(</span><span class=\"token namespace\">[Math]</span>::Round<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get-PSDrive</span> C<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Free <span class=\"token operator\">/</span> 1024 <span class=\"token operator\">/</span> 1024<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$pageFileSize</span> = <span class=\"token variable\">$totalPhysicalMemSize</span> <span class=\"token operator\">+</span> 400\n<span class=\"token variable\">$pageFileSetting</span> = <span class=\"token string\">\"c:\\pagefile.sys <span class=\"token variable\">$pageFileSize</span> <span class=\"token variable\">$pageFileSize</span>\"</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$freeStorageSizeofC</span> <span class=\"token operator\">-gt</span> <span class=\"token variable\">$pageFileSize</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-eq</span> <span class=\"token boolean\">$True</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">New-ItemProperty</span> <span class=\"token operator\">-</span>LiteralPath <span class=\"token string\">\"HKLM:System\\CurrentControlSet\\Control\\Session Manager\\Memory Management\"</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"PagingFiles\"</span> <span class=\"token operator\">-</span>PropertyType <span class=\"token string\">\"MultiString\"</span> <span class=\"token operator\">-</span>Value <span class=\"token variable\">$pageFileSetting</span> <span class=\"token operator\">-</span>Force\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">Write-Warning</span> <span class=\"token string\">\"C drive space is too small.\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>上記の設定手順では、大きく以下の 4 つの設定を行っています。</p>\n<ol>\n<li>システムクラッシュ時に出力するダンプの種類をフルメモリダンプに変更</li>\n<li>ページファイルのサイズを「物理メモリのサイズ + 400 MB」に変更</li>\n<li>アプリケーションクラッシュ時に出力するプロセスダンプの種類をフルダンプに変更</li>\n<li>「右 Ctrl + Space キー 2 回」の操作でのシステムクラッシュを有効化</li>\n</ol>\n<p>現在の Windows システムにてアプリケーションクラッシュ時にプロセスダンプを取得する場合、フルダンプよりもすべての情報を取得するオプションを設定して取得したミニダンプの方が多くの情報を収集できます。<sup id=\"fnref-12\"><a href=\"#fn-12\" class=\"footnote-ref\">12</a></sup></p>\n<p>ただし、基本的にはフルダンプの設定で十分な情報を収集できますので、本書ではより直感的にイメージしやすいように、アプリケーションクラッシュ時に出力するプロセスダンプの種類はフルダンプを選択しています。</p>\n<p>また、システムクラッシュ時に取得できるフルメモリダンプには、その端末で稼働する Windows システムがアクセス可能なすべての物理メモリ内のページ情報が全て含まれます。</p>\n<p>ただし、フルメモリダンプを取得する際には、最小で「物理メモリのサイズ + 1 MB」のサイズのページファイルを構成する必要があります。</p>\n<p>これは、物理メモリ内のすべての情報をダンプファイルとして出力するために必要な設定です。</p>\n<p>なお、安全にフルメモリダンプを取得するためには「物理メモリのサイズ + 1 MB」のサイズに、デバイスドライバのクラッシュデータを含めることができる 256 MB 以上のページファイルサイズをさらに追加しておくことが推奨されています。<sup id=\"fnref-13\"><a href=\"#fn-13\" class=\"footnote-ref\">13</a></sup></p>\n<p>スクリプトの概要については以下の公開ブログでも紹介しているので、D4C.exe ではなく PowerShell スクリプトを手動で実行して設定を行いたい場合には、下記を参照してください。</p>\n<br>\n<p>Power Shell スクリプトで Windows のフルメモリダンプの取得設定とキーボードクラッシュの設定を行う(かえるのひみつきち):</p>\n<p><a href=\"https://kashiwaba-yuki.com/windows-setting-fulldump\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://kashiwaba-yuki.com/windows-setting-fulldump</a></p>\n<br>\n<h2 id=\"マシンでフルメモリダンプを取得してみる\" style=\"position:relative;\"><a href=\"#%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%A7%E3%83%95%E3%83%AB%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%80%E3%83%B3%E3%83%97%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"マシンでフルメモリダンプを取得してみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>マシンでフルメモリダンプを取得してみる</h2>\n<p>設定が有効に動作していることを確認するためにフルメモリダンプの取得を行います。</p>\n<p>[ダンプファイル取得とキーボードクラッシュの設定] の手順を実行した後、再起動したマシンにサインインします。</p>\n<p>続けて、キーボードの右 Ctrl キーを押しながら、Space キーを 2 回連打します。</p>\n<p>キーボードクラッシュの設定が反映されている場合、上記のキー操作を実施するとシステムがクラッシュし、ブルースクリーン画面が表示されます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aed56d2ac06acaecdc7941c14636d092/0b533/fulldump-003.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABZUlEQVQoz41S2U4CQRBcXxARF8EDwXjFC2OIiQ/GaHzwm4AlgiKigOAVj+iXufeun1J2zyywIQZ5qO2Z7p6artpRlPI3FC2EIqE0BC2If9V69bIuo1IykL6xBRbrNvKPHnIdF/tdT+wzDZnfbLs4eHax0rSw0bax9+BgrWVjt+sgUTMlMZMqmo7MrYV1Kp5++Dh+83Hy7mO742Dr3kGODuzQ+vzrB4cvHo5ePZx9+sg/uaKuElmkog+mZMnxSwMzVwaydxY1GEhem4hRbqpqIFqVtVTdFHuuzdGac5MVY2BVXzJ9eMLVpo15ahQ+FYY8KoZQCFAc8lQLEfKEfHOCblUJyZqcIFqR0/FEKvXEA0yzIo5VuY9R7JMyIZOx3GXCUsOiH2SKOFuTh1k++8Ty+TBL71nCkfNSuvBQR4oIF4gkS9LTDSY1hfzIhY4J9qYUelajnk05kDyysd/8D8ITjtU8Th/hFw2O1/mgLvuiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/aed56d2ac06acaecdc7941c14636d092/8ac56/fulldump-003.webp 240w,\n/static/aed56d2ac06acaecdc7941c14636d092/d3be9/fulldump-003.webp 480w,\n/static/aed56d2ac06acaecdc7941c14636d092/b0a15/fulldump-003.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/aed56d2ac06acaecdc7941c14636d092/8ff5a/fulldump-003.png 240w,\n/static/aed56d2ac06acaecdc7941c14636d092/e85cb/fulldump-003.png 480w,\n/static/aed56d2ac06acaecdc7941c14636d092/0b533/fulldump-003.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/aed56d2ac06acaecdc7941c14636d092/0b533/fulldump-003.png\"\n            alt=\"ブルースクリーン(BSOD)\"\n            title=\"ブルースクリーン(BSOD)\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>システムの再起動後、<code class=\"language-text\">C:\\Windows</code> フォルダ直下に仮想マシンの物理メモリとほぼ同サイズの <code class=\"language-text\">FULL_MEMORY.DMP</code> が生成されていれば、フルダンプの設定が有効に動作していると判断できます。</p>\n<p>ちなみに、本書の手順で設定したキーボードクラッシュは、 RDP 経由で接続している場合には有効に動作しません。</p>\n<p>物理キーボードを使用可能な場合は、ローカルマシンに直接サインインした状態で「右 Ctrl キーを押しながら、Space キーを 2 回連打」することでシステムクラッシュを発生させることが可能です。</p>\n<p>また、Hyper-V 仮想マシンを利用している場合には、拡張セッションを無効化した状態でマシンにサインインし、「右 Ctrl キーを押しながら、Space キーを 2 回連打」することでキーボードクラッシュを行うことが可能です。</p>\n<p>Virtual Box など、その他の仮想マシンプラットフォームを利用している場合には、ソフトウェアキーボードを使用してキーボードクラッシュを起こすことが可能か試してみてください。</p>\n<p>もしキーボードクラッシュを実施できない環境の場合は、[Sysinternals ユーティリティのインストール] でダウンロードした SysinternalsSuite に含まれる notmyfault.exe を使用することでも、意図的にシステムクラッシュを再現することが可能です。</p>\n<h2 id=\"windbg-と-procmon-にシンボルサーバを設定する\" style=\"position:relative;\"><a href=\"#windbg-%E3%81%A8-procmon-%E3%81%AB%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AB%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\" aria-label=\"windbg と procmon にシンボルサーバを設定する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WinDbg と Procmon にシンボルサーバを設定する</h2>\n<p>WinDbg や Process Monitor(Procmon) などを使用してトラブルシューティングを行う際に適切なシンボルを取得することは非常に重要です。</p>\n<p>シンボル<sup id=\"fnref-14\"><a href=\"#fn-14\" class=\"footnote-ref\">14</a></sup>とは、exe や dll などの実行ファイルには含まれない関数や変数の名称などを含む情報です。</p>\n<p>WinDbg などのツールを使用する際には、適切なシンボルを取得し参照することで、よりスムーズな解析を行うことが可能です。</p>\n<p>一般にダンプファイルの解析で使用するシンボル情報は Microsoft が公開しているシンボルサーバ<sup id=\"fnref-15\"><a href=\"#fn-15\" class=\"footnote-ref\">15</a></sup>から取得できます。</p>\n<p>ただし、一部の公開されていないモジュールのシンボル情報や、サードパーティが独自に開発したソフトウェアのシンボル情報は、Microsoft によって公開されているシンボルサーバからダウンロードすることはできません。</p>\n<p>なお、解析対象のプログラムがユーザ自身によって開発されている場合は、プログラムのビルド時に生成できる pdb や dbg ファイルをシンボル情報としてデバッガにロードして利用できます。</p>\n<p>この項では、Microsoft が公開しているシンボルサーバからシンボル情報を取得するため、WinDbg と Process Monitor の設定を行います。</p>\n<p>本書では必要ありませんが、必要に応じて Process Explorer でも同様の設定を実施しておくとよいでしょう。</p>\n<p>まずは、WinDbg x64 を管理者権限で起動して、[Ctrl + S] キーを押して Symbol Scratch Path ウインドウを起動します。</p>\n<p>起動した Symbol Scratch Path ウインドウに以下を入力して、[OK] をクリックします。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">srv*https:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>msdl<span class=\"token punctuation\">.</span>microsoft<span class=\"token punctuation\">.</span>com/download/symbols</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/06a570beb37f5c88d5743f41e976f84d/0b533/windbg-symbol-001.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABjElEQVQoz6WSe0+CUBiH+f5fpJlOByqImxfAa7Y2RZxt3SxDEjW1EBTx13uOzqWt9UdsD7+Xc3kYL0cIfB/eagWfpefx/M8lGLqOSqUCTdNQLpePGEYFtVoNOs2XSjpUtYhiUUM+X0KhwNZWUSK0xg2Mw/5mswmh2WigWq2iddWCZVkwTRPdbhddSlZ3Oh3KDmUbJqsp2ZxlmZDSEi5il4jH44jFYkgkEhBehjZm73P6bB/BenPCesMID3WITRhiFWyw9GhtGKFeryOVSkJRFMiyjGw2C+FuYGMwHOHh+RWDV4fX909D2O4My9Ua80+fBAGmSw/2eIr+ow3juofe4wi6YSCZTHJROp3mCLyTuwg7gm77OorY4Emzt9st3Nkctm2j3TYpR9T7U2Emk9kLd7/AtNFuXwfhFuPZAiMSst46jsN/5g/h8G1Cb15gMv8glmfsx6aUTOa4Uy7s92/hui4/AT+EMj0oiowcNfY3jvM5QlXp6OTpGKkQRfEoOgolSQJD/AtR4oLvnMsYXyzZvMdcurfiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/06a570beb37f5c88d5743f41e976f84d/8ac56/windbg-symbol-001.webp 240w,\n/static/06a570beb37f5c88d5743f41e976f84d/d3be9/windbg-symbol-001.webp 480w,\n/static/06a570beb37f5c88d5743f41e976f84d/b0a15/windbg-symbol-001.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/06a570beb37f5c88d5743f41e976f84d/8ff5a/windbg-symbol-001.png 240w,\n/static/06a570beb37f5c88d5743f41e976f84d/e85cb/windbg-symbol-001.png 480w,\n/static/06a570beb37f5c88d5743f41e976f84d/0b533/windbg-symbol-001.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/06a570beb37f5c88d5743f41e976f84d/0b533/windbg-symbol-001.png\"\n            alt=\"Symbol Scratch Path ウインドウの設定\"\n            title=\"Symbol Scratch Path ウインドウの設定\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>設定が完了したら、左上の [File] から [Save Workspace] をクリックします。</p>\n<p>これで既定のワークスペースに設定が保存されるため、次回以降の起動時にもシンボルパスの設定が引き継がれます。</p>\n<p>次に、[Sysinternals ユーティリティのインストール] で取得した SysinternalsSuite から Procmon64.exe を管理者権限で実行します。</p>\n<p>起動した Procmon のウインドウ上部のメニューから [Options]>[Configure Symbols…] をクリックします。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e9eeba7b98afd8eed8b01bc6b167546c/0b533/procmon-symbol-001.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB40lEQVQoz5VT226bQBDl/6VIVfPQh771H6JWauRGSdTkoQ8pvgEmLra57bLscgkYDPh0IHHrtFWbjnQ4EuyemTMzaGaQQsYRokggTRJEQkAIBcNLYbsSSkq0XYd/xn4/kCa4QMwyiDjGauMhZwFmboiTTwne3UQIfQ8PRYGyLH+g2m7hshgOSxDyEG3bkN6euIVmLxywVQFntYJpLVGul9AJPPCwWTvYuD4YJwciBicXjKCUwujmDme3Or7MbilJgS0l6ciJVlUVtlU5HOozt5SpooqSyMdiqiPyVshiqqJM0BTqCdQKwbGlavuo6xp5nj9a/lM76qbFxVziw12ISzPBpZXifJbiI+F8nuL9WOFbIIez3VF/e9ta/zhGH0XV4O1nhVcjjtMRw5trhdOrHK+vMuIMJxcZJmvVS6Db49ld7aB8/LKj5uYyhO9YcJcmioSj7a0+yCfEyBKJx9M/7/1m+fChnxbnHKZhwTAXcL0AsUwgpCJWA0upcFzMXwV3TYO1F+L+fgnHcWDbNhjjtKvRkIgxRoLy5YL1roHtbDCZTKDrOibjMfSvOizLgkd7GQbhsBUvFuwnx8IAxtyAYRiYE0+nU/i+j5h+gL7K/xI8bH23754NrKFW7Ha7AYd1+VXwO/1tk6Gq5q4FAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e9eeba7b98afd8eed8b01bc6b167546c/8ac56/procmon-symbol-001.webp 240w,\n/static/e9eeba7b98afd8eed8b01bc6b167546c/d3be9/procmon-symbol-001.webp 480w,\n/static/e9eeba7b98afd8eed8b01bc6b167546c/b0a15/procmon-symbol-001.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e9eeba7b98afd8eed8b01bc6b167546c/8ff5a/procmon-symbol-001.png 240w,\n/static/e9eeba7b98afd8eed8b01bc6b167546c/e85cb/procmon-symbol-001.png 480w,\n/static/e9eeba7b98afd8eed8b01bc6b167546c/0b533/procmon-symbol-001.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e9eeba7b98afd8eed8b01bc6b167546c/0b533/procmon-symbol-001.png\"\n            alt=\"Configure Symbols の設定\"\n            title=\"Configure Symbols の設定\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>既定では、[DbgHelp.dll path(version 6.0 or later)] に <code class=\"language-text\">C:\\WINDOWS\\SYSTEM32\\dbghelp.dll</code> が登録されています。</p>\n<p>しかし、<code class=\"language-text\">C:\\WINDOWS\\SYSTEM32\\dbghelp.dll</code> は通常はバージョン 6.0 以上の要件を満たさないので、要件を満たす dbghelp.dll のパスを指定する必要があります。</p>\n<p>この要件を満たす dbghelp.dll は、[Debugging Tools for Windows のインストール] でインストールした WinDbg x64 などと同じく <code class=\"language-text\">C:\\Program Files (x86)\\Windows Kits\\10\\Debuggers\\x64</code> の直下に配置されています。</p>\n<p>そのため、[DbgHelp.dll path(version 6.0 or later)] には以下のパスを指定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">C:\\Program Files <span class=\"token punctuation\">(</span>x86<span class=\"token punctuation\">)</span>\\Windows Kits\\10\\Debuggers\\x64\\dbghelp<span class=\"token punctuation\">.</span>dll</code></pre></div>\n<p>また、[Symbol paths:] には WinDbg の時と同じく Microsoft のシンボルサーバのアドレスを指定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">srv*https:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>msdl<span class=\"token punctuation\">.</span>microsoft<span class=\"token punctuation\">.</span>com/download/symbols</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6c17ed61bf717d4b603ba711b9911bc9/0b533/procmon-symbol-002.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACnUlEQVQ4y3VU2XLaQBDk/78pD3lIpVKxMWAQkpDQfcs60I0EdGYWbJzgbFXX7K52e6fn0EwLCzRtjbquMfQdqrZFT+i6HnXboe1anC8Q43LGl+N8PuN0Ogk7C4MI5duA8nCA7fhoogBOnsK1DVSBi7c0R5H5KIsc3bGElNRQwwg7N4LspLA8m8gmXOhRJp0pqoHYaWCYFtTdHr3vQKZD86dfqOw9HMeDbUjI6ZF+yPHdLvBsufi5lPHtaYOVNkdHipqmJdILZv0wkKsTsixHFIZIyIZegCwvyKMjWjpc1y3GcUTfD7iMdH6acOx7NNWBwnBBkiQoy1LIn03TSUyapkEcRYgIcZyIdUUXquoa3wOFRNiqEvPDoaJvV+R5Lr4Jwn6cxIQPbSUJm/UG69UrFosFVssVXmm+XCyxfFngZT6HvJVhGAZ0TYdpmvD9gByIxX1BOE5XQn7J2O8JhrB84X3uui5cx6F4XsFrx3YoYW9CCUt+JKQNVVEgrSXI0lZ4y97w3LZt+J5P3viCyCUUFGOWWRSFeOCDcPiQXEFVd1iTZNMigiAUCKhEPJJl0Z5LpLzmfU5aSXfY2vQAK/yLkD+qpg/F8KA5EXQ3xp7hJWLNMMMMWTsia0ak9UA4Ii5bWKTggZBd1nYathsJ0oYkbxkyhUEV0nfkvSIrYs7hkOjclsKhqqoIxQMhb3DWOBF7fQ+P4vIet7v14P2DgMLBpXaP4a0OecNzPVECTMD1xhmsm/pmG2F76m3uebZd19F/oBFJuXv4iZALVFym7FUfBXwFFzn3uxdn1L+UsCRHmqaijCzLeiTkDZYQUvsFQSDsZ3Bben6I35KJHy8KnmULuq5Bonjqun4nPN4I+U/R3GT9D+0Xknvqae53vs/jD/VFshBwppCnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6c17ed61bf717d4b603ba711b9911bc9/8ac56/procmon-symbol-002.webp 240w,\n/static/6c17ed61bf717d4b603ba711b9911bc9/d3be9/procmon-symbol-002.webp 480w,\n/static/6c17ed61bf717d4b603ba711b9911bc9/b0a15/procmon-symbol-002.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6c17ed61bf717d4b603ba711b9911bc9/8ff5a/procmon-symbol-002.png 240w,\n/static/6c17ed61bf717d4b603ba711b9911bc9/e85cb/procmon-symbol-002.png 480w,\n/static/6c17ed61bf717d4b603ba711b9911bc9/0b533/procmon-symbol-002.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6c17ed61bf717d4b603ba711b9911bc9/0b533/procmon-symbol-002.png\"\n            alt=\"Procmon にシンボルサーバを設定\"\n            title=\"Procmon にシンボルサーバを設定\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これでシンボルサーバの設定は完了です。</p>\n<h2 id=\"1-章のまとめ\" style=\"position:relative;\"><a href=\"#1-%E7%AB%A0%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"1 章のまとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1 章のまとめ</h2>\n<p>この章では、Windows のダンプファイルの解析やトラブルシューティングに必要なツールのセットアップを行いました。</p>\n<p>トラブルシューティングのためにダンプファイルの解析を行う場合には、自分が取得したダンプファイルにどのような情報が含まれており、ファイルサイズはどの程度の大きさになるのかなどの情報を事前に把握しておくことが重要です。</p>\n<p>また、ダンプファイルには確かに非常に多くの情報が含まれますが、ダンプファイルから参照可能な情報はあくまでそのダンプを取得した一瞬間のメモリ情報のスナップショットに過ぎません。</p>\n<p>そのため、より効率的にトラブルシューティングを行うためには、様々な調査ツールを使用して問題の発生前後のシステムの動きをトレースしたり、OS やアプリケーションのログファイルなどを調査する必要があります。</p>\n<p>私は、トラブルシューティングの方法に決まった型は存在しないと考えています。</p>\n<p>本書は Windows のダンプファイルの解析を中心とした内容ではありますが、皆さんが実際にトラブルシューティングを行う際には、様々なツールや機能を活用して、あらゆる角度からの解析を楽しんでいただければと思います。</p>\n<h2 id=\"各章へのリンク\" style=\"position:relative;\"><a href=\"#%E5%90%84%E7%AB%A0%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF\" aria-label=\"各章へのリンク permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>各章へのリンク</h2>\n<ul>\n<li><a href=\"/magical-windbg-vol1-00\">まえがき</a></li>\n<li><a href=\"/magical-windbg-vol1-01\">1 章 環境構築</a></li>\n<li><a href=\"/magical-windbg-vol1-02\">2 章 WinDbg の基本操作</a></li>\n<li><a href=\"/magical-windbg-vol1-03\">3 章 解析に必要な前提知識</a></li>\n<li><a href=\"/magical-windbg-vol1-04\">4 章 アプリケーションのクラッシュダンプを解析する</a></li>\n<li><a href=\"/magical-windbg-vol1-05\">5 章 システムクラッシュ時のフルメモリダンプを解析する</a></li>\n<li><a href=\"/magical-windbg-vol1-06\">6 章 プロセスダンプからユーザモードアプリケーションのメモリリーク事象を調査する</a></li>\n<li><a href=\"/magical-windbg-vol1-07\">7 章 フルメモリダンプからユーザモードメモリリーク事象を調査する</a></li>\n<li><a href=\"/magical-windbg-vol1-50\">付録 A WinDbg の Tips</a></li>\n<li><a href=\"/magical-windbg-vol1-51\">付録 B Volatility 3 でクラッシュダンプを解析する</a></li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>WinDbg とは <a href=\"https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/windbg-overview?source=recommendations\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/windbg-overview?source=recommendations</a></p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-2\">\n<p>GFlags <a href=\"https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/gflags\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/gflags</a></p>\n<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-3\">\n<p>Windows SDK - Windows app development <a href=\"https://developer.microsoft.com/ja-jp/windows/downloads/windows-sdk/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://developer.microsoft.com/ja-jp/windows/downloads/windows-sdk/</a></p>\n<a href=\"#fnref-3\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-4\">\n<p>Process Monitor <a href=\"https://learn.microsoft.com/ja-jp/sysinternals/downloads/procmon\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://learn.microsoft.com/ja-jp/sysinternals/downloads/procmon</a></p>\n<a href=\"#fnref-4\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-5\">\n<p>Process Explorer <a href=\"https://learn.microsoft.com/ja-jp/sysinternals/downloads/process-explorer\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://learn.microsoft.com/ja-jp/sysinternals/downloads/process-explorer</a></p>\n<a href=\"#fnref-5\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-6\">\n<p>Sysinternals <a href=\"https://learn.microsoft.com/ja-jp/sysinternals\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://learn.microsoft.com/ja-jp/sysinternals</a></p>\n<a href=\"#fnref-6\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-7\">\n<p>Windows Sysinternals徹底解説 : 無償ツールで極めるトラブルシューティングテクニック (Mark E. Russinovich・Aaron Margosis 著 / 山内 和朗 訳 / 日経BP社 / 2017 年)</p>\n<a href=\"#fnref-7\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-8\">\n<p>Ghidra <a href=\"https://github.com/NationalSecurityAgency/ghidra\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/NationalSecurityAgency/ghidra</a></p>\n<a href=\"#fnref-8\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-9\">\n<p>マスタリング Ghidra 基礎から学ぶリバースエンジニアリング完全マニュアル (Chris Eagle, Kara Nance 著 / 石川 朝久 監訳 / 中島 将太, 小竹 泰一, 原 弘明 訳 / オライリー・ジャパン / 2022 年)</p>\n<a href=\"#fnref-9\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-10\">\n<p>リバースエンジニアリングツール Ghidra 実践ガイド セキュリティコンテスト入門からマルウェア解析まで (中島 将太, 小竹 泰一, 原 弘明, 川畑 公平 著 / マイナビ出版 / 2020 年)</p>\n<a href=\"#fnref-10\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-11\">\n<p>garyu-windbg <a href=\"https://github.com/kash1064/garyu-windbg/releases/tag/v0.1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/kash1064/garyu-windbg/releases/tag/v0.1</a></p>\n<a href=\"#fnref-11\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-12\">\n<p>ユーザモードダンプファイル <a href=\"https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/user-mode-dump-files\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/user-mode-dump-files</a></p>\n<a href=\"#fnref-12\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-13\">\n<p>インサイド Windows 第 7 版 下 P.571 (Andrea Allievi, Mark E.Russinovich, Alex Ionescu, David A.Solomon 著 / 山内和朗 訳 / 日系 BP 社 / 2022 年) </p>\n<a href=\"#fnref-13\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-14\">\n<p>シンボルとシンボルファイル <a href=\"https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/symbols-and-symbol-files\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/symbols-and-symbol-files</a></p>\n<a href=\"#fnref-14\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-15\">\n<p>シンボルサーバーの使用 <a href=\"https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/using-a-symbol-server\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/using-a-symbol-server</a></p>\n<a href=\"#fnref-15\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","fields":{"slug":"/magical-windbg-vol1-01","tagSlugs":["/tag/magical-win-dbg/","/tag/windows/","/tag/win-dbg/"]},"frontmatter":{"date":"2023-11-15","description":"技術書典 15 で頒布した Magical WinDbg -雰囲気で楽しむ Windows ダンプ解析とトラブルシューティング- VOL.1 の WEB 版です。","tags":["Magical WinDbg","Windows","WinDbg"],"title":"Magical WinDbg VOL.1【1 章 環境構築】","socialImage":{"publicURL":"/static/2dbf3e09d59db889dc9dc41adcc8e827/magical-windbg-vol1.png"}}}},"pageContext":{"slug":"/magical-windbg-vol1-01"}},"staticQueryHashes":["251939775","401334301","825871152"]}