{"componentChunkName":"component---src-templates-post-template-js","path":"/note-change-ipv6","result":{"data":{"markdownRemark":{"id":"0f10e15b-f172-51b2-92a6-2958cd06de65","html":"<p>楽天ひかりの回線が急に激重になったのでIPv6接続を有効化しました。</p>\n<p>この記事ではバッファローのルータ<a href=\"https://amzn.to/3qSUW40\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">WSR-5400AX6</a>を使って設定しています。</p>\n<p>（たぶんバッファローの家庭用ルータなら大体同じ設定になるはず。。）</p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li><a href=\"#%E7%B5%8C%E7%B7%AF\">経緯</a></li>\n<li>\n<p><a href=\"#%E6%A5%BD%E5%A4%A9%E3%81%B2%E3%81%8B%E3%82%8A%E3%81%A7ipv6%E6%8E%A5%E7%B6%9A%E3%82%92%E6%9C%89%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95\">楽天ひかりでIPv6接続を有効にする方法</a></p>\n<ul>\n<li><a href=\"#%E3%82%AF%E3%83%AD%E3%82%B9%E3%83%91%E3%82%B9%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B\">クロスパスを有効化する</a></li>\n<li><a href=\"#nd%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B\">NDプロキシを有効化する</a></li>\n<li><a href=\"#nd%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%A8%E3%81%AF\">NDプロキシとは</a></li>\n</ul>\n</li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n<li>\n<p><a href=\"#%E8%BF%BD%E8%A8%982022%E5%B9%B41%E6%9C%8828%E6%97%A5\">追記(2022年1月28日)</a></p>\n<ul>\n<li><a href=\"#%E6%94%B9%E5%96%84%E3%81%95%E3%82%8C%E3%81%9F%E3%81%93%E3%81%A8\">改善されたこと</a></li>\n<li><a href=\"#%E6%94%B9%E6%82%AA%E3%81%95%E3%82%8C%E3%81%9F%E3%81%93%E3%81%A8\">改悪されたこと</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"経緯\" style=\"position:relative;\"><a href=\"#%E7%B5%8C%E7%B7%AF\" aria-label=\"経緯 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>経緯</h2>\n<p>だいたい半年前(2020年9月ごろ)から楽天ひかりを契約しています。</p>\n<p>リモートワークメインになり、自宅で安定した回線が欲しいと思っていたのと、ちょうど一年間の無料キャンペーン中だったこともあり、楽天ひかりを契約しました。</p>\n<p>賃貸なので、壁に穴を空ける工事が不要で開通可能だったというのも大きな理由でした。</p>\n<p>申し込みのための電話がいつまで待ってもつながらなかったり、申し込みから開通まで2か月ほどかかったりと若干の不満はあったものの、開通後は常時<a href=\"https://fast.com/ja/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fast.com</a>の計測値で200~400Mbps程度の速度(IPv4、有線接続時)が安定してでており、非常に快適に使えていました。</p>\n<p>僕の環境では、IPv6の知識が乏しく、適切な設定ができる自信がなかったのと、IPv4接続のみでも十分満足できる回線速度がでていたことから、ルータの設定でIPv6接続を無効化した上で、インターネット側からのすべてのIPv6接続を拒否する設定を行っていました。</p>\n<p>しかし、2022年の1月18日ごろから急に接続が遅くなりました。</p>\n<p>具体的には、日中は75Mbps程度、夜間帯は2~8Mbps程度にまで回線速度が落ちてしまいました。(いずれもIPv4、有線接続時の<a href=\"https://fast.com/ja/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fast.com</a>の計測値)</p>\n<p>モデム、ルータ、OSの再起動など一通り試したものの状況が改善しなかったため、通信速度改善のためにIPv6接続を有効化することとしました。</p>\n<h2 id=\"楽天ひかりでipv6接続を有効にする方法\" style=\"position:relative;\"><a href=\"#%E6%A5%BD%E5%A4%A9%E3%81%B2%E3%81%8B%E3%82%8A%E3%81%A7ipv6%E6%8E%A5%E7%B6%9A%E3%82%92%E6%9C%89%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95\" aria-label=\"楽天ひかりでipv6接続を有効にする方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>楽天ひかりでIPv6接続を有効にする方法</h2>\n<p>楽天ひかりの回線は、アルテリアネットワークスのサービスを利用しています。</p>\n<p>そのため、楽天ひかり回線でIPv6によるインターネット接続を有効化するためには、アルテリアネットワークスが提供しているクロスパスという仕組みを使う必要があります。</p>\n<p>参考：<a href=\"https://www.arteria-net.com/business/service/internet/line/flets/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ブロードバンドアクセス（クロスパス） | アルテリア・ネットワークス株式会社</a></p>\n<p>クロスパス機能を有効化するためには、ルータがクロスパス設定に対応している必要があります。</p>\n<p>バッファロールータでクロスパスに対応しているルータ・ファームウェアバージョンは、以下のリンクから確認できます。</p>\n<p>参考：<a href=\"https://www.buffalo.jp/support/other/network-ipv6.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">IPv6(IPoE/IPv4 over IPv6)対応確認済みリスト | バッファロー</a></p>\n<p><a href=\"https://amzn.to/3qSUW40\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">WSR-5400AX6</a>の場合は現行最新のファームウェアVer.1.02以降のバージョンでの対応になるので、必要に応じてファームウェアのバージョンアップを実施します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 327px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e281e3b9b0466804012f896c1eeebc79/00e65/image-16.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 136.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAADp0lEQVRIx5VVW09UVxT2P7Y2sdqX9sEWkAAdgbnITTStadL6wAPeEIlCUjUxNvXCgMIMEIaZSHUGDTPMuZ8z5z5zQCDW+Ln2mRuXmTg+fNln77X2t9f69lr7nOB5HqqqQrUsqJ4H1XWh2jZUxyFUvgsFKIpS9msAZiuQz8bGBk7w+Tw0IhFnZpDvaAc3Mgz+6lXwV66Ux7/+hByP+8SKLH8F4dQdcJ2dEIlEnJ6GeOsm+NGLEGiuZDJQdb0W5dFoDxNSyhpbNE3IRCwYBhRKX6ml7fgpq03IGhLqdPqb168xH41iKRZDbGEBiwwvXyKXzfqbZEq3pQi5CmEquYa56BxiRDj7/DlezL/A8vIKkS8ikUgimUwhlUr5G7+csqYdcFIOOSqKTNEp/rckSa1p2MypmV7lQ+toSMhO53kBHMf7oyhKNbAIm9VgwwjZRJZESCKHfD5Lhjdwiw7299/7sCyTDiyn3gw1QkHg6QQNly+F0PbzN+ju+gHnOk6hk9DddQa/nD2JlfgE8HENe9tx7L9fqmNnGR9243DMNYq0gLdvaylrGB8fQyQcwPBwCMNDIQwNBjE0FEQoGMDqyiPs7mTgWq9QdNbrsNdRcl9BL6TpYo/csmXasO0iLNulFF0Ui9solXbgeTvQChYEQSM9C8cgECRJo9Kr1iHH0cSgThAo5P/IKUta5rDtWdjbdX3oukLrHG3km0CoayjRZWxtcZRaO3q6vkNv4AzhNAI9p3D+1+9Jy2+xnpwEsEp6LeLjfqyG//fi+PRhkVJP0D1UNBRFESzt0dFL6OsLIRiMoL8/jHB4AJHIIHr7wkisRuEVN2HoaVhGpgaTjSbpp747rCEL1/O24dLjUCoV4ZVKVAoSObH6FJHZeAdZ0QmFBmDr2vHCzma3EI8vUc8msZZI4MnTJ/jn8WM8ePgQs9FZuhjNb8OjXVLuFLlxL7PFKgx6xqrQD7yFLXWKb6j0bjPU+7tFQqVVwlYi1CoPaHMoX7DLxyNkWjm2Rd1SB5uzh8E0DSoPE7ZlNfCxfY3rLzY9V4ah499ncxi7fgfXb0/j2sQ9H+O37mLi7n3c+/sRpqYf4MbkTM3GwHzHrk0iOr8Ax7GRoZ+Z33o2RTF+cwo/tfehIzCA9p4LPtq6I+gd/B3hkT8QHPgN3f0j/lrV3hEYxI9tvXTYfb9+0+l0vWwEQUAul6M23EKuAvadpZ/U5iaBRmbPHbGzNbaXpX1IQ0Z6sA6/Bmx/VcPPqwNoDQ6tI5YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e281e3b9b0466804012f896c1eeebc79/8ac56/image-16.webp 240w,\n/static/e281e3b9b0466804012f896c1eeebc79/e25e9/image-16.webp 327w\"\n              sizes=\"(max-width: 327px) 100vw, 327px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e281e3b9b0466804012f896c1eeebc79/8ff5a/image-16.png 240w,\n/static/e281e3b9b0466804012f896c1eeebc79/00e65/image-16.png 327w\"\n            sizes=\"(max-width: 327px) 100vw, 327px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e281e3b9b0466804012f896c1eeebc79/00e65/image-16.png\"\n            alt=\"image-16.png\"\n            title=\"image-16.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>設定コンソールのログイン画面に1.02以上のバージョンが表示されていればOKです。</p>\n<h3 id=\"クロスパスを有効化する\" style=\"position:relative;\"><a href=\"#%E3%82%AF%E3%83%AD%E3%82%B9%E3%83%91%E3%82%B9%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B\" aria-label=\"クロスパスを有効化する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>クロスパスを有効化する</h3>\n<p>クロスパスの設定方法は非常に簡単です。</p>\n<p>ルータの管理コンソールから、詳細設定を開いて、[Internet]から以下の画面の設定を有効化します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 776px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cae7bc1f39315c7189797e902a581feb/167b5/image-17.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAChUlEQVQ4y22TWW/aUBCF/f9fWymq1Le+VP0PlRIFQRMgeN+XazBmCYsNITFZdDozYNRIfRhd+947x9/MHGsqy+B5HlarlcRms0FVVZhMJiiKAtPplJ4LRImScPwYhhPCpjWk9yTLMZvNMZ/PJVdTSsH3fdqcSfJiscByuUQYhgijCEmSwHUD3A0M6JYr6013gN+39+iPbMRJiow0WIc1tDRNYVkmgiAQIt5k0TiORSyjCvwgwp+hiZveA5FFyPJcKigJgHP4eTweS56Wk7JlWUThEmEp6Lyalo3BUIeum3BsH30i4+j0htANG0EYIyeR8Tly+gjnSsn80pbMm/yliEsmyti2YX3/Ae/qG4yvV7C/XCH9+QsqzVCcCYtiKpRC2OncwnFcPD4+XgS5hzH1L+aSqSWR7eCu20dE92YEsKAhcTIPoyxnZ5hS8jTD0HF9fQObSJj2Ihgn0sM8V0jVGEPLQ5Bk1L8JBZU5KUSEyT710KPeDYcPMlXGL8sSh8MT9vsd1usV1mQltlG13ZKttvTRBd1Zynld1WiaBq+vrxJvb2/QBoO+iDGdlEz4y1WFmBLr3UEuHY/HS7y8NJ9EWqH2nsYeZMuU/wylnC1hOmQPReamsvhsS4QiRklNc0Rd78TIG9rns/V6Q+cv0KbnSfF6MvZcpjbSDbKTDcPksOC4nlglo35W1Y6iluCBnGyj6CM1NO5ZGy0hXzIMi7zokD99hEGIIMrQG/kYmQ7UmCDKOdK8QBCndJbAI8MzrdaStYItYbd3j073Hpbtyl+Tku+CKJX/lylPlU2JbiKhVP5/wtOUD9g/PWG32+Pw/CxD4P5w4z8+PvBMz0fak7gMrMH7+zv+Ak0f/bzRu8Q+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/cae7bc1f39315c7189797e902a581feb/8ac56/image-17.webp 240w,\n/static/cae7bc1f39315c7189797e902a581feb/d3be9/image-17.webp 480w,\n/static/cae7bc1f39315c7189797e902a581feb/bac22/image-17.webp 776w\"\n              sizes=\"(max-width: 776px) 100vw, 776px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/cae7bc1f39315c7189797e902a581feb/8ff5a/image-17.png 240w,\n/static/cae7bc1f39315c7189797e902a581feb/e85cb/image-17.png 480w,\n/static/cae7bc1f39315c7189797e902a581feb/167b5/image-17.png 776w\"\n            sizes=\"(max-width: 776px) 100vw, 776px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/cae7bc1f39315c7189797e902a581feb/167b5/image-17.png\"\n            alt=\"image-17.png\"\n            title=\"image-17.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>もし[IPアドレス取得方法]の設定が表示されず、「IPアドレス取得方法は「インターネット＠スタートを行う」が設定されています」とだけ表示されている場合は、ルータ本体の背面にあるスイッチが[Manual]ではなく[Auto]に設定されています。</p>\n<p>その場合はルータの背面のスイッチを[Manual]に設定してください。</p>\n<p>これでインターネット接続時にIPv6接続が有効化されます。</p>\n<p>IPv6インターネット接続が有効化されているかは、以下のサイトのヘッダに[via IPv6]と表示されているかどうかで確認することができます。</p>\n<p>参考：<a href=\"https://www.arteria-net.com/company/csr/ipv6/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">IPv6対応サービス | アルテリア・ネットワークス株式会社</a></p>\n<p>続いて、IPv6使用時のNDプロキシ設定を確認していきます。</p>\n<h3 id=\"ndプロキシを有効化する\" style=\"position:relative;\"><a href=\"#nd%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B\" aria-label=\"ndプロキシを有効化する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NDプロキシを有効化する</h3>\n<p>IPv6は、IPv4と異なりNATを経由したIPマスカレードが行われません。</p>\n<p>そのため、ルータの設定によってはインターネット側から家庭内ネットワークのホストにダイレクトでアクセスすることが簡単にできるようになってしまいます。</p>\n<p>基本的にプライベートな運用を想定している家庭内ネットワークの端末にインターネットからアクセス可能な状態はセキュリティ的に好ましくないため、IPv4で一般的に利用しているNATのセキュリティ上の恩恵は非常に大きいことがわかります。</p>\n<p>今回はIPv6インターネット接続を有効化するため、インターネット側からネットワーク内の端末にアクセスできないようにします。</p>\n<p>このような環境の実装のため、ルータの設定にてNDプロキシを有効化します。</p>\n<p>設定は以下のように行います。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 694px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fcdaddc504da8f2c22b982c8b4480014/31198/image-18.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1klEQVQ4y6WT226iUBSGef9H6F3foWm8motmEjElWOQkckYFButp4gGM8Z+1VotBk0k60538YbOAb//rgJI9PyN9eED6+Ijs6QnzosB8Pv+S8jxHnCQw3oZI5yVevBJKFAQQ+T6iMEQURaI4jm/Uxu+fdWMRSeFTirJEzs5o3548m81u9BH/cNaNT6fTGykcNE0TPjksCNTCVqsVNpsN1uu1XN/fl3RwhWqxxHa7xW8Sx3e7Hfb7/VVKQc4sy4JhGAJrgfxyQvVJkpiUwvV8vA5NDE0XztjHeBIgiGKcz2d0l1JSuhPPw2RCDjsNWS6XGL6N0B9o4t73A5iOB8MaY6BTXDPkvmkaAV0uF5E45A/M0QgegfPPOnLKtu1QOSxYbgBVd6CRQ5VAP36+wiJYGEao6/oKFIcMiKIQIwLati0uubicMu/LIkc2K+FMUkoxgen60M0xyvIXFosKp9Pp1iEXPcvSa5qsqqqkwJzO8XhEUx9xampxw7E2zjocDjdS0jSFpmkCbGuYZZkAuyf/TfdL4fR6vR7UwYBqEgqMu/xV4L1kDnlk+v0+HMe5DmgX+C9LgLqu0yza8guVn035byDXUFVV+Rd5z13/tkPXdWUGuSnfBf4BTeVj+PCH+/oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fcdaddc504da8f2c22b982c8b4480014/8ac56/image-18.webp 240w,\n/static/fcdaddc504da8f2c22b982c8b4480014/d3be9/image-18.webp 480w,\n/static/fcdaddc504da8f2c22b982c8b4480014/181fb/image-18.webp 694w\"\n              sizes=\"(max-width: 694px) 100vw, 694px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fcdaddc504da8f2c22b982c8b4480014/8ff5a/image-18.png 240w,\n/static/fcdaddc504da8f2c22b982c8b4480014/e85cb/image-18.png 480w,\n/static/fcdaddc504da8f2c22b982c8b4480014/31198/image-18.png 694w\"\n            sizes=\"(max-width: 694px) 100vw, 694px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fcdaddc504da8f2c22b982c8b4480014/31198/image-18.png\"\n            alt=\"image-18.png\"\n            title=\"image-18.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これでインターネット側から家庭内ネットワークの端末に直接接続することができなくなります。</p>\n<p>なお、家庭用ルータでは、デフォルトでIPv6接続設定が「IPv6パススルー(IPv6ブリッジ)」という設定が有効になっているものがあるようですが、この設定が有効にされている場合はインターネット側から内部ネットワークの端末にダイレクトでアクセスすることができます。</p>\n<p>外部からアクセスしたいなどの特別な理由がなければNDプロキシを有効化しておくのがよさそうです。</p>\n<h3 id=\"ndプロキシとは\" style=\"position:relative;\"><a href=\"#nd%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%A8%E3%81%AF\" aria-label=\"ndプロキシとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NDプロキシとは</h3>\n<p>NDプロキシはRFC4389で定義されており、RA内のPビットを1にすることができる仕様があります。</p>\n<p>NDプロキシが設定されている場合、IPv6アドレスに対する通信は、一度ルータを経由することになります。</p>\n<p>この仕様によって、インターネットからホストへの直接のアクセスを防ぐことができるようになります。</p>\n<p>参考：<a href=\"https://www.youtube.com/watch?v=2lgmpHxd1fE\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NDプロキシとIPv6パススルー：IPv6設定解説 - YouTube</a></p>\n<p>参考：<a href=\"https://www.nic.ad.jp/ja/basics/terms/ra.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">インターネット用語1分解説～RA (Router Advertisement; ルータ広告)とは～ - JPNIC</a></p>\n<p>参考：<a href=\"https://internet.watch.impress.co.jp/docs/column/shimizu/1163817.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">IPv6ならネットから直接アクセスできる？　試して確かめよう【イニシャルB】 - INTERNET Watch</a></p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>IPv6インターネット接続を有効化したことで、8Mbps前後だった回線速度が300Mbpsくらいに戻り、快適なインターネット環境が帰ってきました。</p>\n<p>今後も回線が安定してくれると嬉しいですね。。</p>\n<p>というわけで、「光回線を使ってるけどなんか最近遅い」という方はぜひ一度IPv6設定を確認してみるといいかなと思います。</p>\n<p>正直セキュリティ面ではまだ若干不安があるので、ホスト側のファイアウォール設定をおろそかにしないとか、ネットワーク監視の方法を検討するなどは今後やっていきたいと思います。</p>\n<h2 id=\"追記2022年1月28日\" style=\"position:relative;\"><a href=\"#%E8%BF%BD%E8%A8%982022%E5%B9%B41%E6%9C%8828%E6%97%A5\" aria-label=\"追記2022年1月28日 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>追記(2022年1月28日)</h2>\n<p>この設定を有効化してからちょうど一週間くらい経ちましたので、気づいたことをメモしておこうと思います。</p>\n<h3 id=\"改善されたこと\" style=\"position:relative;\"><a href=\"#%E6%94%B9%E5%96%84%E3%81%95%E3%82%8C%E3%81%9F%E3%81%93%E3%81%A8\" aria-label=\"改善されたこと permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>改善されたこと</h3>\n<p>現在においても、通信速度は<a href=\"https://fast.com/ja/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fast.com</a>の計測値で200~400Mbps程度の速度(有線接続時)が安定して出ており快適に使用することができています。</p>\n<p>また、嬉しい誤算としては、無線接続端末でも、<a href=\"https://fast.com/ja/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fast.com</a>の計測値で200~300Mbps程度の速度が出るようになりました。</p>\n<p>IPv4のみで利用していた時は、有線接続しているマシンの回線速度は高速だったものの、無線接続している端末は10~30Mbps程度の速度しか出ていませんでした。</p>\n<p>ルータの性能が悪いのかとも思っていたのですが、メイン環境は有線で高速に動作していたので、ルータの買い替えなどは行っていませんでした。</p>\n<p>今回IPv6設定を有効化したことで図らずも無線接続端末の通信速度も高速になり、特にスマホのページ読み込みなどが劇的に改善しました。</p>\n<p>(理由は不明ですが。。。)</p>\n<h3 id=\"改悪されたこと\" style=\"position:relative;\"><a href=\"#%E6%94%B9%E6%82%AA%E3%81%95%E3%82%8C%E3%81%9F%E3%81%93%E3%81%A8\" aria-label=\"改悪されたこと permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>改悪されたこと</h3>\n<p>バッファロールータの「ゲストポート機能」が使えなくなりました。</p>\n<p>どうやらゲストポート機能はIPv6に対応しておらず、クロスパス設定を実施している環境ではインターネット接続ができないようです。(IPv4に自動的に切り替えてくれるとありがたいのですが。)</p>","fields":{"slug":"/note-change-ipv6","tagSlugs":["/tag/備忘録/"]},"frontmatter":{"date":"2022-01-22","description":"","tags":["備忘録"],"title":"楽天ひかりの回線が遅くなったのでIPv6インターネット接続(クロスパス設定)とNDプロキシを有効化した","socialImage":{"publicURL":"/static/9696df95af62a630e27b9461a8127607/note-change-ipv6.png"}}}},"pageContext":{"slug":"/note-change-ipv6"}},"staticQueryHashes":["251939775","401334301","825871152"]}