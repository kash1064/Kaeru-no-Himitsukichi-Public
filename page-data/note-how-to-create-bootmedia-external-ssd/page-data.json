{"componentChunkName":"component---src-templates-post-template-js","path":"/note-how-to-create-bootmedia-external-ssd","result":{"data":{"markdownRemark":{"id":"4c026b69-50dc-5bb9-83a7-03034337cd4b","html":"<p>今回は外付けSSDからUSB経由でWindowsを起動可能なブートメディアを作成していきます。</p>\n<p>外付けSSDからUSB経由でWindowsを起動可能なブートメディアの作成方法についてググると非常に多くの情報がでてきます。</p>\n<p>Windowsマシンでは外付けSSDからのブートは実現できないとか、有料アプリを使えば実現できるとか、Macなら可能とか、ほんとに色々な情報があり混乱しました。</p>\n<p>結論から言って、本記事執筆時点で最新のWindows10 21H2のバージョンでも外付けSSDからUSB経由で起動可能なブートメディアを作成することはできます。</p>\n<p>以下の記事の手順でブート可能なSSDを作成することができました。</p>\n<p>参考：<a href=\"https://nisimura.org/usb_ssd_windows_install/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">USBの外付けSSD/HDDからWindows10を起動する方法（無料/手動でWindows to GoをSSD/HDDにインストールする方法） | 西村誠一のパソコン無料サポートとWindowsフリーソフトblog</a></p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li>\n<p><a href=\"#usb%E3%81%8B%E3%82%89%E3%83%96%E3%83%BC%E3%83%88%E5%8F%AF%E8%83%BD%E3%81%AAssd%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\">USBからブート可能なSSDを作成する</a></p>\n<ul>\n<li><a href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%82%92%E5%88%9D%E6%9C%9F%E5%8C%96%E3%81%99%E3%82%8B\">インストールするディスクを初期化する</a></li>\n<li><a href=\"#diskpar%E3%81%A7%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92active%E3%81%AB%E3%83%9E%E3%83%BC%E3%82%AF%E3%81%99%E3%82%8B\">diskparでシステムパーティションを「active」にマークする</a></li>\n<li><a href=\"#diskpar%E3%81%A8%E3%81%AF\">diskparとは</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#dism%E3%81%A8bcdboot%E3%81%A7iso%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%81%AB%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B\">DISMとBCDBootでISOイメージをディスクに展開する</a></p>\n<ul>\n<li><a href=\"#dism%E3%81%A8%E3%81%AF\">DISMとは</a></li>\n<li><a href=\"#bcdboot%E3%81%A7%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\">BCDBootでシステムパーティションを作成する</a></li>\n</ul>\n</li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n</ul>\n<h2 id=\"usbからブート可能なssdを作成する\" style=\"position:relative;\"><a href=\"#usb%E3%81%8B%E3%82%89%E3%83%96%E3%83%BC%E3%83%88%E5%8F%AF%E8%83%BD%E3%81%AAssd%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\" aria-label=\"usbからブート可能なssdを作成する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>USBからブート可能なSSDを作成する</h2>\n<p>今回実践した手順は、失敗すると最悪の場合PCのストレージのデータがすべて消去されます。</p>\n<p>そのため、実施する際は細心の注意を払うとともに、自己責任でお願いいたします。</p>\n<p>僕は万が一にもメインPCのデータが飛ぶのは嫌だったので、サブのノートPCでブートメディアを作成しました。</p>\n<p>作成した環境はWindows 11 21H2です。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 546px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4e7b7b0683cc430a1b14458dd6f77afb/76aed/image-20220303214811571.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADIUlEQVQ4y3VUSU/bYBDNqf2LPfUn9NBTW/4EUCCsKhWVkHooUi89QEhsCEmgRdlIbJKQBZx4i7ckXgLt63yfw6aqkZ7Gnoyf37xvxglBOEIQ+LAsC5OxB7mnInfloGkEwO8pcDeNIwh/ZhFxfjqNcEsIwxDsJ2YLSBykM4iiEIZp4c53sXI8wMu5Kl7tNHEk6ZhP3eDbrwHHTq6P/YqGHyUV+YaO7ZwC6dqAaw0xmUyQymSR6JVy8CY+zGFMuCQqeEGEr3fbKLWH2D1V8b2o40texQ5h71wjIhWiZECUDXRUC55jIwwCHAonSFQLP+GNRzBNE67jQCOlPc2GolvwRw6isQPfsxCOYgSz65FjYUywySrDMOFPxjHh/qHAW+50upAkCZeyjEupDnXQx0DVCCos24btuBha9gMsHq04Dof8HA6FHBIpImTmdjodXFxcoEYolcrxda2GaqWC3vU1FEUhUgeu6z7A8zwebZu1TITijDCiU1KZmsEAGikaDFT0+33KUVT6uLm54WCtMTWGYXDc1zCEYRATHhDh7e0UMrWbz+dRLBZxenrGFVbKFZTLZbovoEJKmfrz83Oeq1arkOVLtFpNbhcT9UyhpumkrM/VKfRmTdPIx/jtTDlXr8VdxArNf1pOi3lGKHK5LMkKPO6N+xhnGLH/noAROeQpe25II/dImI4JmTdsdPgp2i7Npc2H3WCRoNO1TqqYOlbHa+kZRsq2LPDHEPMXMw+nUzQaDZxkj3FWklGotiF3dVrDIWpdA1LPRLGlo1JvoCFLVNvEVauFdrv9hNBH9qTw6KGu62gSaZ1GpV6rokvFNq3UyHOofYfHp227T/zjhEGITDr96CFLmtSOPhsJBja4th379D9wH6mOfSAEQaBNSWVobSb81CxOYPPNsPgWWNynZ2C5+21hM0learoBb0SrxxRmcwX+6WHLHUXRM0wfEPL15PnQR+h7VD/mVhlegGuVxIwjpETa5Tdv3yG5voX5j0ksLK1icXntAQvL61hY2cAiQ3KL4jpWtvewuSdh82sBydU1rK5vYG1zC1ufPuP9hzn8BRN8zt9rl/sSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4e7b7b0683cc430a1b14458dd6f77afb/8ac56/image-20220303214811571.webp 240w,\n/static/4e7b7b0683cc430a1b14458dd6f77afb/d3be9/image-20220303214811571.webp 480w,\n/static/4e7b7b0683cc430a1b14458dd6f77afb/a3666/image-20220303214811571.webp 546w\"\n              sizes=\"(max-width: 546px) 100vw, 546px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4e7b7b0683cc430a1b14458dd6f77afb/8ff5a/image-20220303214811571.png 240w,\n/static/4e7b7b0683cc430a1b14458dd6f77afb/e85cb/image-20220303214811571.png 480w,\n/static/4e7b7b0683cc430a1b14458dd6f77afb/76aed/image-20220303214811571.png 546w\"\n            sizes=\"(max-width: 546px) 100vw, 546px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4e7b7b0683cc430a1b14458dd6f77afb/76aed/image-20220303214811571.png\"\n            alt=\"image-20220303214811571\"\n            title=\"image-20220303214811571\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"インストールするディスクを初期化する\" style=\"position:relative;\"><a href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%82%92%E5%88%9D%E6%9C%9F%E5%8C%96%E3%81%99%E3%82%8B\" aria-label=\"インストールするディスクを初期化する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>インストールするディスクを初期化する</h3>\n<p>Windowsの「ディスクの管理」ツールを使用して、ブートメディアに使用するSSDを以下の2つのボリュームに分割します。</p>\n<ul>\n<li>\n<p>システムパーティション</p>\n<ul>\n<li>ドライブレター：L</li>\n<li>サイズ ：600MB</li>\n<li>ファイルシステム：FAT32</li>\n</ul>\n</li>\n<li>\n<p>ボリュームパーティション</p>\n<ul>\n<li>ドライブレター：M</li>\n<li>サイズ：残りの空き領域すべて</li>\n<li>ファイルシステム：NTFS</li>\n</ul>\n</li>\n</ul>\n<p>ここで初期化するディスクを間違えるとデータが消えてしまうので注意です。</p>\n<p>特にCドライブとして使用しているディスクを消さないように注意しましょう。</p>\n<p>ついでに今回展開するWindowsのISOファイルもダブルクリックしてマウントしておきましょう。</p>\n<p>今回はドライブレター：Fとしてマウントされました。</p>\n<p>初期化が完了した結果はこんな感じになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2dfedb151fc71ca4540e7b37be0f3dca/d318f/image-20220303231738698.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAk0lEQVQI12XNQQqDMBAFUO9/nnZrFxaxiBKJJUFQSVJDE7VqeoDfoG5KFo8P82eYSAiBPG+Q3BsUhfTUmYeyVMiyFtfLA3FM/R73WChhiG9PREopf9QgTTkIEWDs/Ydzg7oe/NN276tKBgiRoFTCuQWR1hp9/0LXDdB6hrUbjFm97bTus2n6YhxdwNojjVkwzx/8AFdh1erFmw4jAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2dfedb151fc71ca4540e7b37be0f3dca/8ac56/image-20220303231738698.webp 240w,\n/static/2dfedb151fc71ca4540e7b37be0f3dca/d3be9/image-20220303231738698.webp 480w,\n/static/2dfedb151fc71ca4540e7b37be0f3dca/e46b2/image-20220303231738698.webp 960w,\n/static/2dfedb151fc71ca4540e7b37be0f3dca/e6c83/image-20220303231738698.webp 1421w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2dfedb151fc71ca4540e7b37be0f3dca/8ff5a/image-20220303231738698.png 240w,\n/static/2dfedb151fc71ca4540e7b37be0f3dca/e85cb/image-20220303231738698.png 480w,\n/static/2dfedb151fc71ca4540e7b37be0f3dca/d9199/image-20220303231738698.png 960w,\n/static/2dfedb151fc71ca4540e7b37be0f3dca/d318f/image-20220303231738698.png 1421w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2dfedb151fc71ca4540e7b37be0f3dca/d9199/image-20220303231738698.png\"\n            alt=\"image-20220303231738698\"\n            title=\"image-20220303231738698\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>ここにブート可能なOSを展開していきます。</p>\n<h3 id=\"diskparでシステムパーティションをactiveにマークする\" style=\"position:relative;\"><a href=\"#diskpar%E3%81%A7%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92active%E3%81%AB%E3%83%9E%E3%83%BC%E3%82%AF%E3%81%99%E3%82%8B\" aria-label=\"diskparでシステムパーティションをactiveにマークする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>diskparでシステムパーティションを「active」にマークする</h3>\n<p>通常のWindowsのインストーラを使用してインストールする場合、残念ながらUSB経由で接続したディスクへのインストールはサポートされていません。</p>\n<p>そのため、ブート構成を自分で作成する必要があります。</p>\n<p>以下のコマンドを管理者権限のPowershellで順に実行していきます。</p>\n<p>環境によってディスクやパーティションの番号が異なるのでコピペしないように注意してください。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">diskpart\nlist disk\n<span class=\"token operator\">/</span><span class=\"token operator\">/</span> ブートメディアに使用するディスクの番号を指定\n<span class=\"token function\">select</span> disk 2\n\nlist partition\n<span class=\"token operator\">/</span><span class=\"token operator\">/</span> システムパーティション用に600MBで初期化したパーティションの番号を選択\n<span class=\"token function\">select</span> partition 1\n\n<span class=\"token operator\">/</span><span class=\"token operator\">/</span> activeとしてマークして終了\nactive\n<span class=\"token keyword\">exit</span></code></pre></div>\n<p>実行結果はこんな感じになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 539px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3737aee7701b1d63fdbd9ec64a1c4a6b/10f9a/image-20220303232019097.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 120%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAACQ0lEQVQ4y5WVWY+CUAyFeVRx3xDcccBoSPj/v67j18zBCy7JPDQXy+3p6WmpUVmWttlsbL/f2+FwsN1u52eaZpZlK8vPmSXrhQ0GsQ2H2NAtjp/PoUW3283W67UlSfIAyBxsPp/bdDr1c7FY+Ps0Te10OrnvE1gDCNB2u/UgTrHFD2MqWC6XX9nJF1EyQBgsCSyKwvCfz2c7Ho/OdjKZfGSGvwG83++W53nDAuDVamX9fv+h26BlBOkMLQSOYIBGGM7RaOQMZ7NZE4yOJIElOsJYMUg0Ho+fDC+Xi2FcxgAkmCAuYvhpBu8AFyD38L8wVAcpG2Y0gsbwGxAZmpKc+1RBDFWQlCQOSDCZACAbbNRxmhRqBSBA+K/Xq2uP1i9dhiWXVALNobTuiIipZOD5pSlkojQ0Ye7ICmuM8sOgbne7fmeIDjCDFaBopEFXZ8PALsDLYPOlAKI5pHQMcMDCuVOgyn4LCBuAMJUKGF0DTLpxmbvIABhNROder9fWkJLRjZPmEAyotFTnNZN0mqoA1OiEOvsc8pLsMIMVmSUBIPi4zIkc2kjEENsCLIrSswAGiIDVKDVFAYAye/zm1HNTsrQgGBA0gkFVVX6GX8ynHdjah+hAIKVQhmbvXRe7GyiOBw1jTYMPNiwoU80BONzaMFcVJNRU8F6jpuXhgPr0AGaguUgg+gkAQG2aMKFWmyqL8suPj4de4BR9NeGTaeG2Sr5XtW8O5quua/9qNGtauv+xKNkwvI+y/sZE3da/27fv9539AqDZSA2kdd0bAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3737aee7701b1d63fdbd9ec64a1c4a6b/8ac56/image-20220303232019097.webp 240w,\n/static/3737aee7701b1d63fdbd9ec64a1c4a6b/d3be9/image-20220303232019097.webp 480w,\n/static/3737aee7701b1d63fdbd9ec64a1c4a6b/9cb26/image-20220303232019097.webp 539w\"\n              sizes=\"(max-width: 539px) 100vw, 539px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3737aee7701b1d63fdbd9ec64a1c4a6b/8ff5a/image-20220303232019097.png 240w,\n/static/3737aee7701b1d63fdbd9ec64a1c4a6b/e85cb/image-20220303232019097.png 480w,\n/static/3737aee7701b1d63fdbd9ec64a1c4a6b/10f9a/image-20220303232019097.png 539w\"\n            sizes=\"(max-width: 539px) 100vw, 539px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3737aee7701b1d63fdbd9ec64a1c4a6b/10f9a/image-20220303232019097.png\"\n            alt=\"image-20220303232019097\"\n            title=\"image-20220303232019097\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"diskparとは\" style=\"position:relative;\"><a href=\"#diskpar%E3%81%A8%E3%81%AF\" aria-label=\"diskparとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>diskparとは</h3>\n<p>diskparコマンドインタプリタは、コンピュータ上のドライブを管理するツールです。</p>\n<p>今回は、インストール対象のディスクにフォーカスした上でパーティションを列挙し、600MBのサイズで初期化した方のパーティションを「active」としてマークしました。</p>\n<p>参考：<a href=\"https://docs.microsoft.com/ja-jp/windows-server/administration/windows-commands/diskpart\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">diskpart | Microsoft Docs</a></p>\n<p>このパーティションを「active」としてマークすることで、BIOSまたはEFIに対してこのパーティションがOSのスタートアップファイルを含むことを通知することができるようになります。</p>\n<p>続いて、この領域にOSのスタートアップファイルを配置していきます。</p>\n<p>参考：<a href=\"https://docs.microsoft.com/ja-jp/windows-server/administration/windows-commands/active\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">active | Microsoft Docs</a></p>\n<h2 id=\"dismとbcdbootでisoイメージをディスクに展開する\" style=\"position:relative;\"><a href=\"#dism%E3%81%A8bcdboot%E3%81%A7iso%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%81%AB%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B\" aria-label=\"dismとbcdbootでisoイメージをディスクに展開する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DISMとBCDBootでISOイメージをディスクに展開する</h2>\n<p>続いて、ISOファイルをSSDに展開していきます。</p>\n<p>以下のコマンドを管理者権限のPowershellで実行します。</p>\n<p>こちらもドライブレターが僕の環境と異なる場合はコピペしないようにしてください。</p>\n<p>完了まで結構時間がかかりました。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">Dism <span class=\"token operator\">/</span>Apply-Image <span class=\"token operator\">/</span>ImageFile:F:\\sources\\install<span class=\"token punctuation\">.</span>wim <span class=\"token operator\">/</span>Index=1 <span class=\"token operator\">/</span>ApplyDir:M:\\\nM:\\Windows\\System32\\bcdboot M:\\Windows <span class=\"token operator\">/</span>l ja-JP <span class=\"token operator\">/</span>s L: <span class=\"token operator\">/</span>f ALL</code></pre></div>\n<p>実行結果はこんな感じでした。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 798px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/17b17feee4296e2643371ce0f5c713c0/898f6/image-20220303233033290.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAy0lEQVQY03WQ246DMAxE88olhFtYINciCoLu///erJ3dVlu1fTjyOFHGnghrLUIIsNbBe9YzjDGYpgnz/Ku5juOYzrhnrbVO/TAMqd4Rfd8/HnsfYGhAXdfI8xxZlr2F7z4hYozY9z2ZOudQVQpN00CRKRsrxbX50wpFUbxQluUDcRwHzvPE9bqR8YZ19di3Cy7RwNkvxDBRRJ2iMm3bous6cDIezNHZ6G4slmUhkxW32zdxUmxH2470N5o2kkRFW0uiSkgpn+Cz/4Y/EhB72Jky8eQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/17b17feee4296e2643371ce0f5c713c0/8ac56/image-20220303233033290.webp 240w,\n/static/17b17feee4296e2643371ce0f5c713c0/d3be9/image-20220303233033290.webp 480w,\n/static/17b17feee4296e2643371ce0f5c713c0/ce206/image-20220303233033290.webp 798w\"\n              sizes=\"(max-width: 798px) 100vw, 798px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/17b17feee4296e2643371ce0f5c713c0/8ff5a/image-20220303233033290.png 240w,\n/static/17b17feee4296e2643371ce0f5c713c0/e85cb/image-20220303233033290.png 480w,\n/static/17b17feee4296e2643371ce0f5c713c0/898f6/image-20220303233033290.png 798w\"\n            sizes=\"(max-width: 798px) 100vw, 798px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/17b17feee4296e2643371ce0f5c713c0/898f6/image-20220303233033290.png\"\n            alt=\"image-20220303233033290\"\n            title=\"image-20220303233033290\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"dismとは\" style=\"position:relative;\"><a href=\"#dism%E3%81%A8%E3%81%AF\" aria-label=\"dismとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DISMとは</h3>\n<p>DISMは、イメージの展開と管理を行うことができるツールです。</p>\n<p>DISMによってWindowsイメージや仮想ハードディスクが作成されます。</p>\n<p>参考：<a href=\"https://docs.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/what-is-dism?view=windows-11\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">DISM の概要 | Microsoft Docs</a></p>\n<p>今回は<code class=\"language-text\">Apply-Image</code>オプションを使用しています。</p>\n<p>これは、指定した領域にWindowsイメージを配置するオプションです。</p>\n<p>参考：<a href=\"https://docs.microsoft.com/ja-jp/powershell/module/dism/expand-windowsimage?view=windowsserver2022-ps\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Expand-WindowsImage (DISM) | Microsoft Docs</a></p>\n<p>今回は<code class=\"language-text\">ImageFile</code>オプションの引数にISO内の<code class=\"language-text\">\\sources\\install.wim</code>を与え、先ほど初期化したディスクのフリー領域に配置しています。</p>\n<p><code class=\"language-text\">Index</code>オプションは1を指定しており、<code class=\"language-text\">install.wim</code>のインデックス1にあるデータを配置することを指定しています。</p>\n<h3 id=\"bcdbootでシステムパーティションを作成する\" style=\"position:relative;\"><a href=\"#bcdboot%E3%81%A7%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\" aria-label=\"bcdbootでシステムパーティションを作成する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BCDBootでシステムパーティションを作成する</h3>\n<p>最後に<code class=\"language-text\">BCDBoot</code>を実行してシステムパーティションを作成します。</p>\n<p><code class=\"language-text\">BCDBoot</code>の第1引数にはブート環境のソースとして使用するWindowsフォルダを指定します。</p>\n<p>今回は先ほどDISMで配置したイメージのWindowsフォルダを指定しています。</p>\n<p><code class=\"language-text\">/l</code>はロケール指定のオプションです。今回は<code class=\"language-text\">ja-JP</code>を指定しています。</p>\n<p><code class=\"language-text\">/s &lt;ボリューム文字></code>のオプションではシステムパーティションに使用するパーティションのドライブ文字を指定します。</p>\n<p>ここでは、システムパーティション用に600MBで初期化したパーティションを指定します。</p>\n<p><code class=\"language-text\">/f</code>オプションはファームウェアの指定です。</p>\n<p>今回のように<code class=\"language-text\">ALL</code>を入れておけばBIOSにもUEFIにも対応させることができます。</p>\n<p>参考：<a href=\"https://docs.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/bcdboot-command-line-options-techref-di?view=windows-11\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">BCDBoot のコマンド ライン オプション | Microsoft Docs</a></p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>これでUSBからブート可能なWindowsのディスクを作成することができました。</p>\n<p>USB 3.1 Gen1でPCとSSDを接続して起動してみましたが、十分に速度が出ているので、体感的には内臓のSSDにインストールされているOSとそこまで遜色ない使用感です。</p>\n<p>ベンチでこれだけ出てれば上出来ですね。普通に快適に使えます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 692px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/164d445b48a5f8760888417208818cf5/91e7e/image-20220303235640818.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD2klEQVQ4yzWTyW9bVRTG/X/AngUsKlViUYYVSAgQqAUJoUKFxAY2hbbAAqkIIWjipmJQEkinkKZOardJ26RpUjfBTpPg2k5iu55Sx1MSv9jPw/PwPPvZ/nFj4Oh++u75zrlX5+qeo/vZv8XyXgLzVgpzcJ/FkMxSON3DgW8NK7izbTbTGu5MG5dgT6aDS9bYSDZxpwRLTTZ2q8z6FHTrMZmaIlEp5EhLO1RKOdS8TEmRKWSTNCpFGuUCdFvUy3najQqqkqZSzPV0ra7yv2UqFXT23SLFWk44BfYzKfKFAlklh5Tap1QuU6nWyOSyJOWU0JIk0yniezvEE7so+bxAATmTQS0VCacL6IbSw+ilI/wgv8pm1UC7BnI6STQeRpZlJEkSB2TS2TQ5JStYJr4bI7i9RVktk0gkCEVC5JUMcaWEbmbPyt+qHovSTypv65UuJ7N4vUF8T/041h1kRYUHpmmdHucVFbfbz1NxkWPdjpTc7+l7RfHkKwkj/Z6jDPg/5Xbte0ZaHzDKR4wUjvPZpTe4OD3AE/cT7tyaYcE/xcXuh1zpHGdUO8EXk29x/s+zOBwb3DJNMrtiQ2fcn2Y69TnT6a9ZrpznfuMM843TzKlnGPeeZNV3m+1QBJ8ngEda5X7zlIiLnNoZJrZPYg0aRDyG1+PCFgihM+w+4HLgS64Ev8NSHWW2pWeuM8AdtQ/93dOM3xzD4/Zwd2oGW9jKPRGba59ntq7n16VvGBkfxOncxDw/h9m+gW4sOcpY5l2u5T7mXvUUhuYxbrSPcS3/Hj9Z3mbqwVU2nC4s5mXsO/Nc144y2TrGZON99LY3uXqnD/vjTdZWrFhdXnRTOzaMvnOYgoPY1RkeNa+zqk2wpI5iDkzg9T0hISVw2Jw4wzZWNAMrLQPW6hgPtsewO9aIxXcI+L2sio/UDUu/oY8d5oL0GsbqJwy1jnCx8woXSofoW34Hh91JYMvPmuUxc95xfu++xB/ayww2XqTf+TrTU1OsrK5hWXrIvM2Bbm7XI8ZsjMXoLbzqIzxNM+v1e+y3fdSqJYJbgV6F0XCMaDqEq7mAu7GAt7VIoSYRCUdEXGInEmYjHEd3IdnPV6Fn+TZ2iEuVo/RpL3C29QzL3XMUM3WGRoZZWHzI+KiRm67L9PE8Pzaf4xcOE0ytYDLNYLb8xdDgIKbFZXR++aApo7Q7cbrtPTqdg30YOikxv9p/U9oU6IqlonUidLrRHqD8r47W44wqRm/AV+d2vM2NSBtjVMMo2BTpCL/JRLiCYbvC5HZV9NwB1zGFOhi3RF5QYzIgdH+ZCV8Zk8CgU+Ef/tv2kiwXWHwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/164d445b48a5f8760888417208818cf5/8ac56/image-20220303235640818.webp 240w,\n/static/164d445b48a5f8760888417208818cf5/d3be9/image-20220303235640818.webp 480w,\n/static/164d445b48a5f8760888417208818cf5/f686e/image-20220303235640818.webp 692w\"\n              sizes=\"(max-width: 692px) 100vw, 692px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/164d445b48a5f8760888417208818cf5/8ff5a/image-20220303235640818.png 240w,\n/static/164d445b48a5f8760888417208818cf5/e85cb/image-20220303235640818.png 480w,\n/static/164d445b48a5f8760888417208818cf5/91e7e/image-20220303235640818.png 692w\"\n            sizes=\"(max-width: 692px) 100vw, 692px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/164d445b48a5f8760888417208818cf5/91e7e/image-20220303235640818.png\"\n            alt=\"image-20220303235640818\"\n            title=\"image-20220303235640818\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>今までツール任せにしていたブート構成を手動で作成してみたので結構勉強になりました。</p>\n<h2 id=\"追記usbpcapをインストールするとosが起動しなくなる問題\" style=\"position:relative;\"><a href=\"#%E8%BF%BD%E8%A8%98usbpcap%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B%E3%81%A8os%E3%81%8C%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B%E5%95%8F%E9%A1%8C\" aria-label=\"追記usbpcapをインストールするとosが起動しなくなる問題 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>追記：USBPcapをインストールするとOSが起動しなくなる問題</h2>\n<p>USB接続したSSDに<code class=\"language-text\">USBPcap</code>をインストールして再起動すると、OS起動時に「自動修復中」の表示になり起動しない問題が発生しました。</p>\n<p>残念ながら、外部接続したSSDからインストール時に作成された以下のフォルダとレジストリをすべて削除してみたものの、起動に失敗する問題は解消されませんでした。</p>\n<ul>\n<li>%ProgramFiles%\\USBPcap</li>\n<li>C:\\Windows\\System32\\drivers\\USBPcap.sys</li>\n<li>HKLM\\System\\CurrentControlSet\\Services\\USBPcap</li>\n<li>HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\USBPcap</li>\n</ul>\n<p>確認した限りでは上記を削除すればUSBPcapのインストール前の状態に戻せそうな気がするのですが、いまいち原因がわかりませんね。</p>\n<p>システムファイルを書き換えてるとは考えにくいですが、現状この問題が発生した場合は起動SSDの再セットアップ以外に解消方法が見つかりませんでした。</p>","fields":{"slug":"/note-how-to-create-bootmedia-external-ssd","tagSlugs":["/tag/windows/","/tag/備忘録/"]},"frontmatter":{"date":"2022-03-03","description":"","tags":["Windows","備忘録"],"title":"DISMとBCDBootでUSB接続した外付けSSDから起動可能なWindowsメディアを作成する","socialImage":{"publicURL":"/static/b27aa09d25b74779e12f1458bf91ad24/note-how-to-create-bootmedia-external-ssd.png"}}}},"pageContext":{"slug":"/note-how-to-create-bootmedia-external-ssd"}},"staticQueryHashes":["251939775","401334301","825871152"]}