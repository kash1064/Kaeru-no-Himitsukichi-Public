{"componentChunkName":"component---src-templates-post-template-js","path":"/note-how-to-deploy-gatsby-spa","result":{"data":{"markdownRemark":{"id":"b2f6b604-c935-574a-88a9-a7643ffa6e02","html":"<p>突然ですが、諸般の事情につきブログを移転することにしました。</p>\n<p><a href=\"https://yukituna.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">旧ブログ</a>の記事は順次こちらのブログに移植していこうと思います（手動でやる必要があるので面倒ですが…。）</p>\n<p>新しいブログですが、MITライセンスで公開されているGatsbyテンプレートの<a href=\"https://github.com/alxshelepenok/gatsby-starter-lumen\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">gatsby-starter-lumen</a>をベースに使用させてもらってます。</p>\n<p>この記事では、新しいブログを公開するまでに実施した作業について備忘録としてまとめておきます。</p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li>\n<p><a href=\"#%E4%BB%8A%E5%9B%9E%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B%E7%92%B0%E5%A2%83\">今回作成する環境</a></p>\n<ul>\n<li><a href=\"#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\">ローカル開発環境</a></li>\n<li><a href=\"#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E7%92%B0%E5%A2%83\">デプロイ環境</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gatsby%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\">Gatsby環境を構築する</a></p>\n<ul>\n<li><a href=\"#docker%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\">Dockerをインストールする</a></li>\n<li><a href=\"#gatsby%E9%96%8B%E7%99%BA%E7%94%A8%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\">Gatsby開発用のコンテナを作成する</a></li>\n<li><a href=\"#gatsby%E3%83%96%E3%83%AD%E3%82%B0%E3%81%AE%E4%BD%9C%E6%88%90\">Gatsbyブログの作成</a></li>\n<li><a href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0eacces-permission-denied-mkdir-appnpmsentry-cli-%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\">トラブルシューティング：EACCES: permission denied, mkdir ‘/app/.npm/sentry-cli’ が発生する場合</a></li>\n<li><a href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0socialimage%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\">トラブルシューティング：socialImageのエラーが発生する場合</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gatsby%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\">Gatsbyの設定を変更する</a></p>\n<ul>\n<li><a href=\"#%E3%83%97%E3%83%AD%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\">プロフィール設定を変更する</a></li>\n<li><a href=\"#%E3%82%B5%E3%82%A4%E3%83%88%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A\">サイトデザインの設定</a></li>\n<li><a href=\"#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%82%92%E8%BF%BD%E5%8A%A0%E7%B7%A8%E9%9B%86%E3%81%99%E3%82%8B\">コンテンツを追加、編集する</a></li>\n<li><a href=\"#%E8%A8%98%E4%BA%8B%E3%81%AEurl%E3%81%8B%E3%82%89%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E5%90%8D%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B\">記事のURLからディレクトリ名を削除する</a></li>\n<li><a href=\"#%E3%82%B7%E3%83%B3%E3%82%BF%E3%83%83%E3%82%AF%E3%82%B9%E3%83%8F%E3%82%A4%E3%83%A9%E3%82%A4%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\">シンタックスハイライトの設定を変更する</a></li>\n</ul>\n</li>\n<li><a href=\"#typora%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%99%E3%82%8B\">Typoraの設定をする</a></li>\n<li>\n<p><a href=\"#github-pages%E3%81%AB%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B\">GitHub Pagesにデプロイする</a></p>\n<ul>\n<li><a href=\"#%E3%83%91%E3%82%B9%E3%81%AE%E8%A8%AD%E5%AE%9A\">パスの設定</a></li>\n<li><a href=\"#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E7%94%A8%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\">デプロイ用のカスタムスクリプトの作成</a></li>\n<li><a href=\"#pages%E3%81%AE%E8%A8%AD%E5%AE%9A\">Pagesの設定</a></li>\n</ul>\n</li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n</ul>\n<h2 id=\"今回作成する環境\" style=\"position:relative;\"><a href=\"#%E4%BB%8A%E5%9B%9E%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B%E7%92%B0%E5%A2%83\" aria-label=\"今回作成する環境 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>今回作成する環境</h2>\n<p>今回は以下の環境を想定しています。</p>\n<h3 id=\"ローカル開発環境\" style=\"position:relative;\"><a href=\"#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\" aria-label=\"ローカル開発環境 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ローカル開発環境</h3>\n<ul>\n<li>Windows 10 Pro</li>\n<li>Docker</li>\n<li>Typora</li>\n</ul>\n<p>この環境が実際に記事を書く環境になります。</p>\n<p>Windowsホスト上のTyporaでMarkdownを編集し、動作確認はGatsby環境を構築したDockerコンテナ上で行います。</p>\n<p>ちなみにTyporaは高機能Markdownエディタです。</p>\n<p>最近有料化しましたが$15くらいの買い切りライセンスなので非常におすすめです。</p>\n<p>参考：<a href=\"https://typora.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Typora</a></p>\n<h3 id=\"デプロイ環境\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E7%92%B0%E5%A2%83\" aria-label=\"デプロイ環境 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>デプロイ環境</h3>\n<p>ローカルで作成したブログは、GitHub Pagesにデプロイして公開します。</p>\n<p>この際、独自ドメインを使用して公開できるように構成します。</p>\n<h2 id=\"gatsby環境を構築する\" style=\"position:relative;\"><a href=\"#gatsby%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\" aria-label=\"gatsby環境を構築する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsby環境を構築する</h2>\n<h3 id=\"dockerをインストールする\" style=\"position:relative;\"><a href=\"#docker%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\" aria-label=\"dockerをインストールする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerをインストールする</h3>\n<p>現在Windows環境にDockerをインストールする方法としては、以下の2つの方法が主になると思います。</p>\n<ul>\n<li>WSL2にDockerをインストールする</li>\n<li>Docker Desktop for Windowsをインストールする</li>\n</ul>\n<p>参考：<a href=\"https://docs.docker.com/desktop/windows/install/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Install Docker Desktop on Windows | Docker Documentation</a></p>\n<p>今回はPowershellからDockerコマンドを実行していく予定なので、Docker Desktop for Windowsをインストールしました。</p>\n<p>ちなみに、Docker Desktop for Windowsは少し前にライセンス有料化で話題になりましたが、個人利用の場合は引き続き無料で使用することができます。</p>\n<p>インストール方法については上記のドキュメントのリンクからダウンロードしたインストーラを実行するだけでOKです。</p>\n<h3 id=\"gatsby開発用のコンテナを作成する\" style=\"position:relative;\"><a href=\"#gatsby%E9%96%8B%E7%99%BA%E7%94%A8%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\" aria-label=\"gatsby開発用のコンテナを作成する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsby開発用のコンテナを作成する</h3>\n<p>続いてGatsbyの開発環境を構築します。</p>\n<p>基本的には以下のドキュメントを参照し、次のようなDockerfileを作成しました。</p>\n<p>参考：<a href=\"https://www.gatsbyjs.com/docs/tutorial/part-0/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Part 0: Set Up Your Development Environment | Gatsby</a></p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> ubuntu:20.04</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> TZ=Asia/Tokyo</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> mkdir -p /app/blog</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> HOME=/app/</span>\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /app</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt update &amp;&amp; apt upgrade -y</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt install tzdata -y</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt install curl git python wget -y</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt install nodejs npm -y</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install n -g</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> n stable</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt purge -y nodejs npm</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt autoremove -y</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> node -v</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install -g gatsby-cli</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install gh-pages --save-dev</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> chown root:root ./* -R</span>\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> <span class=\"token variable\">$HOME</span>/blog</span>\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 8000</span></code></pre></div>\n<p>Ubuntu 20.04のコンテナをベースに最新のNodeJSをインストールした後、<code class=\"language-text\">gatsby-cli</code>をインストールしました。</p>\n<p>これによって<code class=\"language-text\">gatsby</code>コマンドが使用できるようになります。</p>\n<p>また、<code class=\"language-text\">gh-pages</code>はGithub Pagesにデプロイする際に使用するパッケージです。</p>\n<p>詳細は後述します。</p>\n<p>なお、今回作成したイメージは<a href=\"https://hub.docker.com/repository/docker/kashiwabayuki/gatsby-env\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">kashiwabayuki/gatsby-env</a>として公開しているので、以下のコマンドでPullすることも可能です。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> pull kashiwabayuki/gatsby-env</code></pre></div>\n<h3 id=\"gatsbyブログの作成\" style=\"position:relative;\"><a href=\"#gatsby%E3%83%96%E3%83%AD%E3%82%B0%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"gatsbyブログの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsbyブログの作成</h3>\n<p>コンテナイメージを作成した後、環境構築時のみコンテナにログインしていくつかのセットアップを実行する必要があります。</p>\n<p>Powershell環境の場合、以下のコマンドでコンテナにログインできます。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$pwddir</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Get-Location</span> <span class=\"token operator\">-</span>PSProvider FileSystem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Path\ndocker run <span class=\"token operator\">-</span>it <span class=\"token operator\">--</span><span class=\"token function\">rm</span> <span class=\"token operator\">--</span>volume <span class=\"token variable\">$pwddir</span><span class=\"token operator\">/</span>src:<span class=\"token operator\">/</span>app <span class=\"token operator\">-</span>p 8000:8000 kashiwabayuki/gatsby-env</code></pre></div>\n<p>このコマンドで、コンテナのホームディレクトリ<code class=\"language-text\">/app</code>にローカルボリューム<code class=\"language-text\">src/</code>を紐づけてログインしています。</p>\n<p>ログイン後、以下のコマンドで<code class=\"language-text\">gatsby-starter-lumen</code>を使用してGatsbyのコンテンツを作成します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">gatsby new blog https://github.com/alxshelepenok/gatsby-starter-lumen</code></pre></div>\n<p>続いて、新たに生成された<code class=\"language-text\">blog</code>ディレクトリ配下で以下のコマンドを実行します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span>\n<span class=\"token comment\">#もしエラーになる場合は npm install --legacy-peer-deps を実行する。</span></code></pre></div>\n<p><code class=\"language-text\">npm install</code>コマンドでエラーが発生する場合は<code class=\"language-text\">--legacy-peer-deps</code>オプションを付けてから実行してみると良いです。</p>\n<p>これでブログの初期設定は完了です。</p>\n<p>以下のコマンドを実行してローカルサーバが起動すれば成功です。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">gatsby develop -H <span class=\"token number\">0.0</span>.0.0</code></pre></div>\n<h3 id=\"トラブルシューティングeacces-permission-denied-mkdir-appnpmsentry-cli-が発生する場合\" style=\"position:relative;\"><a href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0eacces-permission-denied-mkdir-appnpmsentry-cli-%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\" aria-label=\"トラブルシューティングeacces permission denied mkdir appnpmsentry cli が発生する場合 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>トラブルシューティング：EACCES: permission denied, mkdir ‘/app/.npm/sentry-cli’ が発生する場合</h3>\n<p>再現条件が不定なので原因はよくわかっていないのですが、<code class=\"language-text\">npm install</code> を実行した際に<code class=\"language-text\">EACCES: permission denied, mkdir '/app/.npm/sentry-cli'</code>という権限エラーが発生する場合があります。</p>\n<p>Dockerのユーザはrootにしているので通常発生しないことが想定されるのですが、僕の環境では何度か発生しました。</p>\n<p>対処方としては、Dockerfileでエラーの発生するディレクトリに以下のように明示的に所有者をrootに設定してあげると解消されました。</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> chown root:root ./* -R</span></code></pre></div>\n<p>エラーが発生しないときもあるので、原因は正直よくわかっていないです。。</p>\n<h3 id=\"トラブルシューティングsocialimageのエラーが発生する場合\" style=\"position:relative;\"><a href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0socialimage%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\" aria-label=\"トラブルシューティングsocialimageのエラーが発生する場合 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>トラブルシューティング：socialImageのエラーが発生する場合</h3>\n<p>ちなみに、この時以下のようなエラーが発生する場合があります。</p>\n<p>これは、各記事の<code class=\"language-text\">socialImage</code>の値が空になっているか、参照先の画像が存在していない場合、もしくは<code class=\"language-text\">static</code>ディレクトリが解決できない場合に発生するようです。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Field <span class=\"token string\">\"socialImage\"</span> must not have a selection since <span class=\"token builtin class-name\">type</span> <span class=\"token string\">\"String\"</span> has no subfields.</code></pre></div>\n<p>本記事の手順の場合は問題ないですが、Windowsのホスト上で<code class=\"language-text\">gatsby develop</code>を実行した場合、<code class=\"language-text\">static</code>ディレクトリが解決できない既知の問題のためこのような問題が発生する場合があります。</p>\n<p>解決のためには、以下のIssueに記載の回避策を試すか、本記事に記載のコンテナイメージを利用してください。</p>\n<p>参考：<a href=\"https://github.com/alxshelepenok/gatsby-starter-lumen/issues/761\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Field “socialImage” must not have a selection since type “String” has no subfields. · Issue #761 · alxshelepenok/gatsby-starter-lumen</a></p>\n<h2 id=\"gatsbyの設定を変更する\" style=\"position:relative;\"><a href=\"#gatsby%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\" aria-label=\"gatsbyの設定を変更する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsbyの設定を変更する</h2>\n<p>とりあえずここまでで最低限のGatsby環境が出来上がったので、次は初期セットアップを行っていきます。</p>\n<h3 id=\"プロフィール設定を変更する\" style=\"position:relative;\"><a href=\"#%E3%83%97%E3%83%AD%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\" aria-label=\"プロフィール設定を変更する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>プロフィール設定を変更する</h3>\n<p>基本的なプロフィールやSNSなどの設定は<code class=\"language-text\">blog/config.js</code>から変更できます。</p>\n<p>実際の設定は以下のようになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://kashiwaba-yuki.com'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">pathPrefix</span><span class=\"token operator\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">'かえるのひみつきち'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">subtitle</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">copyright</span><span class=\"token operator\">:</span> <span class=\"token string\">'All rights reserved 2022 Kaeru-no-Himitsukichi.'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">disqusShortname</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">postsPerPage</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">googleAnalyticsId</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">useKatex</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">menu</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">label</span><span class=\"token operator\">:</span> <span class=\"token string\">'All Articles'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">'/'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">label</span><span class=\"token operator\">:</span> <span class=\"token string\">'Development'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">'/tag/development'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">label</span><span class=\"token operator\">:</span> <span class=\"token string\">'Notes'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">'/category/note'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">author</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'かしわば'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">photo</span><span class=\"token operator\">:</span> <span class=\"token string\">'/avatar.png'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">bio</span><span class=\"token operator\">:</span> <span class=\"token string\">'リバースエンジニアになりたい趣味プログラマ。'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">contacts</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">email</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">facebook</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">telegram</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">twitter</span><span class=\"token operator\">:</span> <span class=\"token string\">'yuki_kashiwaba'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">github</span><span class=\"token operator\">:</span> <span class=\"token string\">'kash1064'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">rss</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">vkontakte</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">linkedin</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">instagram</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">line</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">gitlab</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">weibo</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">codepen</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">youtube</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">soundcloud</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">medium</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>特に<code class=\"language-text\">contacts</code>内のSNSアカウントについて、表示したくないものはコメントアウトではなく空欄にする必要があります。</p>\n<p>コメントアウトするとエラーが発生します。</p>\n<h3 id=\"サイトデザインの設定\" style=\"position:relative;\"><a href=\"#%E3%82%B5%E3%82%A4%E3%83%88%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A\" aria-label=\"サイトデザインの設定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>サイトデザインの設定</h3>\n<p>サイトデザインを変更する場合は、各要素のテンプレートをそれぞれ編集する必要があります。</p>\n<p>今回はベースのレイアウトは変更せず、配色などを一部変更しました。</p>\n<p>基本のデザインを変更したい場合は<code class=\"language-text\">blog/src/assets/scss/base/_generic.scss</code>を編集します。</p>\n<p>内容は以下のようになっており、各要素の文字サイズや色、フォントなども変更することができます。</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/** \n * Generic\n */</span>\n<span class=\"token selector\">html</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> $typographic-root-font-size<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">body</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 0 0 0 <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>100vw - 100%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> $typographic-font-family<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> $typographic-base-font-color<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">line-height</span><span class=\"token punctuation\">:</span> $typographic-base-line-height<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> $typographic-base-font-size<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">-ms-text-size-adjust</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">-webkit-text-size-adjust</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">text-rendering</span><span class=\"token punctuation\">:</span> optimizeLegibility<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">-webkit-font-smoothing</span><span class=\"token punctuation\">:</span> antialiased<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">-moz-osx-font-smoothing</span><span class=\"token punctuation\">:</span> grayscale<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">h1,\nh2,\nh3,\nh4,\nh5,\nh6</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> $typographic-font-family<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> 600<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">h1</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> $typographic-base-font-size * 1.8<span class=\"token punctuation\">;</span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">line-height</span><span class=\"token punctuation\">(</span>1.8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">margin-top</span><span class=\"token punctuation\">(</span>4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">margin-bottom</span><span class=\"token punctuation\">(</span>1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">h2</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> $typographic-base-font-size * 1.6875<span class=\"token punctuation\">;</span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">line-height</span><span class=\"token punctuation\">(</span>1.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">margin-top</span><span class=\"token punctuation\">(</span>2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">margin-bottom</span><span class=\"token punctuation\">(</span>.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">h3</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> $typographic-base-font-size * 1.375<span class=\"token punctuation\">;</span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">line-height</span><span class=\"token punctuation\">(</span>1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">margin-top</span><span class=\"token punctuation\">(</span>2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">margin-bottom</span><span class=\"token punctuation\">(</span>.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> 省略 <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>また、リンクの色や一部の要素のサイズなどは<code class=\"language-text\">blog/src/assets/scss/_variables.scss</code>で定義されている変数にて設定されています。</p>\n<p>例えばリンクの色を変更したい場合は、<code class=\"language-text\">$color-primary</code>を変更する必要があります。</p>\n<p>コンテンツの最大幅は<code class=\"language-text\">$layout-post-single-width</code>で設定されています。</p>\n<p>そのため、僕のブログでも以下のようにベースカラーを一部変更しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\">// Colors\n$<span class=\"token property\">color-base</span><span class=\"token punctuation\">:</span> #222<span class=\"token punctuation\">;</span>\n$<span class=\"token property\">color-primary</span><span class=\"token punctuation\">:</span> #918D40<span class=\"token punctuation\">;</span>\n$<span class=\"token property\">color-secondary</span><span class=\"token punctuation\">:</span> #A9D159<span class=\"token punctuation\">;</span>\n\n$<span class=\"token property\">color-white</span><span class=\"token punctuation\">:</span> #FFF<span class=\"token punctuation\">;</span>\n$<span class=\"token property\">color-gray</span><span class=\"token punctuation\">:</span> <span class=\"token function\">lighten</span><span class=\"token punctuation\">(</span>$color-base<span class=\"token punctuation\">,</span> 40%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n$<span class=\"token property\">color-gray-border</span><span class=\"token punctuation\">:</span> <span class=\"token function\">lighten</span><span class=\"token punctuation\">(</span>$color-base<span class=\"token punctuation\">,</span> 77%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n$<span class=\"token property\">color-gray-bg</span><span class=\"token punctuation\">:</span> <span class=\"token function\">lighten</span><span class=\"token punctuation\">(</span>$color-base<span class=\"token punctuation\">,</span> 79%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"コンテンツを追加編集する\" style=\"position:relative;\"><a href=\"#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%82%92%E8%BF%BD%E5%8A%A0%E7%B7%A8%E9%9B%86%E3%81%99%E3%82%8B\" aria-label=\"コンテンツを追加編集する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>コンテンツを追加、編集する</h3>\n<p><code class=\"language-text\">gatsby-starter-lumen</code>を使用する場合、デフォルトでは以下の2タイプのコンテンツが用意されています。</p>\n<ul>\n<li>Pages：Aboutページなどの固定ページ</li>\n<li>Posts：ブログコンテンツ</li>\n</ul>\n<p>これらはいずれも<code class=\"language-text\">blog/content/</code>ディレクトリの配下に配置されています。</p>\n<p>Gatsbyは、<code class=\"language-text\">blog/src/cms/index.js</code>の定義に沿って<code class=\"language-text\">blog/content/</code>配下のファイルを探索し、指定された形式のページとして識別します。</p>\n<p>そのため、デフォルトではすべてのブログページは<code class=\"language-text\">blog/content/posts</code>配下に置かれている必要がありますが、ここに<code class=\"language-text\">notes</code>などのカスタムディレクトリを追加したい場合は、以下のように<code class=\"language-text\">CMS.registerPreviewTemplate</code>にてディレクトリ名とテンプレートを紐づける必要があります。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// @flow strict</span>\n<span class=\"token keyword\">import</span> <span class=\"token constant\">CMS</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'netlify-cms-app'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> PagePreview <span class=\"token keyword\">from</span> <span class=\"token string\">'./preview-templates/page-preview'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> PostPreview <span class=\"token keyword\">from</span> <span class=\"token string\">'./preview-templates/post-preview'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token constant\">CMS</span><span class=\"token punctuation\">.</span><span class=\"token function\">registerPreviewTemplate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pages'</span><span class=\"token punctuation\">,</span> PagePreview<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">CMS</span><span class=\"token punctuation\">.</span><span class=\"token function\">registerPreviewTemplate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> PostPreview<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">CMS</span><span class=\"token punctuation\">.</span><span class=\"token function\">registerPreviewTemplate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'notes'</span><span class=\"token punctuation\">,</span> PostPreview<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"記事のurlからディレクトリ名を削除する\" style=\"position:relative;\"><a href=\"#%E8%A8%98%E4%BA%8B%E3%81%AEurl%E3%81%8B%E3%82%89%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E5%90%8D%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B\" aria-label=\"記事のurlからディレクトリ名を削除する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>記事のURLからディレクトリ名を削除する</h3>\n<p>デフォルトでは、記事のURLは以下の形式になります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">https://<span class=\"token operator\">&lt;</span>カスタムドメイン<span class=\"token operator\">></span>/<span class=\"token operator\">&lt;</span>記事の存在するディレクトリ名<span class=\"token operator\">></span>/<span class=\"token operator\">&lt;</span>記事のSlug<span class=\"token operator\">></span></code></pre></div>\n<p>URLに<code class=\"language-text\">&lt;記事の存在するディレクトリ名></code>が埋まっていると、今後Markdownファイルのディレクトリを変更するたびにURLが変わってしまうのでよろしくありません。</p>\n<p>そのため、URLに<code class=\"language-text\">&lt;記事の存在するディレクトリ名></code>が入らないように設定を変更します。</p>\n<p><code class=\"language-text\">blog/gatsby/on-create-node.js</code>の<code class=\"language-text\">createNodeField</code>を以下のように書き換えます。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'MarkdownRemark'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>slug <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> dirname <span class=\"token operator\">=</span> <span class=\"token function\">getNode</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>relativeDirectory<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      node<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'slug'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// value: `/${dirname}/${node.frontmatter.slug}`</span>\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>slug<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>これでデプロイ時に生成されるURLからディレクトリ名を削除することができます。</p>\n<h3 id=\"シンタックスハイライトの設定を変更する\" style=\"position:relative;\"><a href=\"#%E3%82%B7%E3%83%B3%E3%82%BF%E3%83%83%E3%82%AF%E3%82%B9%E3%83%8F%E3%82%A4%E3%83%A9%E3%82%A4%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\" aria-label=\"シンタックスハイライトの設定を変更する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>シンタックスハイライトの設定を変更する</h3>\n<p>今回使用したテーマのシンタックスハイライトはPrism.jsを利用しています。</p>\n<p>そのため、シンタックスハイライトをカスタマイズしたい場合は以下のページからCSSを生成して<code class=\"language-text\">static\\css\\prismjs\\theme.min.css</code>と置き換えてあげる必要があります。</p>\n<p>参考：<a href=\"https://prismjs.com/download.html#themes=prism-tomorrow&#x26;languages=markup+css+clike+javascript\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Download ▲ Prism</a></p>\n<p>ちなみに、僕のブログでは以下の構成にしています。</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* PrismJS 1.27.0\nhttps://prismjs.com/download.html#themes=prism-tomorrow&amp;languages=markup+css+clike+javascript+aspnet+bash+c+csharp+cpp+csv+dart+django+go+http+java+makefile+markdown+markup-templating+nginx+php+powershell+python+ruby+rust+sql+typescript+yaml */</span>\n<span class=\"token selector\">code[class*=language-],pre[class*=language-]</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>#ccc<span class=\"token punctuation\">;</span><span class=\"token property\">background</span><span class=\"token punctuation\">:</span>0 0<span class=\"token punctuation\">;</span><span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span>Consolas<span class=\"token punctuation\">,</span>Monaco<span class=\"token punctuation\">,</span><span class=\"token string\">'Andale Mono'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Ubuntu Mono'</span><span class=\"token punctuation\">,</span>monospace<span class=\"token punctuation\">;</span><span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span>1em<span class=\"token punctuation\">;</span><span class=\"token property\">text-align</span><span class=\"token punctuation\">:</span>left<span class=\"token punctuation\">;</span><span class=\"token property\">white-space</span><span class=\"token punctuation\">:</span>pre<span class=\"token punctuation\">;</span><span class=\"token property\">word-spacing</span><span class=\"token punctuation\">:</span>normal<span class=\"token punctuation\">;</span><span class=\"token property\">word-break</span><span class=\"token punctuation\">:</span>normal<span class=\"token punctuation\">;</span><span class=\"token property\">word-wrap</span><span class=\"token punctuation\">:</span>normal<span class=\"token punctuation\">;</span><span class=\"token property\">line-height</span><span class=\"token punctuation\">:</span>1.5<span class=\"token punctuation\">;</span><span class=\"token property\">-moz-tab-size</span><span class=\"token punctuation\">:</span>4<span class=\"token punctuation\">;</span><span class=\"token property\">-o-tab-size</span><span class=\"token punctuation\">:</span>4<span class=\"token punctuation\">;</span><span class=\"token property\">tab-size</span><span class=\"token punctuation\">:</span>4<span class=\"token punctuation\">;</span><span class=\"token property\">-webkit-hyphens</span><span class=\"token punctuation\">:</span>none<span class=\"token punctuation\">;</span><span class=\"token property\">-moz-hyphens</span><span class=\"token punctuation\">:</span>none<span class=\"token punctuation\">;</span><span class=\"token property\">-ms-hyphens</span><span class=\"token punctuation\">:</span>none<span class=\"token punctuation\">;</span><span class=\"token property\">hyphens</span><span class=\"token punctuation\">:</span>none<span class=\"token punctuation\">}</span><span class=\"token selector\">pre[class*=language-]</span><span class=\"token punctuation\">{</span><span class=\"token property\">padding</span><span class=\"token punctuation\">:</span>1em<span class=\"token punctuation\">;</span><span class=\"token property\">margin</span><span class=\"token punctuation\">:</span>.5em 0<span class=\"token punctuation\">;</span><span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span>auto<span class=\"token punctuation\">}</span><span class=\"token selector\">:not(pre)>code[class*=language-],pre[class*=language-]</span><span class=\"token punctuation\">{</span><span class=\"token property\">background</span><span class=\"token punctuation\">:</span>#2d2d2d<span class=\"token punctuation\">}</span><span class=\"token selector\">:not(pre)>code[class*=language-]</span><span class=\"token punctuation\">{</span><span class=\"token property\">padding</span><span class=\"token punctuation\">:</span>.1em<span class=\"token punctuation\">;</span><span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span>.3em<span class=\"token punctuation\">;</span><span class=\"token property\">white-space</span><span class=\"token punctuation\">:</span>normal<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>#999<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.punctuation</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>#ccc<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.attr-name,.token.deleted,.token.namespace,.token.tag</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>#e2777a<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.function-name</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>#6196cc<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.boolean,.token.function,.token.number</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>#f08d49<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.class-name,.token.constant,.token.property,.token.symbol</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>#f8c555<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>#cc99cd<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.attr-value,.token.char,.token.regex,.token.string,.token.variable</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>#7ec699<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.entity,.token.operator,.token.url</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>#67cdcc<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.bold,.token.important</span><span class=\"token punctuation\">{</span><span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span>700<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.italic</span><span class=\"token punctuation\">{</span><span class=\"token property\">font-style</span><span class=\"token punctuation\">:</span>italic<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.entity</span><span class=\"token punctuation\">{</span><span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span>help<span class=\"token punctuation\">}</span><span class=\"token selector\">.token.inserted</span><span class=\"token punctuation\">{</span><span class=\"token property\">color</span><span class=\"token punctuation\">:</span>green<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"># 追記\np > code[class*=language-text]</span><span class=\"token punctuation\">{</span><span class=\"token property\">background</span><span class=\"token punctuation\">:</span>#F9F9F9 <span class=\"token important\">!important</span><span class=\"token punctuation\">;</span> <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> #2d2d2d <span class=\"token important\">!important</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n<span class=\"token selector\">li > code[class*=language-text]</span><span class=\"token punctuation\">{</span><span class=\"token property\">background</span><span class=\"token punctuation\">:</span>#F9F9F9 <span class=\"token important\">!important</span><span class=\"token punctuation\">;</span> <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> #2d2d2d <span class=\"token important\">!important</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>最後の1行については、本文埋め込みの整形済みテキストの背景色と文字色を定義しています。</p>\n<h2 id=\"typoraの設定をする\" style=\"position:relative;\"><a href=\"#typora%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%99%E3%82%8B\" aria-label=\"typoraの設定をする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Typoraの設定をする</h2>\n<p>僕が愛用しているTyporaというマークダウンエディタの非常に便利な機能の1つに、画像をコピペすると自動的に任意のローカルフォルダに保存してくれる機能があります。</p>\n<p>Gatsbyの場合<code class=\"language-text\">blog/static/media</code>配下の画像に対して<code class=\"language-text\">/media</code>でアクセスできます。</p>\n<p>そのため、以下のようにTyporaの設定で、コピペされた画像が<code class=\"language-text\">blog/static/media</code>配下の任意のディレクトリに配置されるように設定を行いました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/915fae9fa8c5853d16b68d568fce6fff/525d3/image-20220221222611109.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWklEQVQoz42S3VKDMBCFeaZaAuEnQKAhtKZYtZ3q2AsvHX3/2+NuWiJ16owX3wQ27Nmzu0RxViHOa8QZU3nu0tKfIq9C7L9EIlOIJQsoEjiLVp1FWjRB2CNVQNwQ4lwmSrICIs2RyCIIWrdDqQ3yqkNaagjVQugeyYUlvXN8TnDILjxc/RKUVYuMxBQlC/rYlQ0+V2t8rUd80HlIcii6LxqDol5RRwMas0FCXUWdHaGNQ91tgsOJJRVZEEat8Ebix7rDK3GiZGMdFAnp/p6Ee2+AnUb74zse9ye43dFXmM9D5A0EjWJhXqBGYthCrXfoxgMKbn3WVWhZ0jwW1MLPZuvglE+Oa/uAYfsMM4wY3BMaapsdTQbmi4muHV2LcQK7qGnrune0KHuhBxvh+wmfyzOcC0zPhobPm+ahs2BatihbGwpwXM42LRl6P/+HN9xNH0+Ffrf110/Nd9//6Vjt6iNuBQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/915fae9fa8c5853d16b68d568fce6fff/8ac56/image-20220221222611109.webp 240w,\n/static/915fae9fa8c5853d16b68d568fce6fff/d3be9/image-20220221222611109.webp 480w,\n/static/915fae9fa8c5853d16b68d568fce6fff/e46b2/image-20220221222611109.webp 960w,\n/static/915fae9fa8c5853d16b68d568fce6fff/36bbb/image-20220221222611109.webp 1090w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/915fae9fa8c5853d16b68d568fce6fff/8ff5a/image-20220221222611109.png 240w,\n/static/915fae9fa8c5853d16b68d568fce6fff/e85cb/image-20220221222611109.png 480w,\n/static/915fae9fa8c5853d16b68d568fce6fff/d9199/image-20220221222611109.png 960w,\n/static/915fae9fa8c5853d16b68d568fce6fff/525d3/image-20220221222611109.png 1090w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/915fae9fa8c5853d16b68d568fce6fff/d9199/image-20220221222611109.png\"\n            alt=\"image-20220221222611109\"\n            title=\"image-20220221222611109\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これで、デプロイ時にブログページが適切な画像を参照できるようになります。</p>\n<h2 id=\"github-pagesにデプロイする\" style=\"position:relative;\"><a href=\"#github-pages%E3%81%AB%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B\" aria-label=\"github pagesにデプロイする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GitHub Pagesにデプロイする</h2>\n<p>さて、概ね形は整ったのでいよいよデプロイしていきます。</p>\n<p>基本的には公式の手順をベースにしています。</p>\n<p>参考：<a href=\"https://www.gatsbyjs.com/docs/how-to/previews-deploys-hosting/how-gatsby-works-with-github-pages/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How Gatsby Works with GitHub Pages | Gatsby</a></p>\n<p>まず必要なのは公開用のGithubリポジトリです。</p>\n<p>リポジトリの設定はパブリックにする必要があります。</p>\n<p>公開リポジトリにプッシュが完了したら、Github Pagesへのデプロイを始めていきます。</p>\n<h3 id=\"パスの設定\" style=\"position:relative;\"><a href=\"#%E3%83%91%E3%82%B9%E3%81%AE%E8%A8%AD%E5%AE%9A\" aria-label=\"パスの設定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>パスの設定</h3>\n<p>今回はカスタムドメインを使用するので、<code class=\"language-text\">blog\\gatsby-config.js</code>の<code class=\"language-text\">pathPrefix</code>に<code class=\"language-text\">/</code>を設定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// pathPrefix: siteConfig.pathPrefix,</span>\n  <span class=\"token literal-property property\">pathPrefix</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>これは、URLでアクセスする際に適切なパスを使えるようにするために必要な設定です。</p>\n<p>一方、カスタムドメインを指定しない場合は、<code class=\"language-text\">pathPrefix</code>にリポジトリ名を設定します。</p>\n<h3 id=\"デプロイ用のカスタムスクリプトの作成\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E7%94%A8%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"デプロイ用のカスタムスクリプトの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>デプロイ用のカスタムスクリプトの作成</h3>\n<p>次にデプロイ用のスクリプトを設定します。</p>\n<p><code class=\"language-text\">blog\\package.json</code>内の<code class=\"language-text\">scripts>deploy</code>を以下のように設定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string-property property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    \n  <span class=\"token string-property property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rm -rf node_modules/.cache/gh-pages &amp;&amp; gatsby clean &amp;&amp; gatsby build --prefix-paths &amp;&amp; echo 'kashiwaba-yuki.com' > public/CNAME &amp;&amp; gh-pages -d public -b pages\"</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p><code class=\"language-text\">rm -rf node_modules/.cache/gh-pages</code>は、ビルド時にエラーが発生しないよう、過去のキャッシュを削除しています。</p>\n<p><code class=\"language-text\">gatsby clean &amp;&amp; gatsby build --prefix-paths</code>では、<code class=\"language-text\">gatsby</code>コマンドでコンテンツをビルドしています。</p>\n<p>変更内容を確実に反映させるために<code class=\"language-text\">gatsby clean</code>が必要です。</p>\n<p><code class=\"language-text\">echo 'kashiwaba-yuki.com' > public/CNAME</code>は、カスタムドメインを使用するためのCNAMEファイルを公開ディレクトリに配置するための記述です。</p>\n<p>これが無いとデプロイするたびにカスタムドメインが解除されます。</p>\n<p><code class=\"language-text\">gh-pages -d public -b pages</code>は<code class=\"language-text\">gh-pages</code>を使って<code class=\"language-text\">pages</code>ブランチにビルドしたコンテンツを配置しています。</p>\n<p>Gitリポジトリにプッシュするため、コンテナ内からリポジトリにプッシュできるようにしておく必要があります。</p>\n<h3 id=\"pagesの設定\" style=\"position:relative;\"><a href=\"#pages%E3%81%AE%E8%A8%AD%E5%AE%9A\" aria-label=\"pagesの設定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pagesの設定</h3>\n<p>ここまで来たら後は簡単です。</p>\n<p>公開リポジトリの設定画面を開き、「Pages」で公開用のブランチ<code class=\"language-text\">pages</code>を指定してGtihub Pagesを公開します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f563b163d6bd711d854562d48559456d/dcccd/image-20220223010848772.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDElEQVQ4y22Ty3LbMAxFtW0cvUVRoiTqLVuPpOOk6abLTL+gq35E/395C0C2x0m7OAMNRV5cgKATZxZuqIXHIJVobI+qmaCLDgdfEekF9V/cQN80nCgtRegqxqjqBG2PMFWPWFdQlFTlTI2ESIt2j6aRtes5EWyGFRkd9KKMMpFopBH0NbJlQvl0gtlmpOu2s8yIRxIlJE4NfTcIu1JwVQZHc7a7sllQNXTAVoiqCiERVJao6ZtiWcIvSnjGwMtzwadvxo3Joe1Od/1LxWlLrm07o7AjqvZEcPkDMkoeaws/bWlvjkfq6wdIwzF2EJH7PjbjhuP2Av5n+xklCXLfQhI7BJxcSfL73t16OM5fwWVHupTSg8SgOz5jfn5DQTfNlyYXQ80PdAMvqW7J7xFBdsgH/DhHqApxythuRjttJFbdNh8ukff6sUFA0SPcKBe3uzA57I5PyMpe3F0Pc4ksaKiHzTCjHlechgU99TPJ91FhQl3DU5/GJslqPHjJzYFHGctulXJDcs8tYKcJESlzN69cjf6nl05NmXlA94X9Z0DzlBZW1tl5chnomNzFZpD2ROmOH2cfLsnhoeZLuWb44oZ4//kHbz9+o11eMazfMa4vGJczhplYX1FPZ6SWXlM9X1joZU3SX0fK5fd4EXzwY5y//cK0vdOhI72iiRg+oGlNFQNUOe6RSEwrF/oXt29Oq5a0OpwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f563b163d6bd711d854562d48559456d/8ac56/image-20220223010848772.webp 240w,\n/static/f563b163d6bd711d854562d48559456d/d3be9/image-20220223010848772.webp 480w,\n/static/f563b163d6bd711d854562d48559456d/e46b2/image-20220223010848772.webp 960w,\n/static/f563b163d6bd711d854562d48559456d/0b154/image-20220223010848772.webp 1127w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f563b163d6bd711d854562d48559456d/8ff5a/image-20220223010848772.png 240w,\n/static/f563b163d6bd711d854562d48559456d/e85cb/image-20220223010848772.png 480w,\n/static/f563b163d6bd711d854562d48559456d/d9199/image-20220223010848772.png 960w,\n/static/f563b163d6bd711d854562d48559456d/dcccd/image-20220223010848772.png 1127w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f563b163d6bd711d854562d48559456d/d9199/image-20220223010848772.png\"\n            alt=\"image-20220223010848772\"\n            title=\"image-20220223010848772\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>今回はCNAMEファイルも作成してカスタムドメインが有効になっているので、このドメインに接続すれば作成したブログを確認することができます。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>WordPressの旧ブログから順次こちらに移行していく予定です。</p>\n<p>画像とか内部リンクとかの修正を手動でやる必要があるのでかなり手間がかかりそうです。。</p>","fields":{"slug":"/note-how-to-deploy-gatsby-spa","tagSlugs":["/tag/blog/","/tag/gatsby/","/tag/備忘録/"]},"frontmatter":{"date":"2022-02-20","description":"Gatsbyで作成したSPAブログをGithub Pagesに公開する手順についてまとめています。Gatsbyの開発環境はDockerコンテナ上に構築しています。","tags":["Blog","Gatsby","備忘録"],"title":"Gatsbyで作成したSPAブログをGitHubPagesに公開する環境を作る備忘録","socialImage":{"publicURL":"/static/09d53d0b620280b69e0b4abe0fe4fbdd/note-how-to-deploy-gatsby-spa.png"}}}},"pageContext":{"slug":"/note-how-to-deploy-gatsby-spa"}},"staticQueryHashes":["251939775","401334301","825871152"]}