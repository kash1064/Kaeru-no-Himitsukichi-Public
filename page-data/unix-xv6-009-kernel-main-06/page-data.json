{"componentChunkName":"component---src-templates-post-template-js","path":"/unix-xv6-009-kernel-main-06","result":{"data":{"markdownRemark":{"id":"f1fa2828-0ab4-5817-a7c3-c29037018eeb","html":"<p><a href=\"https://amzn.to/3q8TU3K\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">はじめてのOSコードリーディング ~UNIX V6で学ぶカーネルのしくみ</a>にインスパイアされて<a href=\"https://github.com/mit-pdos/xv6-public\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">xv6 OS</a>を読んでます。</p>\n<p>UNIX V6自体はx86CPUでは動作しないため、基本的には、UNIXv6をX86アーキテクチャで動くようにした<a href=\"https://github.com/mit-pdos/xv6-public\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">xv6 OS</a>のリポジトリをForkした<a href=\"https://github.com/kash1064/xv6-public\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">kash1064/xv6-public: xv6 OS</a>のソースコードを読んでいくことにしました。</p>\n<p><a href=\"/unix-xv6-008-kernel-main-05\">前回</a>は<code class=\"language-text\">main</code>関数で実行される<code class=\"language-text\">seginit</code>関数を確認しました。</p>\n<p>今回は<code class=\"language-text\">picinit</code>関数と<code class=\"language-text\">ioapicinit</code>関数の挙動を追っていきます。</p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li><a href=\"#picinit%E9%96%A2%E6%95%B0\">picinit関数</a></li>\n<li>\n<p><a href=\"#ioapicinit%E9%96%A2%E6%95%B0\">ioapicinit関数</a></p>\n<ul>\n<li><a href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%9E%E3%83%83%E3%83%97%E3%81%95%E3%82%8C%E3%81%9Fioapic%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E9%A0%98%E5%9F%9F%E3%81%AE%E5%8F%82%E7%85%A7\">メモリマップされたIOAPICレジスタ領域の参照</a></li>\n<li><a href=\"#data%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E7%B5%8C%E7%94%B1%E3%81%A7%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E6%9B%B8%E3%81%8D%E3%82%92%E8%A1%8C%E3%81%86\">Dataレジスタ経由でデータの読み書きを行う</a></li>\n<li><a href=\"#redirection-table%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96\">Redirection Tableの初期化</a></li>\n</ul>\n</li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n<li><a href=\"#%E5%8F%82%E8%80%83%E6%9B%B8%E7%B1%8D\">参考書籍</a></li>\n</ul>\n<h2 id=\"picinit関数\" style=\"position:relative;\"><a href=\"#picinit%E9%96%A2%E6%95%B0\" aria-label=\"picinit関数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>picinit関数</h2>\n<p><code class=\"language-text\">picinit</code>関数は<code class=\"language-text\">picirq.c</code>で定義された関数です。</p>\n<p>以下の通りかなり小さい関数です。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"types.h\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"x86.h\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"traps.h\"</span></span>\n\n<span class=\"token comment\">// I/O Addresses of the two programmable interrupt controllers</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IO_PIC1</span>         <span class=\"token expression\"><span class=\"token number\">0x20</span>    </span><span class=\"token comment\">// Master (IRQs 0-7)</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IO_PIC2</span>         <span class=\"token expression\"><span class=\"token number\">0xA0</span>    </span><span class=\"token comment\">// Slave (IRQs 8-15)</span></span>\n\n<span class=\"token comment\">// Don't use the 8259A interrupt controllers.  Xv6 assumes SMP hardware.</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">picinit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// mask all interrupts</span>\n  <span class=\"token function\">outb</span><span class=\"token punctuation\">(</span>IO_PIC1<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">outb</span><span class=\"token punctuation\">(</span>IO_PIC2<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//PAGEBREAK!</span>\n<span class=\"token comment\">// Blank page.</span></code></pre></div>\n<p><code class=\"language-text\">outb</code>は<code class=\"language-text\">x86.h</code>で定義された以下の関数です。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">inline</span> <span class=\"token keyword\">void</span> <span class=\"token function\">outb</span><span class=\"token punctuation\">(</span>ushort port<span class=\"token punctuation\">,</span> uchar data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">asm</span> <span class=\"token keyword\">volatile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out %0,%1\"</span> <span class=\"token operator\">:</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"a\"</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"d\"</span> <span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>任意のポートにデータを送信するアセンブリを発行します。</p>\n<p>参考：<a href=\"https://stackoverflow.com/questions/8365746/what-does-outb-in-att-asm-mean\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">assembly - what does “outb” in AT&#x26;T asm mean? - Stack Overflow</a></p>\n<p>ここでは、<code class=\"language-text\">0x21</code>と<code class=\"language-text\">0xA1</code>という<code class=\"language-text\">8259 PIC</code>に関連したポートをマスクしています。</p>\n<p><code class=\"language-text\">8259 PIC</code>は、割込み要求を受け入れ、CPUに送信する割込みコントローラですが、SMPをサポートするxv6OSではAPICによる割込みを実装するため、無効化する必要があります。</p>\n<p>ここで、<code class=\"language-text\">0x21</code>と<code class=\"language-text\">0xA1</code>は、どちらも<code class=\"language-text\">8259 PIC</code>のデータポートになります。</p>\n<p>以下のOSDevのWikiにある通り、ローカルAPICとIOAPICによる割込みを実装する場合は、これらのデータポートに<code class=\"language-text\">0xFF</code>を設定して<code class=\"language-text\">8259 PIC</code>を無効化します。</p>\n<p>参考：<a href=\"https://wiki.osdev.org/PIC\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">8259 PIC - OSDev Wiki</a></p>\n<p>参考：<a href=\"https://stackoverflow.com/questions/62329557/i-o-port-addressing\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">assembly - I/O Port Addressing - Stack Overflow</a></p>\n<h2 id=\"ioapicinit関数\" style=\"position:relative;\"><a href=\"#ioapicinit%E9%96%A2%E6%95%B0\" aria-label=\"ioapicinit関数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ioapicinit関数</h2>\n<p><code class=\"language-text\">picinit</code>関数の処理が完了し、PICが無効化されました。</p>\n<p>続いて、<code class=\"language-text\">ioapic.c</code>で定義された<code class=\"language-text\">ioapicinit</code>関数が<code class=\"language-text\">main</code>関数から呼び出されます。</p>\n<p>この関数では、IOAPICの初期化を行います。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">ioapicinit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> maxintr<span class=\"token punctuation\">;</span>\n\n  ioapic <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">volatile</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ioapic</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>IOAPIC<span class=\"token punctuation\">;</span>\n  maxintr <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ioapicread</span><span class=\"token punctuation\">(</span>REG_VER<span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span>\n  id <span class=\"token operator\">=</span> <span class=\"token function\">ioapicread</span><span class=\"token punctuation\">(</span>REG_ID<span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">24</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">!=</span> ioapicid<span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ioapicinit: id isn't equal to ioapicid; not a MP\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Mark all interrupts edge-triggered, active high, disabled,</span>\n  <span class=\"token comment\">// and not routed to any CPUs.</span>\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> maxintr<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">ioapicwrite</span><span class=\"token punctuation\">(</span>REG_TABLE<span class=\"token operator\">+</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">,</span> INT_DISABLED <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>T_IRQ0 <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ioapicwrite</span><span class=\"token punctuation\">(</span>REG_TABLE<span class=\"token operator\">+</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>i<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>コードを順番に見ていきます。</p>\n<h3 id=\"メモリマップされたioapicレジスタ領域の参照\" style=\"position:relative;\"><a href=\"#%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%9E%E3%83%83%E3%83%97%E3%81%95%E3%82%8C%E3%81%9Fioapic%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E9%A0%98%E5%9F%9F%E3%81%AE%E5%8F%82%E7%85%A7\" aria-label=\"メモリマップされたioapicレジスタ領域の参照 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>メモリマップされたIOAPICレジスタ領域の参照</h3>\n<p><code class=\"language-text\">ioapic = (volatile struct ioapic*)IOAPIC;</code>の行では変数<code class=\"language-text\">ioapic</code>に<code class=\"language-text\">ioapic</code>構造体を設定しています。</p>\n<p><code class=\"language-text\">IOAPIC</code>は<code class=\"language-text\">0xFEC00000</code>として<code class=\"language-text\">ioapic.c</code>で定義されています。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// ioapic.c</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IOAPIC</span>  <span class=\"token expression\"><span class=\"token number\">0xFEC00000</span>   </span><span class=\"token comment\">// Default physical address of IO APIC</span></span></code></pre></div>\n<p>IOAPICのアドレスはデフォルトで<code class=\"language-text\">0xFEC00000</code>になることが保証されているため、このアドレスを固定値として指定しています。</p>\n<p>参考：<a href=\"https://stackoverflow.com/questions/24828186/about-the-io-apic-82093aa\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">x86 - About the IO-APIC 82093AA - Stack Overflow</a></p>\n<p><code class=\"language-text\">ioapic</code>構造体は、以下のように非常にシンプルな構造になっています。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// IO APIC MMIO structure: write reg, then read or write data.</span>\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ioapic</span> <span class=\"token punctuation\">{</span>\n  uint reg<span class=\"token punctuation\">;</span>\n  uint pad<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  uint data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>参考：<a href=\"http://web.archive.org/web/20161130153145/http://download.intel.com/design/chipsets/datashts/29056601.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Memory Mapped Registers for Accessing IOAPIC Registers</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/45b8bf0613c0fee518900e712948f7c0/0b533/image-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAARlAAAEZQAGA43XUAAAA4klEQVQY0y2O6W6DMBCE8/6PVvVX2uYCwhpiDJgz2E5KVX11aVdazcweo9kp6zCj51B07KXlTSwvl5rXtKGbFh4hMC+euwuEyBf3qwNTnIXwwHnP4v93EXfE+v5amYaep1+4mYaPrGToe9xyR+uKw1VzzDXGGKSy7JOS90xj+xFRJRfRtE3DOeJm+Hx+0nU90zyjRDgfj4gonHPYtsXoG6aKT5E/gkfyjLY2W3rJc86nE000lPz6Z7iuK9Za+phKKUWSJBRlyTiOW6qiKGKXGx+GARW1MfW2lxggTVOqqtrufgDVECrAWoI6dQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/45b8bf0613c0fee518900e712948f7c0/8ac56/image-6.webp 240w,\n/static/45b8bf0613c0fee518900e712948f7c0/d3be9/image-6.webp 480w,\n/static/45b8bf0613c0fee518900e712948f7c0/b0a15/image-6.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/45b8bf0613c0fee518900e712948f7c0/8ff5a/image-6.png 240w,\n/static/45b8bf0613c0fee518900e712948f7c0/e85cb/image-6.png 480w,\n/static/45b8bf0613c0fee518900e712948f7c0/0b533/image-6.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/45b8bf0613c0fee518900e712948f7c0/0b533/image-6.png\"\n            alt=\"2022/02/image-6.png\"\n            title=\"2022/02/image-6.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>参考画像：<a href=\"https://www.intel.com/content/dam/www/public/us/en/documents/datasheets/9-series-chipset-pch-datasheet.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Intel 9 Series Chipset Platform Controller Hub Datasheet</a></p>\n<p>最初の<code class=\"language-text\">reg</code>がインデックスとして使用され、<code class=\"language-text\">data</code>の領域を利用して読み書きを行われます。</p>\n<p>実際に起動時に<code class=\"language-text\">ioapic</code>の領域に格納される値がどうなっているのか気になったのでデバッガで確認してみました。</p>\n<p><code class=\"language-text\">0xFEC00000</code>から20バイト分の領域を見てみましたが、この時点ではすべて0でした。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ x/5wx 0xfec00000\n0xfec00000:\t0x00000000\t0x00000000\t0x00000000\t0x00000000\n0xfec00010:\t0x00000000</code></pre></div>\n<h3 id=\"dataレジスタ経由でデータの読み書きを行う\" style=\"position:relative;\"><a href=\"#data%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E7%B5%8C%E7%94%B1%E3%81%A7%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E6%9B%B8%E3%81%8D%E3%82%92%E8%A1%8C%E3%81%86\" aria-label=\"dataレジスタ経由でデータの読み書きを行う permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dataレジスタ経由でデータの読み書きを行う</h3>\n<p>続いて以下のコードを見ます。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">maxintr <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ioapicread</span><span class=\"token punctuation\">(</span>REG_VER<span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span>\nid <span class=\"token operator\">=</span> <span class=\"token function\">ioapicread</span><span class=\"token punctuation\">(</span>REG_ID<span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">24</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">!=</span> ioapicid<span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ioapicinit: id isn't equal to ioapicid; not a MP\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">ioapicread</code>関数は、引数として受け取った値を<code class=\"language-text\">ioapic</code>の<code class=\"language-text\">reb</code>に書き込み、その後<code class=\"language-text\">data</code>の値を取得して返却する関数です。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> uint <span class=\"token function\">ioapicread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> reg<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  ioapic<span class=\"token operator\">-></span>reg <span class=\"token operator\">=</span> reg<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> ioapic<span class=\"token operator\">-></span>data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>IOAPICでは、<code class=\"language-text\">ioapic->reg</code>がインデックスレジスタとして使用され、間接的にデータの読み書きを行うことができます。</p>\n<p>インデックスレジスタとレジスタの対応は以下の通りです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f8fc332e216b95790c9d23b8ce7a518/0b533/image-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAARlAAAEZQAGA43XUAAABI0lEQVQY00VR226EIBD1/3/PPjTqpl5BEbnsimB1PR2IbUnICTDnMkMmrMdkA8waUDGFYlBoRo2PRqJkGtvmcRwHVsLZrFBPh80HfO87nNvwdB5+22DXDSEEZLjX+zwgpQSbJNzLouMCPZ/BOUfb1OjYSEYKvVAw9pVEGL19Vl+JVzU9tDHI3teVBEPYwRgDpz1NAmqRWOSMuq5RliWstVjJ6GkNjNbQ2qR6NvQYxxEjZ3SnkV234HmeEEKg6zoiWVRVhaZtk2Ce56geD4h5xk6teu8TxvqWaiIWZGpiwusvYaBkE2YiTeTYk3DX9RiGIRF+MSaNxIgp4d1VxGVZ/gXj4AUJDvSglEptRIOYoCgKcDpLIjianXP0MYTJ/A4RO4tGP9vhxMmussmZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0f8fc332e216b95790c9d23b8ce7a518/8ac56/image-5.webp 240w,\n/static/0f8fc332e216b95790c9d23b8ce7a518/d3be9/image-5.webp 480w,\n/static/0f8fc332e216b95790c9d23b8ce7a518/b0a15/image-5.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0f8fc332e216b95790c9d23b8ce7a518/8ff5a/image-5.png 240w,\n/static/0f8fc332e216b95790c9d23b8ce7a518/e85cb/image-5.png 480w,\n/static/0f8fc332e216b95790c9d23b8ce7a518/0b533/image-5.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0f8fc332e216b95790c9d23b8ce7a518/0b533/image-5.png\"\n            alt=\"2022/02/image-5.png\"\n            title=\"2022/02/image-5.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>参考画像：<a href=\"https://www.intel.com/content/dam/www/public/us/en/documents/datasheets/9-series-chipset-pch-datasheet.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Intel 9 Series Chipset Platform Controller Hub Datasheet</a></p>\n<p>参考：<a href=\"https://mmi.hatenablog.com/entry/2017/04/09/132708\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">I/O APICについて - 睡分不足</a></p>\n<p><code class=\"language-text\">maxintr = (ioapicread(REG_VER) >> 16) &amp; 0xFF;</code>の行では、インデックスレジスタに1を指定してバージョン情報を取得しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ x/5wx 0xfec00000\n0xfec00000:\t0x00000001\t0x00000000\t0x00000000\t0x00000000\n0xfec00010:\t0x00170020</code></pre></div>\n<p><code class=\"language-text\">maxintr</code>には<code class=\"language-text\">0x17</code>が入ります。</p>\n<p>これはバージョンレジスタの23:16bitの範囲にあるMREを取得しているようです。</p>\n<p>ここで取得できる情報は割込み入力PINの数から1を引いた数になるみたいです。(おそらくこれが定義できる割込みの最大数に?)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/32a6e216be2c56ffd4c31ca9ea42dd60/0b533/image-7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAARlAAAEZQAGA43XUAAAB/klEQVQoz21T246qQBDk/z/Kl3UTox6NsnIVkIuACgLe1wdru1o9l+RM0umZpma6qmYwpn4ONy5hrUp4eQsn2WGRNTDTBvXxBo7H46HBcbvd0LYtrterRtd1OJ1Ov3FG4HsIlr7G9XJGliYoixzn0xH/G3VVYbkM9OCyLOC6Lo7HP1gjTRIkSYogCJCt1wJeIpZaGEaI41gjTVNEUaSxFgxrnK9WK81t2+FyuWgTYz6fySE+fN+H53lwHEdAK3jSmd19qUVhqBuXgmFjz3MVxzkzSXBvUZYiOQjRds8O9ONwOKgEBtfM/F43HZr2oN/fGGb6+V7zDCPJt0jXJQ5q7llpvw1n3L+/UbdHeFmFqNjrpr+DmHfe7/cwfLkU27bxazyGaZoqkfIpg5Isy1LP1lmGIs/VT/rInEkt0TuQixS5lVyYQVlVtcN0OpGYYj6bYT439XDbtjCZTNRL79XIlgb0lyToH2vOa14U4uH9flcPXNdRJqTdNC222y02m42ACux2O2WQC0PWy3KjazLl9+1GsLJm3ajqWumPRyN89Pv4/Oyj1+thMBhgJLXhcKiZDMjashZYLBY6Z5Ad17SGFhh8S/SKRW4iS8pg91qaMehN0zTK/qmg+SfeNSoxEn3Eofpnfn3pY6UMNf5l+POBPxtzTgz3xJI5pzX8/dj8B//bc+BEHWN+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/32a6e216be2c56ffd4c31ca9ea42dd60/8ac56/image-7.webp 240w,\n/static/32a6e216be2c56ffd4c31ca9ea42dd60/d3be9/image-7.webp 480w,\n/static/32a6e216be2c56ffd4c31ca9ea42dd60/b0a15/image-7.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/32a6e216be2c56ffd4c31ca9ea42dd60/8ff5a/image-7.png 240w,\n/static/32a6e216be2c56ffd4c31ca9ea42dd60/e85cb/image-7.png 480w,\n/static/32a6e216be2c56ffd4c31ca9ea42dd60/0b533/image-7.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/32a6e216be2c56ffd4c31ca9ea42dd60/0b533/image-7.png\"\n            alt=\"2022/02/image-7.png\"\n            title=\"2022/02/image-7.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>参考画像：<a href=\"https://www.intel.com/content/dam/www/public/us/en/documents/datasheets/9-series-chipset-pch-datasheet.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Intel 9 Series Chipset Platform Controller Hub Datasheet</a></p>\n<p>次の行では<code class=\"language-text\">id</code>として<code class=\"language-text\">0x0</code>を取得しました。</p>\n<p>これはIDレジスタの27:24bitの範囲の値でAPIC IDの値になります。(1つ目が0なのでたぶん初回実行時の値が0になっている?)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f20954147f64329fe787e7a1456b66e2/0b533/image-8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAARlAAAEZQAGA43XUAAABZUlEQVQoz5VS126DQBC8//+xSFHiJrkCphsw1TgugOzJzspO5Ic85KTRnrbM7A2YVVzhfZPgwynw6ewx2hawsi+M3BJvmz3srAXP7XbXOAwDLpcL+r5H110lf9P8/X5XGMuysFou0dQVDk0N27ZRliX+Ommaas8w9AiDAHlRvNQNi57nIQxDJEkC3/fhui52ux3yPFdkWYY4jkWokr7gcS8RRSF8mWW9EOK6rmE8GSaZ4ziqHIgqCdfrtUZXBhzbgr1ZI0sT8EUkfPZzGd6jKMLpdIYJ0lKZr9frK7pOYy8+JWWLjXgd5Y341qmHrJ3P5x8wx03NYrnCeDzGdDIRNV/VuTEjVWOBH4Swtz48icxp/vFsPpWoqkq3Ne52q2TT6fRBGCkhPWTkMO8k3qnIb65tW8XhcMDxeFQRw4+wmM8xm83UHyqxyKbnwF+gVU+wn/6bWJTUfAGf0EqhaRpt+A8owF/qG1VGoTvNDXmCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f20954147f64329fe787e7a1456b66e2/8ac56/image-8.webp 240w,\n/static/f20954147f64329fe787e7a1456b66e2/d3be9/image-8.webp 480w,\n/static/f20954147f64329fe787e7a1456b66e2/b0a15/image-8.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f20954147f64329fe787e7a1456b66e2/8ff5a/image-8.png 240w,\n/static/f20954147f64329fe787e7a1456b66e2/e85cb/image-8.png 480w,\n/static/f20954147f64329fe787e7a1456b66e2/0b533/image-8.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f20954147f64329fe787e7a1456b66e2/0b533/image-8.png\"\n            alt=\"2022/02/image-8.png\"\n            title=\"2022/02/image-8.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>参考画像：<a href=\"https://www.intel.com/content/dam/www/public/us/en/documents/datasheets/9-series-chipset-pch-datasheet.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Intel 9 Series Chipset Platform Controller Hub Datasheet</a></p>\n<p>この値が<code class=\"language-text\">ioapicid</code>と一致するかを検証しています。</p>\n<p><code class=\"language-text\">ioapicid</code>は<a href=\"/unix-xv6-006-kernel-main-03\">マルチプロセッサ編</a>で見た通り、MPコンフィグレーションテーブルから取得したAPICの番号でした。</p>\n<h3 id=\"redirection-tableの初期化\" style=\"position:relative;\"><a href=\"#redirection-table%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96\" aria-label=\"redirection tableの初期化 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redirection Tableの初期化</h3>\n<p>最後に、<code class=\"language-text\">ioapicwrite</code>関数で全ての<code class=\"language-text\">Redirection Table</code>を無効化しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// Mark all interrupts edge-triggered, active high, disabled,</span>\n<span class=\"token comment\">// and not routed to any CPUs.</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> maxintr<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">ioapicwrite</span><span class=\"token punctuation\">(</span>REG_TABLE<span class=\"token operator\">+</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">,</span> INT_DISABLED <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>T_IRQ0 <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">ioapicwrite</span><span class=\"token punctuation\">(</span>REG_TABLE<span class=\"token operator\">+</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>i<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">ioapicwrite</code>関数は以下のようにインデックスと書き込みデータを使用して書き込みを行う関数です。</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ioapicwrite</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> reg<span class=\"token punctuation\">,</span> uint data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  ioapic<span class=\"token operator\">-></span>reg <span class=\"token operator\">=</span> reg<span class=\"token punctuation\">;</span>\n  ioapic<span class=\"token operator\">-></span>data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">INT_DISABLED</code>は、<code class=\"language-text\">0x00010000</code>として定義されています。</p>\n<p>これによって、17番目のbitに1をセットすることができます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fd74530a7bc6d1dd7ea4a28d709cede8/0b533/image-9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAARlAAAEZQAGA43XUAAAAvElEQVQY0z1PXQ9EMBD0/38aolRFwmm158VXEF6Z2y3uYTI7M91mJ5inCUmSoCgKaK0xzzOGYcBEPmfMrMdx9PPL7xvWDNa8G5znScEIpRTiOIYxBoY+dtbBti1agnPOe6wt+Vo3/8zD3LyuK4LrurDvO6SUiKIIKs+RCgHxIGedpjQnDwvP7yxlhizLEIYhvl2H4DgOf7K1FnVd+9p8ZVVV0E1zg7wPZd7T1MBolGWJvu+xbRuWZfF1+cIfeiEh/Dp95tgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fd74530a7bc6d1dd7ea4a28d709cede8/8ac56/image-9.webp 240w,\n/static/fd74530a7bc6d1dd7ea4a28d709cede8/d3be9/image-9.webp 480w,\n/static/fd74530a7bc6d1dd7ea4a28d709cede8/b0a15/image-9.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fd74530a7bc6d1dd7ea4a28d709cede8/8ff5a/image-9.png 240w,\n/static/fd74530a7bc6d1dd7ea4a28d709cede8/e85cb/image-9.png 480w,\n/static/fd74530a7bc6d1dd7ea4a28d709cede8/0b533/image-9.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fd74530a7bc6d1dd7ea4a28d709cede8/0b533/image-9.png\"\n            alt=\"2022/02/image-9.png\"\n            title=\"2022/02/image-9.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>参考画像：<a href=\"https://www.intel.com/content/dam/www/public/us/en/documents/datasheets/9-series-chipset-pch-datasheet.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Intel 9 Series Chipset Platform Controller Hub Datasheet</a></p>\n<p>このbitはMaskフラグになっており、セットされた場合割込みが送信されなくなります。</p>\n<p>下位8bitに設定している値は割込みベクタです。</p>\n<p>なんで初期化時に無効化してるんでしょうか。。</p>\n<p>たぶん以降のコードを読めばわかると思うので引き続き進めていこうと思います。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>今回は<code class=\"language-text\">picinit</code>と<code class=\"language-text\">ioapicinit</code>まで読み進めました。</p>\n<p>まだ読んでいない<code class=\"language-text\">main</code>関数で実行している関数も残り10個になり、折り返しに差し掛かってきました。</p>\n<p>次回は<code class=\"language-text\">consoleinit</code>関数を読んでいきます。</p>\n<h2 id=\"参考書籍\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83%E6%9B%B8%E7%B1%8D\" aria-label=\"参考書籍 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考書籍</h2>\n<ul>\n<li><a href=\"https://amzn.to/3qZSCY7\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">30日でできる! OS自作入門</a></li>\n<li><a href=\"https://amzn.to/3qXYsZX\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ゼロからのOS自作入門</a></li>\n<li><a href=\"https://amzn.to/3q8TU3K\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">はじめてのOSコードリーディング ~UNIX V6で学ぶカーネルのしくみ</a></li>\n<li><a href=\"https://amzn.to/3I6fkVt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">詳解 Linuxカーネル</a></li>\n<li><a href=\"https://amzn.to/3JRUdI2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">作って理解するOS x86系コンピュータを動かす理論と実装</a></li>\n</ul>","fields":{"slug":"/unix-xv6-009-kernel-main-06","tagSlugs":["/tag/unix/","/tag/xv-6/","/tag/kernel/","/tag/os/"]},"frontmatter":{"date":"2022-02-06","description":"教育用OSのxv6OSのソースコードを読んでカーネルについて学んでいきます。この記事ではxv6OSのカーネルのmain関数の挙動を読み解きます。","tags":["Unix","xv6","Kernel","OS"],"title":"xv6OSを真面目に読みこんでカーネルを完全に理解する -IOAPIC 編-","socialImage":{"publicURL":"/static/ce2728ae27ca5fabc09dfa2abcf668e6/unix-xv6-009-kernel-main-06.png"}}}},"pageContext":{"slug":"/unix-xv6-009-kernel-main-06"}},"staticQueryHashes":["251939775","401334301","825871152"]}