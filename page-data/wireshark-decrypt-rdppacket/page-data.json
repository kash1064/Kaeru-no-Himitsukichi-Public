{"componentChunkName":"component---src-templates-post-template-js","path":"/wireshark-decrypt-rdppacket","result":{"data":{"markdownRemark":{"id":"a9c0dde3-9e01-5394-94b7-8c3ba2cde28c","html":"<p>今回は、WireSharkでRDPパケットのキャプチャを行って復号する方法について紹介します。</p>\n<p>単純にWireSharkでRDPパケットの中身を見るだけであれば、以下の公式サイトで配布されているpcapファイルとpemファイルを使うのが一番簡単でいいと思います。</p>\n<p>参考：<a href=\"https://gitlab.com/wireshark/wireshark/-/wikis/home\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Wiki · Wireshark Foundation</a></p>\n<p>この記事では、<a href=\"https://unit42.paloaltonetworks.jp/wireshark-tutorial-decrypting-rdp-traffic/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Wiresharkによるパケット解析講座 11: RDPトラフィックの復号</a>の記事の手順を参考にしながら進めていきます。</p>\n<p>一部この記事の手順通りだと上手くいかない場面があったので、そのあたりも含めてまとめていきます。</p>\n<!-- omit in toc -->\n<h2 id=\"もくじ\" style=\"position:relative;\"><a href=\"#%E3%82%82%E3%81%8F%E3%81%98\" aria-label=\"もくじ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>もくじ</h2>\n<ul>\n<li><a href=\"#%E7%92%B0%E5%A2%83\">環境</a></li>\n<li><a href=\"#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E5%81%B4%E3%81%AErdp%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%8B%E3%82%89forward-secrecy%E6%9A%97%E5%8F%B7%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B\">クライアント側のRDPクライアントからForward Secrecy暗号を削除する</a></li>\n<li><a href=\"#rdp%E3%82%B5%E3%83%BC%E3%83%90%E5%81%B4%E3%81%AE%E7%A7%98%E5%AF%86%E9%8D%B5%E3%82%92%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E3%81%99%E3%82%8B\">RDPサーバ側の秘密鍵をエクスポートする</a></li>\n<li><a href=\"#rdp%E3%83%91%E3%82%B1%E3%83%83%E3%83%88%E3%82%92%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\">RDPパケットをキャプチャしてみる</a></li>\n<li><a href=\"#%E7%A7%98%E5%AF%86%E9%8D%B5%E3%81%A7%E3%83%91%E3%82%B1%E3%83%83%E3%83%88%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E3%82%92%E5%BE%A9%E5%8F%B7%E3%81%99%E3%82%8B\">秘密鍵でパケットキャプチャを復号する</a></li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n</ul>\n<h2 id=\"環境\" style=\"position:relative;\"><a href=\"#%E7%92%B0%E5%A2%83\" aria-label=\"環境 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>環境</h2>\n<p>今回は以下の環境を構築しました。</p>\n<ul>\n<li>RDPクライアントホスト Windows 10 1511 </li>\n<li>RDPサーバ ホスト Windows 10 1511 </li>\n</ul>\n<p>※ RDPサーバ ホストは、リモートデスクトップ接続を有効化しておきます。</p>\n<p>※ いずれもVisualBoxの内部ネットワークで接続。</p>\n<p>利用したアプリケーションは以下です。</p>\n<ul>\n<li>WireShark 3.4.8 ： パケットキャプチャの取得とpcapファイルの表示に使用</li>\n<li>jailbreak：RDPサーバの証明書を取得するために使用</li>\n<li>OpenSSL  v1.1.1L Light：証明書から秘密鍵を取得するために使用</li>\n</ul>\n<h2 id=\"クライアント側のrdpクライアントからforward-secrecy暗号を削除する\" style=\"position:relative;\"><a href=\"#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E5%81%B4%E3%81%AErdp%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%8B%E3%82%89forward-secrecy%E6%9A%97%E5%8F%B7%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B\" aria-label=\"クライアント側のrdpクライアントからforward secrecy暗号を削除する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>クライアント側のRDPクライアントからForward Secrecy暗号を削除する</h2>\n<p>まずはクライアント側のグループポリシーエディタ(<code class=\"language-text\">gpedit.msc</code>)を開いて、Forward Secrecy暗号を削除します。</p>\n<p>Forward Securityとは、サーバの秘密鍵と公開鍵を利用した暗号化方法ではなく、クライアントとサーバのそれぞれの持つ秘密鍵から作成したデータによって暗号化を行う手法です。</p>\n<p>Forward Securityを利用することで、もしクライアントとサーバのどちらか一方の秘密鍵が漏洩した場合でも、データが復号されず、安全性が保たれるメリットがあります。</p>\n<p>デフォルトでは、WindowsのRDP通信はこのForward Securityを用いた暗号化がされているため、単一の秘密鍵を用いてWireSharkからパケットを復号することができません。</p>\n<p>そのため、まずはクライアント側でForward Secrecy暗号を削除する必要があるというわけです。</p>\n<p>以下の画像のように、SSL構成設定からSSL暗号の順位の設定を開き、設定を[有効]にします。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/37a30b2bf43e315d96e62045e795bcc0/0b533/image-24.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.41666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAARlAAAEZQAGA43XUAAACi0lEQVQ4y5VU2W7bMBDU/39W4D72JUcbS5asWyJ1y7qsWJ7urkMnKQoUWWCw1MYc7g6HscI4gSo0MlWgbjpM84JhnDBOjJnWs3zfQbVbfbrn03tdFRWsg+vCO3ooyhqOH2H38zeevRy/jgqHUCHIKkSqEcS6hZ+WcCOFWLXwYv1e75CWvdStpojgew66roNONZIgAce8rPD9EG3b4u3tDefzWfIwDFLbtqusTZ2jH0ZYp65GpQOchglxHKMsy9smOoC/tdIYxxGn04nQC1mWZVBKSW6aRrBtG3EQ4Tj0qJRPRJWQJUmCKIoQhiFeX1+R5zltaIWQu+HDioL0rmvJfBivt+1yI5znCV0VIQgCeJ5HcGUdBCEiIq2rEoVWaGgTd8eE67oKOWNZFmmEOxwMYZkfkaapEPm+L930NLKicVNdIs5I/FQhIkdwx1prGflzvpqRl2VGHttwnAMmsgoLfL2S4EQaEtHO7fDgtHhwezgREQc+qqqWMVk7rQsZ/YOQOmyKQHRbljNM8Cg8xudoGrKW40iXPCajqqqvhOsyoa8TeK4n+piY51m04mCLcLC1bNuW2+XL6Pte8u2WL6ZDskSTiEVGcvxnQuMvlsB0vVKNOzfgv4kvL++E09BCZT4VO9nwP0L6wt/BnV+IkJ+hVeRkEf8oV24uhINHMX67g/SKc429n8APY5oqwvF4lOm423U900vpOyJaCRfxlQkmZ/uwrgbjSC+oP6FoepmIrWW8ycH7LaMbn2AITZffDSHkLjhYA9aIybbr9kX4f4F/Z2DsJYTn83o/4W/ffTfYZtZu9wMvLy/kLwePT494en6Cc7BhOzb29v4De645lPdw6X9oluXiRwN+MZz/ABwPYYpTHK1UAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/37a30b2bf43e315d96e62045e795bcc0/8ac56/image-24.webp 240w,\n/static/37a30b2bf43e315d96e62045e795bcc0/d3be9/image-24.webp 480w,\n/static/37a30b2bf43e315d96e62045e795bcc0/b0a15/image-24.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/37a30b2bf43e315d96e62045e795bcc0/8ff5a/image-24.png 240w,\n/static/37a30b2bf43e315d96e62045e795bcc0/e85cb/image-24.png 480w,\n/static/37a30b2bf43e315d96e62045e795bcc0/0b533/image-24.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/37a30b2bf43e315d96e62045e795bcc0/0b533/image-24.png\"\n            alt=\"image-24.png\"\n            title=\"image-24.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>有効にすると[オプション]の項目にSSL暗号の一覧が格納されます。</p>\n<p>僕の環境(Windows 10 Pro 20H2)で有効化した際には、デフォルトで以下の暗号化スイートが定義されました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">TLS_AES_256_GCM_SHA384、TLS_AES_128_GCM_SHA256、TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384、TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256、TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384、TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256、TLS_DHE_RSA_WITH_AES_256_GCM_SHA384、TLS_DHE_RSA_WITH_AES_128_GCM_SHA256、TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384、TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256、TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384、TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256、TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA、TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA、TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA、TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA、TLS_RSA_WITH_AES_256_GCM_SHA384、TLS_RSA_WITH_AES_128_GCM_SHA256、TLS_RSA_WITH_AES_256_CBC_SHA256、TLS_RSA_WITH_AES_128_CBC_SHA256、TLS_RSA_WITH_AES_256_CBC_SHA、TLS_RSA_WITH_AES_128_CBC_SHA、TLS_RSA_WITH_3DES_EDE_CBC_SHA、TLS_RSA_WITH_NULL_SHA256、TLS_RSA_WITH_NULL_SHA、TLS_PSK_WITH_AES_256_GCM_SHA384、TLS_PSK_WITH_AES_128_GCM_SHA256、TLS_PSK_WITH_AES_256_CBC_SHA384、TLS_PSK_WITH_AES_128_CBC_SHA256、TLS_PSK_WITH_NULL_SHA384、TLS_PSK_WITH_NULL_SHA256</code></pre></div>\n<p>この手順では、デフォルトで設定されている暗号化スイートのうち、いくつかを手動で削除します。</p>\n<p>ここで削除しているのは、現在実用化されているForward Securityの暗号化手法である、DHE（ディフィー・ヘルマン鍵共有）と、ECDHE（楕円曲線ディフィー・ヘルマン鍵共有）に関連した暗号化スイートです。</p>\n<p>削除後の設定は次のようになります。</p>\n<p>面倒なので<code class=\"language-text\">TLS_RSA_WITH_AES_128_CBC_SHA256</code>一つに絞ってしまします。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">TLS_RSA_WITH_AES_128_CBC_SHA256</code></pre></div>\n<p>この設定値を[SSL暗号]のフォームにコピペしてOKボタンを押せば設定は完了です。</p>\n<p>念のため、コマンドプロンプトで以下のコマンドを実行し、グループポリシーの設定を反映させます。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">gpupdate <span class=\"token operator\">/</span>force</code></pre></div>\n<p>これでForward Securityの無効化は完了です。</p>\n<p><strong>※ 後述しますが、この手順だけでは不十分で、手元の環境ではOSを再起動するまで暗号化スイートは変更されませんでした。</strong></p>\n<h2 id=\"rdpサーバ側の秘密鍵をエクスポートする\" style=\"position:relative;\"><a href=\"#rdp%E3%82%B5%E3%83%BC%E3%83%90%E5%81%B4%E3%81%AE%E7%A7%98%E5%AF%86%E9%8D%B5%E3%82%92%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E3%81%99%E3%82%8B\" aria-label=\"rdpサーバ側の秘密鍵をエクスポートする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RDPサーバ側の秘密鍵をエクスポートする</h2>\n<p>次に、RDPサーバ側の証明書をエクスポートします。</p>\n<p>エクスポートには、Mimikatzなどのツールも使えるようですが、今回は参考にしている記事内で使用されていた<a href=\"https://github.com/iSECPartners/jailbreak\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jailbreak</a>をつかってみました。</p>\n<p>Mimikatzで取得する場合は、以下の手順を参照します。</p>\n<p>参考：<a href=\"https://github.com/ypid/FreeRDP-wiki/blob/master/Mimikatz.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">FreeRDP-wiki/Mimikatz.md at master · ypid/FreeRDP-wiki</a></p>\n<p><a href=\"https://github.com/iSECPartners/jailbreak\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jailbreakのリポジトリ</a>からZIPファイルをダウンロードし、バイナリ本体が格納されている<code class=\"language-text\">binaries</code>内<code class=\"language-text\">jailbreak64.exe</code>を管理者権限で起動したコマンドプロンプトから実行します。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">jailbreak64<span class=\"token punctuation\">.</span>exe <span class=\"token operator\">%</span>WINDIR%\\system32\\mmc<span class=\"token punctuation\">.</span>exe <span class=\"token operator\">%</span>WINDIR%\\system32\\certlm<span class=\"token punctuation\">.</span>msc <span class=\"token operator\">-</span>64</code></pre></div>\n<p>実行が完了すると証明書ストアの画面が起動し、[リモートデスクトップ]>[証明書]の中にRDPの証明書が作成されていることが確認できるため、これをエクスポートします。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/43a3f62ccd6055e618e092ede2029af8/0b533/image-25.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAARlAAAEZQAGA43XUAAAB30lEQVQoz3WSS08TYRSGv4U/woVxx8qYuHdr1Ogf0I0Lty6M0XipCQmNF7SWQi1FEUgQF26MC1ea6MYo0QQIRBEqIKVqOzO9zUznwtwev05bNtiTPJkzJ2/e9/vOjDh6/AwHBk4iDp5AHDqFOHwWMXBOch5x5CLi2GXE6VGKqkHk2YSBR79aUlxEYijFYHqaa8PT3EzPcSP9guuZlyRyr7ide00i/4ar+bcUlSZWy6TRaGKaJrpu0LIs/CDA9XyIQrZqFmL1xzqOa+NZJrapy3mwL7nZ1KnUpIFhUC5XpJkemxry3bZtDNmH3i4FRUcsLsxT3P4lhQoVrYaiajLZplZvxL3ruhR2KpTrLSzToFQqoapqbNqrqPtcqzqIlaV51tdWURSVMAz/u5u/VXnCuhn3juPgtpFBURTFBGHH8mOxhfi+8pXSznZs6Pv+nqhNL+CPUqOsNfYF9XR+0NG9X9xAfFv+wuZGAVWr4nnenjBsJ3eFv8tabNqu9iwIO4RdgqCz93eflxFbmz9xbLkf+cWiPlfWanXqTaPv77LbDf7waQExeCdNJveMR9nJmIejEzzIPGEkN0UmP0P26SzJVJ7E/XGGx59z9/Fsh7EZ7o1NkRyZ5Eoyy1BqgguXbvEP6jB7Gs4cHbUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/43a3f62ccd6055e618e092ede2029af8/8ac56/image-25.webp 240w,\n/static/43a3f62ccd6055e618e092ede2029af8/d3be9/image-25.webp 480w,\n/static/43a3f62ccd6055e618e092ede2029af8/b0a15/image-25.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/43a3f62ccd6055e618e092ede2029af8/8ff5a/image-25.png 240w,\n/static/43a3f62ccd6055e618e092ede2029af8/e85cb/image-25.png 480w,\n/static/43a3f62ccd6055e618e092ede2029af8/0b533/image-25.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/43a3f62ccd6055e618e092ede2029af8/0b533/image-25.png\"\n            alt=\"image-25.png\"\n            title=\"image-25.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>エクスポートはこんな感じ。</p>\n<p>パスワードの入力も求められますが、適当なパスワードでOKです。（今回は「test」にしました）</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 625px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f9c6cbe7f20906325e8509187ca90c2c/80d71/image-27.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACM0lEQVQ4y5VUWW/aQBj0//8nldqXvkSV2ko9qZqXJEBKYlIOAwbj28a3Pd1ZvMGJANGVRnv429n5Lmu9/hTjZYj78Qxz00aSV4izAnFaIErzixELmFsPmmW7KPII5moFz3UQBoFEkef43xHGCTSycuRFgaqq5Lqu66MXmqY5irpu5Hfb9aFtHB91VcKytthsNpjOZkiSRCJNU6mUc1mWJ5UpIT96v6AFUbJnt22YpontdiuxXC7lA4Hvy30URWha9a+hHrvtD6DlZSVk1/IVBRrQULmkwtC16aJoCfWnv9CyfL9xHEcqpDLOrusiF+7uY1SfTYb6/qCPBWFRPgeccQvDULgXShe5DkTGsyw7ScZ7VUt4P3ok4T6gdGy328HzPEnii9hxJqiUYSjLQiaIYFV0w8Hx56FDqLJFVxWRLcIQBD48Qd5VzIdJqogOhPqBkIe+UMdsOwKcLcsSGbblIwSz/dr9boxfEHLwwtN4jMVigZmoR13XMZlMMJ8bWIqz6XQq1XaL/KRC2S0iVlRFdaxBrg3DwEq05WJhYL1eI2tb8iJCZpmXDGMuS4ekG7FXbiuCLtlZwjiOpatUxCxTIdckOxQ6XhAfITzUIV1WPUxyZpVlxDNmWbXY80+hnVUvy7LJO3V4yWjOnI0eRackaSb/NlV5DEWLwxltWdRrbwfTjeDFKSLhSVXk6A+G0K5vhrgdjnAzuAy0vb4b4d2n33hz9Q0fenf4+OU7Pn/9ibfvr/APtum5Z88Rke8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f9c6cbe7f20906325e8509187ca90c2c/8ac56/image-27.webp 240w,\n/static/f9c6cbe7f20906325e8509187ca90c2c/d3be9/image-27.webp 480w,\n/static/f9c6cbe7f20906325e8509187ca90c2c/487e2/image-27.webp 625w\"\n              sizes=\"(max-width: 625px) 100vw, 625px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f9c6cbe7f20906325e8509187ca90c2c/8ff5a/image-27.png 240w,\n/static/f9c6cbe7f20906325e8509187ca90c2c/e85cb/image-27.png 480w,\n/static/f9c6cbe7f20906325e8509187ca90c2c/80d71/image-27.png 625w\"\n            sizes=\"(max-width: 625px) 100vw, 625px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f9c6cbe7f20906325e8509187ca90c2c/80d71/image-27.png\"\n            alt=\"image-27.png\"\n            title=\"image-27.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>続いて、取得した証明書から秘密鍵を取得します。</p>\n<p>Windows環境でOpenSSLをインストールする場合は、以下のリンクからインストーラをダウンロードできます。</p>\n<p>参考：<a href=\"https://slproweb.com/products/Win32OpenSSL.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Win32/Win64 OpenSSL Installer for Windows - Shining Light Productions</a></p>\n<p>秘密鍵は以下のコマンドで取得できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">openssl pkcs12 <span class=\"token operator\">-in</span> rdp_key<span class=\"token punctuation\">.</span>pfx <span class=\"token operator\">-</span>nocerts <span class=\"token operator\">-</span>nodes <span class=\"token operator\">-</span>password pass:test <span class=\"token operator\">-</span>out rdp_key<span class=\"token punctuation\">.</span>pem\nopenssl rsa <span class=\"token operator\">-in</span> rdp_key<span class=\"token punctuation\">.</span>pem <span class=\"token operator\">-</span>out rdp_key<span class=\"token punctuation\">.</span>key</code></pre></div>\n<p>手元の環境では、v3.0.0系のOpenSSLの場合は秘密鍵の取得に失敗したため、v1.1.1を使用しました。</p>\n<h2 id=\"rdpパケットをキャプチャしてみる\" style=\"position:relative;\"><a href=\"#rdp%E3%83%91%E3%82%B1%E3%83%83%E3%83%88%E3%82%92%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"rdpパケットをキャプチャしてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RDPパケットをキャプチャしてみる</h2>\n<p>RDPクライアント側のマシンでWireSharkを起動し、パケットのキャプチャを開始しました。</p>\n<p>RDPクライアント側からRDP接続でサーバ側に接続し、ペイントアプリを起動してテキストを書き込むところまでのパケットを取得しました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/21c48037191f2c88e4a5ff6931034e29/0b533/image-51.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAARlAAAEZQAGA43XUAAACu0lEQVQoz12SyU8UQRSH525iRDgpihgPIiHAwat/gSf/AmOMgNGQwMUYl0ggYPTmyUSJSpSIiGwHgyZICMLItMAMyzBLM/swPdPDLMy+fFY3i2glr191vaqvfu+9MijqDr6ggnHDh+wL4fe7UcJh4skUu+kMu6k0SWHZXJ5MriDmGZLC76aLpEU8Jczm8jM5J2GyOjGkkgkSqSyTkh9vKEYsntQ3hcMqgVCIWHLvXzJvIK2s4dpyEZydxheaYcbiZtsTwOzwcexaB013ezFIkkRHZydOp8xOPEFQUVEjKtatIHZ3kLDIYGcnhrTqwLQmEwgE8VqW8QWWsDjdyE4XcRFvan3CxdZuDJMT4xw/UYHVJqONdCZLJpsnVyiRF6bNtXRLJSgKy4tPvgxWWWVZlGnFFsS85qDx1iMu3e7BMDE6SvWZGmSXh6OjVCwKSPHfNUFNpXbJZjKYbX5mJZn5FQ+m5U0dWKcBB4eGOHW6mnWrDUWrWSxGIpEgKWoXjUbJiMPpdFoH5nI54vG4vrYhi0ZaPEgbAZYtdhpuPqSuTVM4MkBlVRWbdifFQgFVjeL1evXDGigSiaAoiq6uXC7rYM1bt8KY1gXMFsK8audyWxcNd0RTxoYHOFtTg8cfPNx8cFAbBXHJXxD7voTNrbK0GRKNibC67uBKey/N7U814DvO1dbi9W/rm4ta9f8DH8wPTFPr9EWxOBTWXVFRLpn6Gw9EyqLL4yODVJysxOX2HhZeIPblHCjdhx+5wB0QoK0Im54YNoeH5pbH1GtN+f51jMamZpHynkLtWRRLZR0l3N6T2edqXosVhHm3Y9j9cZzbKWTxXs9fv8+FFqFwevoHU1PfmJs3Iv1ewrho0m3h16K+NjM7x7xxkZ8LRl58+ELf28/0vflEz+tBuvs/0tM/TNfL91y994yW56/4A6wTQR3ZBewPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/21c48037191f2c88e4a5ff6931034e29/8ac56/image-51.webp 240w,\n/static/21c48037191f2c88e4a5ff6931034e29/d3be9/image-51.webp 480w,\n/static/21c48037191f2c88e4a5ff6931034e29/b0a15/image-51.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/21c48037191f2c88e4a5ff6931034e29/8ff5a/image-51.png 240w,\n/static/21c48037191f2c88e4a5ff6931034e29/e85cb/image-51.png 480w,\n/static/21c48037191f2c88e4a5ff6931034e29/0b533/image-51.png 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/21c48037191f2c88e4a5ff6931034e29/0b533/image-51.png\"\n            alt=\"image-51.png\"\n            title=\"image-51.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>ここでキャプチャしたパケットを復号しようとしたものの、なぜか上手くいきませんでした。</p>\n<p>鍵を変えたりいろいろしてみたものの、結果として上手くいきませんでした。</p>\n<p>それもそのはず、RDP通信時のServer Helloのパケットを確認したところ、どうやら暗号化スイートとしてECDHEを使用しているようでした。（Forward Security無効化できてないじゃん・・・。）</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/98522888f446ae0b51d66d95884cf8d5/2bef9/image-52-1024x676.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAARlAAAEZQAGA43XUAAABq0lEQVQ4y5WT626jMBCFef9n689dVWq6MeZuQ4IN2IRLOJ0xatVIpcqOdBQyxJ/meE6ivFTQqkJVlWivVwxDD+cGjN7Dexf0/flIfMZag2gYhgDKshTGGFwuF8zzjIfaNjxT4zgics7DWIt/IsH7OYZMc6i6QalqFJVGpZsg0zvMd2Betx+10Dvnb4g8AZvW4s9J4u8pxlucIy7qoKS8INMGynjU3Q32tqGbSLdHcb8nU/pq2bIny3QwTZAmCRTdp2lbrOuC/y1LTiNrLEpd4/VdoGkaAmooreHpPsZpwbysBF+xLAtpPdCC9X7H4ByiRJxxIpsvrzGKPENRlkho0jzPyUKPbqAt0g9/hy64E7Dve0RnEQe7iaSFSBlAQgikaUZbb1EWBa6Ugmeq6zpEUibhUJqmAVbwM01YVVX4zn2O056e7VBc3o8MlGRRQpzFl1XuMYgz2nU25OsZYMghQ/ap9gmVUgHGPd6aJeBn0LeDgD8AsyxDSYvI82IHVipY5h5b5SmnaToEfu+NIwWbJ+JJ+LAxn5+7rO3CRfM/yR6op/eZaiALDU1x+wBA4eeBST4vvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/98522888f446ae0b51d66d95884cf8d5/8ac56/image-52-1024x676.webp 240w,\n/static/98522888f446ae0b51d66d95884cf8d5/d3be9/image-52-1024x676.webp 480w,\n/static/98522888f446ae0b51d66d95884cf8d5/e46b2/image-52-1024x676.webp 960w,\n/static/98522888f446ae0b51d66d95884cf8d5/a9a89/image-52-1024x676.webp 1024w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/98522888f446ae0b51d66d95884cf8d5/8ff5a/image-52-1024x676.png 240w,\n/static/98522888f446ae0b51d66d95884cf8d5/e85cb/image-52-1024x676.png 480w,\n/static/98522888f446ae0b51d66d95884cf8d5/d9199/image-52-1024x676.png 960w,\n/static/98522888f446ae0b51d66d95884cf8d5/2bef9/image-52-1024x676.png 1024w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/98522888f446ae0b51d66d95884cf8d5/d9199/image-52-1024x676.png\"\n            alt=\"image-52-1024x676.png\"\n            title=\"image-52-1024x676.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>どうやら<code class=\"language-text\">gpupdate /force</code>だけでは不十分だったようで、OSの再起動を実施しました。</p>\n<p>その後再度パケットキャプチャを取得したところ、無事に<code class=\"language-text\">TLS_RSA_WITH_AES_128_CBC_SHA256</code>による暗号化スイートを使用したRDP通信のパケットを取得することができました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 806px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/56e61e00a8bf3971077c9b384915679c/764be/image-53.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.41666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACy0lEQVQ4y5VUy3LTQBDMz3KAoqDgJzjzJan4D8iRShFCEmzJsqznSlpJ1tOyLDluZsaOScgluKprdmVt70xPj87MoITWGXSWIy9KrIoKXT9gsx3REzbbAd1m+2qcFXWLbd/Dtm24roskSVAUBfI8R5qmaJoGu3HE+EoQ4Rr801rDXi6FpKoqIVytVui6Df7n94zQdT0opaBCBYfIM5Kh6zo0dSOXMMqyRF3XKFaFrJu2lfP7/V5wIsyyDJ7nIfB9zOdzLBYLRFFMiOQS3/Ph03+853c5AZ1oiXzpI6loKIRU6pKyCsMQLhFzVCqisg+ZMFiOmrJ9qtkwDBJPGZbNgZ01Y0JuCkdNh8uqlKYw+OCrNNQ5HSJNuMNcpnOMpnkoOwgCKZk7/1fHYzxqynsGl35mLT0YhiEEpmnBJP2mM9rPLcrUwcyY0/8mRVMuS0izOE7g00W85sq4eRlFluPMDRQJrajEDLEKEAUuNO2zJEKuY4Qe7ZUPHSvUlBH2O5YfY99i//DwsmTbZRIPeRLi6reLayPAjRUJbu0E3+8dXJshfloJUpInWTW4c3PMwgrNZhTyh2NDpClzy8LV1MXXyxafJzU+Tlp8uGgpbvD+osOnCa/XeHfe4nKxxZdvI96c93g72eGH2ktWzwgdMvOvuY+L6xy3hkOw8dvyMV34MB2Fm6mNGa0NO4ATl7DyPcr1AC8pse6Hk/9OJTs+6ReFqLKIzOuKjqlOSDMycJrAc52DtioUN2DXY93WqIoc4zA8mxLJcOmFCKljPjXHpq56YmolduFu8jOekCAIxdgpNY+nhd3AXX1BaHsBAsqMvbagL45H1uDDB5JAxtDzDs/Y9Hd39/KuQdaqqvpll4NIU4la5jOmA5rK5UxkVilylrLWqZg7jmPZxzTnBZl6vV6jpQ/EI2hSeAIOs1odZ/YpqtM0EI7TIms6wxf8iz+oEUn7E7QLqQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/56e61e00a8bf3971077c9b384915679c/8ac56/image-53.webp 240w,\n/static/56e61e00a8bf3971077c9b384915679c/d3be9/image-53.webp 480w,\n/static/56e61e00a8bf3971077c9b384915679c/e94a4/image-53.webp 806w\"\n              sizes=\"(max-width: 806px) 100vw, 806px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/56e61e00a8bf3971077c9b384915679c/8ff5a/image-53.png 240w,\n/static/56e61e00a8bf3971077c9b384915679c/e85cb/image-53.png 480w,\n/static/56e61e00a8bf3971077c9b384915679c/764be/image-53.png 806w\"\n            sizes=\"(max-width: 806px) 100vw, 806px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/56e61e00a8bf3971077c9b384915679c/764be/image-53.png\"\n            alt=\"image-53.png\"\n            title=\"image-53.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"秘密鍵でパケットキャプチャを復号する\" style=\"position:relative;\"><a href=\"#%E7%A7%98%E5%AF%86%E9%8D%B5%E3%81%A7%E3%83%91%E3%82%B1%E3%83%83%E3%83%88%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E3%82%92%E5%BE%A9%E5%8F%B7%E3%81%99%E3%82%8B\" aria-label=\"秘密鍵でパケットキャプチャを復号する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>秘密鍵でパケットキャプチャを復号する</h2>\n<p>ようやくここまでたどり着きました。</p>\n<p>最後に、取得したパケットキャプチャを復号します。</p>\n<p>取得したpcapファイルをWireSharkで開き、ツールバーの[編集]タブから[設定]を開きます。</p>\n<p>続いて、左側のツリーのプロトコル一覧から、[TLS]を選択し、設定を開きます。</p>\n<p>最後に、[RSA keys list]の編集から、以下の設定を入力します。</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">IP address : <span class=\"token string\">\"RDPサーバ側のIPアドレス\"</span>\nPort : <span class=\"token string\">\"RDP接続先のポート（3389）\"</span>\nProtocol : <span class=\"token string\">\"tpkt\"</span>\nKey File : <span class=\"token string\">\"証明書から抽出したRSAキーファイル\"</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/40cd4cdf31407c57b1719d35c42945d3/e4900/image-54.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYklEQVQ4y42UCXPaQAyF/f9/WdppaCgYsCH4vs/1hW0Ir5IgNJ1pJ2HmDbv2+tNbrbRalCiURQXVNBj6HsMwYBxHnE4juuEk837oaX56aJ7nf+o8naE9HxYwQxdlqaCUQtd1aAjO45rU34N8pnmcYWUWtPU2QFHWKIpCXFZVhdVqBV3XRTz/TCVJqRq2G0GzrQl51hIwx2mc0LYtbNtGmqbkupRALB67rgvf98U9g+q6FlVVTWYqBJ6C5tgTirylFxXl4SwLNpsNDMPAbrfDdruVOYsDMfgG+eiSgIqAwTuw6Ohhicvbm+RP19fY7/fwPA9RFIlbVp7nD+BHMbRpaMt2/geYpgkpo3yWCMIISZIgjuO/ALxlluTtng7+fzj0FedwJJCS6I1qEKc5jk5I80zcvgP59Luul1OXCqBn/J53UFe1OHScgoDkMM9vhzJQ3TEoSHI4VJ92QovSBlZUwcuah/yiR9zMSLsLPD8QIDv0vfrmMKNFDGrJAW97miZ85fdGOWeH7JgdPg4lCHKJwCXDeRvHG/B6vf5X78DD64G+Dwjsw+Utu86Ml2WAlxcHplngefH6cPg58ALTCHB8VbCOioAnBp7x4znE03cXe3PA07ej9OWXtny9EKRBEgHxXQTssNYjrNYUiaIsfzlyoiO55IuALwp2fL5fANN0l4xHHA4RbKuFY9+kWbaF5XIJfaNLDy8WP6UGOS9cc0kSI81rrIwCOyOjDkqp6HORYcSkvazzPF/aUgvDUC4B7gzTNEimwPglKwh8qksPi80R+nZP7WhSO/K6A323lbV8mHzSrN+Q7bdKgEjsvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/40cd4cdf31407c57b1719d35c42945d3/8ac56/image-54.webp 240w,\n/static/40cd4cdf31407c57b1719d35c42945d3/d3be9/image-54.webp 480w,\n/static/40cd4cdf31407c57b1719d35c42945d3/e46b2/image-54.webp 960w,\n/static/40cd4cdf31407c57b1719d35c42945d3/6257a/image-54.webp 988w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/40cd4cdf31407c57b1719d35c42945d3/8ff5a/image-54.png 240w,\n/static/40cd4cdf31407c57b1719d35c42945d3/e85cb/image-54.png 480w,\n/static/40cd4cdf31407c57b1719d35c42945d3/d9199/image-54.png 960w,\n/static/40cd4cdf31407c57b1719d35c42945d3/e4900/image-54.png 988w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/40cd4cdf31407c57b1719d35c42945d3/d9199/image-54.png\"\n            alt=\"image-54.png\"\n            title=\"image-54.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>この設定を反映すると、RDPのパケットが複合され、フィルタリングできるようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/becc0450d554fcca3509abafeac03bef/3dde1/image-55.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.16666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFklEQVQ4y3WT6XbaQAyF/f6v1aZJMNhjvIDxvrM6LFkKtNzeGcdAzkl/6EjWSJ/uaI61MIsQZhMENCfykdT8Ln24aQQvCeEGDoI8QrNpUK0rLLcLtK8tNofNF1sf1so0t57BrAXspUvvQDQ2vM0U7trHUzKENSdwFylvLzwYlQV3NcG0ncF/CT4tVDXSND8BHgZLPBktLO8dPxkLej+64Mdzg4HYYhYDOr3jn/CgL/E4WqvYC//ApneDM28JRDQtiI/4pRd4HFZw/T3jEsJtESRH5kqClggZm/aaQz5U3cBsIJyuJquAnJaVQFpcoFXFGYZRwTBrROEBw1EJ39+iyE/Ml7DGC5SMVS47YsScEDVMs4LjrNjziiR+Q0yrq7/Q8vysYMKaIwgIJHw63SLPTmyuCFwiJ3AyfUGaHqFzoCkaNWhEqOu1cN0NvAnPk98EslGqEtaCwL1qmPCwz0tgwaFySEagzPUCDIJ9f4eQNwuptKouN+CIRb3Ce+DYXqHkWmROAeWVCZMqbV45ST4QRW+qN02pMMu6qbJAAXuF+Vdgr9CQD0Kgrna9w2IOzJvOmhod8LbD/fc7zOQOe2CNMffXPd4ec0JqXrU3LaVk43PJCsjCG7Df4alTKIeLO4WzvVLWw5TCOH5XRaa4KfT+s8OcQFlnXRXurkAJuwLl88upM07UhwWBrQLKWCq8B3bD+Qfx7DvgP2l8rX2/PckQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/becc0450d554fcca3509abafeac03bef/8ac56/image-55.webp 240w,\n/static/becc0450d554fcca3509abafeac03bef/d3be9/image-55.webp 480w,\n/static/becc0450d554fcca3509abafeac03bef/e46b2/image-55.webp 960w,\n/static/becc0450d554fcca3509abafeac03bef/5304f/image-55.webp 1018w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/becc0450d554fcca3509abafeac03bef/8ff5a/image-55.png 240w,\n/static/becc0450d554fcca3509abafeac03bef/e85cb/image-55.png 480w,\n/static/becc0450d554fcca3509abafeac03bef/d9199/image-55.png 960w,\n/static/becc0450d554fcca3509abafeac03bef/3dde1/image-55.png 1018w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/becc0450d554fcca3509abafeac03bef/d9199/image-55.png\"\n            alt=\"image-55.png\"\n            title=\"image-55.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>お疲れ様でした！！</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>基本的には、<a href=\"https://unit42.paloaltonetworks.jp/wireshark-tutorial-decrypting-rdp-traffic/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Wiresharkによるパケット解析講座 11: RDPトラフィックの復号</a>の記事の手順に沿って進めてみましたが、一部の手順が記事通りに上手く再現できなかったので少し手間取りました。</p>\n<p>結果として、WireSharkやWindowsの暗号化スイートについて勉強になったのでやってみてよかったかなとは思ってます。</p>\n<p>気が向いたらRDPプロトコルの詳細についても記事を書こうと思ってます。</p>\n<p>ただ、いまいちこの500ページくらいのリファレンスを読むモチベが湧いてこないので、ほんとに気が向いたときになると思います。</p>\n<p>参考：<a href=\"https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rdpbcgr/5073f4ed-1e93-45e1-b039-6e30c385867c\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[MS-RDPBCGR]: Remote Desktop Protocol: Basic Connectivity and Graphics Remoting | Microsoft Docs</a></p>","fields":{"slug":"/wireshark-decrypt-rdppacket","tagSlugs":["/tag/wire-shark/","/tag/windows/","/tag/network/"]},"frontmatter":{"date":"2021-10-19","description":"WireSharkでRDPパケットのキャプチャを行って復号する方法について紹介します。","tags":["WireShark","Windows","Network"],"title":"Forward Securityを削除して、WireSharkでRDPのパケットを復号する","socialImage":{"publicURL":"/static/dc4d8b7f8795f3c3d3489d9957d155f2/no-image.png"}}}},"pageContext":{"slug":"/wireshark-decrypt-rdppacket"}},"staticQueryHashes":["251939775","401334301","825871152"]}