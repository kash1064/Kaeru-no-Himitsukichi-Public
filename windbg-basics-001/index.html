<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e71379dda153709d1a9a.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.625rem;margin:.3125rem 0;border:1px solid #999;border-radius:.3125rem}.Sidebar-module--search-container--17C6F{position:relative}.Sidebar-module--search-container-input--27Tw4{width:100%}.Sidebar-module--search-container-submit--WwtLg{position:absolute;width:2.375rem;height:2.375rem;top:calc(50% - 19px);right:0;border:3px solid #999;border-radius:0 .25rem .25rem 0;background:#999}.Sidebar-module--search-container-submit--WwtLg:before{position:absolute;content:"";width:.9375rem;height:.9375rem;top:calc(50% - 9px);left:calc(50% - 9px);border-radius:50%;box-shadow:0 0 0 2px #fff}.Sidebar-module--search-container-submit--WwtLg:after{position:absolute;content:"";width:.5rem;height:.375rem;top:calc(50% + 6px);left:calc(50% + 2px);border-top:2px solid #fff;transform:rotate(45deg)}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">WinDbg でダンプ解析、ライブデバッグを行う時のチートシート - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content="個人的によく使う WinDbg コマンドなどをまとめたチートシートです。内容については今後追加していく予定です。"/><meta data-react-helmet="true" property="og:site_name" content="WinDbg でダンプ解析、ライブデバッグを行う時のチートシート - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/b0fbf9e03e8ff058d29fe4543b9d3f45/windbg-basics-001.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="WinDbg でダンプ解析、ライブデバッグを行う時のチートシート - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content="個人的によく使う WinDbg コマンドなどをまとめたチートシートです。内容については今後追加していく予定です。"/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/b0fbf9e03e8ff058d29fe4543b9d3f45/windbg-basics-001.png"/><link as="script" rel="preload" href="/webpack-runtime-4718dad6a25a617d234f.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-c30b476365ba6fe21041.js"/><link as="script" rel="preload" href="/app-313d4424c06143b3718b.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/windbg-basics-001/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">WinDbg でダンプ解析、ライブデバッグを行う時のチートシート</h1><div class="Content-module--content__body--2TrQ-"><p>個人的によく使う WinDbg コマンドなどをまとめたチートシートです。</p>
<p>内容については今後追加していく予定です。</p>
<!-- omit in toc -->
<h2 id="もくじ" style="position:relative;"><a href="#%E3%82%82%E3%81%8F%E3%81%98" aria-label="もくじ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>もくじ</h2>
<ul>
<li><a href="#%E3%81%BE%E3%81%88%E3%81%8C%E3%81%8D">まえがき</a></li>
<li><a href="#%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%86%E3%83%AA%E3%83%B3%E3%82%AF%E9%9B%86">よく使うリンク集</a></li>
<li><a href="#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E4%B8%80%E8%A6%A7%E3%81%AE%E6%93%8D%E4%BD%9C%E6%83%85%E5%A0%B1%E5%8F%96%E5%BE%97">モジュール一覧の操作、情報取得</a></li>
<li><a href="#%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E3%81%AE%E5%8F%82%E7%85%A7%E3%81%A8%E6%93%8D%E4%BD%9C">レジスタの参照と操作</a></li>
<li><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%A2%E3%83%BC%E3%83%89%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89">ユーザモードスレッド</a></li>
<li><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%A2%E3%83%BC%E3%83%89%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9">ユーザモードプロセス</a></li>
<li><a href="#%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E3%83%90%E3%83%83%E3%82%AF%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9%E3%81%A8%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E8%A1%A8%E7%A4%BA">スタックバックトレースとフレームの表示</a></li>
<li><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E5%8F%82%E7%85%A7%E3%81%A8%E7%B7%A8%E9%9B%86">メモリの参照と編集</a></li>
<li><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E5%86%85%E3%81%AE%E6%A4%9C%E7%B4%A2">メモリ内の検索</a></li>
<li><a href="#%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E5%87%BA%E5%8A%9B">アセンブリコードの出力</a></li>
<li><a href="#%E5%A4%89%E6%95%B0%E3%81%A8%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%AE%E5%87%BA%E5%8A%9B">変数と構造体の出力</a></li>
<li>
<p><a href="#%E3%83%96%E3%83%AC%E3%83%BC%E3%82%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A">ブレークポイントの設定</a></p>
<ul>
<li><a href="#%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%92%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8B">読み取り、書き込みアクセスを監視する</a></li>
<li><a href="#%E3%83%96%E3%83%AC%E3%83%BC%E3%82%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E8%A8%AD%E5%AE%9A%E3%81%AE%E7%AE%A1%E7%90%86">ブレークポイント設定の管理</a></li>
</ul>
</li>
<li>
<p><a href="#%E3%82%B3%E3%83%BC%E3%83%89%E5%AE%9F%E8%A1%8C%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">コード実行コマンド</a></p>
<ul>
<li><a href="#step-overp">Step Over(p)</a></li>
<li><a href="#step-intot">Step Into(t)</a></li>
<li><a href="#gog">go(g)</a></li>
</ul>
</li>
<li><a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%87%BA%E5%8A%9B%E3%82%92%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B">コマンド出力をファイルに保存する</a></li>
<li>
<p><a href="#%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD">拡張機能</a></p>
<ul>
<li><a href="#help%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%81%AE%E3%83%98%E3%83%AB%E3%83%97">!help：拡張機能のヘルプ</a></li>
<li><a href="#analyze%E4%BE%8B%E5%A4%96%E3%82%84%E3%83%90%E3%82%B0%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%96%E5%BE%97">!analyze：例外やバグチェックに関する情報の取得</a></li>
<li><a href="#address%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%84%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%82%E7%85%A7">!address：メモリやプロセスに関する情報の参照</a></li>
<li><a href="#handle%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%BE%E3%81%9F%E3%81%AF%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AB%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%82%E7%85%A7">!handle：システムまたはプロセスのハンドル情報の参照</a></li>
<li><a href="#%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E7%92%B0%E5%A2%83%E3%83%96%E3%83%AD%E3%83%83%E3%82%AFteb%E3%81%AE%E6%83%85%E5%A0%B1%E5%8F%96%E5%BE%97">スレッド環境ブロック(TEB)の情報取得</a></li>
<li><a href="#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E7%92%B0%E5%A2%83%E3%83%96%E3%83%AD%E3%83%83%E3%82%AFpeb%E3%81%AE%E6%83%85%E5%A0%B1%E5%8F%96%E5%BE%97">プロセス環境ブロック(PEB)の情報取得</a></li>
</ul>
</li>
<li><a href="#config-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">Config コマンド</a></li>
<li>
<p><a href="#%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%95%E3%83%AB%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E8%A7%A3%E6%9E%90">カーネルデバッグ、フルダンプの解析</a></p>
<ul>
<li><a href="#%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%87%E3%83%90%E3%83%83%E3%82%AC%E3%81%AE%E6%8E%A5%E7%B6%9Ahyper-vvirtualbox">カーネルデバッガの接続(Hyper-V、VirtualBox)</a></li>
<li><a href="#%E3%83%95%E3%83%AB%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E5%8F%96%E5%BE%97%E8%A8%AD%E5%AE%9A">フルメモリダンプの取得設定</a></li>
<li><a href="#%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%88%97%E6%8C%99%E3%81%99%E3%82%8B">カーネル構造体の情報を列挙する</a></li>
<li><a href="#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E6%83%85%E5%A0%B1%E3%82%92%E5%88%97%E6%8C%99%E3%81%99%E3%82%8B">プロセス情報を列挙する</a></li>
<li><a href="#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AB%E6%83%85%E5%A0%B1%E3%82%92%E5%88%97%E6%8C%99%E3%81%99%E3%82%8B">プロセスのハンドル情報を列挙する</a></li>
<li><a href="#kpcr-%E3%81%A8-kprcb-%E3%82%92%E5%8F%82%E7%85%A7%E3%81%97%E3%81%A6-cpu-%E3%81%AE%E7%B5%B1%E8%A8%88%E6%83%85%E5%A0%B1%E3%82%92%E8%AA%AD%E3%82%80">KPCR と KPRCB を参照して CPU の統計情報を読む</a></li>
</ul>
</li>
<li><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">その他のコマンド</a></li>
<li>
<p><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%BF%E7%94%A8">スクリプトファイルの使用</a></p>
<ul>
<li><a href="#%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90">条件分岐</a></li>
<li><a href="#%E3%83%AB%E3%83%BC%E3%83%97%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">ループコマンド</a></li>
<li><a href="#%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B">ブロックを作成する</a></li>
<li><a href="#%E3%82%A8%E3%82%A4%E3%83%AA%E3%82%A2%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B">エイリアスを作成、削除する</a></li>
<li><a href="#%E7%96%91%E4%BC%BC%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">疑似レジスタを使用する</a></li>
<li><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB">スクリプトサンプル</a></li>
</ul>
</li>
<li>
<p><a href="#%E8%A7%A3%E6%9E%90%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E7%9F%A5%E8%AD%98">解析に必要な知識</a></p>
<ul>
<li><a href="#32bit-%E3%81%A8-64bit-%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E8%A6%8F%E7%B4%84%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B">32bit と 64bit の呼び出し規約を理解する</a></li>
<li><a href="#ntglobalflag">NTGLOBALFLAG</a></li>
<li><a href="#exception_record">EXCEPTION_RECORD</a></li>
<li><a href="#eprocessethread">EPROCESS、ETHREAD</a></li>
<li><a href="#sysenter-%E5%91%BD%E4%BB%A4">sysenter 命令</a></li>
</ul>
</li>
<li>
<p><a href="#%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A">環境設定</a></p>
<ul>
<li><a href="#visual-studio-%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AB%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B">Visual Studio のリンカ設定を変更する</a></li>
<li><a href="#release-%E3%83%93%E3%83%AB%E3%83%89%E6%99%82%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96%E3%82%92%E7%84%A1%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B">Release ビルド時の最適化を無効化する</a></li>
</ul>
</li>
<li>
<p><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE-tips">その他の Tips</a></p>
<ul>
<li><a href="#windbgx86-%E3%81%A8-windbgx64-%E3%81%A9%E3%81%A1%E3%82%89%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%81%B9%E3%81%8D%E3%81%A7%E3%81%99%E3%81%8B">WinDbg(X86) と WinDbg(X64) どちらを使用すべきですか？</a></li>
<li><a href="#windbgclassic-%E3%81%A7%E3%83%80%E3%83%BC%E3%82%AF%E3%83%86%E3%83%BC%E3%83%9E%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">WinDbg(Classic) でダークテーマを使用する</a></li>
</ul>
</li>
</ul>
<h2 id="まえがき" style="position:relative;"><a href="#%E3%81%BE%E3%81%88%E3%81%8C%E3%81%8D" aria-label="まえがき permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>まえがき</h2>
<p>本記事の内容はすべて一般に公開されている情報や、出版された書籍、または個人の検証環境で動作確認を実施した結果のみを元に作成しています。</p>
<h2 id="よく使うリンク集" style="position:relative;"><a href="#%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%86%E3%83%AA%E3%83%B3%E3%82%AF%E9%9B%86" aria-label="よく使うリンク集 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>よく使うリンク集</h2>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/debugging-resources" target="_blank" rel="nofollow noopener noreferrer">Debugging Resources - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/commands" target="_blank" rel="nofollow noopener noreferrer">Commands - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://www.google.com/search?q=site%3Ahttps%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fwindows-hardware%2Fdrivers%2Fdebugger%20" target="_blank" rel="nofollow noopener noreferrer">Docs 検索用リンク</a></p>
<p>参考：<a href="https://degiuli.github.io/WinDBG/Intro.html" target="_blank" rel="nofollow noopener noreferrer">WinDBG</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/windbg-release-notes" target="_blank" rel="nofollow noopener noreferrer">WinDbg Release notes - Windows drivers | Microsoft Learn</a></p>
<p>参考：<del><a href="http://windbg.info/download/doc/pdf/WinDbg_A_to_Z_color_JP.pdf" target="_blank" rel="nofollow noopener noreferrer">WinDbg<em>A</em>to_Z(リンク切れ)</a></del></p>
<h2 id="モジュール一覧の操作情報取得" style="position:relative;"><a href="#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E4%B8%80%E8%A6%A7%E3%81%AE%E6%93%8D%E4%BD%9C%E6%83%85%E5%A0%B1%E5%8F%96%E5%BE%97" aria-label="モジュール一覧の操作情報取得 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>モジュール一覧の操作、情報取得</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># モジュールの列挙</span>
lm

<span class="token comment"># a から始まるモジュールの列挙</span>
lm m a*

<span class="token comment"># モジュール情報の表示、タイムスタンプなども表示できる</span>
<span class="token comment"># !lmi でも、モジュールの詳細情報を取得できる</span>
lm Dvm <span class="token operator">&lt;</span>modulename<span class="token operator">></span>

<span class="token comment"># シンボルからモジュールの main 関数のアドレスを解決</span>
x modulename<span class="token operator">!</span>*main*

<span class="token comment"># a から始まる関数名の列挙</span>
x /D /f modulename<span class="token operator">!</span>a*

<span class="token comment"># アドレスからシンボル名を解決</span>
<span class="token function">ln</span> address</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/lm--list-loaded-modules-" target="_blank" rel="nofollow noopener noreferrer">lm (List Loaded Modules) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/x--examine-symbols-" target="_blank" rel="nofollow noopener noreferrer">x (Examine Symbols) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/ln--list-nearest-symbols-" target="_blank" rel="nofollow noopener noreferrer">ln (List Nearest Symbols) - Windows drivers | Microsoft Learn</a></p>
<h2 id="レジスタの参照と操作" style="position:relative;"><a href="#%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E3%81%AE%E5%8F%82%E7%85%A7%E3%81%A8%E6%93%8D%E4%BD%9C" aria-label="レジスタの参照と操作 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>レジスタの参照と操作</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># レジスタの一覧表示</span>
r

<span class="token comment"># 特定レジスタ、複数レジスタの表示</span>
r eip
r zf
r eax,ebx,ecx,edx,ebp,eip

<span class="token comment"># レジスタの値の書き換え</span>
r <span class="token assign-left variable">eax</span><span class="token operator">=</span>00000001
r <span class="token assign-left variable">zf</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token comment"># 2 番目のスレッドに割り当てられているレジスタの表示</span>
<span class="token comment"># または、~1s などで現在のスレッドを切り替えてから出力する</span>
~1 r

<span class="token comment"># すべてのスレッドに関連づけられているレジスタの表示</span>
~* r eax

<span class="token comment"># xmm0 を符号なし 16 バイトとして表示</span>
<span class="token comment"># xmm1 は倍精度浮動小数点形式で表示</span>
r xmm0:16ub, xmm1:d

<span class="token comment"># 疑似レジスタの表示</span>
r <span class="token variable">$peb</span>,<span class="token variable">$teb</span>

<span class="token comment"># eax に ebx の値をコピー</span>
r eax <span class="token operator">=</span> @ebx</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/r--registers-" target="_blank" rel="nofollow noopener noreferrer">r (Registers) - Windows drivers | Microsoft Learn</a></p>
<h2 id="ユーザモードスレッド" style="position:relative;"><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%A2%E3%83%BC%E3%83%89%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89" aria-label="ユーザモードスレッド permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ユーザモードスレッド</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ユーザモードデバッグもしくはプロセスダンプの解析にて、すべてのスレッドのコールスタックをダンプ</span>
~*k

<span class="token comment"># TEB の情報をダンプ</span>
<span class="token operator">!</span>teb

<span class="token comment"># ！teb で特定した TEB のアドレスを使用して構造体を出力</span>
dt ntdll<span class="token operator">!</span>_TEB <span class="token operator">&lt;</span>TEB のアドレス<span class="token operator">></span></code></pre></div>
<h2 id="ユーザモードプロセス" style="position:relative;"><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%A2%E3%83%BC%E3%83%89%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9" aria-label="ユーザモードプロセス permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ユーザモードプロセス</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># PEB の情報をダンプ</span>
<span class="token operator">!</span>peb

<span class="token comment"># ！peb で特定した PEB のアドレスを使用して構造体を出力</span>
dt ntdll<span class="token operator">!</span>_PEB <span class="token operator">&lt;</span>PEB のアドレス<span class="token operator">></span></code></pre></div>
<h2 id="スタックバックトレースとフレームの表示" style="position:relative;"><a href="#%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E3%83%90%E3%83%83%E3%82%AF%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9%E3%81%A8%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E8%A1%A8%E7%A4%BA" aria-label="スタックバックトレースとフレームの表示 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>スタックバックトレースとフレームの表示</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># スタックバックトレースの表示(先頭の数字はフレーム番号)</span>
<span class="token comment"># フレーム番号(n)、フレームポインタ(v)、フレームが使用しているメモリサイズ(f)を含めて表示させる</span>
kvnf

<span class="token comment"># すべてのスレッドのスタックバックトレースの表示</span>
~*kvnf

<span class="token comment"># 特定のスレッドのスタックバックトレースのみ表示</span>
~1kvnf

<span class="token comment"># 現在のプロセスのすべてのスレッドのコールスタックを表示</span>
<span class="token operator">!</span>uniqstack</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/k--kb--kc--kd--kp--kp--kv--display-stack-backtrace-" target="_blank" rel="nofollow noopener noreferrer">k, kb, kc, kd, kp, kP, kv (Display Stack Backtrace) - Windows drivers | Microsoft Learn</a></p>
<p><code class="language-text">kvn</code>コマンドなどを実行してスタックトレースの<code class="language-text">ChildEBP</code>(保存された EBP)や<code class="language-text">RetAddr</code>、<code class="language-text">Args to Child</code>を取得できますが、これは基本的にスタック内の情報を参照しています。</p>
<p>そのため、64bit バイナリの呼び出し規約では有効な値を含まないため注意が必要です。</p>
<p>参考：<a href="https://learn.microsoft.com/en-us/cpp/build/x64-calling-convention?view=msvc-170" target="_blank" rel="nofollow noopener noreferrer">x64 calling convention | Microsoft Learn</a></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># フレーム番号を指定してローカル変数を表示</span>
<span class="token comment"># /t は変数の型、/V はローカル変数の相対アドレスを含めて表示するオプション</span>
.frame 01<span class="token punctuation">;</span>dv
.frame 01<span class="token punctuation">;</span>dv /t /V</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/dv--display-local-variables-" target="_blank" rel="nofollow noopener noreferrer">dv (Display Local Variables) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-frame--set-local-context-" target="_blank" rel="nofollow noopener noreferrer">.frame (Set Local Context) - Windows drivers | Microsoft Learn</a></p>
<h2 id="メモリの参照と編集" style="position:relative;"><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E5%8F%82%E7%85%A7%E3%81%A8%E7%B7%A8%E9%9B%86" aria-label="メモリの参照と編集 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>メモリの参照と編集</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># メモリアドレスの範囲またはオフセットを指定してメモリ内の Hex と ASCII を出力</span>
<span class="token function">dc</span> 0x1000 0x1200

<span class="token comment"># L はオブジェクトカウントを指す</span>
<span class="token comment"># dc @addr L1 は DWORD 1 つ分、dq @addr L1 は QWORD 1 つ分</span>
<span class="token function">dc</span> @eip L1
<span class="token function">dc</span> 0x1000 L20

<span class="token comment"># アドレス単体や、アドレス値を持つレジスタを参照することも可能</span>
<span class="token function">dc</span> 0x1000
<span class="token function">dc</span> eax

<span class="token comment"># ポインタサイズの値を取得できる</span>
dps 0x1000
dqs 0x1000

<span class="token comment"># 32bit(ddp)、64bit(dqp)でメモリを表示</span>
ddp 0x1000
dqp 0x1000

<span class="token comment"># ASCII 文字列で表示</span>
da 0x1000

<span class="token comment"># バイト値の書き換え</span>
eb 0x1000 

<span class="token comment"># ASCII 文字列の書き換え</span>
ea 0x1000 <span class="token string">"change ascii"</span></code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/d--da--db--dc--dd--dd--df--dp--dq--du--dw--dw--dyb--dyd--display-memor" target="_blank" rel="nofollow noopener noreferrer">d, da, db, dc, dd, dD, df, dp, dq, du, dw (Display Memory) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/dda--ddp--ddu--dpa--dpp--dpu--dqa--dqp--dqu--display-referenced-memory" target="_blank" rel="nofollow noopener noreferrer">dda, ddp, ddu, dpa, dpp, dpu, dqa, dqp, dqu (Display Referenced Memory) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/dds--dps--dqs--display-words-and-symbols-" target="_blank" rel="nofollow noopener noreferrer">dds, dps, dqs (Display Words and Symbols) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/e--ea--eb--ed--ed--ef--ep--eq--eu--ew--eza--ezu--enter-values-" target="_blank" rel="nofollow noopener noreferrer">e, ea, eb, ed, eD, ef, ep, eq, eu, ew, eza (Enter Values) - Windows drivers | Microsoft Learn</a></p>
<h2 id="メモリ内の検索" style="position:relative;"><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E5%86%85%E3%81%AE%E6%A4%9C%E7%B4%A2" aria-label="メモリ内の検索 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>メモリ内の検索</h2>
<p>基本的なメモリ内の探索は以下のコマンドで実現できます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># RSP のアドレスから 1000000 バイトの範囲で DWORD 値 H を検索する</span>
s -d @rsp L1000000 <span class="token string">'H'</span>

<span class="token comment"># RSP のアドレスから 1000000 バイトの範囲で ASCII 文字列 Hello を検索する</span>
s -a @rsp L10000000 <span class="token string">"Hello"</span>  

<span class="token comment"># 0 から 0x7fffffff までの広い範囲で ASCII 文字列 Hello を検索する</span>
<span class="token comment"># 256 MB 以上の大きな範囲を検索する場合は、 L? の指定が必ず必要になる</span>
s -a <span class="token number">0</span> L?7fffffff <span class="token string">"Hello"</span>

<span class="token comment"># ASCII と同様に、Unicord 文字列も検索することができる</span>
s -u @rsp L1000000 <span class="token string">'Hello'</span>
s -u <span class="token number">0</span> L?7fffffff <span class="token string">"Hello"</span></code></pre></div>
<p>以下は、ASCII 文字列と Unicord 文字列をそれぞれ検索した場合の差分を確認した結果です。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 698px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/742a93bd4df2cc77104334db0c2392ce/487bb/image-20230401234723850.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 24.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVQY0z2QWQqAMAxEvf/BBAUVcd93cRdR/HRkAloYkrTN5BHFsizkeS5KkgRVVaFpGqnHccS+71iWBdu2YV1XEXPe8a3rOkzThGEYcN83FE3T4Ps+HMdBEASo61pEw7Zt5SOHlGUp4htrRg4mEHsNw8BxHFCYkCyOY4lpmkr+mdOQ6vv+p/mIz/OUmmTP84gUXdfheR5s2xbDoigQhqGYfpH3zDmE5CSkOY1JfV0XeMRQVVVBNk1Tmkjouq40cxVRFP3mrLMs+/c8z7MAkPQzfAH8ImvrJ/lMfgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/742a93bd4df2cc77104334db0c2392ce/8ac56/image-20230401234723850.webp 240w,
/static/742a93bd4df2cc77104334db0c2392ce/d3be9/image-20230401234723850.webp 480w,
/static/742a93bd4df2cc77104334db0c2392ce/d1b7f/image-20230401234723850.webp 698w"
              sizes="(max-width: 698px) 100vw, 698px"
              type="image/webp"
            />
          <source
            srcset="/static/742a93bd4df2cc77104334db0c2392ce/8ff5a/image-20230401234723850.png 240w,
/static/742a93bd4df2cc77104334db0c2392ce/e85cb/image-20230401234723850.png 480w,
/static/742a93bd4df2cc77104334db0c2392ce/487bb/image-20230401234723850.png 698w"
            sizes="(max-width: 698px) 100vw, 698px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/742a93bd4df2cc77104334db0c2392ce/487bb/image-20230401234723850.png"
            alt="image-20230401234723850"
            title="image-20230401234723850"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>また、特定のバイトパターンを指定してメモリ内の情報を検索することもできます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># RSP のアドレスから 400 バイトの範囲で「長さ 4 文字以上の ASCII 文字列」を検索</span>
s -<span class="token punctuation">[</span>l4<span class="token punctuation">]</span>sa @rsp L400

<span class="token comment"># RSP のアドレスから 400 バイトの範囲内の「書き込み可能アドレス」から「長さ 4 文字以上の ASCII 文字列」を検索</span>
s -<span class="token punctuation">[</span>wl4<span class="token punctuation">]</span>sa @rsp L400</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/s--search-memory-" target="_blank" rel="nofollow noopener noreferrer">s (Search Memory) - Windows drivers | Microsoft Learn</a></p>
<h2 id="アセンブリコードの出力" style="position:relative;"><a href="#%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E5%87%BA%E5%8A%9B" aria-label="アセンブリコードの出力 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>アセンブリコードの出力</h2>
<p>以下のコマンドで Disassembly ウインドウで参照できるものと同じアセンブリコードを出力できます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># EIP から数行のアセンブリコードを出力(ub は逆方向に出力)</span>
u
ub

<span class="token comment"># 指定のアドレスから 10 行分のアセンブリコードを出力</span>
u 0x1000 L10

<span class="token comment"># 特定のレジスタ内のアドレスを使用することも可能</span>
u eax L10
u eip L20

<span class="token comment"># 関数のアドレスまたはシンボル名から特定の関数全体のコードを出力</span>
uf 0x1000
uf module<span class="token operator">!</span>function

<span class="token comment"># 対象関するルーチン内の call 命令のみ抽出</span>
uf /c 0x1000</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/u--unassemble-" target="_blank" rel="nofollow noopener noreferrer">u, ub, uu (Unassemble) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/uf--unassemble-function-" target="_blank" rel="nofollow noopener noreferrer">uf (Unassemble Function) - Windows drivers | Microsoft Learn</a></p>
<h2 id="変数と構造体の出力" style="position:relative;"><a href="#%E5%A4%89%E6%95%B0%E3%81%A8%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%AE%E5%87%BA%E5%8A%9B" aria-label="変数と構造体の出力 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>変数と構造体の出力</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 現在のスコープ内のローカル変数を出力(/t で型名を表示)</span>
dv
dv /t

<span class="token comment"># 変数の型名は dt コマンドからも解決することができる</span>
dt local_val_name

<span class="token comment"># シンボル名またはアドレスから構造体を解決</span>
dt MyStruct

<span class="token comment"># 構造体のメンバになっているサブ構造体の情報も再帰的に列挙するために -r もしくは -b を使用する</span>
dt -r MyStruct

<span class="token comment"># -r1 -r2 などのようにして再帰的に表示する構造体の階層を指定できる</span>
dt -r2 MyStruct

<span class="token comment"># 特定の構造体のアドレスを指定することで実際の値を取得できる</span>
dt nt<span class="token operator">!</span>_EPROCESS <span class="token operator">&lt;</span>EPROCESSのアドレス<span class="token operator">></span>

<span class="token comment"># サブタイプ名を指定することで、特定の値のみ抽出することもできる</span>
dt nt<span class="token operator">!</span>_EPROCESS ImageFileName <span class="token operator">&lt;</span>EPROCESSのアドレス<span class="token operator">></span>

<span class="token comment"># -l オプションでリンクされたリストをたどって構造体情報をダンプする</span>
<span class="token comment"># -y オプションで「指定の文字列が名前の先頭部分に一致する」行を出力する</span>
<span class="token comment"># -o オプションでオフセットを非表示にする</span>
<span class="token comment"># -i オプションでサブタイプのインデントを行わない</span>
dt nt<span class="token operator">!</span>_EPROCESS -l ActiveProcessLinks.Flink  -y Ima -yoi Uni <span class="token operator">&lt;</span>EPROCESSのアドレス<span class="token operator">></span></code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/dv--display-local-variables-" target="_blank" rel="nofollow noopener noreferrer">dv (Display Local Variables) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/dt--display-type-" target="_blank" rel="nofollow noopener noreferrer">dt (Display Type) - Windows drivers | Microsoft Learn</a></p>
<p>解析対象の構造体に双方向リストが含まれる場合、dt コマンドで再帰的にリストで連結された情報を取得することができます。(カーネルデバッグ時の<code class="language-text">_EPROCESS</code>構造体の列挙など)</p>
<p>また、dv コマンドは 64bit 呼び出し規約や<code class="language-text">Fast calling convention</code>(引数を可能な限りレジスタ経由で渡す呼び出し規約)では有効に動作しません。</p>
<p>例えば、x86 Windows で標準的に使用される呼び出し規約<code class="language-text">__cdecl</code>は引数がすべてスタック経由で与えられるため、dv コマンドで安定してローカル引数を参照することが可能です。</p>
<p>参考：<a href="https://www.glamenv-septzen.net/view/581#id2d585d" target="_blank" rel="nofollow noopener noreferrer">抄訳メモ/Calling Conventions Demystified - Glamenv-Septzen.net</a></p>
<h2 id="ブレークポイントの設定" style="position:relative;"><a href="#%E3%83%96%E3%83%AC%E3%83%BC%E3%82%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A" aria-label="ブレークポイントの設定 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ブレークポイントの設定</h2>
<p>ブレークポイントは、bp、bu、bm の 3 つのコマンドを使用して設定することができます。</p>
<p>bp は通常のブレークポイント設定で、コマンドで指定したシンボルやアドレスにブレークポイントを設定します。</p>
<p>一方で、未解決のアドレスや bp で解決できなかったアドレスについては bu を使用してブレークポイントを設定します。</p>
<p>さらに、bm コマンドを使用することでパターンを使用してシンボルに対してブレークポイントを設定できます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># オフセットを指定してブレークポイントを設定</span>
bp module+0x123
bu dllmodule<span class="token operator">!</span>DLLMain

<span class="token comment"># mem から始まる複数のモジュールにまとめてブレークポイントを設定</span>
bm myprogram<span class="token operator">!</span>mem*</code></pre></div>
<p>また、ブレークポイントを設定する場合にはブレークポイントにマッチした場合の処理や、停止されるまでに該当のコードが呼び出される回数を指定することも可能です。</p>
<p>加えて、IF 文などの条件分岐を定義してブレーク時の動作を細かく条件付けできます。</p>
<p>条件式に使用できる演算子しては、<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/masm-numbers-and-operators" target="_blank" rel="nofollow noopener noreferrer">MASM Numbers and Operators</a> などが利用できます。</p>
<p>条件分岐は .if や j コマンドで定義できますが、現在はこの記法は推奨されておらず、<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/setting-a-conditional-breakpoint" target="_blank" rel="nofollow noopener noreferrer">Conditional breakpoints in WinDbg</a> の通り<code class="language-text">bp /w "(Condition)" Address</code>の記法を使用することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ブレークポイントを設定した処理が 7 回目に呼び出された場合に実行を停止する</span>
bp MyTest+0xb <span class="token number">7</span>

<span class="token comment"># ブレークポイントにマッチした後、 EAX と変数 MyVar の出力を行い、自動的に実行を再開する</span>
bp ntdll<span class="token operator">!</span>RtlRaiseException <span class="token string">"r eax; dt MyVar; gc"</span>

<span class="token comment"># echo で任意の文字列を出力して処理を続行</span>
bp module<span class="token operator">!</span>myFunction <span class="token string">".echo myFunction executed; gc"</span>

<span class="token comment"># IF 文条件式の基本的な構文</span>
bp module<span class="token operator">!</span>myFunction <span class="token string">".if () {} .else {}"</span>

<span class="token comment"># var のアドレスを poi で逆解決し、10 進数の 10 と比較</span>
<span class="token comment"># 一致すれば何もせずブレークし、一致しない場合は処理を継続する</span>
bp module<span class="token operator">!</span>myFunction <span class="token string">".if ( poi(var) == 0n10 ) {} .else { gc }"</span>

<span class="token comment"># 以下も上記と同等の結果を得られる</span>
bp module<span class="token operator">!</span>myFunction <span class="token string">"j ( poi(var) == 0n10 ) ''; 'gc'"</span></code></pre></div>
<p>ちなみに、gc コマンドは条件付きブレークポイントからの移動を指示するコマンドで、これをブレーク時の条件に含める場合、このブレークポイントに到達した際の実行コマンド(g や F10 など)と同じ方法で処理を進めるように指定することができます。</p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/bp--bu--bm--set-breakpoint-" target="_blank" rel="nofollow noopener noreferrer">bp, bu, bm (Set Breakpoint) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/gc--go-from-conditional-breakpoint-" target="_blank" rel="nofollow noopener noreferrer">gc (Go from Conditional Breakpoint) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/j--execute-if---else-" target="_blank" rel="nofollow noopener noreferrer">j (Execute If - Else) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/setting-a-conditional-breakpoint" target="_blank" rel="nofollow noopener noreferrer">Conditional breakpoints in WinDbg and other Windows debuggers - Windows drivers | Microsoft Learn</a></p>
<p>また、ブレークポイントの条件はスクリプトファイルを使用して制御することも可能です。</p>
<p>詳しくは<a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%BF%E7%94%A8">スクリプトファイルの使用</a>に記載します。</p>
<h3 id="読み取り書き込みアクセスを監視する" style="position:relative;"><a href="#%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%92%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8B" aria-label="読み取り書き込みアクセスを監視する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>読み取り、書き込みアクセスを監視する</h3>
<p>ba コマンドを使用することで、実行コードだけでなく、特定のメモリ領域にアクセスが発生した場合のブレークポイントも設定することができます。</p>
<p>この時指定可能な値は大きく「実行(e)」、「読み取り/書き込み(r)」、「書き込み(w)」の 3 つです。</p>
<p>また、カーネルデバッグ時限定で、「I/O(i)」オプションで特定の I/O ポートに対するアクセスが行われた場合のブレークポイントを構成することもできます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 変数名または変数のアドレスから「4 バイト分の領域に読み取りアクセスが発生した場合」にブレークする</span>
ba r4 myVar
ba r4 0x1000

<span class="token comment"># 対象に書き込みアクセスが発生した場合にブレークする</span>
ba w4 0x1000

<span class="token comment"># 3f8 から 3f8+4 の範囲のポートで I/O が発生した場合にブレークする(カーネルデバッグ時のみ)</span>
ba i4 3f8</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/ba--break-on-access-" target="_blank" rel="nofollow noopener noreferrer">ba (Break on Access) - Windows drivers | Microsoft Learn</a></p>
<h3 id="ブレークポイント設定の管理" style="position:relative;"><a href="#%E3%83%96%E3%83%AC%E3%83%BC%E3%82%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E8%A8%AD%E5%AE%9A%E3%81%AE%E7%AE%A1%E7%90%86" aria-label="ブレークポイント設定の管理 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ブレークポイント設定の管理</h3>
<p>現在のブレークポイント設定の確認や有効化/無効化は以下のコマンドで行うことができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 現在設定されているブレークポイントの列挙</span>
<span class="token comment"># ここで表示されるブレークポイントの ID は他の管理コマンドで対象を指定する際に使用できる</span>
bl

<span class="token comment"># すべてのブレークポイントを無効化する</span>
bd *

<span class="token comment"># ID 1 のブレークポイントのみを無効化する</span>
bd <span class="token number">1</span>

<span class="token comment"># すべてのブレークポイントを有効化する</span>
be *

<span class="token comment"># ID 1 のブレークポイントのみを有効化する</span>
be <span class="token number">1</span>

<span class="token comment"># 現在のブレークポイント設定に使用したコマンドを上から順にリストする</span>
.bpcmds</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/bl--breakpoint-list-" target="_blank" rel="nofollow noopener noreferrer">bl (Breakpoint List) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/be--breakpoint-enable-" target="_blank" rel="nofollow noopener noreferrer">be (Breakpoint Enable) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/bd--breakpoint-disable-" target="_blank" rel="nofollow noopener noreferrer">bd (Breakpoint Disable) - Windows drivers | Microsoft Learn</a></p>
<p>また、現在のブレークポイント設定や条件式を更新したい場合は以下のコマンドを使用します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ブレークポイントの ID を変更します</span>
<span class="token comment"># 複数の ID 変更を一括で行うこともできます</span>
br OldID NewID
br OldID NewID OldID2 NewID2 OldID3 NewID3 

<span class="token comment"># ブレークポイントのコマンド部分を修正できます</span>
bs ID <span class="token punctuation">[</span><span class="token string">"CommandString"</span><span class="token punctuation">]</span> 

<span class="token comment"># ブレークポイントの条件文を変更できます</span>
bsc ID Condition <span class="token punctuation">[</span><span class="token string">"CommandString"</span><span class="token punctuation">]</span> </code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/br--breakpoint-renumber-" target="_blank" rel="nofollow noopener noreferrer">br (Breakpoint Renumber) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/bs--update-breakpoint-command-" target="_blank" rel="nofollow noopener noreferrer">bs (Update Breakpoint Command) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/bsc--update-conditional-breakpoint-" target="_blank" rel="nofollow noopener noreferrer">bsc (Update Conditional Breakpoint) - Windows drivers | Microsoft Learn</a></p>
<h2 id="コード実行コマンド" style="position:relative;"><a href="#%E3%82%B3%E3%83%BC%E3%83%89%E5%AE%9F%E8%A1%8C%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89" aria-label="コード実行コマンド permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>コード実行コマンド</h2>
<p>WinDbg でコード実行を行う場合、大きく分けて以下の 3 つの操作を行うことができます。</p>
<ul>
<li>Step：単一の命令またはコードを実行する(Step Over)</li>
<li>Trace：単一の命令またはソース行を実行する(Step Into)</li>
<li>Go：プロセスまたはスレッドの実行を再開する</li>
</ul>
<h3 id="step-overp" style="position:relative;"><a href="#step-overp" aria-label="step overp permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step Over(p)</h3>
<p>p コマンドや F10 キーで単一の命令またはコードを実行します。</p>
<p>WinDbg では p コマンドや F10 キーで実行する操作は Step Over に該当し、 call 命令では呼び出し先の関数には移動せず、call 命令の次の行の処理に進みます。</p>
<p>ちなみに、デフォルトでは Step Over 時にレジスタとフラグが出力されますが、pr のように各コマンドに r を付与するか、<code class="language-text">.prompt_allow -reg</code>コマンドを実行することでレジスタとフラグの出力を無効化することができます。(元に戻す場合は<code class="language-text">.prompt_allow +reg</code>コマンドを実行します)</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ステップオーバーの処理を行う</span>
p <span class="token punctuation">(</span>または F10<span class="token punctuation">)</span>

<span class="token comment"># 5 行分ステップオーバーを実行する</span>
p <span class="token number">5</span>

<span class="token comment"># ステップオーバーの実行後に WinDbg コマンドを実行する</span>
p <span class="token string">"k;r eax"</span>

<span class="token comment"># 指定のアドレスに到達するまで Step Over を繰り返す</span>
pa StopAddress

<span class="token comment"># 次の call 命令の呼び出し行まで Step Over する</span>
pc

<span class="token comment"># pc の場合もカウント実行が可能</span>
pc <span class="token number">3</span>

<span class="token comment"># 次の ret 命令の呼び出し行まで Step Over する</span>
pt

<span class="token comment"># 次の call 命令または ret 命令の呼び出し行まで Step Over する</span>
pct

<span class="token comment"># 次の条件分岐の呼び出しまで Step Over する</span>
ph</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/p--step-" target="_blank" rel="nofollow noopener noreferrer">p (Step) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/pa--step-to-address-" target="_blank" rel="nofollow noopener noreferrer">pa (Step to Address) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/pc--step-to-next-call-" target="_blank" rel="nofollow noopener noreferrer">pc (Step to Next Call) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/pt--step-to-next-return-" target="_blank" rel="nofollow noopener noreferrer">pt (Step to Next Return) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/pct--step-to-next-call-or-return-" target="_blank" rel="nofollow noopener noreferrer">pct (Step to Next Call or Return) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/ph--step-to-next-branching-instruction-" target="_blank" rel="nofollow noopener noreferrer">ph (Step to Next Branching Instruction) - Windows drivers | Microsoft Learn</a></p>
<h3 id="step-intot" style="position:relative;"><a href="#step-intot" aria-label="step intot permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step Into(t)</h3>
<p>TODO：追記予定</p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/t--trace-" target="_blank" rel="nofollow noopener noreferrer">t (Trace) - Windows drivers | Microsoft Learn</a></p>
<h3 id="gog" style="position:relative;"><a href="#gog" aria-label="gog permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>go(g)</h3>
<p>TODO：追記予定</p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/g--go-" target="_blank" rel="nofollow noopener noreferrer">g (Go) - Windows drivers | Microsoft Learn</a></p>
<h2 id="コマンド出力をファイルに保存する" style="position:relative;"><a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%87%BA%E5%8A%9B%E3%82%92%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B" aria-label="コマンド出力をファイルに保存する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>コマンド出力をファイルに保存する</h2>
<p>.logopen コマンドを使用すると、WinDbg のコマンド実行とその出力結果を任意のファイルに保存することができます。</p>
<p>デフォルトでは出力されるテキストは ASCII 文字列ですが、 /u オプションを使用することで Unicord 文字列を指定することができます。</p>
<p>特に、process コマンドなどのような大量の情報を一気に出力する場合などに便利です。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 任意のログファイルにコマンド出力を記録する(ASCII テキスト)</span>
.logopen /t C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Public<span class="token punctuation">\</span>windbg.log

<span class="token comment"># プロセス ID と現在の日時を付与(/t)して任意のログファイルにコマンド出力を記録する</span>
.logopen /t C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Public<span class="token punctuation">\</span>windbg.log

<span class="token comment"># プロセスやファイル情報などから自動的にファイル名を決定して保存</span>
.logopen /d

<span class="token comment"># 既存のログファイルに追記する</span>
.logappend C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Public<span class="token punctuation">\</span>windbg.log

<span class="token comment"># ファイルを閉じて記録を終了する</span>
.logclose</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/keeping-a-log-file-in-windbg" target="_blank" rel="nofollow noopener noreferrer">Keeping a Log File in WinDbg - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-logopen--open-log-file-" target="_blank" rel="nofollow noopener noreferrer">.logopen (Open Log File) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-logappend--append-log-file-" target="_blank" rel="nofollow noopener noreferrer">.logappend (Append Log File) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-logclose--close-log-file-" target="_blank" rel="nofollow noopener noreferrer">.logclose (Close Log File) - Windows drivers | Microsoft Learn</a></p>
<h2 id="拡張機能" style="position:relative;"><a href="#%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD" aria-label="拡張機能 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>拡張機能</h2>
<p>ロードされている拡張機能は<code class="language-text">.chain</code>で確認できます。</p>
<p>デフォルトの拡張機能は以下の種類があり、それぞれ DLL として読み込まれます。</p>
<ul>
<li>ext</li>
<li>wow64exts</li>
<li>dbghelp</li>
<li>exts</li>
<li>uext</li>
<li>ntsdexts</li>
</ul>
<h3 id="help拡張機能のヘルプ" style="position:relative;"><a href="#help%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%81%AE%E3%83%98%E3%83%AB%E3%83%97" aria-label="help拡張機能のヘルプ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>!help：拡張機能のヘルプ</h3>
<p><code class="language-text">!help</code>拡張機能は既定では ext 拡張機能のコマンド一覧を出力します。</p>
<p>ただし、help 拡張機能は他にもいくつかの拡張機能に存在しており、<code class="language-text">!ext.help</code>や<code class="language-text">!wow64exts.help</code>などの記法でそれぞれの拡張機能のコマンド一覧にアクセスできます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ext 拡張機能のヘルプを出力</span>
<span class="token operator">!</span>ext.help

analyze <span class="token punctuation">[</span>-v<span class="token punctuation">]</span><span class="token punctuation">[</span>level<span class="token punctuation">]</span>        - Analyzes current exception or bugcheck <span class="token punctuation">(</span>levels are <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">9</span><span class="token punctuation">)</span>
owner <span class="token punctuation">[</span>symbol<span class="token operator">!</span>module<span class="token punctuation">]</span>      - Displays the Owner <span class="token keyword">for</span> current exception or bugcheck
comment                    - Displays the Dump's Comment<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

error <span class="token punctuation">[</span>errorcode<span class="token punctuation">]</span>          - Displays Win32 or NTSTATUS error string
gle <span class="token punctuation">[</span>-all<span class="token punctuation">]</span>                 - Displays the Last Error <span class="token operator">&amp;</span> Last Status of the current thread

address <span class="token punctuation">[</span>address<span class="token punctuation">]</span>          - Displays the address space layout
        <span class="token punctuation">[</span>-UsageType<span class="token punctuation">]</span>       - Displays the address space regions of the given <span class="token builtin class-name">type</span>

cpuid <span class="token punctuation">[</span>processor<span class="token punctuation">]</span>          - Displays the CPU information <span class="token keyword">for</span> a specific or all CPUs

exchain                    - Displays exception chain <span class="token keyword">for</span> the current thread

for_each_process <span class="token operator">&lt;</span>cmd<span class="token operator">></span>     - Executes <span class="token builtin class-name">command</span> <span class="token keyword">for</span> each process
for_each_thread <span class="token operator">&lt;</span>cmd<span class="token operator">></span>      - Executes <span class="token builtin class-name">command</span> <span class="token keyword">for</span> each thread
for_each_frame <span class="token operator">&lt;</span>cmd<span class="token operator">></span>       - Executes <span class="token builtin class-name">command</span> <span class="token keyword">for</span> each frame <span class="token keyword">in</span> the current thread
for_each_local <span class="token operator">&lt;</span>cmd<span class="token operator">></span> <span class="token variable">$$</span><span class="token operator">&lt;</span>n<span class="token operator">></span> - Executes <span class="token builtin class-name">command</span> <span class="token keyword">for</span> each <span class="token builtin class-name">local</span> variable <span class="token keyword">in</span> the current frame,
                             substituting the fixed-name <span class="token builtin class-name">alias</span> <span class="token variable">$u</span><span class="token operator">&lt;</span>n<span class="token operator">></span> <span class="token keyword">for</span> each occurrence of <span class="token variable">$$</span><span class="token operator">&lt;</span>n<span class="token operator">></span>

imggp <span class="token operator">&lt;</span>imagebase<span class="token operator">></span>          - Displays GP directory entry <span class="token keyword">for</span> <span class="token number">64</span>-bit image
imgreloc <span class="token operator">&lt;</span>imagebase<span class="token operator">></span>       - Relocates modules <span class="token keyword">for</span> an image

str <span class="token operator">&lt;</span>address<span class="token operator">></span>              - Displays ANSI_STRING or OEM_STRING
ustr <span class="token operator">&lt;</span>address<span class="token operator">></span>             - Displays UNICODE_STRING

list <span class="token punctuation">[</span>-? <span class="token operator">|</span> parameters<span class="token punctuation">]</span>     - Displays lists

cppexr <span class="token operator">&lt;</span>exraddress<span class="token operator">></span>        - Displays a C++ EXCEPTION_RECORD
obja <span class="token operator">&lt;</span>address<span class="token operator">></span>             - Displays OBJECT_ATTRIBUTES<span class="token punctuation">[</span><span class="token number">32</span><span class="token operator">|</span><span class="token number">64</span><span class="token punctuation">]</span>
rtlavl <span class="token operator">&lt;</span>address<span class="token operator">></span>           - Displays RTL_AVL_TABLE
std_map <span class="token operator">&lt;</span>address<span class="token operator">></span>          - Displays a std::map<span class="token operator">&lt;></span></code></pre></div>
<h3 id="analyze例外やバグチェックに関する情報の取得" style="position:relative;"><a href="#analyze%E4%BE%8B%E5%A4%96%E3%82%84%E3%83%90%E3%82%B0%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%96%E5%BE%97" aria-label="analyze例外やバグチェックに関する情報の取得 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>!analyze：例外やバグチェックに関する情報の取得</h3>
<p><code class="language-text">!analyze</code>は ext 拡張に含まれるコマンドで、クラッシュダンプなどの解析で非常に有用です。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 主要な解析の実行</span>
<span class="token operator">!</span>analyze -v

<span class="token comment"># グローバルフラグ</span>
NTGLOBALFLAG

<span class="token comment"># プロセスやアプリケーション関連の情報が記録される</span>
PROCESS_BAM_CURRENT_THROTTLED
PROCESS_BAM_PREVIOUS_THROTTLED
APPLICATION_VERIFIER_FLAGS

<span class="token comment"># EXCEPTION_RECORD には例外発生、クラッシュしたプロセスの情報が記録される</span>
EXCEPTION_RECORD:  <span class="token punctuation">(</span>.exr -1<span class="token punctuation">)</span>
ExceptionAddress: 00007ffce5c60910 <span class="token punctuation">(</span>ntdll<span class="token operator">!</span>LdrpDoDebuggerBreak+0x0000000000000030<span class="token punctuation">)</span>
	ExceptionCode: <span class="token number">80000003</span> <span class="token punctuation">(</span>Break instruction exception<span class="token punctuation">)</span>
	ExceptionFlags: 00000000

<span class="token comment"># 例外発生時のスタックコールバックがきろくされる</span>
<span class="token comment"># ~0s ; .cxr ; kb のコマンドでも同等の内容を出力できる</span>
STACK_TEXT

<span class="token comment"># 問題のカテゴリを表示する</span>
FAILURE_BUCKET_ID</code></pre></div>
<p>参考：<a href="https://degiuli.github.io/WinDBG/WinDBG.html" target="_blank" rel="nofollow noopener noreferrer">WinDBG !analyze extension command</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-analyze" target="_blank" rel="nofollow noopener noreferrer">analyze (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<h3 id="addressメモリやプロセスに関する情報の参照" style="position:relative;"><a href="#address%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%84%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%82%E7%85%A7" aria-label="addressメモリやプロセスに関する情報の参照 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>!address：メモリやプロセスに関する情報の参照</h3>
<p><code class="language-text">!address</code>も ext 拡張に含まれるコマンドで、指定したアドレスのメモリ領域やプロセスに関する情報を表示します。</p>
<p>例えば、<code class="language-text">malloc</code>関数の戻り値のアドレスに対して<code class="language-text">!address</code>コマンドを発行するなどによって、対象のメモリ領域に関する情報を取得することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 各メモリブロックの情報を出力する </span>
<span class="token operator">!</span>address

<span class="token comment"># 指定のアドレスに関する情報を出力する</span>
<span class="token operator">!</span>address <span class="token operator">&lt;</span>Address<span class="token operator">></span>

<span class="token comment"># ユーザモードデバッグでメモリに関する統計情報を出力する</span>
<span class="token operator">!</span>address -summary </code></pre></div>
<p>以下の Docs のパラメータ表の通り、対象のメモリ領域の用途やステータス、保護の状態など様々な情報を取得することができます。</p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-address" target="_blank" rel="nofollow noopener noreferrer">address (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<h3 id="handleシステムまたはプロセスのハンドル情報の参照" style="position:relative;"><a href="#handle%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%BE%E3%81%9F%E3%81%AF%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AB%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%82%E7%85%A7" aria-label="handleシステムまたはプロセスのハンドル情報の参照 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>!handle：システムまたはプロセスのハンドル情報の参照</h3>
<p><code class="language-text">!handle</code>も ext 拡張に含まれるコマンドで、システムやプロセスのハンドルに関する情報を取得できます。</p>
<p>ユーザモードデバッグで使用した場合、そのプロセスのハンドル情報の一覧や統計情報を取得できる。</p>
<p>オプションなしの<code class="language-text">!handle</code>コマンドで取得できる情報は、Process Explorer のハンドルビューと非常に近しい情報を取得することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ハンドル情報の取得</span>
<span class="token operator">!</span>handle

<span class="token comment"># すべてのハンドルの詳細な情報をダンプ</span>
<span class="token operator">!</span>handle <span class="token number">0</span> 0xf

<span class="token comment"># ハンドル ID が 430 のハンドルの詳細な情報を取得</span>
<span class="token operator">!</span>handle <span class="token number">430</span> 0xf</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-handle" target="_blank" rel="nofollow noopener noreferrer">handle (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<h3 id="スレッド環境ブロックtebの情報取得" style="position:relative;"><a href="#%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E7%92%B0%E5%A2%83%E3%83%96%E3%83%AD%E3%83%83%E3%82%AFteb%E3%81%AE%E6%83%85%E5%A0%B1%E5%8F%96%E5%BE%97" aria-label="スレッド環境ブロックtebの情報取得 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>スレッド環境ブロック(TEB)の情報取得</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># TEB の情報をダンプ</span>
<span class="token operator">!</span>teb</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-teb" target="_blank" rel="nofollow noopener noreferrer">teb (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<h3 id="プロセス環境ブロックpebの情報取得" style="position:relative;"><a href="#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E7%92%B0%E5%A2%83%E3%83%96%E3%83%AD%E3%83%83%E3%82%AFpeb%E3%81%AE%E6%83%85%E5%A0%B1%E5%8F%96%E5%BE%97" aria-label="プロセス環境ブロックpebの情報取得 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>プロセス環境ブロック(PEB)の情報取得</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># PEB の情報をダンプ</span>
<span class="token operator">!</span>peb</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-peb" target="_blank" rel="nofollow noopener noreferrer">peb (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<h2 id="config-コマンド" style="position:relative;"><a href="#config-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89" aria-label="config コマンド permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Config コマンド</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># シンボル設定の確認</span>
.sympath

<span class="token comment"># シンボルキャッシュとソースの設定</span>
.sympath cache*C:<span class="token punctuation">\</span>symbols<span class="token punctuation">;</span>srv*https://msdl.microsoft.com/download/symbols
.reload

<span class="token comment"># シンボル読み込み時の詳細を出力/抑制</span>
<span class="token operator">!</span>sym noisy
<span class="token operator">!</span>sym quiet

<span class="token comment"># 不一致シンボルの強制読み込み(非推奨)</span>
.reload /f /i <span class="token operator">&lt;</span>modulename<span class="token operator">></span>

<span class="token comment"># ロードされている拡張機能のリストを出力</span>
.chain

<span class="token comment"># 追加の拡張機能のロード</span>
.load <span class="token operator">&lt;</span>拡張機能 DLL のパス<span class="token operator">></span>

<span class="token comment"># 拡張機能の詳細を表示</span>
.extmatch /D /e <span class="token operator">&lt;</span>モジュール<span class="token operator">></span> *

<span class="token comment"># ヘルプウィンドウの起動</span>
.hh

<span class="token comment"># ダンプファイルとして保存</span>
<span class="token comment"># https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-dump--create-dump-file-</span>
.dump <span class="token punctuation">[</span>options<span class="token punctuation">]</span> FileName</code></pre></div>
<h2 id="カーネルデバッグフルダンプの解析" style="position:relative;"><a href="#%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%95%E3%83%AB%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E8%A7%A3%E6%9E%90" aria-label="カーネルデバッグフルダンプの解析 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>カーネルデバッグ、フルダンプの解析</h2>
<h3 id="カーネルデバッガの接続hyper-vvirtualbox" style="position:relative;"><a href="#%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%87%E3%83%90%E3%83%83%E3%82%AC%E3%81%AE%E6%8E%A5%E7%B6%9Ahyper-vvirtualbox" aria-label="カーネルデバッガの接続hyper vvirtualbox permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>カーネルデバッガの接続(Hyper-V、VirtualBox)</h3>
<p>以下の記事にまとめています。</p>
<p>参考：<a href="/windows-windbg-004-kernel-debug">WinDbgでWindows10環境のカーネルデバッグを行う最初の一歩</a></p>
<h3 id="フルメモリダンプの取得設定" style="position:relative;"><a href="#%E3%83%95%E3%83%AB%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%80%E3%83%B3%E3%83%97%E3%81%AE%E5%8F%96%E5%BE%97%E8%A8%AD%E5%AE%9A" aria-label="フルメモリダンプの取得設定 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>フルメモリダンプの取得設定</h3>
<p>以下の記事にまとめています。</p>
<p>参考：<a href="/windows-windbg-005-kernel-dump">Windows環境でカーネルメモリダンプを手動で取得し、WinDbgで解析する方法</a></p>
<h3 id="カーネル構造体の情報を列挙する" style="position:relative;"><a href="#%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%88%97%E6%8C%99%E3%81%99%E3%82%8B" aria-label="カーネル構造体の情報を列挙する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>カーネル構造体の情報を列挙する</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># NT カーネル構造体の情報を列挙する</span>
dt nt<span class="token operator">!</span>_*
dt nt<span class="token operator">!</span>_*interrupt*

<span class="token comment"># カーネル構造体の情報をダンプする</span>
dt nt<span class="token operator">!</span>_KINTERRUPT</code></pre></div>
<h3 id="プロセス情報を列挙する" style="position:relative;"><a href="#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E6%83%85%E5%A0%B1%E3%82%92%E5%88%97%E6%8C%99%E3%81%99%E3%82%8B" aria-label="プロセス情報を列挙する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>プロセス情報を列挙する</h3>
<p>カーネルデバッグやフルダンプの解析を行う場合、以下のコマンドでプロセスの情報をダンプできます。</p>
<p><code class="language-text">.process</code>は、デバッガのコンテキストを変更できるコマンドで、非常に有用です。</p>
<p>カーネルデバッグは通常、ほとんどのユーザモードアドレス空間の情報は表示されませんが、<code class="language-text">.process</code>で特定のユーザモードプロセスの紺的とに変更することで、カーネルデバッグ中に特定のユーザモードプロセスを解析することができるようになります。</p>
<p>※ コンテキストを変更した後、元のようにカーネル情報を表示する状態に戻す方法はわからないので、都度カーネルデバッガを再接続させています。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># システム内のすべてのプロセスを列挙</span>
<span class="token operator">!</span>process <span class="token number">0</span> <span class="token number">0</span>

<span class="token comment"># 特定のプロセスの完全な詳細情報を取得</span>
<span class="token operator">!</span>process <span class="token number">0</span> <span class="token number">7</span> notepad.exe

<span class="token comment"># デバッガのコンテキストを指定のプロセスに変更する(！peb などが使えるようになる)</span>
.process /r /P <span class="token operator">&lt;</span><span class="token operator">!</span>process で特定した EPROCESS ブロックのアドレス<span class="token operator">></span>

<span class="token comment"># すべてのプロセスを探索する(すべてのプロセスに対してコマンドを発行することも可能)</span>
<span class="token operator">!</span>for_each_process</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-process" target="_blank" rel="nofollow noopener noreferrer">!process (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-process--set-process-context-" target="_blank" rel="nofollow noopener noreferrer">.process (Set Process Context) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-for-each-process" target="_blank" rel="nofollow noopener noreferrer">for<em>each</em>process - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/changing-contexts" target="_blank" rel="nofollow noopener noreferrer">Changing Contexts - Windows drivers | Microsoft Learn</a></p>
<p><code class="language-text">nt!_EPROCESS</code>からプロセス情報を直接列挙することもできます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># System プロセスの ActiveProcessLinks へのポインタアドレスを取得</span>
r <span class="token variable">$t0</span> <span class="token operator">=</span> nt<span class="token operator">!</span>PsActiveProcessHead<span class="token punctuation">;</span>r <span class="token variable">$t1</span> <span class="token operator">=</span> poi<span class="token punctuation">(</span>@<span class="token variable">$t0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>r <span class="token variable">$t1</span>

<span class="token comment"># ActiveProcessLinks.Flink のオフセットを参照</span>
dt nt<span class="token operator">!</span>_EPROCESS ActiveProcessLinks
<span class="token operator">></span> +0x448 ActiveProcessLinks 

<span class="token comment"># _EPROCESS をダンプ(.process 0 0 と同等の出力)</span>
dt nt<span class="token operator">!</span>_EPROCESS -l ActiveProcessLinks.Flink -y Ima -yoi Uni <span class="token variable">$t1</span>-0x448</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/ja-jp/windows-hardware/drivers/debugger/debugger-command-program-examples" target="_blank" rel="nofollow noopener noreferrer">デバッガー コマンド プログラムの例 - Windows drivers | Microsoft Learn</a></p>
<h3 id="プロセスのハンドル情報を列挙する" style="position:relative;"><a href="#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AB%E6%83%85%E5%A0%B1%E3%82%92%E5%88%97%E6%8C%99%E3%81%99%E3%82%8B" aria-label="プロセスのハンドル情報を列挙する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>プロセスのハンドル情報を列挙する</h3>
<p><code class="language-text">!handle</code>コマンドは、ユーザモードデバッグとカーネルデバッグで少々利用方法に差異が発生します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token operator">!</span>handle notepad.exe</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-handle" target="_blank" rel="nofollow noopener noreferrer">handle (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<h3 id="kpcr-と-kprcb-を参照して-cpu-の統計情報を読む" style="position:relative;"><a href="#kpcr-%E3%81%A8-kprcb-%E3%82%92%E5%8F%82%E7%85%A7%E3%81%97%E3%81%A6-cpu-%E3%81%AE%E7%B5%B1%E8%A8%88%E6%83%85%E5%A0%B1%E3%82%92%E8%AA%AD%E3%82%80" aria-label="kpcr と kprcb を参照して cpu の統計情報を読む permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>KPCR と KPRCB を参照して CPU の統計情報を読む</h3>
<p>カーネルプロセッサ制御領域(KPCR)とカーネルプロセッサ制御ブロック(KPRCB)には、プロセッサ固有のデータや状態、統計に関する情報が記録されています。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 指定のプロセッサの KPRCB の情報を出力</span>
<span class="token operator">!</span>prcb <span class="token operator">&lt;</span>CPU 番号<span class="token operator">></span>

<span class="token comment"># KPCR の情報をダンプ</span>
dt nt<span class="token operator">!</span>_KPCR @<span class="token variable">$pcr</span></code></pre></div>
<h2 id="その他のコマンド" style="position:relative;"><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89" aria-label="その他のコマンド permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>その他のコマンド</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ?&lt;Hex> で 10 進数変換が可能</span>
?ff
<span class="token operator">></span> Evaluate expression: <span class="token number">255</span> <span class="token operator">=</span> 000000ff

<span class="token comment"># 以下のように演算結果を評価することも可能</span>
?ffff-f
<span class="token operator">></span> Evaluate expression: <span class="token number">65520</span> <span class="token operator">=</span> 0000fff0

<span class="token comment"># ユーザモードデバッグで現在のプロセスのステータスを表示する</span>
<span class="token operator">|</span>

<span class="token comment"># デバッグ中のシステムを表示する</span>
<span class="token operator">||</span></code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/commands" target="_blank" rel="nofollow noopener noreferrer">Commands - Windows drivers | Microsoft Learn</a></p>
<h2 id="スクリプトファイルの使用" style="position:relative;"><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%BF%E7%94%A8" aria-label="スクリプトファイルの使用 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>スクリプトファイルの使用</h2>
<p>WinDgb コマンドを記載したテキストファイルを使用することで、WinDgb のコマンド実行をある程度自動化することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ファイルで定義したスクリプトを実行</span>
$<span class="token operator">&lt;</span>C:<span class="token punctuation">\</span>windbgcmd.txt

<span class="token comment"># 単一のコマンドブロックとして実行(ブレークポイントを使うならこちらの方がよい)</span>
$<span class="token operator">></span><span class="token operator">&lt;</span>C:<span class="token punctuation">\</span>windbgcmd.txt

<span class="token comment"># コマンド引数を設定(標準入力ではない)</span>
<span class="token comment"># .echo argument is ${$arg1} などのコマンドを使う場合に使用可能</span>
<span class="token variable">$$</span><span class="token operator">></span>a<span class="token operator">&lt;</span>C:<span class="token punctuation">\</span>windbgcmd.txt test_text

<span class="token comment"># eax レジスタに 1234 が含まれるまで実行を続けるスクリプト eaxstep を再帰的に呼び出す</span>
<span class="token comment"># .if (@eax == 1234) { .echo 1234 } .else { t "$&lt;eaxstep" }</span>
t <span class="token string">"$&lt;C:<span class="token entity" title="\\">\\</span>eaxstep"</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 869px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ccac49f8fefcf145e70c1bca37f258ae/2b2c6/image-20230407210644712.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 32.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABC0lEQVQoz2WQWW6EMBBEuQJi3xezDpqFJROJL8T971RxeWICykfL6rb7VZWNLMvgeZ6qpm7wer0wzzPatoWoBPq+x+P5xLqu6LoO98cDw3BD0zTgbi13bsOAZZnlfQsjCAIFcxwHbdfj/f3GNE2Io1gu37HvO8ZxxLZtSmRZvhSYe6wwDBHHMfI8V6dBmO/7qpIkgW3bsCwLruuqB2VZqplpmkqYM52IRRChNMT+APKsqgpRFP0KeFIghZDAs6AQ4ug9z5eR60OEswuQbtI0PdT5R9mppxiBjKqBQpq4AGlXP+BjQrQDxsmy9OKwLD6O9U5Vf4B6ZuiIVCiK4p/Dc08gRf7+PVCpNJz1A5dGvJ61TLF6AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/ccac49f8fefcf145e70c1bca37f258ae/8ac56/image-20230407210644712.webp 240w,
/static/ccac49f8fefcf145e70c1bca37f258ae/d3be9/image-20230407210644712.webp 480w,
/static/ccac49f8fefcf145e70c1bca37f258ae/c3694/image-20230407210644712.webp 869w"
              sizes="(max-width: 869px) 100vw, 869px"
              type="image/webp"
            />
          <source
            srcset="/static/ccac49f8fefcf145e70c1bca37f258ae/8ff5a/image-20230407210644712.png 240w,
/static/ccac49f8fefcf145e70c1bca37f258ae/e85cb/image-20230407210644712.png 480w,
/static/ccac49f8fefcf145e70c1bca37f258ae/2b2c6/image-20230407210644712.png 869w"
            sizes="(max-width: 869px) 100vw, 869px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/ccac49f8fefcf145e70c1bca37f258ae/2b2c6/image-20230407210644712.png"
            alt="image-20230407210644712"
            title="image-20230407210644712"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-----------------------a---run-script-file-" target="_blank" rel="nofollow noopener noreferrer"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span></span></span></span> , <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3em;vertical-align:-0.1944em;"></span><span class="mpunct">,</span></span></span></span> , $$ a (Run Script File) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/executing-until-a-specified-state-is-reached" target="_blank" rel="nofollow noopener noreferrer">Executing Until a Specified State is Reached - Windows drivers | Microsoft Learn</a></p>
<h3 id="条件分岐" style="position:relative;"><a href="#%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90" aria-label="条件分岐 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>条件分岐</h3>
<p>WinDbg コマンドもしくはスクリプトの内部では以下のような条件式を扱うことができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># IF トークンの使用</span>
.if <span class="token punctuation">(</span>Condition<span class="token punctuation">)</span> <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span> 
.if <span class="token punctuation">(</span>Condition<span class="token punctuation">)</span> <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span> .else <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span> 
.if <span class="token punctuation">(</span>Condition<span class="token punctuation">)</span> <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span> .elsif <span class="token punctuation">(</span>Condition<span class="token punctuation">)</span> <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span> 
.if <span class="token punctuation">(</span>Condition<span class="token punctuation">)</span> <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span> .elsif <span class="token punctuation">(</span>Condition<span class="token punctuation">)</span> <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span> .else <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span></code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-if" target="_blank" rel="nofollow noopener noreferrer">.if (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/control-flow-tokens" target="_blank" rel="nofollow noopener noreferrer">Control Flow Tokens - Windows drivers | Microsoft Learn</a></p>
<p>この時、Condition には様々な上限を含めることができます。</p>
<p>WinDbg の場合、MASM 演算子と C++ の演算子がサポートされています。</p>
<p>特に MASM 演算子の<code class="language-text">poi</code>によるアドレス解決や Non-Numeric な演算子である<code class="language-text">$scmp("String1", "String2")</code>による文字列比較などは頻繁に使用します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># $scmp は C++ の strcmp と同等の評価を行うため、文字列が一致した場合は 0 を返す</span>
.if <span class="token punctuation">(</span><span class="token variable">$scmp</span><span class="token punctuation">(</span><span class="token string">"<span class="token variable">${$ImageName}</span>"</span>,<span class="token string">"notepad.exe"</span><span class="token punctuation">))</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span> .else <span class="token punctuation">{</span> .echo match <span class="token punctuation">}</span>

<span class="token comment"># 疑似レジスタ $t1 のアドレスが指す値を $t1 に再代入する</span>
r <span class="token variable">$t1</span> <span class="token operator">=</span> poi<span class="token punctuation">(</span>@<span class="token variable">$t1</span><span class="token punctuation">)</span></code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/masm-numbers-and-operators" target="_blank" rel="nofollow noopener noreferrer">MASM Numbers and Operators - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/c---numbers-and-operators" target="_blank" rel="nofollow noopener noreferrer">C++ numbers and operators - Windows drivers | Microsoft Learn</a></p>
<p>その他、条件式に使える演算子は以下から探すことができます。</p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/numerical-expression-syntax" target="_blank" rel="nofollow noopener noreferrer">Numerical Expression Syntax - Windows drivers | Microsoft Learn</a></p>
<h3 id="ループコマンド" style="position:relative;"><a href="#%E3%83%AB%E3%83%BC%E3%83%97%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89" aria-label="ループコマンド permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ループコマンド</h3>
<p>WinDbg の<code class="language-text">.for</code>コマンドは C 言語の for とほぼ同等の動作になります。</p>
<p>また、<code class="language-text">.foreach</code>コマンドは WinDbg のコマンド出力やファイル内の情報を要素ごとに分割して 1 つずつ指定のコマンドに与えることができます。</p>
<p><code class="language-text">.foreach</code>コマンドで与えられる要素は、処理中の<code class="language-text">place</code>を置き換えます。</p>
<p>また、<code class="language-text">.while</code>と<code class="language-text">.do</code>もループコマンドとして使用できます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># WinDbg の for 構文(カンマではなくセミコロンで分割)</span>
.for <span class="token punctuation">(</span>InitialCommand <span class="token punctuation">;</span> Condition <span class="token punctuation">;</span> IncrementCommands<span class="token punctuation">)</span> <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span> 

<span class="token comment"># foreach 構文</span>
.foreach <span class="token punctuation">[</span>Options<span class="token punctuation">]</span> <span class="token punctuation">(</span> Variable  <span class="token punctuation">{</span> InCommands <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> OutCommands <span class="token punctuation">}</span> 
.foreach <span class="token punctuation">[</span>Options<span class="token punctuation">]</span> /s <span class="token punctuation">(</span> Variable  <span class="token string">"InString"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> OutCommands <span class="token punctuation">}</span> 
.foreach <span class="token punctuation">[</span>Options<span class="token punctuation">]</span> /f <span class="token punctuation">(</span> Variable  <span class="token string">"InFile"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> OutCommands <span class="token punctuation">}</span> </code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-for" target="_blank" rel="nofollow noopener noreferrer">.for (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-foreach" target="_blank" rel="nofollow noopener noreferrer">.foreach (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-while" target="_blank" rel="nofollow noopener noreferrer">.while (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-do" target="_blank" rel="nofollow noopener noreferrer">.do (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<p><code class="language-text">.for</code>コマンドは以下のような構文で使用できます。</p>
<p><code class="language-text">.continue</code>と<code class="language-text">.break</code>によるループ操作は、C 言語と同じように動作します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 疑似レジスタを使用して for ループを実行</span>
.for <span class="token punctuation">(</span>r <span class="token variable">$t1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$t1</span> <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> r <span class="token variable">$t1</span> <span class="token operator">=</span> <span class="token variable">$t1</span> + <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> r <span class="token variable">$t1</span> <span class="token punctuation">}</span>

<span class="token comment"># continue で次のループにジャンプする</span>
.for <span class="token punctuation">(</span>r <span class="token variable">$t1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$t1</span> <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> r <span class="token variable">$t1</span> <span class="token operator">=</span> <span class="token variable">$t1</span> + <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> .if <span class="token punctuation">(</span> <span class="token variable">$t1</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> .echo skip <span class="token punctuation">;</span> .continue <span class="token punctuation">}</span> <span class="token punctuation">;</span> r <span class="token variable">$t1</span> <span class="token punctuation">}</span>

<span class="token comment"># break でループを停止する</span>
.for <span class="token punctuation">(</span>r <span class="token variable">$t1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$t1</span> <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> r <span class="token variable">$t1</span> <span class="token operator">=</span> <span class="token variable">$t1</span> + <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> .if <span class="token punctuation">(</span> <span class="token variable">$t1</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> .echo stop <span class="token punctuation">;</span> .break <span class="token punctuation">}</span> <span class="token punctuation">;</span> r <span class="token variable">$t1</span> <span class="token punctuation">}</span></code></pre></div>
<h3 id="ブロックを作成する" style="position:relative;"><a href="#%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B" aria-label="ブロックを作成する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ブロックを作成する</h3>
<p><code class="language-text">.block</code>コマンドは、コード内に新しいブロックを追加します。</p>
<p>これは、後述する Alias を変数のように使用する場合などに頻繁に使用します。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">Commands <span class="token punctuation">;</span> .block <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span> <span class="token punctuation">;</span> Commands </code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-block" target="_blank" rel="nofollow noopener noreferrer">.block (WinDbg) - Windows drivers | Microsoft Learn</a></p>
<h3 id="エイリアスを作成削除する" style="position:relative;"><a href="#%E3%82%A8%E3%82%A4%E3%83%AA%E3%82%A2%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B" aria-label="エイリアスを作成削除する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>エイリアスを作成、削除する</h3>
<p><code class="language-text">as</code>と<code class="language-text">aS</code>コマンドは、Alias の定義を行います。</p>
<p>WinDbg では、疑似レジスタと同様に、Alias を変数のように使用できます。</p>
<p>ただし、定義した Alias は現在のブロックでは機能しないため、Alias を定義した後に<code class="language-text">.block</code>コマンドで新しいブロックを作成する必要があります。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 文字列や数値を定義する</span>
as Name <span class="token number">10</span>
aS Name <span class="token string">"Test Value"</span> <span class="token punctuation">;</span> .block <span class="token punctuation">{</span> .echo Name <span class="token punctuation">}</span>

<span class="token comment"># Address からヌル終端までの ASCII 文字列を定義</span>
as /ma Name Address 

<span class="token comment"># Address からヌル終端までの Unicode 文字列を定義</span>
as /mu Name Address 

<span class="token comment"># Address から 64bit の値を定義</span>
as /x Name Expression 

<span class="token comment"># ファイル の内容と同等の値を定義</span>
aS /f Name File 

<span class="token comment"># コマンド出力の値を定義</span>
as /c Name CommandString </code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/as--as--set-alias-" target="_blank" rel="nofollow noopener noreferrer">as, aS (Set Alias) - Windows drivers | Microsoft Learn</a></p>
<h3 id="疑似レジスタを使用する" style="position:relative;"><a href="#%E7%96%91%E4%BC%BC%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B" aria-label="疑似レジスタを使用する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>疑似レジスタを使用する</h3>
<p>WinDbg では値を保持するための疑似レジスタをサポートしており、既定の疑似レジスタを通して値を参照したり、任意の疑似レジスタを登録することができます。</p>
<p>疑似レジスタは、<code class="language-text">$</code>マークを先頭に持ちます。MASM 構文を使用する場合は<code class="language-text">@</code>を付与することができます。</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 疑似レジスタの値を出力</span>
? <span class="token variable">$ip</span>
? @<span class="token variable">$ip</span>
r <span class="token variable">$ip</span>
r @<span class="token variable">$ip</span>

<span class="token comment"># 任意の疑似レジスタを定義する</span>
r <span class="token variable">$t0</span> <span class="token operator">=</span> <span class="token number">7</span>

<span class="token comment"># 疑似レジスタを使用して、任意のアドレスのポインタを poi で参照する</span>
r <span class="token variable">$t0</span> <span class="token operator">=</span> nt<span class="token operator">!</span>PsActiveProcessHead<span class="token punctuation">;</span>r <span class="token variable">$t1</span> <span class="token operator">=</span> poi<span class="token punctuation">(</span>@<span class="token variable">$t0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>r <span class="token variable">$t1</span>

<span class="token comment"># 疑似レジスタで演算を行う</span>
?? @<span class="token variable">$t0</span>+10

<span class="token comment"># r コマンドで型を指定して疑似レジスタを定義する</span>
r? <span class="token variable">$t15</span> <span class="token operator">=</span> * <span class="token punctuation">(</span>UNICODE_STRING*<span class="token punctuation">)</span> 0x12ffbc

<span class="token comment"># 現在のスレッドが ntopenfile を呼び出した場合のみ処理を停止する</span>
bp /t @<span class="token variable">$thread</span> nt<span class="token operator">!</span>ntopenfile</code></pre></div>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/pseudo-register-syntax" target="_blank" rel="nofollow noopener noreferrer">Pseudo-Register Syntax - Windows drivers | Microsoft Learn</a></p>
<p>既定で設定されている疑似レジスタは <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/pseudo-register-syntax#automatic-pseudo-registers" target="_blank" rel="nofollow noopener noreferrer">疑似レジスタ</a> にまとめられていますが、いくつかの疑似レジスタを以下に記載します。</p>
<ul>
<li>$ea：最後の命令の実効アドレス</li>
<li>$ip：命令ポインタレジスタ</li>
<li>$scopeip：現在のローカル コンテキストの命令ポインター</li>
<li>$exentry：現在のプロセスの実行可能ファイルのエントリ ポイントのアドレス</li>
<li>$thread：現在のスレッドのアドレス(カーネルデバッグの場合は ETHREAD ブロック、ユーザモードの場合は TEB のアドレス)</li>
<li>$peb：現在のプロセスの PEB のアドレス</li>
<li>$teb：現在のプロセスの TEB のアドレス</li>
</ul>
<h3 id="スクリプトサンプル" style="position:relative;"><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB" aria-label="スクリプトサンプル permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>スクリプトサンプル</h3>
<ul>
<li>カーネルデバッグ中にプロセスを列挙し、<code class="language-text">notepad.exe</code>のアドレスを取得するスクリプト。</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token variable">$$</span>  Get process list LIST_ENTRY <span class="token keyword">in</span> <span class="token variable">$t0</span><span class="token builtin class-name">.</span>
r <span class="token variable">$t0</span> <span class="token operator">=</span> nt<span class="token operator">!</span>PsActiveProcessHead

<span class="token variable">$$</span>  Iterate over all processes <span class="token keyword">in</span> list.
.for <span class="token punctuation">(</span>r <span class="token variable">$t1</span> <span class="token operator">=</span> poi<span class="token punctuation">(</span>@<span class="token variable">$t0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">(</span>@<span class="token variable">$t1</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>@<span class="token variable">$t1</span> <span class="token operator">!=</span> @<span class="token variable">$t0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      r <span class="token variable">$t1</span> <span class="token operator">=</span> poi<span class="token punctuation">(</span>@<span class="token variable">$t1</span><span class="token punctuation">))</span>
<span class="token punctuation">{</span>
    r? <span class="token variable">$t2</span> <span class="token operator">=</span> <span class="token comment">#CONTAINING_RECORD(@$t1, nt!_EPROCESS, ActiveProcessLinks);</span>
    as /x Procc @<span class="token variable">$t2</span>

    <span class="token variable">$$</span>  Get image name into <span class="token variable">$ImageName</span><span class="token builtin class-name">.</span>
    as /ma <span class="token variable">$ImageName</span> @@c++<span class="token punctuation">(</span><span class="token operator">&amp;</span>@<span class="token variable">$t2</span>-<span class="token operator">></span>ImageFileName<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    .block
    <span class="token punctuation">{</span>
	.if <span class="token punctuation">(</span><span class="token variable">$scmp</span><span class="token punctuation">(</span><span class="token string">"notepad.exe"</span>,<span class="token string">"<span class="token variable">${$ImageName}</span>"</span><span class="token punctuation">))</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> .else <span class="token punctuation">{</span>.echo <span class="token variable">${$ImageName}</span> at <span class="token variable">${Procc}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    ad <span class="token variable">$ImageName</span>
    ad Procc
<span class="token punctuation">}</span></code></pre></div>
<h2 id="解析に必要な知識" style="position:relative;"><a href="#%E8%A7%A3%E6%9E%90%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E7%9F%A5%E8%AD%98" aria-label="解析に必要な知識 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解析に必要な知識</h2>
<h3 id="32bit-と-64bit-の呼び出し規約を理解する" style="position:relative;"><a href="#32bit-%E3%81%A8-64bit-%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E8%A6%8F%E7%B4%84%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B" aria-label="32bit と 64bit の呼び出し規約を理解する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>32bit と 64bit の呼び出し規約を理解する</h3>
<p>TODO：別記事で作成予定。</p>
<h3 id="ntglobalflag" style="position:relative;"><a href="#ntglobalflag" aria-label="ntglobalflag permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NTGLOBALFLAG</h3>
<p><code class="language-text">NTGLOBALFLAG</code>は PEB に存在しており、デフォルト値は 0 ですがデバッグ時に値が設定されます。</p>
<p>32bit プロセスの場合は <code class="language-text">0x68</code>、64bit プロセスの場合は<code class="language-text">0xBC</code>のオフセットに存在しています。</p>
<p>そのため、プログラムが PEB 構造体のアドレスに対して <code class="language-text">ZwQueryInformationProcess</code> などでアクセスし、アンチデバッグの目的で使用する場合もあります。</p>
<p>参考：<a href="https://ctf-wiki.mahaloz.re/reverse/windows/anti-debug/ntglobalflag/" target="_blank" rel="nofollow noopener noreferrer">NtGlobalFlag - CTF Wiki EN</a></p>
<p>参考：<a href="https://osandamalith.com/2016/04/23/debugger-detection-using-ntglobalflag/" target="_blank" rel="nofollow noopener noreferrer">Debugger Detection Using NtGlobalFlag | 🔐Blog of Osanda</a></p>
<h3 id="exception_record" style="position:relative;"><a href="#exception_record" aria-label="exception_record permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>EXCEPTION_RECORD</h3>
<p><code class="language-text">EXCEPTION_RECORD</code>には例外やクラッシュに関する情報が含まれます。</p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-exception_record?redirectedfrom=MSDN" target="_blank" rel="nofollow noopener noreferrer">EXCEPTION_RECORD (winnt.h) - Win32 apps | Microsoft Learn</a></p>
<p><code class="language-text">ExceptionCode</code>には例外の発生理由が含まれています。</p>
<p>一般的に記録される例外の種類については上記のページに記載があります。</p>
<h3 id="eprocessethread" style="position:relative;"><a href="#eprocessethread" aria-label="eprocessethread permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>EPROCESS、ETHREAD</h3>
<p><code class="language-text">EPROCESS</code>構造体はドキュメンテーションされていない構造体ですが、システムプロセスを記述するカーネルメモリ構造体であり、<code class="language-text">nt!_EPROCESS</code>としてアクセスできることが知られています。</p>
<p>この構造体は、双方向連結リスト(<code class="language-text">LIST_ENTRY</code>)<code class="language-text">ActiveProcessLinks</code>によって連結されており、<code class="language-text">cmd /c tasklist</code>コマンドなどが実行された場合には、このリストをたどって<code class="language-text">EPROCESS</code>構造体が探索されることで、プロセスの一覧として出力されます。</p>
<p>そのため、WinDbg 上でもカーネルデバッガでこのリストをたどることで、アクティブなプロセスを探索することができます。</p>
<p>一方で、マルウェアなどがカーネルメモリにアクセスできる場合には、<code class="language-text">ActiveProcessLinks</code>のポインタを付け替えることで、プロセス一覧に悪意のあるプロセスが表示されないように隠ぺいを行う場合があります。</p>
<p>参考：<a href="https://www.nirsoft.net/kernel_struct/vista/EPROCESS.html" target="_blank" rel="nofollow noopener noreferrer">struct EPROCESS</a></p>
<p>参考：<a href="https://www.nirsoft.net/kernel_struct/vista/ETHREAD.html" target="_blank" rel="nofollow noopener noreferrer">struct ETHREAD</a></p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/eprocess" target="_blank" rel="nofollow noopener noreferrer">Windows kernel opaque structures - Windows drivers | Microsoft Learn</a></p>
<p>参考：<a href="https://www.ired.team/miscellaneous-reversing-forensics/windows-kernel-internals/manipulating-activeprocesslinks-to-unlink-processes-in-userland" target="_blank" rel="nofollow noopener noreferrer">Manipulating ActiveProcessLinks to Hide Processes in Userland - Red Team Notes</a></p>
<h3 id="sysenter-命令" style="position:relative;"><a href="#sysenter-%E5%91%BD%E4%BB%A4" aria-label="sysenter 命令 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>sysenter 命令</h3>
<p>TODO：追記</p>
<p>参考：<a href="https://wiki.osdev.org/SYSENTER" target="_blank" rel="nofollow noopener noreferrer">SYSENTER - OSDev Wiki</a></p>
<h2 id="環境設定" style="position:relative;"><a href="#%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A" aria-label="環境設定 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>環境設定</h2>
<h3 id="visual-studio-のリンカ設定を変更する" style="position:relative;"><a href="#visual-studio-%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AB%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B" aria-label="visual studio のリンカ設定を変更する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Visual Studio のリンカ設定を変更する</h3>
<p>最新の Visual Studio のデフォルト設定では、エクスポートテーブルがシンボルファイルに含まれません。</p>
<p>そのため、プロジェクトの設定から、以下のように<code class="language-text">/DEBUG:FULL</code>の構成を設定します。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 897px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/17c37100f84508e3d99da94643445558/3a737/image-20230401113053380.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 61.24999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACA0lEQVQoz5VT227TQBD1//8AVAhekCp4QDwBago8IFFqSKImTezE8XV9t3OxHSeRwM5hZlNHog+VGOlodjWzZ+fMziq2bSOOY3iehyiKkec5qvUJW0K9OWGTJzKP48vl8uwZQRAgyzIMBgMopmnCtCwwMQf8MMbVnY8PQx/vfgq8vfXwRhV4r1rQ9BkWlO+4LhUg6JxNaw/TqSaLuVVVKFEUwaWEerdDVZVEmOD7LMXXscDHoYfraYYbccBAbCEcC4FrI40C7LcFSlZQrAhrsBkzDUqSpCQlkRJWqxVCumlXFsgiH82hRmdVvcezqwleftHx/FrHxec5Ln8IXKoRXt8IvFBXePXpFxTWniQJyrJERYiIvCi3iOmiTVHhT3vE8QjUh98Yu0voYSn9nZPDSGuY+YH8Dvamwbf+PRTfjxCQTMv2SHqANE3x2I7M+KSd4o5lcg8TehAPhmFRpVxteibp0O1bqrbtfLcmNE176qFhQOG+5XkG01xI6Sm1gK1t239InwLnngm7Hi4WJ8LsgfB/rFPBHAqT+ELI0eGX5uHtsKNRYtR1ffYdeL/f7yV43zQNzeMUShiG8pe4NKBVVclH4dJ1XZekHPd9X3rHcWSu93B5URRYr9cSTDoej6FMJhNZKpOw5x8jDxGY4DFYyXw+x2g0gqZp6Pf7YI7hcIher4e/+6x+teeBCeQAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/17c37100f84508e3d99da94643445558/8ac56/image-20230401113053380.webp 240w,
/static/17c37100f84508e3d99da94643445558/d3be9/image-20230401113053380.webp 480w,
/static/17c37100f84508e3d99da94643445558/10735/image-20230401113053380.webp 897w"
              sizes="(max-width: 897px) 100vw, 897px"
              type="image/webp"
            />
          <source
            srcset="/static/17c37100f84508e3d99da94643445558/8ff5a/image-20230401113053380.png 240w,
/static/17c37100f84508e3d99da94643445558/e85cb/image-20230401113053380.png 480w,
/static/17c37100f84508e3d99da94643445558/3a737/image-20230401113053380.png 897w"
            sizes="(max-width: 897px) 100vw, 897px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/17c37100f84508e3d99da94643445558/3a737/image-20230401113053380.png"
            alt="image-20230401113053380"
            title="image-20230401113053380"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h3 id="release-ビルド時の最適化を無効化する" style="position:relative;"><a href="#release-%E3%83%93%E3%83%AB%E3%83%89%E6%99%82%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96%E3%82%92%E7%84%A1%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B" aria-label="release ビルド時の最適化を無効化する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Release ビルド時の最適化を無効化する</h3>
<p>WinDbg の検証目的でプログラムをビルドする場合は、Release ビルド時の最適化設定を無効化しておくと良い場合があります。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 783px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4f1e8aa569235a94d4368c2cca556318/e51a6/image-20230401221935008.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgklEQVQoz32RzWrbQBRG9eSF0kUeIBBCF912V9qGPkAhNUmgjRMrrSTrz/ZIo//Ikq1iGftkNK5LC2kvfDAwd86cO2OEYYjn+9i2jRCCKIqYLyLu3QW3U6Hz1Z4zmnh8uzOZ+S55KsmSmCJNkGKO59gsQp9IrY08z7EsiziWrNdrMtUUypI3l4IX7ya8urA4+5Jxepnz4cphbPl4aYOv4sqaafz4KzWmkjDadqXNpJR0XafAMUlaEAbK+sd3As8F9gx1ceNy8vGBk082L98/cPo55vVVyfko52xU8PZaYCyXS9I01aDVavUbKESkzG2CcMb+wMOdOkzuxpj3Y1w1ZlM/qrt2HGvzs8OI4kwdirm+uSWcSaZuQFXVavyONMvI80IBD8S2bSnKkqZpKctKZ+jr+y39dqv3jbquVUODYzuUVaU/ZbD+qxTwCH2ujnt93x9Gblv1yL5HkiQEQaCAjW7Y7Xa6ef/HwX9Fj7zZDIZLrWqaJr6CDW94NPyf1XOGA/AJBvFVy7h7xugAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/4f1e8aa569235a94d4368c2cca556318/8ac56/image-20230401221935008.webp 240w,
/static/4f1e8aa569235a94d4368c2cca556318/d3be9/image-20230401221935008.webp 480w,
/static/4f1e8aa569235a94d4368c2cca556318/b408c/image-20230401221935008.webp 783w"
              sizes="(max-width: 783px) 100vw, 783px"
              type="image/webp"
            />
          <source
            srcset="/static/4f1e8aa569235a94d4368c2cca556318/8ff5a/image-20230401221935008.png 240w,
/static/4f1e8aa569235a94d4368c2cca556318/e85cb/image-20230401221935008.png 480w,
/static/4f1e8aa569235a94d4368c2cca556318/e51a6/image-20230401221935008.png 783w"
            sizes="(max-width: 783px) 100vw, 783px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/4f1e8aa569235a94d4368c2cca556318/e51a6/image-20230401221935008.png"
            alt="image-20230401221935008"
            title="image-20230401221935008"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>なお、Debug ビルドはデフォルトで最適化が無効化されています。</p>
<h2 id="その他の-tips" style="position:relative;"><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE-tips" aria-label="その他の tips permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>その他の Tips</h2>
<h3 id="windbgx86-と-windbgx64-どちらを使用すべきですか" style="position:relative;"><a href="#windbgx86-%E3%81%A8-windbgx64-%E3%81%A9%E3%81%A1%E3%82%89%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%81%B9%E3%81%8D%E3%81%A7%E3%81%99%E3%81%8B" aria-label="windbgx86 と windbgx64 どちらを使用すべきですか permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WinDbg(X86) と WinDbg(X64) どちらを使用すべきですか？</h3>
<p>基本的には、64bit アプリケーションのデバッグやダンプ解析を行う場合には WinDbg(X64) を使用し、32 bit アプリケーションの場合は WinDbg(X86) を使用します。</p>
<p>WinDbg(X64) は 64bit と 32bit どちらのアプリケーションも解析することができますが、WinDbg(X64) で 32bit アプリケーションを解析する場合には WOW64 レイヤーが追加される影響で、とくにダンプの解析を行う場合に解析を困難にする問題を引き起こす可能性があります。</p>
<p>なお、<code class="language-text">.effmach x86</code>コマンドを使用することで問題を回避できる場合もありますが、WinDbg(X86) を使用する場合とイコールではないため、可能な限り WinDbg(X86) を使用する方が良いです。</p>
<p>参考：<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/-effmach--effective-machine-" target="_blank" rel="nofollow noopener noreferrer">.effmach (Effective Machine) - Windows drivers | Microsoft Learn</a></p>
<h3 id="windbgclassic-でダークテーマを使用する" style="position:relative;"><a href="#windbgclassic-%E3%81%A7%E3%83%80%E3%83%BC%E3%82%AF%E3%83%86%E3%83%BC%E3%83%9E%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B" aria-label="windbgclassic でダークテーマを使用する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WinDbg(Classic) でダークテーマを使用する</h3>
<p>僕が普段使用しているテーマは以下から取得できます。</p>
<p>参考：<a href="https://github.com/kash1064/WinDbg-Classic-Dark" target="_blank" rel="nofollow noopener noreferrer">kash1064/WinDbg-Classic-Dark: The Dark theme of WinDbg Classic</a></p>
<p>見た目としては以下のような感じで、できるだけ色の種類を減らしてシンプルにしつつ、使い慣れた VSCode のダークテーマに近い配色を目指してカスタマイズしています。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/07f9d0c5f8b40c4a9f60b6c8cea2cd0d/e2d85/main-windows.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBAH/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABwSjYVhN4XoP/xAAcEAACAQUBAAAAAAAAAAAAAAABAgADERITFAT/2gAIAQEAAQUCNR5tqY7asxDEpZQog8yCcyW5Un//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAeEAADAAEEAwAAAAAAAAAAAAAAAQIxESEiMiMzof/aAAgBAQAGPwLuxc2d2aK5F5IPbP0e9GaM0f/EACAQAAIBAgcBAAAAAAAAAAAAAAABEUFRITFhkaGx4dH/2gAIAQEAAT8hxfeNUeXfUVbfE4AUq1cngPglFC6Jo1LoXuI//9oADAMBAAIAAwAAABCj/wAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRABAAIBBQEAAAAAAAAAAAAAAQARIUFRYYHwkf/aAAgBAQABPxAZTpcTCql35Rw2W4tDMtqhRykFiFli53eg7wI58wIBco8EpFUJ6DiAPR8n/9k='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/07f9d0c5f8b40c4a9f60b6c8cea2cd0d/8ac56/main-windows.webp 240w,
/static/07f9d0c5f8b40c4a9f60b6c8cea2cd0d/d3be9/main-windows.webp 480w,
/static/07f9d0c5f8b40c4a9f60b6c8cea2cd0d/e46b2/main-windows.webp 960w,
/static/07f9d0c5f8b40c4a9f60b6c8cea2cd0d/6970a/main-windows.webp 1411w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/07f9d0c5f8b40c4a9f60b6c8cea2cd0d/09b79/main-windows.jpg 240w,
/static/07f9d0c5f8b40c4a9f60b6c8cea2cd0d/7cc5e/main-windows.jpg 480w,
/static/07f9d0c5f8b40c4a9f60b6c8cea2cd0d/6a068/main-windows.jpg 960w,
/static/07f9d0c5f8b40c4a9f60b6c8cea2cd0d/e2d85/main-windows.jpg 1411w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/jpeg"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/07f9d0c5f8b40c4a9f60b6c8cea2cd0d/6a068/main-windows.jpg"
            alt="img"
            title="img"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Apr 7, 2023</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/win-dbg/">WinDbg</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/reversing/">Reversing</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたいCTF Player(Team: 0nePadding)。WinDbgとYARAが好き。OSCP / AtCoder 緑 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/kash1064" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/windbg-basics-001";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-313d4424c06143b3718b.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-3b717b72ea029a6e4b57.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-2b4689a538854e3bb9d2.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-accd878b5e1f1e62fa29.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-c6590832582353cfb9b4.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-8a92a19d41f993038be9.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-c2f05dc74373de400085.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-313d4424c06143b3718b.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-c30b476365ba6fe21041.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-4718dad6a25a617d234f.js" async=""></script></body></html>